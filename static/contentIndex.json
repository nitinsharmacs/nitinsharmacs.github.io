{"blogs/tech/docker/docker-compose-todo-app":{"title":"Docker Compose Todo App","links":["blogs/tech/docker/docker-compose"],"tags":["docker-compose","compose","microservices","networks"],"content":"Greetings, esteemed readers! It is an absolute pleasure to see you all here. I trust that each one of you is in the pink of health and high spirits. In this post, we are going to containerize our todo application using docker compose. If you want to learn about docker compose, refer my post on Docker Compose. Let’s hit the road!\nWhat is there to Cover?\nWe will be covering the following sections here.\n\nSetting up the project\nCreate Dockerfile for the backend\nCreate Dockerfile for the frontend\nCreate a docker compose\nSpin up the compose\nAn introduction to deploys\nConclusion\n\nLet’s follow through with each one of these sections.\nSetting up the application\nPrerequisites\n\nnode\nnpm\nmysql\nand docker of course\n\nCreate your sandbox directory where you would be writing the code. Clone the following project in your sandbox.\n# ssh\n⟩ git clone git@github.com:nitinsharmacs/bitphile-todo-app-docker-compose.git\n \n# https\n⟩ git clone github.com/nitinsharmacs/bitphile-todo-app-docker-compose.git\nListing down the contents of the project, we will see.\n⟩ tree                                                                   (base)\n.\n├── README.md\n├── backend\n│   ├── README.md\n│   ├── index.js\n│   ├── package-lock.json\n│   └── package.json\n└── frontend\n    ├── README.md\n    ├── package-lock.json\n    ├── package.json\n    ├── public\n    │   ├── favicon.ico\n    │   ├── index.html\n    │   ├── logo192.png\n    │   ├── logo512.png\n    │   ├── manifest.json\n    │   └── robots.txt\n    └── src\n        ├── App.css\n        ├── App.js\n        ├── App.test.js\n        ├── components\n        │   ├── CreateTodo.jsx\n        │   ├── Header.jsx\n        │   └── TodoItems.jsx\n        ├── index.css\n        ├── index.js\n        ├── logo.svg\n        ├── reportWebVitals.js\n        └── setupTests.js\n \n5 directories, 25 files\nInstall dependencies in each of those directories.\n⟩ cd frontend\n⟩ npm install\n⟩ cd ../backend\n⟩ npm install\nNow, start both the backend and frontend.\nfrontend\n⟩ npm start\n \nbackend\n⟩ npm start\n\nFacing issues with MySQL db? Please make sure it is running. Also, provide environment variables, DB_USER and DB_PASSWORD while running the backend.\n\nOpen localhost:3000, and you should see an ugly page without CSS. Let’s not worry about the styling of the page.\n\nYou should be able to add a to-do.\nCreate Dockerfile for the backend\nLet’s write Dockerfile for the backend.\nFROM node:12-alpine\n \nCOPY package.json package.json\n \nRUN npm install\n \nENV NODE_ENV=production\n \nCOPY index.js index.js\n \nCMD [&quot;npm&quot;, &quot;start&quot;]\n \nEXPOSE 3001\nCopy and paste this content inside backend/Dockerfile.\nNow, build the image.\n⟩ docker build -t bitphile/todo-backend .\nLet’s try running the image we’ve just built.\n⟩ docker run -d --name todo-backend -p 3001:3001 bitphile/todo-backend\n68dc2b21f5e2b8a6d54c35dc46a56f6d0e117793a2a7c1e80dab42ae91826f93\nSeeing the logs of the container,\n⟩ docker logs -f 68dc2b21f5e2b8a6d54c35dc46a56f6d0e117793a2a7c1e80dab42ae91826f93\n \n&gt; backend@1.0.0 start /\n&gt; node .\n \n(node:18) UnhandledPromiseRejectionWarning: Error: getaddrinfo EAI_AGAIN mysql-server\n    at Object.createConnection (/node_modules/mysql2/promise.js:242:31)\n    at Object.&lt;anonymous&gt; (/index.js:54:4)\n    at Module._compile (internal/modules/cjs/loader.js:999:30)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1027:10)\n    at Module.load (internal/modules/cjs/loader.js:863:32)\n    at Function.Module._load (internal/modules/cjs/loader.js:708:14)\n    at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:60:12)\n    at internal/main/run_main_module.js:17:47\n(node:18) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). To terminate the node process on unhandled promise rejection, use the CLI flag `--unhandled-rejections=strict` (see nodejs.org/api/cli.html#cli_unhandled_rejections_mode). (rejection id: 1)\n(node:18) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.\n \n🤯 We are bombarded with an error. If we see it, it is crying because of the MySQL connection. Our container is not able to connect to the MySQL server. And this is straightforward as no MySQL container is running in the network. We will look at it later when we compose our application. For now, let’s move ahead.\nCreate Dockerfile for frontend\nCopy the following Dockerfile content inside frontend/Dockerfile\nFROM node:12-alpine AS builder\n \nWORKDIR /app\n \nCOPY package.json package.json\n \nRUN npm install\n \nCOPY . .\n \nRUN npm run build\n \nFROM nginx:alpine\n \nWORKDIR /usr/share/nginx/html\n \nRUN rm -rf ./*\n \nCOPY --from=builder /app/build .\n \nENTRYPOINT [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]\n\nOption daemon off specifies nginx to run in the foreground so that the container will continue running. If we don’t specify this option, the nginx service would run in the background and the container will stop running as there is nothing to hold it up.\n\nLet’s build the image.\n⟩ docker build -t bitphile/todo-frontend .                               (base)\nSending build context to Docker daemon  478.7kB\nStep 1/11 : FROM node:12-alpine AS builder\n ---&gt; bb6d28039b8c\nStep 2/11 : WORKDIR /app\n ---&gt; Using cache\n ---&gt; 8610e0568d30\nStep 3/11 : COPY package.json package.json\n ---&gt; 2cf4f42b3f97\nStep 4/11 : RUN npm install\n ---&gt; Running in 0606b5b332ec\nperformance.now() and performance.timeOrigin.\n \n&gt; core-js@3.29.1 postinstall /app/node_modules/core-js\n&gt; node -e &quot;try{require(&#039;./postinstall&#039;)}catch(e){}&quot;\n \nThank you for using core-js ( github.com/zloirock/core-js ) for polyfilling JavaScript standard library!\n \nThe project needs your help! Please consider supporting of core-js:\n&gt; opencollective.com/core-js\n&gt; patreon.com/zloirock\n&gt; boosty.to/zloirock\n&gt; bitcoin: bc1qlea7544qtsmj2rayg0lthvza9fau63ux0fstcz\n \nI highly recommend reading this: github.com/zloirock/core-js/blob/master/docs/2023-02-14-so-whats-next.md\n \n \n&gt; core-js-pure@3.29.1 postinstall /app/node_modules/core-js-pure\n&gt; node -e &quot;try{require(&#039;./postinstall&#039;)}catch(e){}&quot;\n \nThank you for using core-js ( github.com/zloirock/core-js ) for polyfilling JavaScript standard library!\n \nThe project needs your help! Please consider supporting of core-js:\n&gt; opencollective.com/core-js\n&gt; patreon.com/zloirock\n&gt; boosty.to/zloirock\n&gt; bitcoin: bc1qlea7544qtsmj2rayg0lthvza9fau63ux0fstcz\n \nI highly recommend reading this: github.com/zloirock/core-js/blob/master/docs/2023-02-14-so-whats-next.md\n \nadded 1489 packages from 684 contributors and audited 1490 packages in 69.985s\n \n233 packages are looking for funding\n  run `npm fund` for details\n \nfound 1 high severity vulnerability\n  run `npm audit fix` to fix them, or `npm audit` for details\nRemoving intermediate container 0606b5b332ec\n ---&gt; e84821d3c273\nStep 5/11 : COPY . .\n ---&gt; 2582c9e1ccf7\nStep 6/11 : RUN npm run build\n ---&gt; Running in 24a2880afcea\n \n&gt; todo-app@0.1.0 build /app\n&gt; react-scripts build\n \nCreating an optimized production build...\nCompiled successfully.\n \nFile sizes after gzip:\n \n  47.56 kB  build/static/js/main.bf9caf07.js\n  1.78 kB   build/static/js/787.2843ca88.chunk.js\n  264 B     build/static/css/main.e6c13ad2.css\n \nThe project was built assuming it is hosted at /.\nYou can control this with the homepage field in your package.json.\n \nThe build folder is ready to be deployed.\nYou may serve it with a static server:\n \n  npm install -g serve\n  serve -s build\n \nFind out more about deployment here:\n \n  cra.link/deployment\n \nRemoving intermediate container 24a2880afcea\n ---&gt; ca6123013213\nStep 7/11 : FROM nginx:alpine\n ---&gt; 2bc7edbc3cf2\nStep 8/11 : WORKDIR /usr/share/nginx/html\n ---&gt; Using cache\n ---&gt; 14150ff7fb4b\nStep 9/11 : RUN rm -rf ./*\n ---&gt; Using cache\n ---&gt; dec51b86101d\nStep 10/11 : COPY --from=builder /app/build .\n ---&gt; bfc76e5e13ec\nStep 11/11 : ENTRYPOINT [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]\n ---&gt; Running in c01fb95e9ca3\nRemoving intermediate container c01fb95e9ca3\n ---&gt; 9ad959056d7a\nSuccessfully built 9ad959056d7a\nSuccessfully tagged bitphile/todo-frontend:latest\n \nLet’s run the image.\n⟩ docker run -d --name todo-frontend -p 4000:80 bitphile/todo-frontend\nNow, if we open http://localhost:4000, we should the to-do page.\nCreate Docker Compose file\nIt is time to take the whole picture of our application. To run our application with all those services, we have to create a docker-compose.yml file. Let’s do create one.\nversion: &#039;3.7&#039;\nname: todo-app\n \nservices:\n  todo-frontend:\n    container_name: todo-frontend\n    build: ./frontend\n    ports:\n      - 4000:80\n    networks:\n      - todo-app\n    depends_on:\n      - todo-backend\n \n  todo-backend:\n    container_name: todo-server\n    build: ./backend\n    ports:\n      - 3001:3001\n    networks:\n      - todo-app\n    environment:\n      - NODE_ENV=production\n      - DB_USER=root\n      - DB_PASSWORD=password\n    depends_on:\n      - mysql\n \n  mysql:\n    container_name: mysql-server\n    image: mysql:5.7\n    volumes:\n      - ./mysql:/var/lib/mysql\n    environment:\n      MYSQL_ROOT_PASSWORD: password\n      MYSQL_DATABASE: todo_app\n    networks:\n      - todo-app\n \nnetworks:\n  todo-app:\n \nLet’s do compose up,\n⟩ docker compose up -d                                                   (base)\n[+] Building 83.3s (22/22) FINISHED\n =&gt; [todo-app_todo-frontend internal] load build definition from Dockerfi  0.0s\n =&gt; =&gt; transferring dockerfile: 305B                                       0.0s\n =&gt; [todo-app_todo-backend internal] load build definition from Dockerfil  0.0s\n =&gt; =&gt; transferring dockerfile: 191B                                       0.0s\n =&gt; [todo-app_todo-frontend internal] load .dockerignore                   0.0s\n =&gt; =&gt; transferring context: 61B                                           0.0s\n =&gt; [todo-app_todo-backend internal] load .dockerignore                    0.0s\n =&gt; =&gt; transferring context: 60B                                           0.0s\n =&gt; [todo-app_todo-frontend internal] load metadata for docker.io/library  0.0s\n =&gt; [todo-app_todo-backend internal] load metadata for docker.io/library/  0.0s\n =&gt; CACHED [todo-app_todo-frontend builder 1/6] FROM docker.io/library/no  0.0s\n =&gt; [todo-app_todo-frontend stage-1 1/4] FROM docker.io/library/nginx:alp  0.0s\n =&gt; [todo-app_todo-frontend internal] load build context                   0.0s\n =&gt; =&gt; transferring context: 458.37kB                                      0.0s\n =&gt; CACHED [todo-app_todo-frontend stage-1 2/4] WORKDIR /usr/share/nginx/  0.0s\n =&gt; [todo-app_todo-frontend stage-1 3/4] RUN rm -rf ./*                    0.5s\n =&gt; CACHED [todo-app_todo-frontend builder 2/6] WORKDIR /app               0.0s\n =&gt; [todo-app_todo-frontend builder 3/6] COPY package.json package.json    0.0s\n =&gt; [todo-app_todo-backend internal] load build context                    0.0s\n =&gt; =&gt; transferring context: 1.60kB                                        0.0s\n =&gt; [todo-app_todo-backend 2/4] COPY package.json package.json             0.0s\n =&gt; [todo-app_todo-frontend builder 4/6] RUN npm install                  69.0s\n =&gt; [todo-app_todo-backend 3/4] RUN npm install                            5.9s\n =&gt; [todo-app_todo-backend 4/4] COPY index.js index.js                     0.0s\n =&gt; [todo-app_todo-frontend] exporting to image                            0.2s\n =&gt; =&gt; exporting layers                                                    0.0s\n =&gt; =&gt; writing image sha256:c30480a00b3ca5464f566693178dd5ae117d60a3a62e5  0.0s\n =&gt; =&gt; naming to docker.io/library/todo-app_todo-backend                   0.0s\n =&gt; =&gt; writing image sha256:28501b3d67ba977a812cfc9e21e91279e52765dc1276a  0.0s\n =&gt; =&gt; naming to docker.io/library/todo-app_todo-frontend                  0.0s\n =&gt; [todo-app_todo-frontend builder 5/6] COPY . .                          0.0s\n =&gt; [todo-app_todo-frontend builder 6/6] RUN npm run build                13.5s\n =&gt; [todo-app_todo-frontend stage-1 4/4] COPY --from=builder /app/build .  0.0s\n[+] Running 4/4\n ⠿ Network todo-app_todo-app  Created                                      0.0s\n ⠿ Container mysql-server     Started                                      0.7s\n ⠿ Container todo-server      Started                                      1.1s\n ⠿ Container todo-frontend    Started                                      1.6s\n \nGreat! Containers seemed to be started. Let’s see,\n⟩ docker compose ps -a                                                   (base)\nNAME                COMMAND                  SERVICE             STATUS              PORTS\nmysql-server        &quot;docker-entrypoint.s…&quot;   mysql               running             3306/tcp, 33060/tcp\ntodo-frontend       &quot;nginx -g &#039;daemon of…&quot;   todo-frontend       running             0.0.0.0:4000-&gt;80/tcp\ntodo-server         &quot;docker-entrypoint.s…&quot;   todo-backend        running             0.0.0.0:3001-&gt;3001/tcp, 3001/tcp\n \nNow, open http://localhost:4000 and add todos.\nAn introduction to deploys\nWe can create multiple containers for the same service using deploy in docker compose.\nversion: &#039;3.7&#039;\nname: todo-app\n \nservices:\n  todo-frontend:\n    container_name: todo-frontend\n    build: ./frontend\n    ports:\n      - 4000:80\n    networks:\n      - todo-app\n    depends_on:\n      - todo-backend\n \n  todo-backend:\n    container_name: todo-server\n    build: ./backend\n    ports:\n      - 3000:3000\n    networks:\n      - todo-app\n    environment:\n      - NODE_ENV=production\n      - DB_USER=root\n      - DB_PASSWORD=password\n    depends_on:\n      - mysql\n    deploy:\n\t    mode: replicated\n\t    replicas: 2\n \n  mysql:\n    container_name: mysql-server\n    image: mysql:5.7\n    volumes:\n      - ./mysql:/var/lib/mysql\n    environment:\n      MYSQL_ROOT_PASSWORD: password\n      MYSQL_DATABASE: todo_app\n    networks:\n      - todo-app\n \nnetworks:\n  todo-app:\nSo, this would create two replicas of the service todo-backend. The routing of which container the request should be sent to would be taken care of by the docker itself.\nRestart policy\nIf the container dies unexpectedly, docker compose can restart the container. Docker compose provides a restart policy for the same that we can define in docker compose file.\nversion: &#039;3.7&#039;\nname: todo-app\n \nservices:\n  todo-backend:\n    container_name: todo-server\n    build: ./backend\n    ports:\n      - 3001:3001\n    networks:\n      - todo-app\n    environment:\n      - NODE_ENV=production\n      - DB_USER=root\n      - DB_PASSWORD=password\n    depends_on:\n      - mysql\n    deploy:\n\t    mode: replicated\n\t    replicas: 2\n\t    restart_policy:\n\t\t    condition: any\n\t\t    delay: 5s\n\t\t    max_attempts: 2\n\t\t    window: 80s\ncondition means the condition to restart the service. delay is the delay in subsequent restart tries and window means how long to wait to decide if the restart is done.\nConclusion\nWell, this is it for now. I hope you find this useful. If there is any problem while setting up the project and running that up, please drop a comment. Please share your feedback and what our next junction topic should be, in the comment section.\nUntil then,\n\nReferences\n\nDocker Compose file reference\n"},"blogs/tech/docker/docker-compose":{"title":"Introduction to Docker Compose","links":["blogs/tech/docker/docker-networking"],"tags":["docker","docker-compose","compose","services","management","orchestration"],"content":"Hello people! Good to see you here. Today we would be learning about docker compose, what is it, why we need it, and its examples. Let’s begin.\nAgenda\n\nCurrent Scenario\nWhat is docker-compose?\nHow does docker compose change the current scenario?\nDefining Services\nVolume and Bind mounts\nNetworking\nEnvironment Variables\nConclusion\n\nCurrent Scenario\nA single application comprises containers for different services responsible for their respective tasks. For example, a backend service, a database service to manage data, a frontend for the app, and so on. All of these services need to be in the same network to communicate with each other. I have explained docker networking in my post Docker Networking.\nManaging all these services and different constituents such as networking, volumes, bind mounts, etc becomes an arduous task.\n\nThe following points summarise the problems in the current scenario:\n\nNetworking. We have to explicitly create and manage networks. We have to be sure that a particular container is connected to a particular network.\nVolumes and bind mounts. There is no centralized way to know what all volumes are connected to all services of an application.\nContainer lifecycle. If any container stops, it becomes our responsibility to restart the container.\n\nThese are some of the major problems. Setting up a multi-container application comprises multiple commands. For example,\n# for running database container\ndocker run -d --name database --network bitphile images/mysql\n \n# for running frontend\ndocker run -d --name frontend -p 3001:3001 --network bitphile bitphile/frontend\n \n# for running backend\ndocker run -d --name backend --network bitphile -mount type=volume,source=bitphile,target=/vol bitphile/backend\nThis is just for a small multi-container application comprising three services. Think about if the application is composing several services.\nDocker Compose\nDocker compose is a tool that helps in defining and running multi-container applications. It enables us to define each container as a service, its interactions with other services, and some other configurations.\nHow does it help to tackle the current Scenario?\nLet’s see each of the points mentioned in the problem statement and scrutinize how docker compose helps in there.\nNetworking\nServices defined inside a docker compose for a particular application are by default in a network for that project. When the docker compose is up, all those services are in a project namespace network.\nSo, there is no need to worry if the frontend sends a request to the backend. Moreover, the networking properties still apply here. A container can be referenced with its name for sending a request instead of its IP address.\nWe will this into action shortly in a subsequent section.\nVolumes and bind mounts\nWe can define volumes and bind mounts for services inside the docker compose definition file. We can specify to delete the volumes when doing compose down.\nContainers Life Cycle\nDocker compose acts like an orchestrator which manages the life cycle of containers. Though it is not much effective for small applications it suffices. It provides ways to specify restart the container if it dies.\nIt becomes very easy to create, run and stop services by using docker compose.\nWhole application picture in a single place\nUsing docker compose, the application becomes fathomable. By seeing the docker compose file itself we can identify what is happening. What all services are there, what is the networking structure, what volumes are in use, etc.\nWell, it is all about theory. Let’s see docker compose in action.\nDefining services\nWe are required to create a docker compose file named docker-compose.yml (you can give any other name but have to specify explicitly in the command, we will see shortly).\nA minimal docker compose file looks like following\nversion: &#039;3.7&#039;\nname: bitphile\n \nservices:\n  todo-backend:\n    container_name: todo-backend\n    image: bitphile/todo-backend\n \nExplanation\n\nversion defines the version of Compose file. It is required to identify the schema used for the docker compose file.\nname is the name of the project. If it is omitted, the project directory name is assigned to name.\nservices defines what all containers the compose comprises. Each item is the name of the service.\n\nBuilding image\nThere are two ways we can define service.\n\nSpecifying how docker can build an image by giving build property.\nDirectly giving the image.\n\nversion: &#039;3.7&#039;\nname: bitphile\n \nservices:\n  todo-backend:\n    container_name: todo-backend\n    build:\n\t    dockerfile: Dockerfile\n\t\tcontext: .\n \nThis builds the image and spins up the container.\nDirectly using image\nversion: &#039;3.7&#039;\nname: bitphile\n \nservices:\n  todo-backend:\n    container_name: todo-backend\n    image: node-alpine\nThis will lead to pulling off the image and then spinning up the container.\nVolume and Bind mounts\nIt is fairly simple to mount a volume in docker compose. There are following ways a docker volume can be mounted.\nLet docker create volume for you\nversion: &#039;3.7&#039;\nname: bitphile\n \nservices:\n  todo-backend:\n    container_name: todo-backend\n    image: bitphile/todo-backend\n    volumes:\n\t    - /app/volume\n \nNow, if we spin up the compose\n⟩ docker compose up -d\nand listing down the volumes, we get\n⟩ docker volume ls                                                           \nDRIVER    VOLUME NAME\nlocal     a98a19a6d84da93031cb6a331993d2a49bfde5689594a413caddefe4a84d4aef\nSo, docker itself created a volume for you.\nNamed Volume\nWe can name our volume by explicitly specifying volumes section in compose file.\nversion: &#039;3.7&#039;\nname: bitphile\n \nservices:\n  todo-backend:\n    container_name: todo-backend\n    image: bitphile/todo-backend\n    volumes:\n\t    - bitphile:/app/volume\n \n \nvolumes:\n\tbitphile:\n\t\tdriver: local\nvolumes can have more properties. You can check those out on the official docs of docker (I have mentioned them in the references section).\nBind a host path\nWe can bind a host path as follows\nversion: &#039;3.7&#039;\nname: bitphile\n \nservices:\n  todo-backend:\n    container_name: todo-backend\n    image: bitphile/todo-backend\n    volumes:\n\t    - ./host/path:/app/host\n \n\nNote: The structure of the volumes item is, [source:]target[:mode] where mode can be ro (read only) and rw (read and write).\n\nNetworking\nDocker compose by default creates a default network where all the defined services reside. However, we can explicitly create a network and define the services.\nversion: &#039;3.7&#039;\nname: bitphile\n \nservices:\n  todo-backend:\n    container_name: todo-backend\n    image: bitphile/todo-backend\n    network:\n\t    - bitphile\n \nnetworks:\n\tbitphile:\n\t\tdriver: bridge\nWe don’t need to mention driver properties. Docker uses it as default. Just to mention that we can specify more properties, I have specified this property.\nEnvironment Variables\nYou must be already aware of environment variables and their use cases. We can use environment variables in docker compose in the following ways.\nPassing to services\n\nUsing environment\nUsing env_file\n\nEnvironment variables\nversion: &#039;3.7&#039;\nname: bitphile\n \nservices:\n  todo-backend:\n    container_name: todo-backend\n    image: bitphile/todo-backend\n    environment:\n\t    - NODE_ENV=production\nEnvironment file\nversion: &#039;3.7&#039;\nname: bitphile\n \nservices:\n  todo-backend:\n    container_name: todo-backend\n    image: bitphile/todo-backend\n    env_file: \n     - .env-file\nPopulating Environment variables in compose file\n\nPassing environment file through docker compose command\nUsing .env file\n\nPassing through CLI\nDocker provides --env-file flag to specify the environment file to use.\n⟩ docker compose --env-file .env-file up\nUsing .env\nWe don’t need to specify this file. Docker takes it by default.\nConclusion\nSo, docker compose is a powerful tool helping in creating and managing multi containers applications. It provides several features and options which can’t be covered in this post. If you are interested in deep diving into those features, I would recommend you to go through the official docs. For simple uses, I don’t think you would have to rummage through all those options.\nSo, this is it for now. We have reached our junction and our train has to take a halt. Let’s continue our journey on the next green light with some other interesting topic.\nPlease provide your valuable feedback about what you liked, what has to improve, and what topic should be there for our next junction.\nUntil then,\n\nReferences\n\nDocker compose overview\nDocker CLI reference\nDocker compose file\n"},"blogs/tech/docker/docker-image-layers":{"title":"Docker Image Layers","links":["blogs/tech/docker/getting-started-with-docker","blogs/tech/docker/docker-storage-driver"],"tags":["docker","infra","kubernetes","docker-image","image-layers","image"],"content":"Deep dive into Docker Image Layers\nIn my previous post Getting started with docker, I explained the basics of docker. In this post, we will be deep diving into docker image layers. We will be covering the following topics in this post,\n\nWhat are docker image layers?\nWhy does knowing docker image layers matter?\nWhere do these intermediary images reside and how to see them?\nWhat are the constituents of a docker container size?\n\nAre you ready? Yes! So let’s start…\nWhat are docker image layers?\nWhen we build a docker image using Dockerfile, you must have seen the logs on the terminal console. There you must have seen some sha IDs that it shows. Those sha IDs are nothing but intermediary image layers IDs.\n⟩ docker build -f Dockerfile.new -t bitphile/test-image .      (base)\nSending build context to Docker daemon  7.168kB\nStep 1/4 : FROM alpine\n ---&gt; da7260331371\nStep 2/4 : COPY app.sh ./app.sh\n ---&gt; 198fdf85c15b\nStep 3/4 : RUN chmod +x app.sh\n ---&gt; Running in cf5c357a3254\nRemoving intermediate container cf5c357a3254\n ---&gt; 8e758ee45de3\nStep 4/4 : ENTRYPOINT [&quot;./app.sh&quot;]\n ---&gt; Running in 857700b4b452\nRemoving intermediate container 857700b4b452\n ---&gt; 4d85107b2c59\nSuccessfully built 4d85107b2c59\nSuccessfully tagged bitphile/test-image:latest\nA docker image is made up of several docker image layers. Each of the commands in Dockerfile stacks up a new image layer on top of the previous one.\n\nNote: Commands in Dockerfile are those instructions which do some changes in the file system. Any change made in the file system creates a new image layer. So, commands are responsible for the creation of a new image layer.\nFor example, COPY, RUN, etc are commands.\n\nThe following image shows the docker image layers having ID and their corresponding parent layer ID.\n\n\nNote: Each of the layers coming on top of the existing one depends on their parent layer. Changing the sequence may altogether change the final image. Caching of image layers also depends upon this (upcoming sections).\n\nR/W image layers\nAn image layer can be read-only or read and write. All the intermediate image layers are read-only. One can’t create a file in any of those layers. If anyone of you has worked on docker must be thinking, bitPhile is saying wrong as we can create files in running docker container.\nYour concern is right. We can create files in the docker container. The reason behind this is Container Layer which is explained in the next section.\nContainer Layer\nWhen an image is turned into a container, a new thin layer is stacked on top of the layers. This thin layer is called container layer. This image layer has both Read and Write access. All other image layers beneath this can only be read.\n\nSource: docs.docker.com/storage/storagedriver/images/container-layers.jpg\nWhy does knowing Image Layers matter?\nThere are several reasons why one should know about docker image layers. A few of them are described below.\nImage Size\nAn image is a pack of all dependencies, libraries, and src code required for an application. These images are stored on cloud registries and shared across devices. Size becomes a foremost requirement for an image.\nImage layers size consititute into the size of the final image. Identifying which layer is adding more size can help the developer to find areas of concern.\nLayers are Cached\nImage layers are stored on the host machine for future builds. This helps build docker images faster.\nLet’s see an example. Consider two Dockerfiles, Dockerfile.new-1 and Dockerfile.new-2.\nDockerfile.new-1\n# syntax=docker/dockerfile:1\nFROM bitphile/my-base-image\n \nCOPY app.sh ./app.sh\n \nRUN chmod +x app.sh\n \nENTRYPOINT [&quot;./app.sh&quot;]\nDockerfile.new-2\n# syntax=docker/dockerfile:1\n \nFROM bitphile/my-base-image\n \nCOPY app.sh ./app.sh\nBuilding the first image, the consoles show,\nSending build context to Docker daemon  7.168kB\nStep 1/4 : FROM bitphile/my-base-image\n ---&gt; da7260331379\nStep 2/4 : COPY app.sh ./app.sh\n ---&gt; 198fdf85c15b\nStep 3/4 : RUN chmod +x app.sh\n ---&gt; Running in cf5c357a3254\nRemoving intermediate container cf5c357a3254\n ---&gt; 8e758ee45de3\nStep 4/4 : ENTRYPOINT [&quot;./app.sh&quot;]\n ---&gt; Running in 857700b4b452\nRemoving intermediate container 857700b4b452\n ---&gt; 4d85107b2c59\nSuccessfully built 4d85107b2c59\nSuccessfully tagged bitphile/my-new-image:latest\nThe second, it shows,\nSending build context to Docker daemon  8.192kB\nStep 1/2 : FROM bitphile/my-base-image\n ---&gt; da7260331379\nStep 2/2 : COPY app.sh ./app.sh\n ---&gt; Using cache\n ---&gt; 198fdf85c15b\nSuccessfully built 198fdf85c15b\nSuccessfully tagged bitphile/my-new-image-2:latest\nWe can see it uses caches for the second build. This increases the speed of building the image. Interesting, right?\n\nNote: If any instruction changes, caches are not used for the next instructions. New image layers are created for them from the scratch. Why does this happen? Think about it!\n\nSeeing Image Layers\nOnce the final image is built, we can see intermediary image layers by,\ndocker history &lt;image-name&gt;\nSo, by running the above commands,\ndocker history bitphile/my-new-image\nGives the output,\nIMAGE          CREATED          CREATED BY                                      SIZE      COMMENT\n4d85107b2c59   50 minutes ago   /bin/sh -c #(nop)  ENTRYPOINT [&quot;./app.sh&quot;]      0B\n8e758ee45de3   50 minutes ago   /bin/sh -c chmod +x app.sh                      33B\n198fdf85c15b   50 minutes ago   /bin/sh -c #(nop) COPY file:1179990b720068e4…   33B\nda7260331379   2 hours ago      /bin/sh -c apk add --no-cache bash              2.24MB\nb2aa39c304c2   3 weeks ago      /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot;]              0B\n&lt;missing&gt;      3 weeks ago      /bin/sh -c #(nop) ADD file:40887ab7c06977737…   7.05MB\n \nThis shows the intermediate image ID, Dockerfile instruction, and size.\n\nNote: &lt;missing&gt; indicates that a particular image is built on a different machine or using builtKit docker builder.\n\nImage Layers on Machine\nWe can find these image layers on the host machine at location /var/lib/docker. If you are using a virtual machine to run a docker daemon, ssh into that machine and access this location.\nListing the contents of /var/lib/docker gives,\ndrwx--x--x   4 root root 4.0K Feb 26 09:14 buildkit\ndrwx--x--x   3 root root 4.0K Feb 26 09:14 containerd\ndrwx--x---  20 root root 4.0K Mar  5 05:51 containers\ndrwx------   3 root root 4.0K Dec 16  2021 image\ndrwxr-x---   3 root root 4.0K Feb 26 09:14 network\ndrwx--x--- 173 root root  24K Mar  5 05:51 overlay2\ndrwx------   4 root root 4.0K Feb 26 09:14 plugins\ndrwx------   2 root root 4.0K Mar  5 02:42 runtimes\ndrwx------   2 root root 4.0K Feb 26 09:14 swarm\ndrwx------   2 root root 4.0K Mar  5 06:21 tmp\ndrwx------   2 root root 4.0K Feb 26 09:14 trust\ndrwx-----x   6 root root 4.0K Mar  5 02:42 volumes\nWe can find these images in images/&lt;storage-driver-name&gt;/imagedb/content/sha25. In my case, overlay2 is storage driver. Refer my post Storage Driver.\nListing content of images/overlay2/imagedb/content/sha25, we see,\n-rw------- 1 root root 1.9K Mar  5 05:10 08bd868662db2cd09a4c7b8e74dad6a9c8fe186964ff31c65d335299d1324ff3\n-rw------- 1 root root 1.9K Mar  5 05:51 198fdf85c15b292a5fff554f3afc26fd1824413822ddd75e72f08937889f1770\n-rw------- 1 root root 2.2K Mar  5 05:11 1d17f325c607e937d89b19de66287aad351fc1abb80bc36591d34b7457ff8316\n-rw------- 1 root root 1.7K Dec 16  2021 25f8c7f3da61c2a810effe5fa779cf80ca171afb0adf94c7cb51eb9a8546629d\n-rw------- 1 root root  16K Mar  1 12:49 2bc7edbc3cf2fce630a95d0586c48cd248e5df37df5b1244728a5c8c91becfe0\n-rw------- 1 root root 2.4K Feb 26 09:51 2f6974482449313e863b0b709841b50da40ce7ef32017f0279671e9b2ee47289\n-rw------- 1 root root  11K Mar  1 06:10 31d22a1554dfca7ad9377b67974ae2e0e3282247fc40fbf2ac3c380102ae772f\n-rw------- 1 root root 4.4K Mar  1 05:26 3c3a210148bab6bc3faedba72ad7de5e58a7cdb6bba0847965211f47fe1c4c21\n-rw------- 1 root root 2.1K Feb 26 09:35 da7260331379a532a15cf3e9bff522627b1574a9ce21bb06c92cea74992613fa\nAs you can see da7260331379 is used as a cache to build the image.\nDocker Container Size\nThere are two things, size and virtual size.\n\nsize is the size of container layer. It comprises of all the files that are written container layer.\n\n\nvirtual size is the sum of size and data of read-only intermediate image layers. If two containers have the same read-only intermediate image layers, will share the same data with separate container layer data.\n\nFor example,\nCONTAINER ID   IMAGE                                          COMMAND                  CREATED         STATUS                   PORTS                  NAMES                                                                                                         SIZE\n7937d5f33e6e   bitphile/my-new-image-2                        &quot;./app.sh&quot;               5 seconds ago   Up 5 seconds                                    bitphile-test-container                                                                                       0B (virtual 9.29MB)\nshows container bitphile-test-container has 0B size and 9.29MB virtual size. If you see the size of the whole image itself is 9.29MB which means it is all size of read-only image layer data.\nNow, adding a new file into the running container should increase the size.\ndocker exec 7937d5f33e6e sh -c &quot;echo hello world &gt; file.txt&quot;\nNow if we see the same container,\nCONTAINER ID   IMAGE                                          COMMAND                  CREATED          STATUS                   PORTS                  NAMES                                                                                                         SIZE\n7937d5f33e6e   bitphile/my-new-image-2                        &quot;./app.sh&quot;               39 seconds ago   Up 39 seconds                                   bitphile-test-container                                                                                       11B (virtual 9.29MB)\ngot 11B of size.\nSo, this is it for now. It’s great that you come reading till here. I will see you in my next post on docker. Till then,\n\nReferences\n\nStorage Drivers \n"},"blogs/tech/docker/docker-networking":{"title":"Docker Networking - How does it work?","links":[],"tags":["docker","networking","ports","bridge","routintg","routing-mesh","overlay"],"content":"Hello folks! Good to see you again on our journey of Docker. In this post, we would be learning about docker networking. So, let’s get started.\nWhat is covered?\n\nAbstract\nProblem Statement\nHow does Docker Network solve the problem?\nSimple example\nTypes of networks based on drivers\nDiving deep into bridge networks\nConclusion\n\nAbstract\nDocker has been a powerful tool for creating and managing independent applications and services. These services are interacting with each other through specified interfaces. However, the isolated environment of docker stymies that interaction. An isolated environment hinders services request-response communications as they have different network namespaces.\nTo solve this problem, docker introduced the concept of networking. Docker Networking.\nProblem without networking\nApplications are running in their containers. These containers have their networking interfaces, namespace, etc. They are not aware of other containers. If there is an application that wants to communicate with another application, sends a request to a specified endpoint of another application. The request never reaches another application as networks are different and isolated.\nFor example, consider a chat application feeberchat (I created this app a long time ago 😄). feeberchat is running inside a container A. The database of feeberchat is getting stored in an instance of mongodb running inside another container B.\nAs both A and B have different network namespaces, they can’t communicate.\n\nHow does Docker Networking solve the problem?\nDocker networking allows to create isolated networks for containers to communicate with each other. It creates a common networking namespace where containers reside and communicate.\n\nAn example\nAssume we have a node (express) application running on port 3000, dockerized with endpoints:\n\n/\n/health\n\nRunning that application in no network using\n⟩ docker run -d --name express-app --network none bitphile/express-app       (base)\nLet’s try to access it from another container.\n⟩ docker run -it --rm --name alpine-shell alpine:latest sh       (base)\nIt opens up the container. Now we have to send a request to container express-app. What is the endpoint? We don’t know as express-app is running without any network. Docker didn’t assign any IP address to express-app container.\nNow, let’s run express-app again differently\n⟩ docker run -d --name express-app bitphile/express-app                (base)\nInspecting network details of express-app gives\n{\n  &quot;bridge&quot;: {\n    &quot;IPAMConfig&quot;: null,\n    &quot;Links&quot;: null,\n    &quot;Aliases&quot;: null,\n    &quot;NetworkID&quot;: &quot;8f7326c66c80c45501e24eb7c29596b9a1065624a81b443ef34f8e5c59abab05&quot;,\n    &quot;EndpointID&quot;: &quot;987f33191fc7843190ac74227c8d062b6a8e2b9c2101e52e289f2f82e6f8c9af&quot;,\n    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,\n    &quot;IPAddress&quot;: &quot;172.17.0.3&quot;,\n    &quot;IPPrefixLen&quot;: 16,\n    &quot;IPv6Gateway&quot;: &quot;&quot;,\n    &quot;GlobalIPv6Address&quot;: &quot;&quot;,\n    &quot;GlobalIPv6PrefixLen&quot;: 0,\n    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,\n    &quot;DriverOpts&quot;: null\n  }\n}\nIt bombarded us with a bunch of details. Let’s not worry about the rest of the details and take IPAddress into consideration. IPAdderss is the IP address of container express-app in the default bridge network (coming in the following sections. Just assume it is as a networking type).\nLet’s send a request to this ip address from alpine-shell container.\n$ curl 172.17.0.3:3000/health\nThis is healthy $\nGreat! We got some results.\nWhat did happen?\nWhen we run express-app container without specifying --network flag, it creates a virtual network (which is called default bridge network). Docker assigns an ip address from that virtual network to the container. That’s why we could see IPAddress in docker inspect.\nIf you try running express-app with --network none flag and inspect the container, you wouldn’t be seeing any network information.\n\nNetwork drivers\nDocker provides various network drivers for different types of requirements. Following is a list of those drivers.\n\nbridge\nhost\noverlay\nmacvlan\nipvlan\n\nEach of these drivers has different capabilities. Select a driver best suits your requirements. For the sake of simplicity and the size of the post, we would be going with bridge network driver.\nBridge Networks\nAligning ourselves with the name, we can think of a bridge as something that connects segments. In networking, it is a Link Layer device that connects network segments.\nIn docker, bridge networks connect containers in a network where they can communicate easily while allowing isolation from the rest of the containers not connected to the same bridge network.\nBridge networks can only be used on the same docker daemon host. For networking among containers from different docker hosts, prefer some other docker networking driver (eg overlay network).\nDefault Bridge Network\nDocker creates this network by default if we don’t specify any network to use.\n⟩ docker network ls                                                              (base)\nNETWORK ID     NAME         DRIVER    SCOPE\n8f7326c66c80   bridge       bridge    local\n1b69478406e4   host         host      local\n9324e36db9ab   none         null      local\nLook bridge network of the driver bridge. This is the default bridge network created and managed by docker. Though we can also configure it but not doing also suffices the requirements in most cases.\n\nNote: Have a look at none network with null driver. This is what we have used for no networking.\n\nUser-defined Bridge Network\nWe can also create a network of driver bridge. This has a few advantages over default bridge network:\n\nThe most important, user-defined bridge network provides automatic DNS resolution between containers. It means, we can directly use container names to send requests instead of IP addresses.\nUser has total control over the configurations on the network.\nOnly containers with this network type can communicate.\n\nUsing user-defined Bridge Network\nCreating a network\nFollowing is the command used to create a docker network\ndocker network create [options] &lt;name&gt;\nLet’s create a network of the name bitphile.\n⟩ docker network create bitphile                                                (base)\n2bfb26180adc42445ca0127f8628d45b71f1871b8b3fdea2a7d3da8b31e9dd17\n⟩ docker network ls                                                             (base)\nNETWORK ID     NAME       DRIVER    SCOPE\n2bfb26180adc   bitphile   bridge    local\n8f7326c66c80   bridge     bridge    local\n1b69478406e4   host       host      local\n9324e36db9ab   none       null      local\nBy default, it creates a network of driver type bridge. We can specify the driver using --driver flag.\n⟩ docker network create --driver macvlan bitphile                               (base)\n237a35cfa290dd59db70b099cf970efd5efbd29f150ae65c7add51632d704a81\nInspecting the network details gives us\n[\n  {\n    &quot;Name&quot;: &quot;bitphile&quot;,\n    &quot;Id&quot;: &quot;2bfb26180adc42445ca0127f8628d45b71f1871b8b3fdea2a7d3da8b31e9dd17&quot;,\n    &quot;Created&quot;: &quot;2023-03-19T09:42:37.48139717Z&quot;,\n    &quot;Scope&quot;: &quot;local&quot;,\n    &quot;Driver&quot;: &quot;bridge&quot;,\n    &quot;EnableIPv6&quot;: false,\n    &quot;IPAM&quot;: {\n      &quot;Driver&quot;: &quot;default&quot;,\n      &quot;Options&quot;: {},\n      &quot;Config&quot;: [\n        {\n          &quot;Subnet&quot;: &quot;172.20.0.0/16&quot;,\n          &quot;Gateway&quot;: &quot;172.20.0.1&quot;\n        }\n      ]\n    },\n    &quot;Internal&quot;: false,\n    &quot;Attachable&quot;: false,\n    &quot;Ingress&quot;: false,\n    &quot;ConfigFrom&quot;: {\n      &quot;Network&quot;: &quot;&quot;\n    },\n    &quot;ConfigOnly&quot;: false,\n    &quot;Containers&quot;: {},\n    &quot;Options&quot;: {},\n    &quot;Labels&quot;: {}\n  }\n]\nRunning the container with this network\n⟩ docker run -d --name express-app --network bitphile bitphile/express-app\n70ae390032cbf2e1e38e749895cf17533c70021168a457480a3dd57f035296fe\nIf we inspect the network bitphile again, we would see a list of containers using this network.\n[\n  {\n    &quot;Name&quot;: &quot;bitphile&quot;,\n    &quot;Id&quot;: &quot;56b7da97479a3a27859e2c62b5a9f84b8389b5b3d5b41b40283b56a40e88d1a6&quot;,\n    &quot;Created&quot;: &quot;2023-03-19T09:46:13.74404902Z&quot;,\n    &quot;Scope&quot;: &quot;local&quot;,\n    &quot;Driver&quot;: &quot;bridge&quot;,\n    &quot;EnableIPv6&quot;: false,\n    &quot;IPAM&quot;: {\n      &quot;Driver&quot;: &quot;default&quot;,\n      &quot;Options&quot;: {},\n      &quot;Config&quot;: [\n        {\n          &quot;Subnet&quot;: &quot;172.22.0.0/16&quot;,\n          &quot;Gateway&quot;: &quot;172.22.0.1&quot;\n        }\n      ]\n    },\n    &quot;Internal&quot;: false,\n    &quot;Attachable&quot;: false,\n    &quot;Ingress&quot;: false,\n    &quot;ConfigFrom&quot;: {\n      &quot;Network&quot;: &quot;&quot;\n    },\n    &quot;ConfigOnly&quot;: false,\n    &quot;Containers&quot;: {\n      &quot;70ae390032cbf2e1e38e749895cf17533c70021168a457480a3dd57f035296fe&quot;: {\n        &quot;Name&quot;: &quot;express-app&quot;,\n        &quot;EndpointID&quot;: &quot;0fda9ef2aa92e5966320c330776986c9cea15210354d2994e3060522619a5290&quot;,\n        &quot;MacAddress&quot;: &quot;02:42:ac:16:00:02&quot;,\n        &quot;IPv4Address&quot;: &quot;172.22.0.2/16&quot;,\n        &quot;IPv6Address&quot;: &quot;&quot;\n      }\n    },\n    &quot;Options&quot;: {},\n    &quot;Labels&quot;: {}\n  }\n]\nQuick introduction to subnet and gateway\nThis won’t be thorough. It would just be for understanding networking in the context of docker.\nSubnet\nIt is used to divide the larger network into the smaller network to make network management easy. For example, subnet 172.22.0.0/16 means the first 16 bites will be used for networks, and the rest of 16 bits will be used for hosts in the sub-network.\n \n172    22    0    0\n -------      ----\n network      host\nIn the context of docker, the subnet makes sure that the network interface has a unique IP address (gateway IP address) and the containers are assigned unique IP addresses. It also helps in routing traffic.\nGateway\nAs the name suggests, it is the entry point (and exit point) of a network segment.\nIn the context of docker, we have gateway 172.22.0.1 which is an entry point for network bitphile.\nSpecifying subnet and gateway\nIt is possible to provide a subnet and gateway while creating a network.\n⟩ docker network create --subnet=172.20.0.0/16 --gateway=172.20.0.1 bitphile  (base)\n340e9f5c82185940df2a3a2009e6ef5276c1c6b440a9a8dc5376c5c5df448b90\nTry running the same command again and see what happens.\nYou can’t create another network with the subnet already used.\nDelete a network\nDeleting something gives such a relaxation that can’t be expressed. Specially deleting the code (don’t delete a working code 😂).\nWe can delete the network using\n⟩ docker network rm bitphile                                                    (base)\nbitphile\nConclusion\nFinally, we are at the home stretch of this post. Hope you found this useful and you got something important out of this. Please reach out to me if you have any feedback. I have given my mail below. See you at the next junction of our journey on docker.\nUntil then,\n\nReferences\n\nNetworking overview\nContainer networking\nDocker bridge networking\n\n📨Mail to me"},"blogs/tech/docker/docker-storage-driver":{"title":"docker-storage-driver","links":[],"tags":[],"content":""},"blogs/tech/docker/docker-volume":{"title":"Docker Volume","links":["blogs/tech/docker/docker-image-layers"],"tags":["docker","infra","kubernetes","docker-volume","volume","storage","bind-mounts","tmpfs"],"content":"Understanding Docker Volume Thoroughly\nAgenda\n\nAbstract\nContainer layer and its data on docker host machine\nWhat are the flaws of storing data in the container layer?\nWhat is the solution?\nUsing docker volume\nConclusion\n\nAbstract\nA Docker container is an independent process comprising the application and its dependencies. Container has its processes, file system, and networks independent of the host machine.\nCreating a resource in the running container stores that resource in the Read-Write layer or Container layer. This is a temporary storage mechanism. It is accessible until the container is running. Once the container is removed, all the data goes.\nDocker provides a few mechanisms to tackle this problem and volume is one of them. Let’s dig deeper into docker volumes.\n\nNote: All the examples are being done by using minikube for running docker daemon. Any mention of docker host machine refers to minikube node (You can go inside minikube node using, minikube ssh).\n\nContainer Layer\nI have explained about container layer in my previous post on Docker at Docker Image Layers. In this section, we would be seeing where actually the container layer is stored on the docker host machine. Excited? Seems like yes 😄. Let’s start.\nWhere does the container layer reside?\nContainer layer is a read-write layer stacked on top of read-only image layers. We can’t modify read-only filesystem of read-only image layers. We can modify the contents in the file system of the container layer.\nLet’s spin up an alpine container with sh command.\ndocker run --rm -it alpine sh\nCreating a file as\n/ # echo &quot;Docker is awesome - Nitin&quot; &gt; testimonials.txt\n/ # ls\nbin               home              mnt               root              srv               tmp\ndev               lib               opt               run               sys               usr\netc               media             proc              sbin              testimonials.txt  var\n\nNow, let’s see where this data is stored on the docker host machine.\nInspecting the above container of ID 385f23abffa3 gives the following\n$ docker inspect --format &#039;{{ .GraphDriver.Data }}&#039; 385f23abffa3\nmap[LowerDir:/var/lib/docker/overlay2/7cb62392ec2ace2c1ea07bbdee8c4976105f4f081531a29b7c5a0320aa5ae032-init/diff:/var/lib/docker/overlay2/71129bf0c1fb93d386d1abd9390e68eb08b64e65cb31186a0e710931359adb72/diff MergedDir:/var/lib/docker/overlay2/7cb62392ec2ace2c1ea07bbdee8c4976105f4f081531a29b7c5a0320aa5ae032/merged UpperDir:/var/lib/docker/overlay2/7cb62392ec2ace2c1ea07bbdee8c4976105f4f081531a29b7c5a0320aa5ae032/diff WorkDir:/var/lib/docker/overlay2/7cb62392ec2ace2c1ea07bbdee8c4976105f4f081531a29b7c5a0320aa5ae032/work]\n$\nWoo! It gives a map with a bunch of paths. Let me example you each of these paths. The following descriptions are based on overlay2 storage driver.\n\nLowerDir is the read-only file system for lower image layers. Any changes made to the file system are reflected in the new file system of the read-write container layer. LowerDir acts as a base file system.\nUpperDir is the read-write file system for the container layer where we can create and delete files and directories. Container layer changes are stored in this location.\nMergedDir is the merge of LowerDir and UpperDir. It gives a unified view of the file system for the container.\nWorkDir is something overlay2 driver uses for its internal operations such as copy-on-write process.\n\nAs you can see LowerDir has two paths separated by :.\nFirst one is the path of the lower image layer read-only file system.\n/var/lib/docker/overlay2/7cb62392ec2ace2c1ea07bbdee8c4976105f4f081531a29b7c5a0320aa5ae032-init/diff\n\nSecond one is the path of the lower image layer read-only file system after changes made by previous running containers.\n/var/lib/docker/overlay2/71129bf0c1fb93d386d1abd9390e68eb08b64e65cb31186a0e710931359adb72/diff\n\nThese two directories serve as a base read-only file system for the container layer read-write file system.\nAs we create a new file testimonials.txt in the container, let’s peek into UpperDir to see this new file. Remember, this is on the docker host machine.\n$ sudo ls -la /var/lib/docker/overlay2/7cb62392ec2ace2c1ea07bbdee8c4976105f4f081531a29b7c5a0320aa5ae032/diff\ntotal 16\ndrwxr-xr-x 3 root root 4096 Mar 12 06:45 .\ndrwx--x--- 5 root root 4096 Mar 12 06:44 ..\ndrwx------ 2 root root 4096 Mar 12 06:44 root\n-rw-r--r-- 1 root root   26 Mar 12 06:45 testimonials.txt\n$\nYay! We have testimonials.txt on our docker host machine. If we cat we see,\n$ pwd\n/var/lib/docker/overlay2/7cb62392ec2ace2c1ea07bbdee8c4976105f4f081531a29b7c5a0320aa5ae032/diff\n$ cat testimonials.txt\nDocker is awesome - Nitin\nGreat. If you have noticed when we do ls inside the container, it gives more directories like,\n$:/ ls\nbin               home              mnt               root              srv               tmp\ndev               lib               opt               run               sys               usr\netc               media             proc              sbin              testimonials.txt  var\nHowever, we didn’t see these directories on UpperDir. Guess why?\nThe reason is, UpperDir only has the changes made to the container file system. This is where MergedDir comes into existence which provides a unified view of the file system. MergedDir is the merge of LowerDir and UpperDir to give a unified file system.\nLet’s see what is inside MergedDir.\n$ sudo ls /var/lib/docker/overlay2/7cb62392ec2ace2c1ea07bbdee8c4976105f4f081531a29b7c5a0320aa5ae032/merged\nbin  etc   lib    mnt  proc  run   srv  testimonials.txt  usr\ndev  home  media  opt  root  sbin  sys  tmp               var\n$\nAs we can see it is the same as the file system of the container. You can go ahead and try creating files in this location and see if it turns up in the container.\nThe Flaws of storing data in the container layer\n\n\nFirst thing first, storing data in the container layer is not permanent. Once you delete the container, all the data stored goes away.\n\n\nstorage-driver is getting used to dealing with the file system on the container. Using container file system for an IO-intensive application is always not a good idea. It causes performance issues and increases latency when accessing files stored on a container file system.\n\n\nContainer size gets increase when we start to store files on the container file system. I would give the example of a use case. Sometimes we get the need to create an image from the container itself. And if we have a huge amount of data inside the container, the resulting image would be big.\n\n\nSharing of data across containers is hard as it is highly coupled with the container itself.\n\n\nThese are the problems we are considering here. There may be different other problems.\nThen what is the solution, huh?\nSolution - Using Docker volume\nVolume is not the only solution. It is one of the solutions docker provides. Some other solutions are bind mound, tmpfs etc.\nWhat is Docker Volume?\nThis is the way of storing and managing persistent data outside of container file system. It is stored on a host file system managed by Docker. These volumes can be shared across different containers.\nCool, Huh?\nLet’s create a volume\nVolumes are not tied to containers. So, we can create and manage volumes without even touching containers.\ndocker volume command is used to manage volumes.\n$ docker volume\n \nUsage:  docker volume COMMAND\n \nManage volumes\n \nCommands:\n  create      Create a volume\n  inspect     Display detailed information on one or more volumes\n  ls          List volumes\n  prune       Remove all unused local volumes\n  rm          Remove one or more volumes\n \nRun &#039;docker volume COMMAND --help&#039; for more information on a command.\n$\nLet’s create a volume of the name bitphile, 😁.\n$ docker volume create bitphile\nbitphile\n$ docker volume ls\nDRIVER    VOLUME NAME\nlocal     bitphile\n$\nInspecting this volume gives us,\n$ docker volume inspect bitphile\n[\n    {\n        &quot;CreatedAt&quot;: &quot;2023-03-12T07:38:38Z&quot;,\n        &quot;Driver&quot;: &quot;local&quot;,\n        &quot;Labels&quot;: {},\n        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/bitphile/_data&quot;,\n        &quot;Name&quot;: &quot;bitphile&quot;,\n        &quot;Options&quot;: {},\n        &quot;Scope&quot;: &quot;local&quot;\n    }\n]\n$\nMountpoint is where this volume is mounted. That is the location on the host machine where volume data will be stored.\nLet’s peek inside that location and see what’s there.\n$ sudo ls -la /var/lib/docker/volumes/bitphile/_data\ntotal 8\ndrwxr-xr-x 2 root root 4096 Mar 12 07:38 .\ndrwx-----x 3 root root 4096 Mar 12 07:38 ..\n$\nNOTHING? Well, we just created it 😂!\nMount Volume to container\nThere are two methods of mounting volume to the container.\n\n--mount option\n-v option\n\n-v option is like shorthand. --mount is verbose and explicit, which is why we going to use --mount throughout this post.\nLet’s create a container and mount it to this volume we have just created.\n$ docker run --rm -it --mount type=volume,source=bitphile,target=/bitphile-vol alpine sh\n/ #\n--mount option takes parameters are key=value pairs separated by ,.\n\ntype specifies the volume as type. --mount is being used by bind mounts, and tmpfs also. By default, type is volume. But for the sake of being explicit, I have used it.\nsource is the volume name.\ntarget is the path in the container file system that will be mounted with the volume. There is alias of this option as dest, destination etc.\n\nListing contents in the container file system root we see,\n/ # ls\nbin           home          opt           sbin          usr\nbitphile-vol  lib           proc          srv           var\ndev           media         root          sys\netc           mnt           run           tmp\n/ #\n\nWe have bitphile-vol directory mounted to volume bitphile.\nLet’s create a file inside that directory.\n/ # echo Good morning &gt; bitphile-vol/greetings.txt\n/ # cat bitphile-vol/greetings.txt\nGood morning\n/ #\n\nPeeking on the volume mount location on the host machine, we see,\n$ sudo ls -la /var/lib/docker/volumes/bitphile/_data\ntotal 12\ndrwxr-xr-x 2 root root 4096 Mar 12 07:48 .\ndrwx-----x 3 root root 4096 Mar 12 07:38 ..\n-rw-r--r-- 1 root root   13 Mar 12 07:48 greetings.txt\n$\nCool! We have greetings.txt.\nMount the same volume to another container\nLet’s spin up a new container with the same volume.\n$ docker run --name bitphile-second -it --mount source=bitphile,target=/bit-vol alpine sh\n/ $ ls\nbin      etc      media    proc     sbin     tmp\nbit-vol  home     mnt      root     srv      usr\ndev      lib      opt      run      sys      var\n/ $\nLet’s see what bit-vol has,\n/ # ls bit-vol\ngreetings.txt\n/ # cat bit-vol/greetings.txt\nGood morning\n/ #\n\nNice.\nConclusion\nFinally, we are at the end (the happiest moment when the zoom meeting ends 😂).\nSo, docker volumes are used as one of the methods to store data permanently. There are some other methods of doing the same. We will have look at those sometime later.\nUntil then,\n\nReferences\n\nDocker Volumes\n"},"blogs/tech/docker/getting-started-with-docker":{"title":"Getting Started With Docker","links":["blogs/tech/docker/docker-image-layers"],"tags":["docker","infra","kubernetes","container","containerisation","containerization"],"content":"Introduction\nDeveloping software and applications is getting more complex day by day. This introduces the complexity of running and deploying the applications in different machines or environments. It also includes making sure it works everywhere no matter what the architecture of the host machine is.\nApplications running in the same environment can conflict with other applications. This can cause malfunctions and make application development less effective.\nTo solve this problem we need isolation and a virtual machine is one way to achieve this. We can have different virtual machines to run the applications that will be independent of other applications environments.\nHowever, using a virtual machine has its own pros and cons. Some of these are the followings:\nVirtual Machine Pros\n\nStronger isolation and security as it provides hardware-level isolation which makes them more secure and isolated.\n\nVirtual Machine Cons\n\nRequires more resources. Virtual machine requires guest system operation to run which consumes more resources.\nStartup time is more in virtual machines as it has to boot the whole operating system.\nPortability is less as virtual machines are tied to specific hardware and require additional configurations to run.\n\nSo, what alternative do we have to achieve this isolated environment? The answer is containerization.\nContainerization\nJust to get started with this concept, I would like to give an example. We have seen containers that are used on ships to transport things. These containers have isolated environments and temperatures specific to the items they are containing.\nSimilarly, containers can contain applications and supporting libraries required to run the application. This helps in running applications in any environment no matter what host system OS and architecture are.\nDocker\nDocker is a containerization tool that is used to create and run containers. There are several other alternatives to docker like Podman, openVZ, etc.\nArchitecture\nDocker uses client-server architecture where the docker client talks with the docker daemon which can run on either a host machine, a virtual machine, or a machine on the cloud. Docker clients can connect to multiple daemons.\n\nSource: docs.docker.com/engine/images/architecture.svg\nDocker client\nDocker client is an interface that lets users create and run containers. Client talks with docker daemon using Docker API requests. It is not more than an application that can be web-based or cli that sends requests to the server and gets responses back.\nThe server or daemon performs the requested job.\nDocker daemon\nA Docker daemon is the server that accepts requests from the docker client and performs the respective job. It can run on a host machine or virtual machine. Docker clients can connect to multiple docker daemons and change the daemon using docker client-provided commands.\nFor example,\ndocker context ls\nIt shows available contexts or daemons to which a client can connect to.\nNAME                DESCRIPTION                               DOCKER ENDPOINT                                     KUBERNETES ENDPOINT   ORCHESTRATOR\ndefault             Current DOCKER_HOST based configuration   tcp://localhost:2376                                                      swarm\ndesktop-linux                                                 unix:///Users/test/.docker/run/docker.sock\nrancher-desktop *   Rancher Desktop moby context              unix:///Users/test/.rd/docker.sock\n\nTo change context, use\ndocker context use rancher-desktop\n\nNote: Rancher desktop is an alternative to Docker desktop you can use. Docker desktop requires a license. Rancher desktop creates a lightweight virtual machine on the host system which contains docker components. Docker daemon runs inside that virtual machine.\n\nDocker Container and Image\nContainer\nAs I mentioned before, a container is a self-contained unit having all the necessary things required for the item container is containing. In this context, a container is a self-contained runnable unit that comprises the application and supporting libraries that are required to run that application.\nImage\nAn image is a blueprint of a container that defines a container. An image contains all the instructions and resources required to create a container.\nIf you have worked on OOPs, you must have heard about classes and objects. You can think of images as classes and objects as containers.\nYou can create your image by using other images as a base. I will show you shortly how to do it.\nRegistry\nThis is the place where you can push your docker images. It’s like GitHub where you push source code onto GitHub and here you would be pushing docker images. You can also pull docker images stored on the docker registry.\nDocker provides a docker hub register where you can get almost all docker images pushed by other people. Visit hub.docker.com for more details.\nDockerfile\nDockerfile is used to build docker images. It contains all the instructions required to build an image. Following is an example of a Dockerfile.\n\nFROM fedora:latest\nRUN dnf install figlet -y\nENTRYPOINT [&quot;figlet&quot;]\nCMD [&quot;bitPhile&quot;]\nExplanation\n\nFROM specifies to use fedora:latest as the base image. The base image is the parent image on which your image is based. A new image will be built on top of this base image.\nRUN instruction is used to run the given command while building the image.\nENTRYPOINT is the starting script that will run when the container is started.\nCMD specifies the default command to run when the container is started.\n\n\nThere is a difference between ENTRYPOINT and CMD. When ENTRYPOINT is provided, whatever argument CMD instruction has will be append as arguments to ENTRYPOINT. For instance, if we will see the above example, the final command will be figlet hello world.\n\nBuilding Docker Image\nSave the above file and run the following docker command.\ndocker build -t docker-fedora-test .\nbuild is the subcommand that tells to build a docker image. -t is a tag where docker-fedora-test is passed as a tag name. . is the context.\n\nWhat is context? Context the part of the host file system that is required to build a docker image. For example, there may be some file or data which is required in image building. So, we pass those files using context.\nWe can only pass one context.\n\nA docker image is built through several layers of images. Each of the instructions in Dockerfile runs in a separate image layer. To learn more about docker image layers, refer to my blog docker image layers.\nRunning Docker Image\nTo run the image we’ve just built, run the following docker command.\ndocker run docker-fedora-test\nThis gives output as,\n _     _ _   ____  _     _ _\n| |__ (_) |_|  _ \\| |__ (_) | ___\n| &#039;_ \\| | __| |_) | &#039;_ \\| | |/ _ \\\n| |_) | | |_|  __/| | | | | |  __/\n|_.__/|_|\\__|_|   |_| |_|_|_|\\___|\nAwesome, right?\nWe can also pass arguments while we are running the container.\ndocker run docker-fedora-test hello world\nhello world gets append as an argument to fedora entrypoint command.\nFolks, this is it for now. There are lots of things that come in docker and it is hard to put everything in one place both for you and me. So, see you in the next post on docker. Stay tuned.\nPlease provide your feedback as it helps me improve the posts and get more information to you.\nReferences\n\ndocs.docker.com/engine/reference/builder/ for Dockerfile\ndocs.docker.com/get-started/overview/ for overview and architecture\n"},"blogs/tech/programming/scala/chat-app-in-scala-armeria":{"title":"Chat App in Scala Armeria","links":[],"tags":["rest-api","microservices","armeria","websocket","socket"],"content":"Contents\n\nAbstract\nWhat is Armeria and its features?\nProject details\nProject setup requirements\nSetting up Armeria and service handler\nSetting up the web socket handler\nShow example in the browser console\nSocket service for frontend\nCode snippet of the chat screen\nWorking example Screenshots etc\nConclusion\nAcknowledgements\nReferences\n\nAbstract\nAs a part of E4R (Engineering for Research) retreat Hackathon, we explored Armeria and created a small PoC single group chat application using HTTP request polling and websockets. We are using the Armeria framework to develop one of the services in our project. So, it became the inspiration for the exploration.\nThis blog constitutes building a small chat application using REST API framework Armeria, Scala, and JavaScript. It won’t have end-to-end code but only contains code snippets. You can find code on here.\nWhat is Armeria?\nArmeria is a REST API microservice framework that becomes a backbone of powerful, fast, and asynchronous web services. It is completely asynchronous and built on top of reactive streams and Java 8 CompletableFuture. It is built in Java and compatible with any language that runs on JVM such as Scala, Kotlin, Clojure, etc.\nIt lets you develop services with technologies like gRPC, Thrift, HTTP, etc. running on the same application and port.\nI think this introduction to Armeria would be enough to get a basic understanding. If you are more interested in Armeria’s features, please have a look at its official website. Now let’s see Armeria in action with the help of a small chat application.\nAbout PoC\nWe are going to build a single group chat application comprising a backend service in Scala using the Armeria framework and a frontend service using React/Javascript.\nPrerequisites\nTo get started with the project, we have to have some required prerequisites.\n\nJava 17 or more installed\nScala installed and sbt\nNode v17 or more\nAnd an IDE of your choice.\n\nSetting up the project\nAssuming all the prerequisites done, create a new project using sbt.\nmkdir chat-app\ncd chat-app\nsbt\nIt setups the project. Now we need to create build.sbt and write the following inside it.\nThisBuild / version := &quot;0.1.0-SNAPSHOT&quot;\n \nThisBuild / scalaVersion := &quot;3.3.0&quot;\n \nlazy val root = (project in file(&quot;.&quot;))\n  .settings(\n    name := &quot;chat-app-retreat&quot;,\n    libraryDependencies ++= Seq(\n      &quot;com.linecorp.armeria&quot;  &quot;upickle&quot; % &quot;3.0.0&quot;\n    )\n  )\nCreate src directory with the following basic structure.\nsrc\n├── main\n│   ├── resources\n│   └── scala\n└── test\n    └── scala\n\nNow reload the project using sbt reload.\nCreate a service handler in Main.scala\nCreating a simple server in Armeria is very simple as below code snippet shows. For now, we only have a single handler on path &quot;/&quot; that responds with OK.\nobject Main:  \n  def main(args: Array[String]): Unit =\n    val port: Int      = 8000\n    val server: Server = newServer(port)\n    val future         = server.start()\n    future.join()\n    logger.info(s&quot;Server is running on port $port&quot;)\n \n  private def newServer(port: Int) =\n    val serverBuilder: ServerBuilder = Server.builder()\n \n    serverBuilder\n      .http(port)\n      .service(\n        &quot;/&quot;,\n        (ctx, req) =&gt; HttpResponse.of(HttpStatus.OK)\n      )\n      .requestTimeout(Duration.ofSeconds(1000))\n      .build()\nA handler or a service is attached to the server using service method. We can also have an annotated controller similar to Spring Boot that can be attached using annotatedService method.\nRunning this and sending request to our server, we get 200 OK. Cool, our server works.\n⟩ curl http://localhost:8000/\n200 OK⏎\nCreating message endpoints\nWe require to create two endpoints for creating and fetching all the messages.\n\nGET /e4r/message\nPOST /e4r/create-message\n\nSupposing we have a ChatController which handlers messages services. Adding it to server would like as shown below.\nprivate def newServer(port: Int) =\n    val serverBuilder: ServerBuilder = Server.builder()\n \n    serverBuilder\n      .http(port)\n      .service(\n        &quot;/&quot;,\n        (ctx, req) =&gt; HttpResponse.of(HttpStatus.OK)\n      )\n\t  .annotatedService(\n        &quot;/e4r&quot;,\n        ChatController(ChatService(new ChatRepository))\n      )\n      .requestTimeout(Duration.ofSeconds(1000))\n      .build()\nAdding two handlers in ChatController\nclass ChatController(chatService: ChatService):\n  @Get(&quot;/message&quot;)\n  def getMessages: HttpResponse =\n    val result = chatService.getMessages\n    HttpResponse.ofJson(HttpStatus.OK, messages)\n \n  @Post(&quot;/create-message&quot;)\n  @RequestConverter(classOf[JacksonRequestConverterFunction])\n  def createMessage(message: MessageDTO): HttpResponse =\n    chatService\n      .createMessage(message.toMessage)\n      HttpResponse.of(HttpStatus.CREATED)\n \nSending request on /e4r/message returns all the messages in group. /e4r/create-message creates a new message.\n⟩ curl -X POST --header &quot;content-type: application/json&quot; -d &#039;{&quot;sender&quot;:&quot;@atul&quot;, &quot;text&quot;: &quot;Hey there!&quot;, &quot;createdAt&quot;: &quot;2023-08-03T09:30:37.258Z&quot;}&#039; http://localhost:8000/e4r/create-message\n201 Created\n \n⟩ curl -q http://localhost:8000/e4r/message | jq\n[\n  {\n    &quot;id&quot;: &quot;d69f836c-eac7-48dc-9138-9d2d40b38f4c&quot;,\n    &quot;sender&quot;: &quot;@atul&quot;,\n    &quot;text&quot;: &quot;Hey there!&quot;,\n    &quot;createdAt&quot;: 1692114770.973873\n  },\n  {\n    &quot;id&quot;: &quot;50ca044a-0f2b-4904-902f-297946c30413&quot;,\n    &quot;sender&quot;: &quot;@atul&quot;,\n    &quot;text&quot;: &quot;Hey there!&quot;,\n    &quot;createdAt&quot;: 1691055037.258\n  }\n]\nImplementing Websocket handler\nTo make the chat experiment real-time, we are required to use web sockets. Web socket is a protocol that creates a full duplex connection among devices. Want to deep dive into web sockets? You can have a read about it over this.\nTalking about Armeria, it has got web socket support in recent versions and that’s why there is no rich documentation on it. However, we managed to get some implementation of web sockets by going through the code and tests.\nLet’s attach a socket service to our server.\n \nval socketService = new SocketService()\nsocketService.on(&quot;new-message&quot;, (data) =&gt; println(data))\nsocketService.on { (data) =&gt;\n    println(&quot;from broadcast&quot;)\n    println(data)\n}\n    \nprivate def newServer(port: Int) =\n    val serverBuilder: ServerBuilder = Server.builder()\n \n    serverBuilder\n      .http(port)\n      .service(\n        &quot;/&quot;,\n        (ctx, req) =&gt; HttpResponse.of(HttpStatus.OK)\n      )\n      .service(\n        &quot;/chat/:clientId&quot;,\n        WebSocketService.builder(socketService).allowedOrigins(&quot;*&quot;).build()\n      )\n\t  .annotatedService(\n        &quot;/e4r&quot;,\n        ChatController(ChatService(new ChatRepository))\n      )\n      .requestTimeout(Duration.ofSeconds(1000))\n      .build()\nWebSocketService builder takes socketService and builds a websocket handler. Method allowOrigins let’s it accept connection from any origin.\nFollowing code snippet shows SocketService.\nclass SocketService extends WebSocketServiceHandler:\n \n  override def handle(ctx: ServiceRequestContext, in: WebSocket): WebSocket =\n\tval writer: WebSocketWriter = WebSocket.streaming()\n    in.subscribe(new Subscriber[WebSocketFrame]:\n      def onSubscribe(s: Subscription): Unit =\n        s.request(Long.MaxValue)\n \n      def onNext(webSocketFrame: WebSocketFrame): Unit =\n        try\n          val frame = webSocketFrame\n          try\n            frame.`type` match\n              case WebSocketFrameType.TEXT =&gt;\n\t\t\t\t// call handlers\n\t\t\t\tgetAllHanders.foreach((cb) =&gt; cb(frame.text()))\n              case WebSocketFrameType.CLOSE =&gt;\n                val closeFrame = frame.asInstanceOf[CloseWebSocketFrame]\n                writer.close(closeFrame.status, closeFrame.reasonPhrase)\n \n              case _ =&gt;\n              // do nothing\n          catch\n            case jsonException: ujson.ParseException =&gt;\n              println(jsonException)\n            case t: Throwable =&gt;\n              writer.close(t)\n          finally println(&quot;finally&quot;)\n        catch\n          case t: Throwable =&gt;\n            println(t)\n \n      def onError(t: Throwable): Unit =\n        writer.close(t)\n \n      def onComplete(): Unit =\n        println(&quot;CLOSED&quot;)\n        writer.close\n    )\n    writer\n \n  def emit(namespace: String, data: String): Unit =\n    this.socketWriters.values.foreach((writer) =&gt;\n      writer.write(this.createPayload(namespace, data, &quot;namespaced&quot;))\n    )\n \nSocketService extends WebSocketServiceHandler. The important method to implement is handle which triggers every time any client connects with the server.\nArmeria implements Websocket using reactive streams. So, a subscriber is attached to the web socket reactive stream in on every new connection. The writer stream is used to write data to the connected client socket.\nwriter.write(&quot;Hello world&quot;)\nemit is the method that takes a namespace and data. Any handler on the client side listening on this namespace will get that data.\nSo, whenever a new message is created, all the connected clients have to be notified about the message. This can be accomplished using,\n  class ChatController(chatService: ChatService, socket: SocketService):\n  // ...\n  @Post(&quot;/create-message&quot;)\n  @RequestConverter(classOf[JacksonRequestConverterFunction])\n  def createMessage(message: MessageDTO): HttpResponse =\n\tsocket.emit(&quot;new-message&quot;, message.toJson)\n    chatService\n      .createMessage(message.toMessage)\n      HttpResponse.of(HttpStatus.CREATED)\n \nnew-message is namespace and message.toJson is data.\nLet’s try creating a message and see if we get new message on client socket.\n\nSo, the client is connected to the server. Creating a new message triggers a message event on client socket. The below picture shows the message it got from the server.\n\nOur simple chat application (without any UI 😂) is working.\nImplementing Socket on UI\nSimilar to backend, we have written a wrapper on top of WebSocket. This simplistic wrapper manages namespaces and invokes handlers listening on respective namespaces.\ntype fn = { (data: string): void };\n \nclass ChatSocket {\n  handlers: { [key: string]: fn[] };\n  //...\n  connect() {\n    this.socket = new WebSocket(this.url + `/${this.username}`);\n    this.socket.addEventListener(&#039;open&#039;, () =&gt; {\n      console.log(&#039;socket connected&#039;);\n    });\n \n    this.socket.addEventListener(&#039;message&#039;, (event: MessageEvent) =&gt; {\n      const { namespace, data } = JSON.parse(event.data);\n      this.handlers[namespace].forEach((cb) =&gt; cb(data));\n    });\n \n    this.socket.addEventListener(&#039;close&#039;, (event) =&gt;\n      console.log(&#039;Closed&#039;, event)\n    );\n \n    return this;\n  }\n  //...\n}\nTo register a handler, wrapper implements an on method.\nclass ChatSocket {\n  //...\n  on(namespace: string, cb: fn): void {\n    const handlers = this.handlers[namespace];\n \n    if (handlers) {\n      handlers.push(cb);\n      return;\n    }\n \n    this.handlers[namespace] = [cb];\n  }\nUsing Socket wrapper in Chat component\nAs of now, we are only listening on new messages. We are not sending messages using socket. Messages are created using HTTP REST request only.\nFollowing shows usages of socket wrapper in a chat component.\nconst Chats = ({ chatService, username }: ChatAppProps) =&gt; {\n  //...\n \n  useEffect(() =&gt; {\n    //...\n    const chatSocket = new ChatSocket(\n      &#039;ws://localhost:8000/chat&#039;,\n      username\n    ).connect();\n \n    chatSocket.on(&#039;new-message&#039;, (message: Message) =&gt;\n      setMessages((prevMessages: Message[]) =&gt; [...prevMessages, message])\n    );\n  }, []);\n  //...\n};\nuseEffect hook initialises the socket and socket starts listening on new-message namespace. Whenever a new message comes, setMessages updates the messages state and the component updates.\nConclusion\nArmeria is a newly developed framework which is currently in development. It provides several powerful features such as allowing to run different services within a single application and on the same port. It also provides asynchronous execution out of the box. So, it can handle multiple requests without us implementing concurrency and get our hands dirty in threads and concurrency. If you are looking for a lightweight, fast, asynchronous, and ready-to-use REST API framework, it is a good choice to go with.\nHowever, being a new framework, the documentation is undeveloped. We tried to find the implementation of web sockets by going inside the tests they’ve created.\nAcknowledgements\nWe would like to thank Satya and the Retreat team for organising such an interesting Retreat. Thanks to all the team members (Shubham Chauhan and Atul) who have chosen this trivial problem statement to explore.\nReferences\n\nArmeria Official Docs. URL: armeria.dev/docs/\nArmeria Github Repo. URL: github.com/line/armeria\nTrustin Lee — Armeria: A microservice framework well-suited everywhere. Youtube. URL: www.youtube.com/watch%2CJoker%D0%B8JUGru\nArmeria: A microservice framework well-suited everywhere. URL: speakerdeck.com/trustin/armeria-a-microservice-framework-well-suited-everywhere\n"},"index":{"title":"index","links":[],"tags":[],"content":"bitPhile\nA knowledge repository where I add my daily notes on tech I read and blogs I create, and other content."},"notes/book-reviews/design-of-everyday-things":{"title":"design-of-everyday-things","links":[],"tags":["books","review"],"content":"Book - The design of everyday things\nIntroduction\n\n“The design of everyday things” is a book by Don Norman, published in 1988, critiques the design of everyday things and objects. It focuses on the importance of how good design can make people lives easy.\nIt also stresses upon how poor design can create frustrations and confusions and that good design should be intuitive and easy to use.\nAuthor shares several design principles and respective examples in depth that brought from the real world.\n\nAuthor\n\nNow a bit about the author.\nDon Norman is a prominent researcher, writer, and a consultant in the field of human-centered design and user experience.\nHis book “The design of everyday things” has become classic in the field of design and read by designers, engineers , students etc.\nHe has written other books like “Emotional Design: Why we love or hate everyday things” and “Living with complexity”.\nBook has : pages\n\nTheme\n\nThe theme of the book is mainly on design principles, user focused design and effects of good and poor design in surroundings.\n\nPrinciples discussed\n\nUnderstanding the needs of the user\naffordances: products should clearly indicate how they can be used and what all is possible\n\ngive some impromptu examples\n\n\nsimplicity\nconsistency: the should be consistency across different products, interfaces and systems. This helps user to understand and navigate easily.\nfeedback\nmapping : relationships between controls and the effects should be clear and intuitive\nConstraints: Products should constrain the actions of users in appropriate ways, making it harder for them to make mistakes\nError recovery: Products should provide clear and straightforward methods for users to recover from mistakes and continue using the product effectively.\n\nExamples\n\nDoors. Push and pull doors\nDoors. Fire exit doors\nLight switches\nComputer interfaces\n\nLot of system related things on the front page\nhave to remember complex commands\nnot giving clear feedback\ngive example of government websites\n\n\nYour example of plane\n\nIt is about British European Airways flight 548\nThere were controls for droops and flaps.\n\ndroops are aerodynamic surfaces that help increase the lift during take off\n\n\nThose were same looking controls and anyone can get confused between them.\nThird pilot by mistake changes the flaps liver instead of droops\nIn the end plane crashes.\nExample of your water bottle accessibility\n\n\n"},"notes/logics/browser-tabs/fol":{"title":"fol","links":[],"tags":["logics","links","fol"],"content":"\nSemantics of predicate logics@Youtube\nFOL truth assignments @Youtube\nSemantics of FOL blog\nSemantics of fol lecture pdf\nFOL syntax and semantics\n\n"},"notes/logics/discussions/kkr-meetings":{"title":"kkr-meetings","links":[],"tags":[],"content":"\nexpert systems\n\n"},"notes/logics/domain-reasoning":{"title":"domain-reasoning","links":["tags/fol"],"tags":["fol"],"content":"fol\nClosed world\n\nIt says what you all know is all there in the world\nIt implies If there is something which is not known, it is false.\n\nOpen world\n\nIt says we have only partial knowledge of the world.\nIt implies that conclusions made now will have to be withdrawn when more facts come to light.\n"},"notes/logics/examples/entailment-using-language-of-logic":{"title":"entailment-using-language-of-logic","links":[],"tags":["reasoning","inferences","semantics","example"],"content":"Below is an example which shows Entailment using language of logic and connectives.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nABA -&gt; BTTTTFFFTTFFT\nGiven A -&gt; B is true. Then new table looks like,\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nABA -&gt; BTTTFTTFFT\nGiven A is true. Then new table is,\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nABA -&gt; BTTT\nSo, B is necessarily be true.\nWe can say that, A and A -&gt; B entail B.\n\\{(A -&gt; B), A\\} ⊨ B\nReference\n\nThe language of Logic\n"},"notes/logics/examples/proving-modus-ponens-resolution":{"title":"proving-modus-ponens-resolution","links":["notes/logics/propositional-logic/clausal-form"],"tags":["reasoning","example","inferences"],"content":"Modus Ponens,\n(p \\land (p \\rightarrow q)) \\rightarrow q\nLet’s tryna prove this using contradiction by checking satisfiability using resolution method.\n\\lnot ((p \\land (p \\rightarrow q)) \\rightarrow q)\nIt can be solved more as shown below.\n(p \\land (p \\rightarrow q)) \\land \\lnot q, using \\lnot (A \\rightarrow B) \\equiv A \\land \\lnot B\nSimplifying it further,\np \\land (\\lnot p \\lor q) \\land \\lnot q\nConverting it into clausal form,\n\n\\displaylines{\n\\{p\\} - (1) \\\\\n\\{\\lnot p, q\\} - (2) \\\\\n\\{\\lnot q\\} - (3)\n}\nUsing (1) and (2),\n\\displaylines{\n\\{q\\} . . . (1), (2) - (3)\\\\\n\\{\\lnot q\\} - (4)\n}\nFurther down,\n\\displaylines{\n\\{\\} ... (3), (4)\n}\nWe get empty set which depicts negation of modus ponens is unsatisfiable. Hence proved that Modus Ponens is a tautology."},"notes/logics/exercises/convert-formula":{"title":"convert-formula","links":[],"tags":["exercises","fol","reasoning","inferences"],"content":"Given\n(A === B)\nExpress it using AND and NOT"},"notes/logics/exercises/find-tautology-of-formula":{"title":"find-tautology-of-formula","links":[],"tags":["reasoning","inferences","exercises"],"content":"Given formula\n(B ∧ (A ⊃ B)) ⊃ A\nFind if it is tautology using truth table method.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nABA ⊃ BB ∧ (A ⊃ B)(B ∧ (A ⊃ B)) ⊃ ATTTTTTFFFTFTTTFFFTFT\nAs third rows give a false value, Hence proved that the given formula is not a tautology."},"notes/logics/first-order-logic/first-order-logic":{"title":"first-order-logic","links":[],"tags":["reasoning","inferences","knowledge-representation"],"content":""},"notes/logics/first-order-logic/interpretation":{"title":"interpretation","links":[],"tags":["reasoning","inferences","knowledge-representation"],"content":"Interpretation of the language with the domain assigns semantics to the symbols used in language.\nIn first order logic, the interpretation requires a domain and interpretation changes when domain changes.\nA constant symbol C is interpreted in domain D to an element or an object the domain.\nC \\in D\nA function symbol f of an arity n maps n elements in domain D to an element in D.\nf(E1_D, E2_D,..., En_D) \\in D\nA predicate or relation symbol R of an arity n is interpreted as a tuple of elements in domain D for which the R is true.\n\\langle E1_D, E2_D,..., En_D \\rangle \\subset D\n\n\n                  \n                  Todo\n                  \n                \n\n\n Verify the interpretation of predicate or relation symbol (@2024-06-20)\n\n\n"},"notes/logics/first-order-logic/quantifiers":{"title":"quantifiers","links":[],"tags":["logics","reasoning","inferences"],"content":"Quantifiers\nFOL provides two quantifiers, \\forall and \\exists which stands for for\\ all and exists respectively.\n\\forall\n\\forall x\\ (\\alpha)\nThis implies that for all x, \\alpha formula holds (true or false).\nIn lisp, it can be represented as, (forall\\ (x) (\\alpha))\n\\exists\n\\exists x\\ (\\alpha)\nThis implies that there exists a x for which \\alpha formula holds (true or false).\nIn lisp, it can be represented as, (exists\\ (x) (\\alpha))\nExamples\nAll Men are Mortal.\n\\forall x\\ (Man(x) \\rightarrow Mortal(x))\nIn lisp,\n(forall (x) (if (man x) (mortal x)))\nSome Men are tall.\n\\exists x\\ (Man(x) \\land Tall(x))\n(exists (x) (and (man x) (tall x)))\n\n\n                  \n                  Info\n                  \n                \n\nNotice the connective with \\forall and \\exists.\n\n\n\n\n                  \n                  Todo\n                  \n                \n\n\n Find why different connective for universal and existential quantifier (@2024-06-20)\n\n\n\nWhy different connectives for universal and existential quantifier?\nWe use \\rightarrow with \\forall and \\land with \\exists. Why?\nNot enough clear about why? As of now just with the thumb rule. I need to figure out why or I’m not satisfied or didn’t understand it.\nSee these conversations\n\nWhy can’t we use implication for the existential quantifier?\n“Why can’t we use implication for the existential quantifier?” (From MSE)\n\n"},"notes/logics/first-order-logic/rules-of-inference":{"title":"rules-of-inference","links":[],"tags":["inferences","reasoning","knowledge-representation"],"content":"Rules Of Inference\nPropositional rules are still applicable in FOL. In addition there are two more rules in FOL.\nUniversal Instantiation\n\\forall x \\ P(x) \\over P(a), a \\in C\nIt says that if for all x on P(x) is true then P(a) also holds true. That is, if for all values for x, if the formula turns out to be true, then formula for a in P(a) will also holds true.\nFor instance,\n\\displaylines {\n    \\forall x \\ (Man(x) \\rightarrow Mortal(x)) \\over Man(Socrats) \\rightarrow Mortal(Socrats)\n}\nGeneralisation\nP(a) \\over\n\\exists x \\ P(x)\nIt says that if, P(a) is true, then some of x for P(x) also holds true.\nFor instance,\n\\displaylines {\n    Student(Hemant) \\land Bully(Hemant) \\over\n    \\exists x \\ Student(x) \\land Bully(x)\n}"},"notes/logics/first-order-logic/rules-of-substitution":{"title":"rules-of-substitution","links":[],"tags":["reasoning","inferences","knowledge-representation"],"content":"Similar to PL, FOL also have rules of substitution.\n\\displaylines {\n    \\lnot (\\forall x \\ P(x)) \\equiv \\exists x \\ \\lnot(P(x)) \\ \\ldots \\ DeMorgan&#039;s \\ Law \\\\\n    \\lnot (\\exists x \\ P(x)) \\equiv \\forall x \\ \\lnot (P(x)) \\ \\ldots \\ DeMorgan&#039;s \\ Law \\\\\n    \\forall x \\forall y \\equiv \\forall y \\forall x \\\\\n    \\exists x \\exists y \\equiv \\exists y \\exists x \\\\\n    \n}\n\n\n                  \n                  Info\n                  \n                \n\n\\exists x \\forall y \\equiv \\forall y \\exists x is not valid.\n\n"},"notes/logics/first-order-logic/syntax":{"title":"syntax","links":[],"tags":["reasoning","syntax","inferences","knowledge-representation"],"content":"Syntax\nFirst order syntax comprises followings\n\nConstants symbols. Such as Bob, Alice, Mathematics etc.\nVariables symbols.\nFunctions symbols. Functions interpreted as Symbols taking input objects and returning output objects. They have arity (number of arguments). For example, fatherOf(Bob), etc. Function symbols follow snake case.\nPredicate Symbols. Similar to functions but can be thought as specifying the property of given input. It defines relationships between/among objects. For example, Rich(Bob) defines Bob\\ is\\ Rich. Owns(Bob, Car) etc. Predicate symbols follow CamelCase.\nQuantifiers. Universal Quantifier  \\forall and existential quantifier \\exists.\nLogical connectives and negation.\n\nUsing these six components, FOL has\n\nTerms\n\nConstants such as mathemetics, arithmetic, drawing etc.\nVariables such as x.\nFunctions of terms. Functions taking terms.  P(T_1, T_2, ...,T_n) where T_i are terms and n is the arity of the function.\n\n\nFormulas\n\nAtomic formulas. P(T_1, T_2, ...,T_n) where T_i are terms and n is the arity of the formula.\nQuantifiers, \\forall and \\exists.\n\n\n\nReferences\n\nFirst Order Logic Syntax and Semantics\n"},"notes/logics/formal-language":{"title":"formal-language","links":[],"tags":["knowledge-representation","reasoning","artificial-intelligence"],"content":""},"notes/logics/hierarchies-of-structured-knowledge":{"title":"hierarchies-of-structured-knowledge","links":["tags/fol","tags/references","tags/reasoning"],"tags":["fol","references","reasoning"],"content":"folreferencesreasoning\nTypes of Hierarchies\n\nAbstraction\n\nis-a\n\n\nAggregation\n\nis-part-of\n\n\n"},"notes/logics/inference-engine/backward-chaining":{"title":"backward-chaining","links":[],"tags":["inferences","reasoning","methods"],"content":"Taking a goal and proofing it by applying inference rules on KB."},"notes/logics/introduction":{"title":"introduction","links":["tags/fol","tags/inferences","tags/reasoning","tags/artificial-intelligence","tags/ai"],"tags":["fol","inferences","reasoning","artificial-intelligence","ai"],"content":"folinferencesreasoningartificial-intelligenceai\nThree types of inferences\n\nDeduction\n\nTaking all the facts and the giving the statement that necessarily be true\nMaking logical inferences\n\n\nAbduction\n\nTaking the final result going back to find the causes which may not be true.\nthese are mostly guesses.\n\n\n\nInduction\n\nGeneralisation of facts.\n\n\n\nEpistemic Logic\nIt deals with the logic of multi-agent systems. It allows us to represent statement of what agents know about other agents."},"notes/logics/left-sessions":{"title":"left-sessions","links":[],"tags":["sessions"],"content":"\n\n\n"},"notes/logics/logic-and-representation":{"title":"logic-and-representation","links":["tags/fol"],"tags":["fol"],"content":"fol\n\nPropositional logic\nFirst order logic\nDescription logic\nDefault reasoning\nEvent calculus\nEpistemic reasoning\n\n"},"notes/logics/logic/formal-logic":{"title":"formal-logic","links":["notes/logics/formal-language"],"tags":["artificial-intelligence","reasoning","knowledge-representation"],"content":"Formal logic uses formal system to represent logic where concrete expressions are replaced with symbols. It is only concerned with the abstract structure of the argument instead of the concrete content.\nFor example,\nAll Sanitisers have Alcohol.\nRoss is a Sanitiser.\nRoss has Alcohol.\nAll S have A.\nR is a S.\nR has A.\nFormal logic uses formal-language to express and analyse arguments.\nReferences\n\nFormal Logic Wikipedia\n"},"notes/logics/logic/logic":{"title":"logic","links":["notes/logics/logic/formal-logic"],"tags":["artificial-intelligence","reasoning","knowledge-representation"],"content":"A logic is used to asses the correctness of an argument. An argument is a set of premises together with a conclusion. For example,\nTeachers are good people.\nRamesh is a teacher.\nThen Ramesh is good person.\n\nThere are two types of logic.\n\nFormal logic\nInformal logic\n"},"notes/logics/new-note":{"title":"new-note","links":[],"tags":["reasoning","inferences","knowledge-representation"],"content":""},"notes/logics/potential-ideas":{"title":"potential-ideas","links":[],"tags":["reasoning","inferences","knowledge-management","ideas"],"content":"\nCombining inferences/reasoning with deep learning methods?\n"},"notes/logics/propositional-logic/ask":{"title":"ask","links":["notes/logics/terminology/entailment","notes/logics/propositional-logic/contradiction","notes/logics/propositional-logic/contingency"],"tags":["inferences","reasoning"],"content":"Asking is the queries the knowledge base.\nAgain three possible responses.\n\nYes. Entailment.\nNo. Contradiction.\nI don’t know. Contingency\n"},"notes/logics/propositional-logic/clausal-form":{"title":"clausal-form","links":[],"tags":["inferences","reasoning"],"content":"Clausal form consists of clause sets.\nClause\nA clause is a set of clause expressions.\nFor example, \\{p\\}, \\{q\\}, ...\nHere, \\{p\\} is a clause.\nClause expression\nA clause expression can be a literal or disjunction of literals.\n\\displaylines {\n    p \\\\\n    q \\\\\n    p \\lor q\n}\nRepresenting these expressions as clauses,\n\\displaylines {\n    \\{p\\} \\\\\n    \\{q\\} \\\\\n    \\{p, q\\} \\\\\n}\nReferences\n\nPropositional Resolution\n"},"notes/logics/propositional-logic/conditional-proofs":{"title":"conditional-proofs","links":["notes/logics/propositional-logic/conditional-wff","notes/logics/terminology/antecedent-consequent"],"tags":["reasoning","inferences","knowledge-management"],"content":"A conditional proof is used to derive a conditional wff. A conditional proof involves that if the consequent of conditional wff can be derived from the given premises and derivations by assuming Antecedent to be true.\nFor example,\n\\begin{array}{l} P \\rightarrow (Q \\lor R)\\\\ P \\rightarrow \\neg S\\\\ S \\leftrightarrow Q\\\\ \\hline P \\rightarrow R \\end{array}\nIf we can derive R by assuming P to be true and using rules of inferences and replacement rules on those given premises, then we can conclude that P \\rightarrow R.\nReferences\n\nConditional Proofs\n"},"notes/logics/propositional-logic/conditional-wff":{"title":"conditional-wff","links":[],"tags":["reasoning","inferences","knowledge-management"],"content":"A conditional wff is a formula whose main operator is \\rightarrow.\nFor example,\n A \\rightarrow B"},"notes/logics/propositional-logic/contingency":{"title":"contingency","links":[],"tags":["inferences","reasoning"],"content":"Contingency when a new information is added to the knowledge base which was not previously known.\nIn logical terms,\n\\emptyset \\subseteq M(f) \\subsetneq M(KB)"},"notes/logics/propositional-logic/contradiction":{"title":"contradiction","links":[],"tags":["inferences","reasoning"],"content":"KB contradicts f iff M(KB) \\cap M(f) = \\emptyset.\nFor example, Rain \\land Wet contradicts \\lnot Wet."},"notes/logics/propositional-logic/deduction-theorem":{"title":"deduction-theorem","links":[],"tags":["reasoning","inferences"],"content":"This theorem says that,\n\n\\Gamma, A \\vdash B \\ \\ \\ \\  \\ iff \\ \\ \\ \\ \\ \\Gamma \\vdash A \\rightarrow B\nThis theorem is also called as conditional proof. (Still not verified)."},"notes/logics/propositional-logic/definite-clauses":{"title":"definite-clauses","links":[],"tags":["reasoning","inferences"],"content":"Definite Clause have this form,\n(P_1 \\land P_2 \\land P_3, ...p_k) \\rightarrow q"},"notes/logics/propositional-logic/direct-deductions":{"title":"direct-deductions","links":[],"tags":["reasoning","inferences","knowledge-management"],"content":"Direct deduction is a form of reasoning where reaching to the conclusion comprises applying the inference rules on given premises and deriving new rules and in turn applying inference rules on them until the conclusion is derived.\n\n\n                  \n                  Not Sure \n                  \n                \n\nIf natural deduction is a type of direct deduction.\n\n"},"notes/logics/propositional-logic/forward-reasoning":{"title":"forward-reasoning","links":[],"tags":["reasoning","inferences"],"content":"Forward Reasoning is the repetitive process of finding new facts using rules of inference, adding them to KB and continue this process until we reach the final goal.\nFor example,\nReferences\n\nForward reasoning at nptel youtube video\n"},"notes/logics/propositional-logic/frege-axioms":{"title":"frege-axioms","links":["notes/logics/propositional-logic/propositional-logic","notes/logics/terminology/tautology"],"tags":["inferences","reasoning","logic"],"content":"Gottlob Frege was the first person who axiomatise Propositional Calculus by giving Tautologies.\nReferences\n\nFrege’s Propositional Calculus Wikipedia\n"},"notes/logics/propositional-logic/horn-clauses":{"title":"horn-clauses","links":[],"tags":["inferences","reasoning"],"content":""},"notes/logics/propositional-logic/interpretation-function":{"title":"interpretation-function","links":[],"tags":["reasoning","inferences"],"content":"An interpretation function is a something which takes a formula (f), a model (w) and evaluates the formula with the given models which results in either of the two values true or false.\nI(f, w)"},"notes/logics/propositional-logic/limitations":{"title":"limitations","links":[],"tags":["reasoning","inferences"],"content":"Limitations\n\nIt only consists of propositional and formulas. It doesn’t have relationships among objects.\nNot able to express complex sentences and relations.\n\n1. \\ Alice\\ and\\ Bob\\ know\\ drawing\nHow can it be represented in PL?\nSomething like this?\n\\displaylines{\n    AliceKnowsDrawing \\land BobKnowsDrawing\n}\n2. \\ All\\ students\\ know\\ drawing\nHow can it be represented in propositional logic?\n\\displaylines {\n    AIsStudent \\rightarrow AKnowsDrawing \\\\\n    BIsStudent \\rightarrow BKnowsDrawing \\\\\n    CIsStudent \\rightarrow CKnowsDrawing \\\\\n    ...\n    \n}\n\nNo notion for categories and individuals.\nIt is missing objects and relations or predicates. For example, AliceKnowsDrawing can be decomposed into Alice, \\ knows, \\ drawing where Alice and drawing are two objects connected with a predicate knows.\n\nReferences\n\nLimitations of propositional logic\nFirst-Order Logic: Syntax and Semantics web.engr.oregonstate.edu/~afern/GOFAI/notes/first-order-logic-syntax-semantics.pdf\n\n"},"notes/logics/propositional-logic/model-checking":{"title":"model-checking","links":["notes/logics/examples/entailment-using-language-of-logic"],"tags":["inferences","reasoning"],"content":"A formula has a valuation. Valuation means it may have value true or false. This is also called as interpretation of the formula.\nIf the interpretation results in true value, then we can say that the interpretation is the model of the formula (Not sure about this statement. Some resources say this and some tell some other).\nFor example, let’s take this formula and try to find its model.\n\\lnot (A \\rightarrow B)\nWe have to find valuation that results in true value for the formula.\n(A \\rightarrow B) has to be false which means, A has to be true and B has to be false. So, the whole formula turns into false. Refer the truth table for implies.\n\\lnot (A \\rightarrow B) will becomes true. We found the model for this formula.\n\nIf \\lnot (A \\rightarrow B) has no model, then we can say that (A \\rightarrow B) is tautology.\n\nReferences\n\nPropositional logic review\n"},"notes/logics/propositional-logic/model":{"title":"model","links":[],"tags":["reasoning","inferences"],"content":"A model is a putting true and false values for variables in a formula (f). It is denoted using w.\nf = Rain \\lor Wet\nPossible ws are \n1. \\hfill &amp; w \\hfill &amp; \\{Rain: true, Wet: True\\} \\hfill \\cr \n2. \\hfill &amp; w \\hfill &amp; \\{Rain: false, Wet: True\\} \\hfill \\cr \n3. \\hfill &amp; w \\hfill &amp; \\{Rain: True, Wet: False\\} \\hfill \\cr \n4. \\hfill &amp; w \\hfill &amp; \\{Rain: False, Wet: False\\} \\hfill \\cr }$$"},"notes/logics/propositional-logic/models":{"title":"models","links":["notes/logics/propositional-logic/model"],"tags":["reasoning","inferences"],"content":"Models is a set of all the models for which the interpretation function gives true for formulas. It is represented as,\nf = Rain \\lor Wet\nM(f) = set\\ of\\ \\bf w\\ \\it which\\ gives\\ \\bf true \nSo, M(f) will be models 1 to 3 from ws as shown in .\nM(KB)\nM(KB) is an intersection of all the formulas in the KB.\nM(KB) = \\bigcap \\limits_{f\\in KB} M(f) \nFor example,\nKB = \\{Rain, Rain \\rightarrow Wet\\}\nThen M(KB) will be,\nM(Rain) \\cap M(Rain \\rightarrow Wet)\nM(Rain) = \\{Rain: True\\}\nM(Rain \\rightarrow Wet) = {(Rain: true, Wet: true), (Rain: false, Wet: true), (Rain: false, Wet: false)}\n\nSo, the intersection will be.\n\n$M(KB) = \\{Rain: true, Wet: true\\}$"},"notes/logics/propositional-logic/proof-by-contradiction":{"title":"proof-by-contradiction","links":[],"tags":["reasoning","inferences"],"content":"It is an indirect way of proofing where we assume that the statement is false and try to proof that. If we are not able to proof that the statement is false, then the statement is essentially true."},"notes/logics/propositional-logic/propositional-logic-syntax":{"title":"propositional-logic-syntax","links":["notes/logics/propositional-logic/frege-axioms"],"tags":["reasoning","inferences","syntax"],"content":"Propositional Logic Syntax consists of following parts.\n\nPropositional statements represented as Upper case letters. For instance, P, Q, R, ..., P_1, P_2, ...\n\nAll the statements are represented using these letters.\n\n\nLogical connectives\n\n\\land, \\lor, \\leftrightarrow, \\rightarrow and \\lnot.\n\n\nInference rules\nAxioms\n\nReferences\n\nSyntax and Formation rules of PL\n"},"notes/logics/propositional-logic/propositional-logic":{"title":"propositional-logic","links":["notes/logics/terminology/connectives"],"tags":["reasoning","inferences","logic"],"content":"Propositional logic is a formal system that deals with manipulation and evaluation of propositions or statements based on their truth or falsity. It doesn’t concern about the meaning of the statements for the logic.\nIt consists a set of propositional variables, logical connectives, inference rules and axioms.\nReferences\n\nPropositional Calculus Wikipedia\nPropositional Logic at Internet Encyclopedia of Philosophy\n"},"notes/logics/propositional-logic/rules-of-inference/Modus-tollens":{"title":"Modus-tollens","links":[],"tags":["inferences","reasoning"],"content":"This says, if you know ~Q and P -&gt; Q then you can say ~P.\nA simple example of modus-tollens is\n\\matrix{ 1. \\hfill &amp; \\lnot Q \\hfill &amp; \\hbox{Premise} \\hfill \\cr 2. \\hfill &amp; P ⊃ Q \\hfill &amp; \\hbox{Premise} \\hfill \\cr 3. \\hfill &amp; \\lnot P \\hfill &amp; \\hbox{Modus tollens (1, 2)} \\hfill \\cr}\nAn invalid modus-tollens\n\\matrix{ 1. \\hfill &amp; Q \\hfill &amp; \\hbox{Premise} \\hfill \\cr 2. \\hfill &amp; P ⊃ Q \\hfill &amp; \\hbox{Premise} \\hfill \\cr 3. \\hfill &amp; \\lnot P \\hfill &amp; \\hbox{INVALID Modus tollens (1, 2)} \\hfill \\cr}\nFor example,\nYou water the garden, the garden get wet -&gt; 1\nthe garden is not wet -&gt; 2\nYou not watered the garden -&gt; Modus tollens (1, 2)\n\nLet’s verify the other way round,\n\\matrix{ 1. \\hfill &amp; \\lnot P \\hfill &amp; \\hbox{Premise} \\hfill \\cr 2. \\hfill &amp; P ⊃ Q \\hfill &amp; \\hbox{Premise} \\hfill \\cr 3. \\hfill &amp; \\lnot Q \\hfill &amp; \\hbox{INVALID Modus tollens (1, 2)} \\hfill \\cr}\nFor example,\nYou water the garden, the garden get wet -&gt; 1\nYou not watered the garden -&gt; 2\nThe garden is not wet -&gt; INVALID Inference as the garden can be wet if it rains.\n\nReferences\n\nRules of inferences and logic proofs\nLogic rules\n"},"notes/logics/propositional-logic/rules-of-inference/abduction":{"title":"abduction","links":[],"tags":["reasoning","inferences"],"content":"Representing Abduction using formal language,\nA ⊃ B\\ and\\ B\\ \\over A\nThe conclusion is not necessarily true. It is possible that A is true or false.\nFor instance,\nIf you water the garden (A), then the lawn becomes wet (B)\nthe lawn is wet (B)\nTherefore, you watered the garden (A)\n\nIt is not always true. As rain can also wet the garden."},"notes/logics/propositional-logic/rules-of-inference/modus-ponens":{"title":"modus-ponens","links":[],"tags":["inferences","reasoning"],"content":"Modus Ponens Denoted as\nA ⊃ B\\ and\\ A\\ \\over B\nIt means, If A implies B and A is true then B will also be true. This is Deduction.\nFor example,\nIf you water the garden (A), then the lawn becomes wet (B)\nyou water the garden (A)\nTherefore, lawn become wet (B)\n"},"notes/logics/propositional-logic/rules-of-inference/resolution-method":{"title":"resolution-method","links":[],"tags":["inferences","reasoning"],"content":"Resolution is a theorem prover method which is sound and complete. It works by converting the premises and conclusions to clause expressions or clausal form.\nWhat resolution method says is,\n\\{\\lnot p, q\\}, \\{p, r\\}\n\\over\n\\{q, r\\}\nIt means, if two clauses having a literal and its negate, then we can combine all those clauses by removing those complementary pair.\n\\{p_1, p_2,...,p_n,\\lnot q\\}, \\{r_1, r_2,...,r_n, q\\}\n\\over\n\\{p_1, p_2,...,p_n, r_1, r_2,...,r_n\\}\n\n\n                  \n                  Important\n                  \n                \n\nEmpty clause means that the set of clauses are unsatisfiable. This property will be used one the applications (proving the unsatisfiability).\n\n\nCommon Resolutions\n1. Modus Ponens\n    p \\rightarrow q\n    ,\\ p\n    \\over\n    q\nThis is can be done using resolution method.\n\\{\\lnot p, q\\}, \\{p\\} \\over \\{q\\}\nReference\n\nPropositional Resolution\n"},"notes/logics/propositional-logic/rules-of-inference/substitution":{"title":"substitution","links":[],"tags":["inferences","reasoning"],"content":""},"notes/logics/propositional-logic/satisfiability":{"title":"satisfiability","links":[],"tags":["inferences","reasoning"],"content":"A KB is satisfiable iff M(KB) \\ne \\emptyset\nA compound formula is a satisfiable when there is at least one model which evaluates formula to true."},"notes/logics/propositional-logic/tableau-method":{"title":"tableau-method","links":["notes/logics/terminology/tautology","notes/logics/propositional-logic/proof-by-contradiction","notes/logics/propositional-logic/rules-of-inference/modus-ponens"],"tags":["reasoning","inferences"],"content":"Tableau Method\nTableau method is a method to proof satisfiability of a set of formulas.\nIt is also used to proof a formula to be tautology using proof by contraction.\nBasic rules\n\nWe have to break the complex formula until it gets to single atomic formulas.\nLogical \\lor creates branches (that’s obvious as it makes two sets out of single set).\nEach of the branch should have every formula expanded at least once.\nIf there is a contraction of any atomic formula in the branch, then that branch is closed.\nIf all the branches are closed then set of formulas is not satisfiable.\nIf there is any one branch opened, set is satisfiable.\n\n\n\n                  \n                  Info\n                  \n                \n\nClosed: When there is any contraction exists for any formula in a branch.\nOpened: Opposite of closed.\n\n\nLet’s see an example for better understanding.\nset = \\{(a \\lor b) \\land c, \\lnot b \\lor \\lnot c, \\lnot a\\}\n\nProof Tautologies\nA tautology can be proofed by taking the negate of that and try to proof satisfiability for that negate using tableau method. If that negate is unsatisfiable, then the tautology is proofed.\nexample, let’s proof modus ponens\n(A \\land (A \\rightarrow B)) \\rightarrow B\nTaking negation of this,\n\\lnot((A \\land (A \\rightarrow B)) \\rightarrow B)\n   ~((A ∧ (A -&gt; B)) -&gt; B)\n           |\n     (A ∧ (A -&gt; B))\n           |\n          ~B\n           |\n           A\n           |\n        (A -&gt; B)\n        /      \\\n       /        \\\n     ~A         B\n    CLOSED    CLOSED\n\nSo, both branches are closed and there is no model for the negation. So, we can conclude that Modus Ponens is a tautology.\nReferences\n\nPropositional tableaux - DIAG\n"},"notes/logics/propositional-logic/tell":{"title":"tell","links":["notes/logics/terminology/entailment","notes/logics/propositional-logic/contradiction","notes/logics/propositional-logic/contingency"],"tags":["inferences","reasoning"],"content":"A tell operation is feeding knowledge to the KB.\nTell[f]\\rightarrow KB  \\rightarrow ?\nPossible respones:\n\nAlready know that. This is entailment. KB \\vDash f\nDon’t believe that. This is contradiction. KB \\vDash \\lnot f.\nNew knowledge. This is contingency. f \\rightarrow KB\n"},"notes/logics/questions":{"title":"questions","links":[],"tags":["query","questions"],"content":"\nWhat actually a model is?\n\nA model is the true or false value for variables?\n\nTold by this video\n\n\nOr a set of values of variables which that evaluates the formula true?\n\nTold by this video \n\n\n\n\nHow to fix completeness in Propositional logic?\n\nRestricting propositional logic using clauses?\nUsing resolution?\n\n\nIs natural deduction and direct deduction same?\nWhat is deduction theorem?\n\nis it just assuming A to derive B and the concluding this A \\rightarrow B ?\n\n\n\n"},"notes/logics/syllogism":{"title":"syllogism","links":["notes/logics/logic/formal-logic"],"tags":["artificial-intelligence","knowledge-representation","reasoning"],"content":"It is a form of logical reasoning with two premises which considered to be true to arrive at the conclusion. It consists of three sentences.\nAll forts are historic.\nSinhagad is a fort.\nTherefore, Sinhagad is historic.\nIt was used in antiquity (Ancient times). Now it is replaced with formal-logic.\nReferences\n\nSyllogism\n"},"notes/logics/symbols-and-thought/reasoning":{"title":"reasoning","links":[],"tags":["ai","fol","reasoning","flash-card"],"content":"\nThe manipulation of symbol in a meaningful manner.\nReasoning is the activity of drawing inferences.\n\n"},"notes/logics/symbols-and-thought/representation":{"title":"representation","links":[],"tags":["fol","ai","reasoning"],"content":"Semiotics\nA branch of study of symbols.\nBiosemiotics\nA branch of study about the interaction of simple systems to give complex behaviours.\nPhysical symbol system\nA symbol system is a collection of systems. Such as alphabets etc.\nA physical symbol systems follows the rules or laws such as addition, division etc.\nSymbolic AI\nThe ability of manipulating symbols."},"notes/logics/symbols":{"title":"symbols","links":[],"tags":["symbols","connectives"],"content":"\nAND : ∧\nOR: ∨\nImplies: ⊃\nNAND: ↑\nNOR: ↓\n\n"},"notes/logics/taxonomies":{"title":"taxonomies","links":["tags/fol","tags/reasoning","tags/knowledge-representation"],"tags":["fol","reasoning","knowledge-representation"],"content":"folreasoningknowledge-representation\nTaxonomy is the classification data into categories and sub-categories.\nFor example, animals have two eyes. So, Cat inherits animal. So, Cat has two eyes."},"notes/logics/terminology/antecedent-consequent":{"title":"antecedent-consequent","links":[],"tags":["reasoning","inferences"],"content":"Given the Proposition below,\nA \\to B\nA is called antecedent and B is called consequent."},"notes/logics/terminology/connectives":{"title":"connectives","links":[],"tags":["artificial-intelligence","knowledge-representation","reasoning"],"content":"Connectives are symbols used to conjunct two or more logical sentences. There are different logical connectives, 1 Unary (~) , 16 binary connectives etc.\nLogical connectives are defined using truth table. For example, below shows the truth table for implies (-&gt;) connective.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\negABA -&gt; B1TTT2TFF3FTT4FFT\nSheffer Stroke or NAND is a connective. It is represented using ↑\nPeirce Arrow or NOR is a connective. It is represented using ↓."},"notes/logics/terminology/dag":{"title":"dag","links":[],"tags":["graphs"],"content":""},"notes/logics/terminology/entailment":{"title":"entailment","links":[],"tags":["reasoning","knowledge-representation","artificial-intelligence","flash-card"],"content":"Entailment means that a sentence is true belonging to a true Knowledge base. It is said that the sentence entailed from the knowledge base.\nIt is denoted as where KB is knowledge base which is true and α is a sentence.\nKB ⊨ α\n\nSo, above statement says that KB entails α.\nWhen a sentence is entailed from a true knowledge base, then the sentence is said to be true.\nIn more logical terms, an formula f is entailed from the KB then the following is true.\nM(KB) \\subseteq M(f)\nEntailed f is not adding any new information to the KB. For example,\nKB = \\{Rain \\land Wet\\}\nf = Rain\nthen,\nM(KB) = \\{(Rain: true, Wet: true)\\}\nM(f) = \\{Rain: true\\}\nSo, M(KB) \\subseteq M(f)\nWe can say that KB \\vDash f."},"notes/logics/terminology/premise":{"title":"premise","links":["notes/logics/terminology/proposition"],"tags":["artificial-intelligence","inferences","reasoning","terminology","flash-card","knowledge-representation"],"content":"A premise is a proposition which is used in an argument to prove the truth of another proposition called conclusion."},"notes/logics/terminology/proof":{"title":"proof","links":[],"tags":["inferences","reasoning","artificial-intelligence","knowledge-representation","logic"],"content":"A logic machine can add new sentences to a knowledge base using the rules of inferences. A logic machine can have the algorithm to do so.\nWhen a sentence α is added to the knowledge base by a logic machine using the rules of inferences then we can say that,\nα is provable.\nKB ├─ α\n\nA proof system is defined by two things: premises (or axioms) and rules of inference. To proof a sentence truthiness, we use those premises and rules to synthesis new sentences and in the end the sentence we want to prove.\nThere are two types of proofs:\n\nDirect proofs. It goes from given premises to proof the conclusion.\nIndirect proofs\n\nReferences\n\nWhat are soundness and completeness?\nRules of inferences\n"},"notes/logics/terminology/proposition":{"title":"proposition","links":[],"tags":["artificial-intelligence","knowledge-representation","reasoning"],"content":"Proposition is a statement or assertion that expresses a judgement or opinion. (from Google).\nFor example, “Glass has milk” is a proposition which can be true or false.\nReferences\n\nWhat is Proposition? @nptelherd Youtube\n"},"notes/logics/terminology/soundness-and-completeness":{"title":"soundness-and-completeness","links":[],"tags":["inferences","reasoning","semantics"],"content":"Soundness\n\nWhat all can be derived is entailed.\n\n    KB \\vdash f \\subseteq KB \\vDash f\n\n\nThis statement states that what all derived is has superset of what all is entailed.\n\n\nSoundness of an reasoning algorithm means that it proves only true statements which are totally valid. These statements are guaranteed to be true. Deductive reasoning algorithms are supposed to sound in nature.\n\n\nSoundness means that if a sentence is provable, then it must be true with all its interpretations. In other words, it should also be entailed.\n\n\nA proof system is sound if everything that is provable is actually true.\n\n\nCompleteness\n\nWhat all be derived is more that what all can be entailed.\n\n    KB \\vdash f \\supseteq KB \\vDash f\n\n\nThis states that what all can be entailed is a part of what all can be derived.\n\n\nCompleteness means that it proves all the true statements. It ensures that it can find a valid solution for any valid input.\n\n\nA proof system is complete if everything that is true can be proved\n\n\nIt is required for any algorithm to be sound and complete.\nReferences\n\nlogic - what does soundness of a semantic reasoner mean? @stakeoverflow\ntextbooks.cs.ksu.edu/cis301/4-chapter/4_9-soundcomplete/index.html\n"},"notes/logics/terminology/tautology":{"title":"tautology","links":["notes/logics/propositional-logic/rules-of-inference/modus-ponens"],"tags":["inferences","reasoning","logic"],"content":"A statement which is always true. For example, Modus Ponens."},"notes/operating-systems/architectures":{"title":"architectures","links":["tags/os","tags/operating-system","tags/architecture"],"tags":["os","operating-system","architecture"],"content":"tags:osoperating-systemarchitecture\nis_child_of: [operating-systems]]\nOperating system architectures\n\nMonolithic\nLayered\n\nMonolithic\n\nIt is a single executable program comprising all the operating system functionalities.\nIt contains of different procedures linked togther to build a single executable that runs in kernel mode. If we see, it is a big kernel handles everything of an operating system.\nUser programs directly run on top of it. It becomes direct to access system resources as there is no layer.\nFor example, Linux is a monolithic operating system.\nHowever, some of modern monolithic operating systems have modular code which makes it quite simple to design the system. Moreover, these modules can be loaded at run time as not to make the boot process heavy.\nLayered\n\nOperating system responsibilities are divided among different layers solely responsible for their specific set of tasks.\nFor instance, layer for process management, IO, file management etc.\nMicrokernel\n\nIt basic idea about this design is that to put very less in kernel to make system reliable and robust.\nThe operating system is divided in small modules such that the very less is given to the kernel and most of the activities happen in user mode.\nA kernel is reponsible for the mechanism that is, it is reponsible for doing the work (lower level work) and the policies or rules of how to do things will be decided in user mode.\nSo mechanism and policy are decoupled. Mechanism will be taken care by kernel and policies will reside in user mode.\nFor instance, priority is the basic process scheduling algorithm. The priorities can be assigned in the user mode and the kernel can run process by looking their priorities."},"notes/operating-systems/file-system/i-node":{"title":"i-node","links":["tags/files","tags/file-system","tags/directories","notes/operating-systems/file-system/introduction"],"tags":["files","file-system","directories"],"content":"tags:filesfile-systemfilesdirectories\nis_child_of: introduction\nWhat is an i-node?\nAn i-node is a data structure which is used by file system to store metadata about files.\nIt contains information like name, permissions, file type, disk blocks location and so on.\nFile system maintains a table in the hard disk to store all these i-nodes.\nA directory contains files. These are not the actual files for sure. These are the structure having information about the file. It is a node of 16 bytes out of which, 2 bytes for i-node number and 14 bytes for file name.\nWhenever a file or a directory has to be located, it gets the file name and finds the i-node number and then gets the file metadata and the locates the file from the disk."},"notes/operating-systems/file-system/introduction":{"title":"introduction","links":["tags/os","tags/operating-system","tags/file-system","tags/files","tags/directories","tags/mounts","notes/operating-systems/operating-systems"],"tags":["os","operating-system","file-system","files","directories","mounts"],"content":"tags:osoperating-systemfile-systemfilesdirectoriesmounts\nis_child_of: operating-systems"},"notes/operating-systems/history":{"title":"history","links":["tags/os","tags/operating-system","notes/operating-systems/operating-systems"],"tags":["os","operating-system"],"content":"tags:osoperating-system\nis_child_of: operating-systems\nHistory of Operating System\nGeneration 1945-55 of Vaccum Tubes\n\nVaccum tubes were used in computers that were very slow.\n\nGeneration 1955-65 of Transistors and Batch systems\n\nTransisters were used in computers.\nTasks were carried out batch sytems.\nIn batch system, tasks were divided in parts.\n\nTo run a program, program as to write programs on card.\nPrograms from those cards where written on magnetic taps using a reader.\nThose taps where then provided to mainframe computer who actually does computing.\nOutput where written on magnetic taps by mainframe computer.\nOutput taps then provided to reader again to print the output through printer.\n\n\n\nGeneration 1965-80 of ICs and multiprogramming\n\nComputer systems became more compact by the introduction of ICs.\nThis was the time of mutiprogramming where various users can access a single mainframe computer.\nThese computers were used in time sharing mode.\nMULTICS(Multiplexed information and computing service) was a an operating system designed for time sharing.\nMULTICS leads the development of UNIX. An employee in MULTICS named Ken Thompson developed UNIX.\nBy seeing MULTICS as it was open source, a Finnish student Linos Torvalds developed Linux.\n"},"notes/operating-systems/input-output":{"title":"input-output","links":["tags/operating-system","tags/input/output","tags/architecture"],"tags":["operating-system","input/output","architecture"],"content":"tags:operating-systemoutputarchitecture\nCPU talks with IO devices using device controllers. More specificially, CPU send request to device driver and device driver talks with device controller.\nThere are different approaches of communication involves in different computer architectures. Some of them are\n\nDevice driver send request to device controllers and waits for device controller to give some response. Device driver goes to a tight loop of waiting.\nDevice driver gets interrupted from device controller once the operation is done.\nUsing a dedicated hardware DMA (Direct Memory Access). There is no intervention of CPU in the data transfer. CPU talks to DMA when there is an IO operation and once the operation is done, CPU gets notified by DMA.\n"},"notes/operating-systems/memory-management/page-fault":{"title":"page-fault","links":["tags/memory-management","tags/memory"],"tags":["memory-management","memory"],"content":"tags:memory-managementmemory\nIt is the problem in which when there is an instruction to execute but that is not present in the memory, the operating system goes and gets the missing instruction from the disk.\nThis blocks the whole process."},"notes/operating-systems/modes":{"title":"modes","links":[],"tags":[],"content":""},"notes/operating-systems/operating-system-types":{"title":"operating-system-types","links":["tags/operating-system","tags/architecture","tags/os","notes/operating-systems/operating-systems"],"tags":["operating-system","architecture","os"],"content":"tags:operating-systemarchitectureos\nis_child_of: operating-systems\nThere are different types of operating systems used for,\n\nMainframe computers\nServer computers\nMultiprocessor\nPersonal comptuers\nHandheld computers\nEmbedded systems\nReal time systems\nSensory nodes operating systems\nSmart card operating systems\n\nMainframe computer\nThese are super computer handles high computing and IO.\nOperating systems used are\n\nOS/390\nUnix and Linux\n\nServer computers\nThese come next from mainframe computers. These are workstations and large personal comptuer connected with each other.\n\nSolaris\nFreeBSD\nLinux\nWindows server\n\nMultiprocessor\nHaving multiple processors in a single chips. It requires an operating systems which can control those processors and resources.\n\nWindows\nLinux\nUnix\n\nPersonal computers\nWe do use them in daily routine.\n\nWindows\nLinux\nUnix\nMacintosh\n\nHandheld computers\nThese are Personal Digital Assistants (PDAs) devices.\n\nPalm OS\nSymbian OS\n\nSensory nodes\nNodes with sensors to examine surroundings and other designed use cases.\n\nTinyOS\n\nEmbedded systems\nThese are systems which are designed for a specific use case. These usually embedded into the hardware to control its functions. For example washing machine, microwave etc.\n\nQNX\nVxWorks\n\nReal time systems\nTime is a real constraint here. Actions have to be taken at their right time otherwise can cause consequences.\nThis includes hard real time and soft real time systems. Hard real time where time is a serious constraint and wheareas in soft real time, missing the desirable action on a particular time can be accepted.\n\ne-Cos\n\nSmart card operating systems\nWe have ATM cards and metro cards. They also have an operating that gets activated when come in contact with sensory machines."},"notes/operating-systems/operating-systems":{"title":"operating-systems","links":["tags/os"],"tags":["os"],"content":"tag:os\nOperating System\nReferences\n\nTextbook\n"},"notes/operating-systems/process/interprocess-communication/condition-variable":{"title":"condition-variable","links":["tags/multithreading","tags/multiprocessing","tags/thread","tags/busy-waiting","tags/synchronization","notes/operating-systems/process/interprocess-communication/mutex"],"tags":["multithreading","multiprocessing","thread","busy-waiting","synchronization"],"content":"tags:multithreadingmultiprocessingthreadbusy-waitingsynchronization\nCondition Variable\nCondition variable is a synchronisation method where a process/thread is blocked by some condition. The thread is not restarted until the condition becomes true.\nIt commonly used with mutex.\nOperations\nThe main operations associated with condition variable are.\n\nwait\n\nSuspend the process/thread calling this procedure until a signal to wake it up not send called by some other process/thread. It also unlocks the locked mutex.\n\n\nsignal\n\nResumes the suspended process/thread\n\n\nbroadcast\n\nResumes all of the process/threads waiting for the particular condition variable. Schedular then can choose which one to restart.\n\n\n\nFollowing shows a C program using pthread.\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;pthread.h&gt;\n \n#define MAX 10\n \npthread_mutex_t mutex;\npthread_cond_t condc, condp;\nint buffer = 0;\n \nvoid *producer() {\n\tint i;\n \n\tfor (i = 1; i &lt; MAX; i++) {\n\t\tpthread_mutex_lock(&amp;mutex);\n\t\twhile ( buffer != 0) {\n\t\t\tprintf(&quot;Producer waiting\\n&quot;);\n\t\t\tpthread_cond_wait(&amp;condp, &amp;mutex);\n\t\t}\n\t\t\n\t\tprintf(&quot;Producer producing\\n&quot;);\n\t\tbuffer = i;\n\t\tpthread_cond_signal(&amp;condc);\n\t\tpthread_mutex_unlock(&amp;mutex);\n\t}\n \n\tpthread_exit(0);\n}\n \nvoid *consumer() {\n\tint i;\n\tfor (i = 1; i &lt; MAX; i++) {\n\t\tpthread_mutex_lock(&amp;mutex);\n\t\twhile (buffer == 0) { \n\t\t\tprintf(&quot;Consumer waiting\\n&quot;);\n\t\t\tpthread_cond_wait(&amp;condc, &amp;mutex);\n\t\t}\n\t\t\n\t\tprintf(&quot;Consumer consuming buffer\\n&quot;);\n\t\tbuffer = 0;\n\t\tpthread_cond_signal(&amp;condp);\n\t\tpthread_mutex_unlock(&amp;mutex);\n\t}\n \n\tpthread_exit(0);\n}\n \nint main() {\n\tpthread_t con, prod;\n\tpthread_mutex_init(&amp;mutex, 0);\n\tpthread_cond_init(&amp;condc, 0);\n\tpthread_cond_init(&amp;condp, 0);\n\tpthread_create(&amp;con, 0, consumer, 0);\n\tpthread_create(&amp;prod, 0, producer, 0);\n\t\n\tpthread_join(prod, 0);\n\tpthread_join(con, 0);\n\t\n\tpthread_cond_destroy(&amp;condc);\n\tpthread_cond_destroy(&amp;condp);\n\tpthread_mutex_destroy(&amp;mutex);\n\treturn 0;\n}\nProgram in python.\nimport threading\nfrom random import randint \n \nMAX = 5\n \nshared_buffer = []\n \ncond = threading.Condition()\n \ndef producer():\n\t\n\tfor i in range(1, 20):\n\t\twith cond:\n\t\n\t\t\twhile len(shared_buffer) &gt;= MAX:\n\t\t\t\tprint(&quot;===&gt; Producer waiting &lt;===&quot;)\n\t\t\t\tcond.wait()\n\t\n\t\t\titem = randint(0, 100)\n\t\t\tprint(&quot;Producing item &quot;, item)\n \n\t\t\tshared_buffer.append(item)\n\t\t\tcond.notify()\n \n \n \ndef consumer():\n\tfor i in range(1, 20):\n\t\twith cond:\n\t\t\twhile len(shared_buffer) == 0:\n\t\t\t\tprint(&quot;===&gt; Consumer waiting &lt;===&quot;)\n\t\t\t\tcond.wait()\n \n\t\t\titem = shared_buffer.pop(0)\n\t\n\t\t\tprint(&quot;Consuming item &quot;, item)\n\t\n\t\t\tcond.notify()\n \n \n \ndef main():\n \n\tprod_thread = threading.Thread(target=producer)\n\tcon_thread = threading.Thread(target=consumer)\n \n\tprod_thread.start()\n\tcon_thread.start()\n \n\tprod_thread.join()\n\tcon_thread.join()\n \n \nmain()\n \nHere, condition variable is much abstract as it interally controls mutex (with context manager is for that only)."},"notes/operating-systems/process/interprocess-communication/for-later":{"title":"for-later","links":["tags/later"],"tags":["later"],"content":"tags:later\n\nRead-Copy-Update (page 148)\n"},"notes/operating-systems/process/interprocess-communication/interprocess-communication":{"title":"interprocess-communication","links":["tags/process","tags/communication","tags/ipc","tags/threads","notes/operating-systems/process/process"],"tags":["process","communication","ipc","threads"],"content":"tags:processcommunicationipcthreads\nis_child_of: process\nThere are some of the issues related to interprocess communcation. Three of them are.\n\nHow process will communicate?\nHow process won’t come in each others’ way?\nHow proper sequencing will met incase of dependencies?\n\nProcess B waiting for output generated by process A.\n\n\n\nAll the problems and solutions are same for threads as well."},"notes/operating-systems/process/interprocess-communication/message-passing":{"title":"message-passing","links":["tags/message-passing","tags/mpi","tags/ipc","tags/communication"],"tags":["message-passing","mpi","ipc","communication"],"content":"tags:message-passingmpiipccommunication\nMessage Passing\nIt is an interprocess communication mechanism in which one process sends messages to another process. It can happen on the local processes or processes running on different system on the remote.\nThere are two system calls to achieve message passing.\nsend(reciever, &amp;message)\n\nreceive(sender, &amp;message) \n\nDifferent approaches of implementation\n\nMailbox: There is a mailbox of each process running. Processes send messages to that mailbox. Mailbox are the buffers of certain size specified when these are created, to store messages.\n\nInstead of addressing processes in the messages, mailbox for the particular process is addressed.\n\n\nRendezvous: In the mechanism, if a send is done before the receive, the sender will be blocked. If a receive is done before the send, the receive gets blocked.\n\n\nNote: Message passing is commonly used in parallel programming. One of the well known interfaces for message passing is MPI (Message Passing Interface).\n"},"notes/operating-systems/process/interprocess-communication/monitors":{"title":"monitors","links":["tags/synchronization","tags/multithreading","tags/multiprocessing","tags/threads","tags/process","notes/operating-systems/process/interprocess-communication/producer-consumer-problem"],"tags":["synchronization","multithreading","multiprocessing","threads","process"],"content":"tags:synchronizationmultithreadingmultiprocessingthreadsprocess\nMonitors\nA monitor is an abstraction provided to implement synchronization while accessing sharing resource. It abstracts the implementation of conditional variables and semaphores or mutexes.\nThis is the feature provided the by language itself. It is the concept and different language implements this concept.\nFor instance, Java uses synchronized keyword to achieve synchronization on the block of code or the method.\nThe producer and consumer problem can be thought using monitors in this way.\nfunction Producer() {\n    while true {\n        item = produceItem()\n        ProducerConsumer.insert(item)\n    }\n}\n\nfunction Consumer() {\n    while true {\n        ProducerConsumer.remove()\n    }\n}\n\nmonitor ProducerConsumer {\n    cond_var full, empty;\n    int buffer = 0;\n    mutex_var mutex;\n    \n    function insert(item) {\n        lock(mutex)\n        if (buffer != 0) wait(full, mutex)\n        buffer = 1\n        signal(empty)\n        unlock(mutex)\n    }\n\n    function remove() {\n        lock(mutex)\n        if (buffer == 0) wait(empty, mutex)\n        buffer = 0\n        signal(full)\n        unlock(mutex)\n    }\n}\n"},"notes/operating-systems/process/interprocess-communication/mutex":{"title":"mutex","links":["tags/mutual-exclusion","tags/semaphores","notes/operating-systems/process/interprocess-communication/mutual-exclusion","notes/operating-systems/process/interprocess-communication/condition-variable"],"tags":["mutual-exclusion","semaphores"],"content":"tags:mutual-exclusionsemaphores\nMutex\nmutex is a special kind of semaphore for a specific purpose to ensure mutual-exclusion. It is similar to lock variable. It can only contain one of two values, 0 or 1. 0 means unlocked and 1 means locked.\nImplementation of mutex for threads\nmutex_lock:\n    TSL REG, MUTEX\n    CMP REG, #0\n    JE RET\n    CALL thread_yield\n    JMP mutex_lock\n\nmutex_unlock:\n    MOVE MUTEX, #0\n    RET\n\nThis implementation may seem similar to enter_region and exit_region. However, it is not. There is a subtle difference between them.\nenter_region and exit_region involves busy waiting. This one though doesn’t do that.\nSee also\n\nFutex\nMutex in Pthreads\ncondition-variable\n"},"notes/operating-systems/process/interprocess-communication/mutual-exclusion":{"title":"mutual-exclusion","links":["tags/os","tags/multiprocessing","tags/race-condition","tags/deadlocks"],"tags":["os","multiprocessing","race-condition","deadlocks"],"content":"tags:osmultiprocessingrace-conditiondeadlocks\nMutual Exclusion\nThis is the condition in which two or more process try to access a single shared resources at the same time. The sequence of accessing the resource matters. If the sequence changes, the result can vary and not wanted.\nThere are various proposed solutions to this problem. With each solution, there are sticking problem with them also.\n1. Disabling interrupts\nWhen the process goes into critical region, it stops responding to clock interrupts.\nProblems\n\nGiving the ability to enable/disable interrupts to user space is not a wise idea.\nWhat if process disables the interrupts but never enables it?\n\nIt is better for kernel level operations instead of user space.\n2. Lock variables\nProcess sets the lock variable to let other processes know that the sharing resource is in use.\nIf you notice, that variable is also a shared resource which is getting used to access another shared resource. How would this variable will be managed?\n3. Strict turns\nProcesses takes turns for getting into their critical regions. Before going into critical region, it has to check if the turn has come. If not, process goes into loop until the turns comes.\nturn = 0;\nProcess A\nwhile (TRUE) {\n    while (turn != 0)\n    critical_region();\n    turn = 1;\n    normal_region();\n}\nProcess B\nwhile (TRUE) {\n    while (turn != 1)\n    critical_region();\n    turn = 0;\n    normal_region();\n}\nInitially, turn is 0, so process A executes critical region and changes turn to 1 . Process B starts executing critical region and changes turn to 0. This goes on like this.\nIt has a problem, one process executing non critical region can case another process to block executing its critical region.\n4. Peterson’s solution\nSolution proposed by Peterson in which he defines two functions in C, which are called before and after the execution of critial regions.\nenter_region is called before going into critical region.\nexit_region is called after the critical region.\n5. TSL instruction\nThe problem with lock variable was that a process can have old value of lock variable and can go into critical region at the same time.\nenter_region:\n    LOAD LOCK, REG\n    MOVE LOCK, #1\n    CMP REG, #0\n    JNE enter_region\n    RET\n\nexit_region:\n    MOVE LOCK, #0\n    RET\n\nIt has a problem. Let’s say process A calls enter_region which executes first assembly instruction and gets suspended. Another process calls enter_region  and sets LOCK to 1. Previous process again starts executing but has old value of LOCK.\nSo, we the reading and settings of LOCK variable should be atomic in nature. This can be accomplished using TSL (Test and Set Lock) instruction. It loads value and sets the value in one shot. It blocks the memory bus so that no other process access the LOCK variable.\nenter_region:\n    TSL REG, LOCK\n    CMP REG, #0\n    JNE enter_region\n    RET\n"},"notes/operating-systems/process/interprocess-communication/producer-consumer-problem":{"title":"producer-consumer-problem","links":["tags/multiprocessing","tags/multithreading","tags/threads","tags/deadlocks","tags/race-condition","notes/operating-systems/process/interprocess-communication/semaphores"],"tags":["multiprocessing","multithreading","threads","deadlocks","race-condition"],"content":"tags:multiprocessingmultithreadingthreadsdeadlocksrace-condition\nProducer Consumer Problem\nThis is a synchronization issue in multiprocessing and multithreading. In this problem, there are two types of processes or threads accessing a single resource or buffer.\nThis problem occur when both of the process try to access the buffer at the same time causing data inconsistencies, deadlocks etc.\nTo solve these problem, there are various techniques are used. One of them is semaphores."},"notes/operating-systems/process/interprocess-communication/race-conditions":{"title":"race-conditions","links":["tags/os","tags/parallelism","tags/multiprocessing","tags/process","notes/operating-systems/process/interprocess-communication/mutual-exclusion"],"tags":["os","parallelism","multiprocessing","process"],"content":"tags:osparallelismmultiprocessingprocess\nRace condition\nThis is a situation in which two or more process try to access a shared resources at the same time where sequence of accessing can alter the resulting output.\nCritical Region\nA part of the program where the program access the shared resource.\nConditions to avoid race conditions\n\nNo two process should go to their critical regions at the same time.\nNo process running outside its critical region should block other process\nNo process should wait to enter its critical region\n\nMutual exclusion\nIt is a way to making sure if some process is using a shared resource, some other process should be excluded to access that resource.\nRead more."},"notes/operating-systems/process/interprocess-communication/semaphores":{"title":"semaphores","links":["tags/synchronization","tags/multithreading","tags/multiprocessing","tags/mutual-exclusion","notes/operating-systems/process/interprocess-communication/mutex"],"tags":["synchronization","multithreading","multiprocessing","mutual-exclusion"],"content":"tags:synchronizationmultithreadingmultiprocessingmutual-exclusion\nSemaphores are the mechanism to synchronize operations in multithreading or concurrent programming. It can be used solve race conditions, produce consumer problem, etc.\nSemaphores is a variable that maintains non-negative value and allows only two atomic operations, down and up.\nIn down operation, the value of semaphore decreases. If it’s value is 0, then the process is put to sleep and value remains 0.\nIn up operation, the value of semaphore is increased. If any process is sleeping associated with the semaphore is get awakend.\nSolving producer consumer problem\nThe main problem with producer and consumer is the accessing the shared buffer. So, we have put the process to sleeping state if some other process is currently using it. That is, we have to manage the control regions.\nWe can solve this using enter_region and exit_region mechanism but it starts the infinity loop which is CPU intensive.\nLet’s use semaphore to solve this issue.\n#define N 100\ntypedef int semaphore\n \nsemaphore mutex = 0;\nsemaphore empty = N;\nsemaphore full = 0;\n \nvoid producer() {\n    int item;\n \n    while (TRUE) {\n        item = produce_item();\n        down(&amp;empty);\n        down(&amp;mutex);    // entering critical region\n        insert_item(item);\n        up(&amp;mutex);    // leaving critical region\n        up(&amp;full);\n    }\n}\n \n \nvoid consumer() {\n    while (TRUE) {\n        down(&amp;full);\n        down(&amp;mutex);\n        item = remote_item();\n        up(&amp;mutex);\n        up(&amp;empty);\n        consume_item(item);\n    }\n}\nLet’s understand this pesudo program. There are three semaphores, mutex, empty and full.\nmutex is used for critical region. Before going into critical region, we are doing down(&amp;mutex). If mutex is 0 then the process is put to sleeping state as shared buffer is already is in use. mutex can only contain one of two values, 0 or 1. This is called Binary Semaphore. mutex is used to ensure mutual exclusion.\nSemaphores full and empty are used to make sure the producer stops running if buffer is full and consumer stops running if the buffer is empty.\nMutexes are specially used for mutual exclusion. These are used for entering and exiting the critical region."},"notes/operating-systems/process/introduction":{"title":"introduction","links":["tags/operating-system","tags/os","tags/process","tags/program","notes/operating-systems/process/process"],"tags":["operating-system","os","process","program"],"content":"tags:operating-systemosprocessprogram\nis_child_of: process\nWhat is a process?\nA process is a running program which has allocated system resources.  In more simpler words, it is a container that holds all the information to run a program.\nProcess resources\nA process contains following resources\n\nAddress space\nRegisters\n\nProgram counter\nStack pointer\n\n\nList of open files\nRelated processes\n\nAddress space\nThis is the memory allocated to a process where it stores all its data. An address space defines the limit of memory accessing of the process.\nAddress space consists the program instructions, data, and its stack.\nProcess table\nOperating system maintains a process table having information about all the processes created so far. The table consist information like\n\nList of all the open files and their pointers.\nInformation about related processes or child processes\nEtc.\n\nWhen a process is suspended, operating system has to save process state and all the information in process table. Address space of process is not stored in process table. That is already preserved in the main memory.\nWhen the process is restarted, operating loads the process information from process table and process continues in the state it left."},"notes/operating-systems/process/memory":{"title":"memory","links":["tags/process","tags/memory","tags/memory-management","tags/operating-system","tags/os","notes/operating-systems/process/process"],"tags":["process","memory","memory-management","operating-system","os"],"content":"tags:processmemorymemory-managementoperating-systemos\nis_child_of: process\nMemory Segments\nA process has memory divided into three segments.\n\nProgram text\nData\nand Stack\n\n\nData grows upward and stack grows downward. Growing of stack is automatic while data space has be explicitely grown."},"notes/operating-systems/process/process-creation":{"title":"process-creation","links":["tags/os","tags/operating-system","tags/process","tags/architecture","notes/operating-systems/process/process"],"tags":["os","operating-system","process","architecture"],"content":"tags:osoperating-systemprocessarchitecture\nis_child_of: process\nProcess Creation\nA process is created by following events:\n\nSystem initialisation\nRunning process calling process creation system call\nUser launching a process\nStarting a batch job\n\nA process is created by using system calls provided by operating system. fork is the system call used to create a clone of an existing process.\nTaking the example of shell, when we a run a command following things happen:\n\nIt forks a child process using fork system call\nChild process copies the file descriptors of the parents to manipulate stdin, stdour and stderr\nChild process then execute execve() system call to change the process image to that command. It means that instead of executing the child  process code, the code of that command will be executed\n\nA simple shell using this theory.\nimport os\n \n \ndef read_command() -&gt; tuple:\n    user_input = input(&quot;&gt; &quot;)\n    return tuple(user_input.strip().split(&#039; &#039;))\n \n \nwhile True:\n    command, *argv = read_command()\n    env = {&#039;PATH&#039;: os.environ[&#039;PATH&#039;]}\n    pid = os.fork()\n \n    if pid == 0:\n        os.execve(command, [command, *argv], env)\n    else:\n        chid_pid, status =\\\n         os.waitpid(pid, os.WUNTRACED)\n \nI’m not doing duplication of file descriptors in this example. However this duplication can be done using dup2 system call."},"notes/operating-systems/process/process-table":{"title":"process-table","links":["tags/os","tags/process","tags/scheduler","notes/operating-systems/process/process"],"tags":["os","process","scheduler"],"content":"tags:osprocessscheduler\nis_child_of: process\nProcess table\nA process table is a data structure used by scheduler to store process information and state.\nIt has process information entries, also known as process control block. This process control block contains information about:\n\nProcess management\n\nRegisters\nProgram counter\nProgram status word\nProcess id\nStack\nProcess group\nSignals\nand so on.\n\n\nMemory management\n\nPointer to text segment\nPointer to data segment\nPointer to stack segment\n\n\nFile management\n\nFile descriptors\nRoot directory\nWorking directory\nUser ID\nGroup ID\n\n\n\n\nBonus: /proc directory in Linux machine, we can see information stored about each process in user program space. Commands such as ps uses this information to show the process. However, ps also uses information from process table residing in kernel memory.\n"},"notes/operating-systems/process/process":{"title":"process","links":["notes/operating-systems/operating-systems"],"tags":[],"content":"is_child_of: operating-systems"},"notes/operating-systems/process/threads/hybrid-implementation":{"title":"hybrid-implementation","links":["tags/implementation","tags/threads","notes/operating-systems/process/threads/implementations"],"tags":["implementation","threads"],"content":"tags:implementationthreads\nis_child_of: implementations\nHybrid Thread Implementation\nIn this approach, both user and kernel space threads implementations are incorporated.\nIn this model, user level threads are created and managed in user space unaware of the underlying hardware.\nKernel level threads are associated with each user level threads to provide system resources. Whenever user level threads need to make a system call, kernel level thread makes that call on its behalf.\nThis approach solve the problem of creation and management of several threads in kernel space and system resources access by threads in user space.\nCreation and management is taking place in user space while access to system resources taking place in kernel space."},"notes/operating-systems/process/threads/implementations":{"title":"implementations","links":["tags/threads","tags/thread","tags/implementation","notes/operating-systems/process/threads/thread","notes/operating-systems/process/threads/user-space-threads","notes/operating-systems/process/threads/kernel-space-threads","notes/operating-systems/process/threads/hybrid-implementation"],"tags":["threads","thread","implementation"],"content":"tags:threadsthreadimplementation\nis_child_of: thread\nThere are majorliy three way the threads can be implemented.\n\nUser space threads\nKernel space threads\nHybrid implementation\n"},"notes/operating-systems/process/threads/kernel-space-threads":{"title":"kernel-space-threads","links":["tags/thread","tags/threads","tags/kernel","tags/implementation","notes/operating-systems/process/threads/implementations"],"tags":["thread","threads","kernel","implementation"],"content":"tags:threadthreadskernelimplementation\nis_child_of: implementations\nImplementing threads in Kernel\n\nKernel is aware of processes threads.\nIt manages threads table having theads state.\nThreads calls blocking system calls and kernel switches the threads.\n\nSome problems\n\nSystem calls are costlier to switch and manage threads.\nSignal issue. If a signal is sent to process, which thread should handle it?\n"},"notes/operating-systems/process/threads/scheduler-activation":{"title":"scheduler-activation","links":["tags/threads","tags/scheduler","tags/synchronization","notes/operating-systems/process/threads/thread"],"tags":["threads","scheduler","synchronization"],"content":"tags:threadsschedulersynchronization\nis_child_of: thread\nScheduler Activation\nThis method focuses on mimicking the functionality of kernal threads. The way kernel threads handle the scheduling threads when a thread gets blocked. If all of these process can happen in user space through the implemetation of threads package.\nWhenever a thread calls blocking system call, kernel notifies run time about it by sending some parameters. Run time then manages which thread to run. When the blocking thread becomes activated, kernel again specifies run time to schedule that thread. Now it is upto run time to restart the thread or schedule it for later.\nThe call where kernel notfies run time is called upcall.\nThe main idea behind this method is to avoid the transition between user space and kernel space."},"notes/operating-systems/process/threads/thread":{"title":"thread","links":["tags/os","tags/process","tags/thread","notes/operating-systems/process/process"],"tags":["os","process","thread"],"content":"tags:osprocessthread\nis_child_of: process\nThread\nA thread is a sequence of instructions getting executed independently. A thread is a part of the big process running independently from the parent process.\nWhy do we need threads?\nThere are following reasons to use threads.\n\nProgram having several IO, networks and any blocking operation holds the program execution and CPU remains idle. This leads to resources wastage. So, organizing the program using threads can resolve this issue.\nThreads are lightweight. These are easy to create and destroy. Threads don’t require much of the resources like parent.\nOperations require parent process resource sharing. Different process can’t be created for the same resource. However, threads can share same parent resource.\nThreads can help gaining performance if the program is composed of several blocking operations.\n\nThreads complications\n\nMakes programming model complicated.\nIf child processes get threads from parent, blocking thread\n"},"notes/operating-systems/process/threads/user-space-threads":{"title":"user-space-threads","links":["tags/threads","tags/thread","tags/user-space","tags/implementation","notes/operating-systems/process/threads/implementations","notes/operating-systems/memory-management/page-fault"],"tags":["threads","thread","user-space","implementation"],"content":"tags:threadsthreaduser-spaceimplementation\nis_child_of: implementations\nImplementing Threads in User space\n\nLibraries in user space are handling creation and management of threads.\nThere is a run-time maintaining a thread table similar to process table managed in kernel space.\nThread table stores the state of each thread which is used in threads switching.\n\nAdvantages over Kernel space\n\nThere is no system call invoked for thread switching leading to performance gain.\nThere is no kernel trap.\nEach process can have its own customized scheduling algorithm.\nIt is scalable as memory won’t be a problem for threads table when the threads numbers increase.\n\nDisadvantages\n\nThreads using blocking calls such as for I/O or networking, it blocks the whole process, so blocks all threads.\nThis can be avoided using non-blocking calls. However, it would require to change system calls of operating system which is unwanted.\nIf a thread starts running, no other thread in that process will ever run unless the first thread voluntarily gives up the CPU.\nIf a thread causes page-fault, the kernel naturally blocks the entire process until the respective instructions are fetched from the disk.\n\n"},"notes/operating-systems/registers":{"title":"registers","links":["tags/operating-system","tags/os","tags/architecture","notes/operating-systems/operating-systems"],"tags":["operating-system","os","architecture"],"content":"tag:operating-systemosarchitecture\nis_child_of: operating-systems\nCPU contains several registers to store intermediatery variables and other data which is frequently used. Some of the examples are,\n\nGeneral registers that a programmer doesn’t have access to.\nProgram counter which stores the address of next instruction to fetch.\nStack pointer which points to the top of the stack in memory. Stack is used to store the procedure data such as arguments, what is the return address etc.\nPSW (Program Status Word) to store result of conditional instructions and some other information.\n\n"},"notes/operating-systems/resource-multiplexing":{"title":"resource-multiplexing","links":[],"tags":[],"content":""},"notes/operating-systems/system-calls":{"title":"system-calls","links":["tags/os","tags/operating-system","tags/computer","tags/architecture","notes/operating-systems/operating-systems"],"tags":["os","operating-system","computer","architecture"],"content":"tags:osoperating-systemcomputerarchitecture\nis_child_of: operating-systems\nWhat are System calls?\nSystem calls are the abstractions provided by operating system to access low level resources such as IO handling, read/write files, etc.\nThese are the way in which a user program can request service from the kernel of the operating system.\nThere are libraries provided which lets user program make use of system calls.\nFor example, in python we have os package providing system calls to read/write files and some other features.\nimport os\n \nfd = os.open(&#039;file.txt&#039;, os.O_RDONLY)\n \ncontent = os.read(fd, 100)\n \nprint(content.decode())\nThere are library procedures which make use of system calls. We hardly use system calls directly. We use library procedures to deal with system calls.\nRunning a system call\nWhen a system call is invoked, following things happens in a sequence.\n\nUser program calls library procedure to make a system call.\nVariables are pushed on to the stack as the control is going to procedure call.\nProcedure sets a value at a specified register or location the operating system expects for some system call.\nProcedure executes a TRAP instruction which in turn executes the TRAP handler in the kernel mode.\nOnce the TRAP handler done with its work, the control is returned back to procedure call and in return the control goes back to the user program.\n\nProcedure call Vs Trap call\nBoth of these are instruction calls. However, they differ in following two ways.\n\nExecution of TRAP instruction changes mode from user to kernel.\nProcedure call instruction contains the address where to find the instruction. This address is dynamic. Whereas, TRAP instruction as a 8 bit location which points to a table in memory that has the location of TRAP handler to execute. And this is fixed by the system architecture.\n"},"notes/operating-systems/users-and-groups":{"title":"users-and-groups","links":["tags/os","tags/operating-system","tags/computer","tags/linux","tags/unix","notes/operating-systems/operating-systems"],"tags":["os","operating-system","computer","linux","unix"],"content":"tags:osoperating-systemcomputerlinuxunix\nis_child_of: operating-systems\nUsers\nAdding users\nWe can add users using command useradd\nuseradd nitin\nWe have to create a directory of this user and user permissions to that directory.\nmkdir /home/nitin\n \nchown nitin /home/nitin\nNow if we see the permissions we will see,\nroot@515d32d1d259:/home/hemant# ls -alrt /home\ntotal 12\ndrwxr-xr-x 1 nitin root 4096 Apr  6 11:27 nitin\ndrwxr-xr-x 1 root  root 4096 Apr  6 11:27 ..\ndrwxr-xr-x 1 root  root 4096 Apr  6 11:39 .\nThere is one more way to create  a user.\nadduser nitin\nThis does everything for you.\nDeleting user\nuserdel nitin\nrm -rf /home/nitin\nor\ndeluser nitin\nSwitching user\nsu nitin\nsu is switch user command.\nChanging the password\npasswd nitin\n \nNew Password:\nRetype New Password:\nGroups\nA group is a collection of users with a set of permissions.\nCreating a group\ngroupadd bitphile\nAdding group to directory and file\nchgrp nitin /home/nitin\nAdding user to the group\nusermod -aG bitphile nitin\n-aG means add group.\nDelete user from the group\ngpasswd -d bitphile nitin\nDelete group\ngroupdel bitphile\nSee also\n\nsudoers file\n"},"notes/operating-systems/what-is-os":{"title":"what-is-os","links":["tags/operating-system","tags/os","tags/computer","tags/applications","tags/architecture","notes/operating-systems/operating-systems","notes/operating-systems/modes","notes/operating-systems/resource-multiplexing"],"tags":["operating-system","os","computer","applications","architecture"],"content":"tags:operating-systemoscomputerapplicationsarchitecture\nis_child_of: operating-systems\nWhat is an Operating system?\nThis is the program that provides abstractions for user programs to deal with computer hardwares and other resources. It works in kernel modes.\nResource Manager\nOperating system is a resource manager which manages complex system resources among various programs.\nThere are two ways in which an OS multiplexes (shares) the resources among programs.\n\nTime multiplexing\nSpace multiplexing\n\nIn time multiplexing, user programs take turns to use resources. Whoever comes first uses the resource first.\nIn Space multiplexing, defined space is allocated to the programs. For example, space on hard disk and RAM.\nSee resource-multiplexing."},"notes/radio-astronomy/calibration/interferometric-errors":{"title":"interferometric-errors","links":[],"tags":["radio-astronomy"],"content":"Three types of errors to cope using calibration.\n\npropagate errors: atmospheric components.\ngeometric errors: positions of dishes.\ninstrumental errors\n"},"notes/radio-astronomy/deconvolution/casa-deconvolution":{"title":"casa-deconvolution","links":[],"tags":["radio-astronomy"],"content":"\nimage reconstruction is based on cotton-schwab major/minor cycle.\n"},"notes/radio-astronomy/deconvolution/clean-algorithms":{"title":"clean-algorithms","links":[],"tags":["radio-astronomy","casa"],"content":"CASA Clean\n\nclean involves finding the peaks in residual image, subtraction the effect of PSFs for the peaks.\noperation models of clean algorithms\n\ndelta function sky model\nmulti-scale sky model\n\n\nclean algorithms\n\nhogbom (hogbom)\n\nuses delta function sky model\nit uses full PSF and thus it is high compute intensive\nefficient as delta functions are optimal for fields of compact sources\nsuspectible to errors for inappropriate weights especially when PSF has high sidelobs.\n\n\nclark (clark)\n\nit uses only small patch of psf to update the residual image\nminor cycle is faster because of above point.\nHowever, it have errors when sources are spread over wide field of view where the flux estimate at a given location is affected the sidelobs of farout sources.\nTo compensate this issue, the iteration is stopped when the brightest peak in the residual image is below the sidelobe level of the brightest source in the initial residual image.\nfor polarization imaging, it searches peak in combined stokes\n\nI^2 + Q^2 + U^2 + V^2\n\n\n\n\nclarkstokes (clarkstokes)\n\nuses clark psf\nfor polarization imaging, stokes planes are cleaned sequentially.\n\n\nmulti-scale (cornwell-holdaway Multi-scale clean) multiscale\n\nscale-sensitive deconvolution algorithm for images with complicated spatial structure.\nmatched-filtering technique is used locate dominant flux components.\nit requires scale sizes in pixel for algorithm.\n\n\nMulti-term (Multi Scale) Multi-Frequency Synthesis (mtmfs)\n\na wide-band imaging algorithm\n\n\n\nMaximum Entropy Method (mem)\n Adaptive Scale Pixel algorithm (asp)\n\nexperimental version in tclean\n\n\n\n\n\nThis algorithm can be given to tclean task using parameter deconvolver (string=&#039;hogbom&#039;)\nAstron Radler\n\nradler (deconvolver) at astron\n\nnot able to install radler using source.\n\n\n\n\nopen questions\n\nchi-square minimization\n"},"notes/radio-astronomy/dirty-image":{"title":"dirty-image","links":[],"tags":["radio-astronomy"],"content":"Dirty Image\nA dirty image creation process consists steps:\n\ngridding (optional)\nweighting (optional)\ninverse fourier transformation\n"},"notes/radio-astronomy/dumps":{"title":"dumps","links":[],"tags":["radio-astronomy","misc"],"content":"\nD is a antenna configuration\n"},"notes/radio-astronomy/imaging/1-spatial-frequency/spatial-frequency-notebook":{"title":"spatial-frequency-notebook","links":[],"tags":[],"content":"import numpy as np\nimport matplotlib.pyplot as plt\ndef rgb_to_gray(rgb):\n    r, g, b = rgb[:, :, 0], rgb[:, :, 1], rgb[:, :, 2]\n    gray = 0.2989 * r + 0.5870 * g + 0.1140 * b\n    return gray\nPlotting grayscale image\ntodo;\n\nchoose the right two images to be used\nplot two images sidewise\ncreate amp and phase image for both images and plot them\ncreate image by combining amp of first image and phase of second image and plot it\n\nduck = &quot;duck.jpg&quot;\npattern = &quot;pattern.jpg&quot;\nImages\nduck_img = rgb_to_gray(plt.imread(duck))\npattern_img = rgb_to_gray(plt.imread(pattern))\nplt.subplots(figsize=(16, 8))\nplt.subplot(1, 2, 1)\nimg = plt.imshow(duck_img)\nimg.set_cmap(&#039;gray&#039;)\nplt.subplot(1, 2, 2)\nimg = plt.imshow(pattern_img)\nimg.set_cmap(&#039;gray&#039;)\n\nApply fourier transformation on duck image\n# duck_fft = np.fft.fft2(np.fft.fftshift(duck_img))\nduck_fft = np.fft.fftshift(np.fft.fft2(duck_img))\nplt.subplots(figsize=(12, 5))\nplt.suptitle(&quot;Amp and Phase image for duck&quot;)\nplt.subplot(1, 2, 1)\nplt.imshow(10. * np.log10(np.abs(duck_fft)))\n \n \nplt.subplot(1, 2, 2)\nplt.imshow(np.angle(duck_fft))\n&lt;matplotlib.image.AxesImage at 0x7f2c2dda87c0&gt;\n\n\n\n\n\n\nApply fourier transformation on pattern image\npattern_fft = np.fft.fftshift(np.fft.fft2(pattern_img))\nplt.subplots(figsize=(12, 5))\nplt.suptitle(&quot;Amp and Phase image for pattern&quot;)\nplt.subplot(1, 2, 1)\nplt.imshow(10. * np.log10(np.abs(pattern_fft)))\n \nplt.subplot(1, 2, 2)\nplt.imshow(np.angle(pattern_fft))\n&lt;matplotlib.image.AxesImage at 0x7f2c300e8670&gt;\n\n\n\n\n\n\nCreate image using amp of pattern and phase of duck\namp = np.abs(pattern_fft)\nphase = np.angle(duck_fft)\n \nhybrid_ftt = amp * (np.cos(phase) + 1j * np.sin(phase))\n \n# applying inverse fft\nhybrid = np.abs(np.fft.ifft2(np.fft.fftshift(hybrid_ftt)))\n \n \nplt.figure(figsize=(8, 8))\nplt.title(&quot;Image created with amp of pattern and  phase of duck image&quot;)\nimg = plt.imshow(hybrid)\nimg.set_cmap(&#039;gray&#039;)\n \n\n \nCreate image using amp of duck and phase of pattern\namp = np.abs(duck_fft)\nphase = np.angle(pattern_fft)\n \nhybrid_fft = amp * (np.cos(phase) + 1j * np.sin(phase))\nhybrid = np.abs(np.fft.ifft2(np.fft.fftshift(hybrid_fft)))\n \nplt.figure(figsize=(8, 8))\nplt.title(&quot;Image created with amp of duck and  phase of pattern&quot;)\nimg = plt.imshow(hybrid)\nimg.set_cmap(&quot;gray&quot;)\n\nRemarks\n\nPhase mostly defines the structures of the image. So, when phase of duck is used and amp of pattern, only the duck is visible.\nWhen phase of pattern and amp of duck is used, we can only see the pattern.\n\nCreating duck image using its phase and amp of all values 1.\nphase = np.angle(duck_fft)\namp = np.ones_like(duck_fft)\n \nphase_only_duck_fft = amp * (np.cos(phase) + 1j * np.sin(phase))\n \nphase_only_duck = np.abs(np.fft.ifft2(np.fft.fftshift(phase_only_duck_fft)))\n \nplt.figure(figsize=(8, 8))\nplt.title(&quot;Duck phase only&quot;)\nimg = plt.imshow(phase_only_duck)\nimg.set_cmap(&quot;gray&quot;)\n\nCreating duck image using amp only\namp = np.abs(duck_fft)\nphase = np.angle(np.zeros_like(duck_fft))\n \namp_only_duck_fft = amp * (np.cos(phase) + 1j * np.sin(phase))\n \namp_only_duck = np.abs(np.fft.ifft2(np.fft.fftshift(amp_only_duck_fft)))\n \nplt.subplots(figsize=(16, 8))\n \nplt.suptitle(&quot;Duck image using amp only&quot;)\n \nplt.subplot(1, 2, 1)\nplt.title(&quot;Duck image&quot;)\nimg = plt.imshow(amp_only_duck)\nimg.set_cmap(&quot;gray&quot;)\n \n# using decibles\n \namp = 10. * np.log10(np.abs(duck_fft))\namp_only_duck_fft = amp\nplt.suptitle(&quot;Duck image using amp in dB&quot;)\nplt.subplot(1, 2, 2)\nimg = plt.imshow(amp)\nimg.set_cmap(&quot;gray&quot;)\n\nCreating duck images using real and imaginary components\nduck_fft_real = duck_fft.real\nduck_fft_imag = duck_fft.imag\nduck_real = np.abs(np.fft.ifft2(duck_fft_real))\nduck_imag = np.abs(np.fft.ifft2(duck_fft_imag))\n \n \nplt.subplots(figsize=(12, 4.5))\nplt.suptitle(&quot;Duck images using real and imaginary parts&quot;)\n \nplt.axis(&quot;off&quot;)\nplt.grid(False)\n \nplt.subplot(1, 2, 1)\nimg = plt.imshow(duck_real)\nimg.set_cmap(&quot;gray&quot;)\n \nplt.subplot(1, 2, 2)\nimg = plt.imshow(duck_imag)\nimg.set_cmap(&quot;gray&quot;)\n\nPlotting point source image\ndef point_source_fft(img_size, y_pos, x_pos, amp=1):\n    point_img = np.zeros((img_size + 1, img_size + 1))\n    \n    point_img[y_pos, x_pos] = amp\n    \n    plt.subplots(figsize=(18, 8))\n    plt.suptitle(&quot;Single point image&quot;)\n    \n    plt.grid(False)\n    plt.axis(False)\n    \n    plt.subplot(1, 2, 1)\n    plt.title(&quot;Single centered point image&quot;)\n    plt.imshow(point_img, interpolation=&#039;nearest&#039;)\n    plt.colorbar(shrink=0.8)\n    plt.set_cmap(&quot;gray&quot;)\n    \n    ## not sure why fftshit is happening before fourier transformation here?? above images shows opposite of it.\n    point_img_fft = np.fft.fft2(np.fft.fftshift(point_img))\n    # point_img_fft = np.fft.fftshift(np.fft.fft2(point_img))\n    \n    phase = np.angle(point_img_fft)\n    plt.subplot(1, 2, 2)\n    plt.title(&quot;Phase&quot;)\n    plt.imshow(phase)\n    plt.colorbar(shrink=0.8)\n    plt.set_cmap(&#039;hsv&#039;)\nimg_size = 128\nx_pos = (img_size // 2) + 1\ny_pos = (img_size // 2) + 1\n \npoint_source_fft(img_size, y_pos, x_pos)\n\nPhase fringe patterns on point location change from center\nimg_size = 128\npoint_source_fft(img_size, (img_size // 2) + 1, (img_size // 2))\n \npoint_source_fft(img_size, (img_size // 2) + 1, (img_size // 2) + 1 - 10)\n \npoint_source_fft(img_size, (img_size // 2) + 1 - 10, (img_size // 2) + 1)\n\n\n\nRemarks\n\nSo moving the point to left side, we get fringe color pattern for the phase.\nMoving point vertically creates horizontal fringes.\nMoving point horizontally creates vertical fringes.\n\nPhase fringe pattern while rotating pixel around center\ndef point_source_fft_circle(img_size, y_pos, x_pos, amp=1., radius=10.):\n    ## create image\n    img = np.zeros((img_size + 1, img_size+2))\n    img[y_pos, x_pos] = amp\n    img_fft = np.fft.fft2(np.fft.fftshift(img))\n \n    ## plot setup\n    plt.subplots(figsize=(18, 8))\n    plt.grid(False)\n    plt.axis(False)\n    \n    ## image plot without fft\n    ax = plt.subplot(1, 2, 1)\n    plt.set_cmap(&quot;gray&quot;)\n    plt.title(&quot;image without fft&quot;)\n    plt.imshow(img, interpolation=&#039;nearest&#039;)\n    plt.colorbar(shrink=0.8)\n    circle = plt.Circle(((img_size/2)+1, (img_size/2)+1), radius, color=&#039;blue&#039;, linewidth=2, fill=False)\n    ax.add_patch(circle)\n \n    ## phase\n    phase = np.angle(img_fft)\n    plt.subplot(1, 2, 2)\n    plt.title(&quot;image phase&quot;)\n    plt.imshow(phase)\n    plt.set_cmap(&quot;hsv&quot;)\n    plt.colorbar(shrink=0.8)\n    \n    \nimg_size = 128\npoint_source_fft_circle(img_size, (img_size // 2) + 1 + 10, (img_size // 2) + 1)\npoint_source_fft_circle(img_size, (img_size // 2) + 1 + 10, (img_size // 2) + 1 + 10)\n\n\nRemarks\n\nWhen the pixel position rotates around the center without changing the distance, the phase frequency remains the same but the phase rotates.\n\nFFT of multiple source points\ndef multiple_fft(img_size, pos, amps):\n    img = np.zeros((img_size + 1, img_size + 1))\n \n    ## fillup amps\n    for p, a in zip(pos, amps):\n        img[p[0], p[1]] = a\n \n    img_fft_phase = np.angle(np.fft.fft2(np.fft.fftshift(img)))\n    \n    plt.subplots(figsize=(18, 8))\n    plt.suptitle(&quot;multiple source points image&quot;)\n    plt.grid(False)\n    plt.axis(False)\n \n    plt.subplot(1, 2, 1)\n    plt.title(&quot;image&quot;)\n    plt.imshow(img)\n    plt.set_cmap(&#039;gray&#039;)\n    plt.colorbar(shrink=0.8)\n \n    plt.subplot(1, 2, 2)\n    plt.title(&quot;phase&quot;)\n    plt.imshow(img_fft_phase)\n    plt.set_cmap(&quot;hsv&quot;)\n    plt.colorbar(shrink=0.8)\n    \n    \nimgSize = 128\n \nmultiple_fft(imgSize, [[64, 65], [90,80]], [1., 1])\nmultiple_fft(imgSize, [[64,65], [90,80], [40,10], [60,50], [20,80]], [.2, 0.3, 0.5, 0.1, 0.7])\n\n\nRemarks\n\nImage with multiple sources has resulting phase an amplitude weighted average of phases of each point source.\nIt means that for the averaging of phases of each individual sources, their amplitudes are also taken into consideration.\n\nReconstructing duckk image\ndef reconstruct_image(vis, nsamples):\n    new_vis = np.zeros_like(vis)\n    y_pos = np.random.randint(0, high=vis.shape[0] - 1, size=int(nsamples))\n    x_pos = np.random.randint(0, high=vis.shape[1] - 1, size=int(nsamples))\n    \n    new_vis[y_pos, x_pos] = vis[y_pos, x_pos] # substituting values\n \n    img = np.fft.ifft2(np.fft.fftshift(new_vis))\n    plt.subplots(figsize=(16, 6))\n    plt.suptitle(&quot;Image reconstruction by taking samples&quot;)\n    plt.grid(False)\n    plt.axis(False)\n \n    plt.subplot(1, 2, 1)\n    plt.imshow(np.abs(new_vis).astype(bool), interpolation=&#039;nearest&#039;, cmap=&quot;gray&quot;)\n    plt.title(&quot;sampled visibilities&quot;)\n    \n    plt.subplot(1, 2, 2)\n    plt.imshow(np.abs(img), cmap=&quot;gray&quot;)\n    plt.title(&quot;Reconstructed image&quot;)\nreconstruct_image(duck_fft, 1e1)\nreconstruct_image(duck_fft, 1e3)\nreconstruct_image(duck_fft, 1e5)\nreconstruct_image(duck_fft, 1e6)\n \n\n\n\n\nRemarks\n\nWe can recreate the image by selecting spatial frequencies with different amplitude and phases.\nWe don’t require to sample all the points to reconstruct the image.\n\n "},"notes/radio-astronomy/imaging/1-spatial-frequency/spatial-frequency":{"title":"spatial-frequency","links":["notes/radio-astronomy/imaging/1-spatial-frequency/spatial-frequency-notebook.ipynb"],"tags":["radio-astronomy"],"content":"Spatial Frequency\nSpatial domain also called as image domain where each pixel or data point has a position and intensity value. This is the domain where we usually see the images and can understand the meaning of various parts of it.\nSpatial frequency domain where image is represented in terms of frequency components. In this domain, each point represent a frequency with its amplitude and phase.\nAmplitude of the frequency tells the intensity level and phase tells about the structure of the image where intensity should be placed.\nFourier Transformation\nFourier transformation is the part which actually coverts spatial domain to spatial frequency domain.\nspatial domain ----- fft -----&gt; spatial frequency domain\nspatial frequency domain &lt;----- ifft ---- spatial domain\n\nFrequency region in image\nIn spatial frequency domain, signals are composed of complex sinusoidal waves. Low-frequency are usually located at the center of the image where the intensity changes slowly. This is where the large structures are present. And we move farther, the intensity level goes down and intensity changes rapidly which results high-frequency regions.\nSampling\nWe can create the original image by selecting bunch of visibilities samples in spatial frequency domain.\nRefer notebook."},"notes/radio-astronomy/imaging/1-spatial-frequency/tutorial":{"title":"tutorial","links":[],"tags":[],"content":"Notes\n\n\nphase contains most of the structural information.\n  A way to think about the phase and amplitude information is that phase information describes the structure of an image, that is, where the power needs to be placed. And ampltiude information describes the intensity of that structure given a position.\n\n\n\nPhase describes about the structure of the image where the power needs to be placed. Amplitude information describes intensity of the structure for positions.\n\nimage with a single intensity pixel represent a boxcar function with the width the size of the pixel. When the number of the pixels in the image increases, it becomes a delta function (what?).\nFFT of a delta function gives a field of flat values (that is constant amplitude at all places in the image).\nWhen the pixel is at the center of the image, the phase is also flat. But the position of the pixel moves, the phase shows fringes pattern relative to the position of the pixel.\nmoving the pixel on x axis, the phase remains constants on y axis. And vice versa.\nMoving the pixel around a circular path at a constant distance from the center, the phase frequency remains the same but the direction of phase changes.\ntwo point source fft\n\nresulting phase is the average of phases of all point sources with point source weights of their amplitude. (amplitude weighted average of the each phases)\n\n\n\n"},"notes/radio-astronomy/imaging/2-sampling-and-psf/sampling-and-psf":{"title":"sampling-and-psf","links":[],"tags":["radio-astronomy"],"content":"Sampling and PSF\nSky is a continuous image. Interferometric arrays gives this continuous function as visibilities as fourier transformation. This visibilities needed to be converted into image domain to create sky image.\nRegular sampling\nContinuous signal is converted to discrete signal by applying a regular spaced function called Shah function.\nHowever, this method can’t be used with radio astronomy because of the issues like scale, sensitivity and technology.\nPoint Spread Function (PSF)\nPoint spread function is the response of any telescope to a point source object in the sky. The optics for optical telescope impose some structure on the point source objects as shown in the image below.\n\n\n\n\n\n\n\n\n\n\n\nFigure: Carina Nebula image from the Hubble Telescope, the cross pattern and airy pattern from the stars in the foreground is the point spread function of the telecsope due to the optics. Credit: NASA, ESA, and M. Livio and the Hubble 20th Anniversary Team (STScI)\nThere are two types of PSFs in radio astronomy.\n\ntelescope optics and structure PSF\ngeometry of the array configuration in interferometry.\n\nGeometry of arrays in interferometry defines how sampling of visibility domain happens. PSF of an interferometric arrays is a fourier transformation of sampling function.\n\\text{PSF}(l, m) \\rightleftharpoons S(u,v)\nFollowing image shows Sampling function of a telescope with a circular aperture. Light coming within the circumference of the lens is included and excluded otherwise.\n\nImage below shows the corresponding PSF of the telescope.\n\nThe central peak with highest amplitude is called PSF primary\\ lobe and those rings are called secondary\\ lobes.\nAnd the resulting observed signal is a convolution of actual signal and PSF of the system.\n\\text{I}_{obs} = \\text{PSF} \\circ \\text{I}_{true}\nReferences\n\nhttp://math_research.uct.ac.za/~siphelo/admin/interferometry/5_Imaging/5_2_sampling_functions_and_psfs.html\n"},"notes/radio-astronomy/model-prediction":{"title":"model-prediction","links":[],"tags":["radio-astronomy"],"content":"\n“The image to data transform is called the prediction step”\n\n"},"notes/radio-astronomy/radio-imaging-hands-on":{"title":"radio-imaging-hands-on","links":[],"tags":["radio-astronomy"],"content":"\npolarization types\n\nlinear\ncircular\n\n\nddi - data description id - a column in measurement set.\n\nthere a data description table having entries for info of polarization and spectral window\n\n\nwhat is spectral window???\nwhat is convolution?\nevery channel separately - spectral imaging?\n\n"},"notes/radio-astronomy/session-calibration":{"title":"session-calibration","links":[],"tags":[],"content":"\nvan cittert zernika theorem\njones matrices in calibration\na model is an astronomical source of known brightness and structure\ntypes of calibration\n\ndirection dependent\ndirection independent\nself calibration\n\n\n\nhands on\n\nface calibration\nflux calibration\n\n\nYou can try flux calibration\n"},"notes/radio-astronomy/terminology":{"title":"terminology","links":[],"tags":["radio-astronomy"],"content":"Radio Astronomy Terminology\n\nFoV: Field of view\nBaseline: An array of antennas and dishes replicating a single big telescope.\nElement: An antenna or dish in a baseline.\nbig is small;small is big: bit telescopes have less FoV and vice versa.\nSDP: Science Data processor\nfield\npolarizations:\n\nlinear: XX, XY, YX, YY\ncircular: RR, LL, LR, RL\n\n\nSpatial domain: This is the image domain where each pixel is defined with the position and intensity value.\n"},"notes/tech/CPython/Pandas":{"title":"Pandas","links":[],"tags":[],"content":"Pandas\nPandas is a python library used for data structures and data analysis.\nLoading CSV files\nimport pandas\ndf1 = pandas.read_csv(&quot;filename.csv&quot;)\ndf1\npandas.read_csv() returns a DataFrame.\nCSV file without header\ndf = pandas.read_csv(&quot;csv_without_header.csv&quot;, header=None)\ndf.columns = [&quot;col1&quot;, &quot;col2&quot;,...]\ndf\nSetting index\ndf.set_index(&quot;ID&quot;)\n# this will create a new data frame with ID set as index\n \ndf.set_index(&quot;ID&quot;, inplace=True)\n# this won&#039;t create new data frame. It will modify the same frame\nBut the second statement has a problem. If another index is set of it, the old index column would be deleted i.e. ID column be will be dropped. This can be solved using\ndf.set_index(&quot;ID&quot;, inplace=True, drop=False)\nAccessing DataFrames\nUsing labels\ndf.loc([row_start:row_end, col_start:col_end])\n \ndf1.loc[2:3, &quot;Address&quot;:&quot;City&quot;]\nUsing indexing\n# syntax df1.iloc[row_index_start: row_index_end, col_index_start: col_index_end]\n \ndf1.loc[2:3, 3:5]"},"notes/tech/CPython/Python":{"title":"Python","links":["notes/tech/CPython/projects/tech/CPython/Python","notes/tech/CPython/multi-threading","notes/tech/CPython/Async-IO","notes/tech/CPython/projects/tech/CPython/References","notes/tech/CPython/Pandas","notes/tech/CPython/opencv-python","notes/tech/CPython/Asyc-Server","notes/tech/CPython/poetry"],"tags":[],"content":"Python\nTable Of contents\nCpython\nA type of implementation of python programming language. It’s written in\nDeclaring and initializing variable\nname = &#039;nitin&#039;;\nname, age = &#039;nitin&#039;, 21;\n&gt;&gt;&gt; name, age = &#039;nitin&#039;, 21, 23\nTraceback (most recent call last):\n  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;\nValueError: too many values to unpack (expected 2)\n&gt;&gt;&gt; name, age, status = &#039;nitin&#039;, 21\nTraceback (most recent call last):\n  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;\nValueError: not enough values to unpack (expected 3, got 2)\n&gt;&gt;&gt;\nOperators\n\n// : floor division\n** : power\n\nData types\n\nint\nfloat\ndecimal\nfraction\ncomplex number\nstrings\n\nprint()\nr for printing raw string\nprint(&#039;hello world\\nbye world&#039;); # prints with new line\nprint(r&#039;hello world\\nbye world&#039;); # prints in single line with &#039;\\n&#039;\nend keyword for specifying what to insert at the end\nprint(&#039;hello world&#039;, end=&#039;,&#039;); #prints &#039;hello world,&#039; without new line\nString\ngreeting = &#039;good morning&#039;;\ngreeting = &quot;good morning&quot;;\nMulti-line string\ngreetings = &#039;&#039;&#039;\n\tGood morning\n\tWelcome everyone\n&#039;&#039;&#039;;\n \ngreetings = &quot;&quot;&quot;\n\tGood morning\n\tWelcome everyone\n&quot;&quot;&quot;;\n \ngreetings = &quot;&quot;&quot;\\\n\tGood morning\n\tWelcome everyone\n&quot;&quot;&quot;; # &#039;\\&#039; prevents leading new line\nTwo or more string literals are concated automatically\n&gt;&gt;&gt; &#039;good&#039; &#039; morning&#039;;\n&#039;good morning&#039;\nStrings can be indexed\nproject[0];   # returns &#039;y&#039;\nproject[-1];  # returns &#039;a&#039;\n\nIndices can be negative to start from the right.\nStrings are immutable here also\n\nSlicing\n&#039;&#039;&#039; Sytax :\n\tstring[startIndex:endIndex];\n&#039;&#039;&#039;\n \nproject[0:1]; # returns &#039;y&#039;\nproject[0:4]; # returns &#039;yask&#039;\n \nproject[:4]; # returns &#039;yask&#039;. defaults to 0\nproject[1:]; # returns &#039;aska&#039;. defaults to string length\nString length\nlen(project); # returns 5\nString formatting\nMethod 1\nname = &#039;Nitin&#039;\nsurname = &#039;Sharma&#039;\nprint(&quot;Hello %s&quot; % name)\nprint(&quot;Hello %s %s&quot; % (name, surname))\nThis method is used in old versions of pythons.\nMethod 2\nprint(f&quot;Hello {nitin}&quot;)\nMethod 3\nprint(&quot;Hello {}&quot;.format(name))\nList\nList is a collection of elements of same type or different types. It’s more likely arrays in javascript.\npreferences = [&#039;bengalore&#039;, &#039;pune&#039;, &#039;gurgaon&#039;];\npreferences[0]; # returns &#039;bengalore&#039;\n \nlen(preferences); #returns list length i.e. 3\n \n# elements can be changed using indices\npreferences[0] = &#039;pune&#039;;\npreferences[1] = &#039;bengalore&#039;;\n \n# Assignment to slices is also possible\n \npreferences[0:1] = &#039;Pune&#039;;\npreferences; # returns [&#039;Pune&#039;, &#039;bengalore&#039;, &#039;gurgaon&#039;]\n \npreferences[:] = []; # clears the list\nList in a list\ninterests = [&#039;typing&#039;, &#039;reading&#039;];\nperson = [&#039;nitin&#039;, 21, interests];\n \ninterests.append(&#039;traveling&#039;);\nperson[2];  # it also gets &#039;traveling&#039;, i.e. list reference is stored\n\nNote : for equal to operator, the list items are checked. It’s not javascript where references are compared\n\ninterests = [&#039;typing&#039;, &#039;reading&#039;];\n_interests = [&#039;typing&#039;, &#039;reading&#039;];\n \ninterests == _interests; # True\n \n_interests.append(&#039;travel&#039;);\ninterests == _interests; # False\nList comprehension\nList comprehension provides concise way to create lists\nnums = [1, 2, 3, 4]\nevens = [x for x in nums if x % 2 == 0]\n \nprint(evens) # [2, 4]\nLook, how concise it is.\nIt starts with an expression followed by for statement. That expression is compulsory.\nWith if-else\ndef _filter(items: list) -&gt; list:\n    return [item if type(item) is int else 0 for item in items]\nSo, for if-else, the position of the components has to change\nTuples\nTuples are similar to lists but these are immutable.\nnames = &#039;nitin&#039;, &#039;hemant&#039;\nprint(names) #(&#039;nitin&#039;, &#039;hemant&#039;)\n \nnames = () # for empty tuple\n \nnames = &#039;nitin&#039;, # for single value in tuple. Trailing , is needed\n \n# unpacking the tuple\nname1, = names # name1 contains &#039;nitin&#039;\nNumbers of variables on the left hand side should be equal to size of tuple.\nnames = &#039;nitin&#039;, &#039;hemant&#039;\nmy_name, = names # won&#039;t work\n \nname1, name2 = names; # will work\nThis is called sequence unpacking.\n\nNote that multiple assignment is really just a combination of tuple packing and sequence unpacking\n\nSet\nIt’s an unordered collection of items.\nnames = {&#039;nitin&#039;, &#039;hemant&#039;}\n# Or\nnames = set([&#039;nitin&#039;, &#039;hemant&#039;])\n \nnames = set([&#039;nitin&#039;, &#039;hemant&#039;, &#039;nitin&#039;])\nprint(names) # {&#039;nitin&#039;, &#039;hemant&#039;}\nSet operations\nIt also supports set operations\nset1 = {1, 2, 3, 4}\nset2 = {1, 4, 6, 9}\n \nset1 - set2 # {2, 3}, in set1, not in set2\nset1 &amp; set2 # {1, 4} in both\n \nFunction\ndef greet():\n\tprint(&#039;Good morning!&#039;)\nKeyword Arguments\ndef greet(age, name):\n\tprint(&#039;Good morning&#039;, name)\n \ngreet(12, name=&#039;nitin&#039;);\n\nKeyword argument should come after positional argument. If positional argument comes after keyword argument, interepreter throws error.\n\ngreet(name=&#039;nitin&#039;, 12) # won&#039;t work\ngreet(12, name=&#039;nitin&#039;)\n*args and **keywordArgs\ndef function(arg, *args, **keywordArgs):\n\tprint(arg)\n\tprint(args)\n\tprint(keywordArgs)\n\narg is a positional argument,\nargs is a tuple having other dynamic arguments,\nkeywordArgs is a dict having keyword and value\n\nfunction(&#039;hello&#039;, &#039;world&#039;,&#039;bye world&#039;, name=&#039;nitin&#039;, surname=&#039;sharma&#039;);\n# output\nhello\n(&#039;world&#039;, &#039;bye world&#039;)\n{&#039;name&#039;: &#039;nitin&#039;, &#039;surname&#039;: &#039;sharma&#039;}\n\n*args should be before **keywordArgs .\n\nSpecial parameters\ndef f(pos1, pos2, /, pos_or_kwd, *, kwd1, kwd2):\n      -----------    ----------     ----------\n        |             |                  |\n        |        Positional or keyword   |\n        |                                - Keyword only\n         -- Positional only\nNames of positional only parameter can be used in keyword only parameters.\ndef foo(name, /, **kwds):\n\treturn &#039;name&#039; in kwds\n \nfoo(1, name=&#039;nitin&#039;) # return True\nfoo(1, **{name: &#039;niitn&#039;}) # return True\nUnpacking Argument list\n# unpacks list\nargs = [1, 2]\nlist(range(*args))\n \n# unpacks dictionary\ngreet(**{&#039;name&#039;:&#039;nitin&#039;, &#039;age&#039;: 21});\nLambda Expressions\nis_even = lambda number: number % 2 == 0\n \ndef filter(array: list, predicate):\n  resArray = []\n  for item in array:\n    predicate(item) and resArray.append(item)\n  \n  return resArray\n \nprint(filter([1, 2, 3, 4], is_even))\nModule\nfunction.py\ndef greet():\n\tprint(&#039;Good morning&#039;)\nimport function\n \nfunction.greet() # Good morning\nfunction module is in global space where it is imported.\nIt’s like require in node. The module file is evaluated and all the functions and variables can be imported.\ndef fun():\n\timport function\n\tfunction.greet()\n \nfun() # import function in it&#039;s space and calls function.greet\n \nfunction.greet() # won&#039;t work as it&#039;s not in global space of the file\n# different types of import\n \nfrom function import greet\n \nfrom function import *\nAll of these imports get the imported function or variables from the module into the global scope of the file.\nimport function as fun\n \n# or \nfrom function import greet as printGreet\n \nfun.greet()\nprintGreet()\nPackages\nA package is a directory having modules or python files.\napp\n├── app.py\n└── src\n    ├── components\n    │   ├── __init__.py\n    │   └── header.py\n    └── layout.py\n\nimport app.app\n \napp.App()\nThis is one way to import module from package.\nfrom app.app import App\n \nApp()\nThis is another way to import module. It loads the module and puts the function in the namespace.\nImporting * from package\nfrom app import *\nThis doesn’t work until we put __init__.py in the package.\napp\n├── __init__.py\n├── app.py\n└── src\n    ├── components\n    │   ├── __init__.py\n    │   └── header.py\n    └── layout.py\n\napp/__init__.py\n__all__ = [&quot;app&quot;]\n__all__ is a list having all the modules to make avaiable for  import * So, app  module gets imported the following works.\nfrom app import *\n \napp.App()\n&quot;&quot;&quot;\nThis is app layout\nThis is a header\nThis is App\n&quot;&quot;&quot;\nAbsolute imports and relative imports\nIn file layout.py\n\nAbsolute import\n\nfrom app.src.components.header import Header;\n \ndef Layout():\n  print(&#039;This is app layout&#039;)\n  Header()\n\nRelative import\n\nfrom .components.header import Header;\n \ndef Layout():\n  print(&#039;This is app layout&#039;)\n  Header()\nPython Namespaces and Scopes\nNamespace\nA namespace is a collection of unique names. Name in a namespace can be same as in another namespace.\nAttributes of a dictionary are also names in dictionary namespace.\n\nNote : The important thing to know about namespaces is that there is absolutely no relation between names in different namespaces\n\nTypes of Namespaces\n\nBuilt-in : python built-in\nGlobal : in a file or module\nLocal: in function or method\n\nClasses\nclass SomeClass:\n\tdef __init__(self, arg1, arg2):\n\t\tself.arg1 = arg1;\n\t\tself.arg2 = arg2;\n \n\tdef do_something(self):\n\t\tpass\n\t\t//do something\n \ninstance = SomeClass(1, 2)\ninstance.arg1\ninstance.arg2\ninstance.do_something()\nself has to pass as first argument to class function.\nClass function and Instance method\nThere is a difference between class function and instance method. An instance method is created using class function.\nWhen instance.do_something() is called, the attribute do_something is searched in the class that appears to be a function. instance is bounded with that class function and called with argument list.\nPrivate variables\nThere is way to define private methods and variables in python. It’s all convention here. Variable starting with _ are considered as private.\nclass S:\n\tdef __init__(self):\n\t\tself._private_attribute = 2\nCallable class instances\nA class instances can be called if class implements __call__ method.\nclass Counter:\n  def __init__(self, start=0):\n    self.count = start\n  \n  def __call__(self):\n    self.count += 1\n    return self.count\n \ncounter = Counter()\n \ncounter() # returns 1\ncounter() # returns 2\nIterator\nAn iterator has __next__() object method that gives the next value. for does the same thing, it gets iterator of the list and calls this __next__() method.\nTo create iterator, the class should have __next__() and __iter__() functions. for loop calls this __iter__() method to get iterator.\nclass Reverse:\n  def __init__(self, items: list):\n    self.items = items\n    self.index = len(items)\n  \n  def __iter__(self):\n    return self\n  \n  def __next__(self):\n    if self.index == 0:\n      raise StopIteration\n    \n    self.index -= 1\n    return self.items[self.index]\nFile IO\nf = open(&#039;file&#039;, &#039;r&#039;, encoding=&#039;utf-8&#039;)\nf.read()\nJSON in Python\nimport json\n \nnums = [1, 2, 3, 4]\n \njson.dumps(nums) # returns json of nums\n \njson.dump(nums, fileObject) # writes the nums json to file\nLoading Json files\njson.load(fileObject)\nErrors and Exceptions\nBasic Syntax\ntry:\n\t# some code that might raise an exception\nexcept Exception:\n\t# code that handles exception\nelse:\n\t# code that executed when try block gets executed successfully\nelse should follow all except clauses.\nexcept can take multiple type of Exceptions together\nexcept (ExceptionType1, ExceptionType2...):\nThere can be multiple except blocks.\nRaising Exceptions\nExceptions are raised using raise statement.\ntry:\n\traise Exception(&#039;demo&#039;)\nexcept Exception as ex:\n\tprint(ex)\nException Chaining\nAn exception can cause another exception to raised.\ntry:\n\topen(&#039;some-bad-file&#039;, &#039;r&#039;)\nexcept OSError:\n\traise RuntimeError(&#039;unable to process&#039;)\nThis flows like, due to OSError another exception RuntimeError occured.\nTo make an exception direct consquence of another, from clause is used\ntry:\n\topen(&#039;some-bad-file&#039;, &#039;r&#039;)\nexcept OSError as file_error:\n\traise RuntimeError(&#039;unable to process&#039;) from file_error\nNow, file_error is the direct cause of RuntimeError .\nThis chaining can be disabled by using from None\ntry:\n\topen(&#039;some-bad-file&#039;, &#039;r&#039;)\nexcept OSError:\n\traise RuntimeError(&#039;unable to process&#039;) from None\nSo, only RuntimeError will be raised.\nfinally block\ntry:\n\t# some code that might raise an exception\nexcept:\n\t# exception handling code\nfinally:\n\t# code that will run always\nSome points to remember:\n\nReturn value will be taken from the finally even though try returns some value.\nIf try raises some exception, except block handles that. If it doesn’t handle, the finally block will get exectued and the exception will be re-raised.\nIf finally has  break, continue or return, exception won’t be re-raised.\n\nContext Managers\nContext managers allow allocate and release of resources. A common use case of context managers is to lock and unlock resources.\nA context manager basically has two functions\n\n__enter__\n__exit__\n\nwith statement calls this __enter__ method and assigns to as parameter.\nOn any exception, with calls __exit__ method and passes, type, value, and traceback.\nclass FileManager:\n  def __init__(self, filename):\n    self.filename = filename\n  \n  # context manager implementation\n  def __enter__(self):\n    self.fileobject = open(self.filename, encoding=&#039;utf-8&#039;)\n    return self.fileobject\n  \n  def __exit__(self, type, value, traceback):\n    print(&#039;Error:&#039;, type, value, traceback)\n    self.fileobject.close()\n \nwith FileManager(&#039;some-file&#039;) as file:\n\tfile.read()\n \nwith FileManager(&#039;some-file&#039;) as file:\n\tfile.some_undefined_method() # with will call __exit__ method\n \nIf __exit__ method returns True then the exception is handled by __exit__ otherwise with raises exception\nFor more information, read this.\nDecorators\nDecorators are function that wraps a function.\ndef decorator(function):\n  def wrapper():\n    print(&quot;doing something before calling actual function&quot;)\n    function()\n    print(&quot;doing something after calling actual function&quot;)\n  \n  return wrapper\n \ndef greet():\n\tprint(&quot;Good morning peeps!&quot;)\n \ngreet = decorator(greet)\n \ngreet()\nThe same thing can be done using decorator\n@decorator\ndef greet():\n\tprint(&quot;Good morning peeps!&quot;)\n \ngreet()\nDecorating function accepting argument\ndef decorator_with_args(function):\n  def wrapper(*args, **kwargs):\n    print(&quot;before calling actual function&quot;)\n    function(*args, **kwargs)\n    print(&quot;after calling actual function&quot;)\n  return wrapper\nIt is not always necessary that decorate should have wrapper function inside it. The main focus should be on that the decorator takes a function as an argument and returns a function.\n\nNote : With decorator, we are losing information about the actual function. We can’t inspect that function being decorated. For example,\n\n@decorator\ndef greet():\n\tprint(&quot;hi&quot;)\n \ngreet.name # would give wrapper\ngreat.__doc__ # would give doc of wrapper\nTo solve this issue, we use python utility functools package.\nimport functools\n \ndef decorator(function):\n\t@functools.wraps(function)\n  def wrapper():\n    print(&quot;doing something before calling actual function&quot;)\n    function()\n    print(&quot;doing something after calling actual function&quot;)\n  \n  return wrapper\n \ndef greet():\n\tprint(&quot;Good morning peeps!&quot;)\n \ngreet.__name__ # would give greet\nfunctools.wraps is a decorator that takes the function being decorated. What it does is, copies the __doc__ and __name__ information of decorated function given to the wrapper function.\nDecorators with arguments\nA decorator is a function that takes function as a argument. To pass argument to the decorator, we need to make a function that returns decorator.\nimport functools\n \ndef repeat(times):\n  def decorator_repeat(fn):\n    @functools.wraps(fn)\n    def repeat_wrapper(*args, **kwargs):\n      for i in range(times):\n        fn(*args, **kwargs)\n    \n    return repeat_wrapper\n  return decorator_repeat\n \n@repeat(2)\ndef greet():\n\tprint(&quot;Good morning&quot;)\nClass decorators\nClass can be used to make stateful decorators. If we know how decorator works, it would be easy to understand how can be a class used to make decorators.\n@decorator\ndef fn():\n\tpass\nSo, decorator is actually a function which takes fn as argument, wraps this function in a wrapper and returns that wrapper and assigns to same variable fn.\nScenerio with class\n@SomeClassDecorator\ndef fn():\n\tpass\nSo, with this, an instance of the class is created. That instance is assigned to the variable fn. Ofcourse that instance should be callable. And we know how to make class callable.\nclass Countable:\n  def __init__(self, fun):\n    self.fun = fun\n    self.count = 0\n    functools.update_wrapper(self, fun)\n  \n  def __call__(self, *args, **kwargs):\n    self.count += 1\n    self.fun(*args, **kwargs)\n    print(f&quot;Called {self.fun.__name__} {self.count} times&quot;)\n@Countable\ndef greet():\n\tprint(&quot;hi&quot;)\n \n# is equivalent to\ndef greet():\n\tprint(&quot;hi&quot;)\n \ngreet = Countable(greet)\n \nfunctools.update_wrapper is used to update the introspetion details of the instance.\nWhy do we need Decorators\nRead more\nTo look\n\n  Decorators\n  Documentation Strings. Conventions to document.\n  sorted() or .sort() method\n  Inheritance\n  “Compiled” Python files\n  Make interfaces.\n\n  Try to pass classes to function.\n  Try passing drived class to function accepting base class and access drive class methods\n\n\n  Decoratos\n\n  Caching values using decorators\n  Adding Information About Units\n  Validating JSON\n\n\n  dags and airflow (jobs and pipelines)\n\nPoints Noted\n\n\nPython code is synchronous in nature. If there is any blocking code in the infinite loop, the loop will wait for that blocking code to get executed.\nFor example\nwhile True:\n        data = connection.recv(1024)\n        print(&quot;From client: &quot;, data)\n        if not data:\n          print(&quot;Client closed the connection&quot;)\n          break\n        \n        connection.sendall(data)\n\n\nReferences\n\nStandard types\nPython 3 contents\nVariables\nNaming Convenstions\nWalrus operator\nGlob\nPathlib\nSocket Real Python\nPEP\n\n\nmulti-threading\nAsync IO\nReferences\nPandas\nopencv-python\nAsyc Server\npoetry"},"notes/tech/CPython/References":{"title":"References","links":[],"tags":[],"content":"References\ngithub.com/Pierian-Data/Complete-Python-3-Bootcamp"},"notes/tech/CPython/asyncio/Asyc-Server":{"title":"Asyc Server","links":[],"tags":[],"content":"Asyc Server\nDescription\nThis article goes through the thorogh theory and practical information of creating an async server that can handle multiple clients at the same time. We would start with simple socket server that handles only one client and then gradually improve our server.\nLet’s get started…\nSimple echo server\n# server.py\n \nimport socket\n \ndef handle_connection(sock: socket.socket):\n    while True:\n        received_data = sock.recv(4096)\n        if not received_data:\n            break\n        sock.sendall(received_data)\n \n    print(&#039;Client disconnected&#039;, sock.getpeername())\n    sock.close()\n \ndef run_server(host: str, port: int) -&gt; None:\n    sock = socket.socket()\n    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n    sock.bind((host, port))\n    sock.listen()\n    print(&#039;Server is listening on {}:{}&#039;.format(host, port))\n    while True:\n        client_sock, addr = sock.accept()\n        print(&#039;Connetion from&#039;, addr)\n        handle_connection(client_sock)\n \nif __name__ == &#039;__main__&#039;:\n    run_server(&#039;localhost&#039;, 3000)\nNow, when we run it and connect with it, only one connection can be made at single point of time. For next connection the already existing connection has to end first.\npython3 server.py\n \n# client\nnc localhost 3000\nhello\nhello\nIntroducing Threads\nLet’s use threads for multiple connections:\n \n# server.py\n \nimport socket\nimport threading\n \ndef handle_connection(sock: socket.socket):\n    while True:\n        received_data = sock.recv(4096)\n        if not received_data:\n            break\n        sock.sendall(received_data)\n \n    print(&#039;Client disconnected&#039;, sock.getpeername())\n    sock.close()\n \ndef run_server(host: str, port: int) -&gt; None:\n    sock = socket.socket()\n    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n    sock.bind((host, port))\n    sock.listen()\n    print(&#039;Server is listening on {}:{}&#039;.format(host, port))\n    while True:\n        client_sock, addr = sock.accept()\n        print(&#039;Connetion from&#039;, addr)\n\t\t\t\tthread = threading.Thread(target=handle_connection, args=[client_sock])\n\t      thread.start()\n \nif __name__ == &#039;__main__&#039;:\n    run_server(&#039;localhost&#039;, 3000)\n \nSo, this let’s us connect multiple clients but still for each connection you need to have a thread which is expensive.\nUsing Thread pools\nTo control the number of threads being used, we can use thread pools\nfrom concurrent.futures import ThreadPoolExecutor\n \nsockets = set()\n \npool = ThreadPoolExecutor(max_workers=20)\n \ndef handle_connection(sock: socket.socket):\n    while True:\n        received_data = sock.recv(4096)\n        if not received_data:\n            break\n        sock.sendall(received_data)\n \n    print(&#039;Client disconnected&#039;, sock.getpeername())\n    sock.close()\n \ndef run_server(host: str, port: int) -&gt; None:\n    sock = socket.socket()\n    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n    sock.bind((host, port))\n    sock.listen()\n    print(&#039;Server is listening on {}:{}&#039;.format(host, port))\n    while True:\n        client_sock, addr = sock.accept()\n        print(&#039;Connetion from&#039;, addr)\n\t\t\t\tpool.submit(handle_connection, client_sock)\n \nif __name__ == &#039;__main__&#039;:\n    run_server(&#039;localhost&#039;, 3000)\nIf you create 20 connections, to make one more connection, you need to wait for the atleast one to get end.\nLet’s use IO multiplexing\nThe major problem with our socket is that it has to wait for any read or write that blocks the program execution. How cool that would be if someone notifies us that there is some update on the socket and run a callback? Cool huh…\nPython provides IO multiplexing module selectors  that we can use. It provides different selectors and one of them is DefaultSelector .\nTo register a socket, we do\nsel = selectors.DefaultSelector()\n \nsel.register(sock, selectors.EVENT_READ, data)\nsel.select() returns a list of (key, events) tuple and each tuple describes a readu socket.\n\nkey is an object with socket object key.filobj and auxiliary data key.data.\nevents are bitmasks of events ready on the socket.\n\nSo, [server.py](server.py) with selectors\n# server.py\n \nimport selectors\nimport socket\n \nsockets = set()\n \ndef broadcast(broadcaster, message):\n    for sock in sockets:\n        if broadcaster is not sock:\n            sock.sendall(message)\n \ndef handle_connection(sock: socket.socket):\n    received_data = sock.recv(4096)\n    if received_data:\n        broadcast(sock, received_data)\n    else:\n        print(&#039;Client disconnected:&#039;, sock.getpeername())\n        sel.unregister(sock)\n        sock.close()\n \nsel = selectors.DefaultSelector()\n \ndef accept(sock: socket.socket):\n    client_sock, addr = sock.accept()\n    print(&#039;Client connected from {}&#039;.format(addr))\n    sockets.add(client_sock)\n    sel.register(client_sock, selectors.EVENT_READ, handle_connection)\n \ndef setup_server_socket(host: str, port: int):\n    sock = socket.socket()\n    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n    sock.bind((host, port))\n    sock.listen()\n    print(&#039;Server is listening on {}:{}&#039;.format(host, port))\n    sel.register(sock, selectors.EVENT_READ, accept)\n \ndef run_event_loop():\n    while True:\n        for key, _ in sel.select():\n            cb = key.data\n            sock = key.fileobj\n            cb(sock)\n \nif __name__ == &#039;__main__&#039;:\n    setup_server_socket(&#039;localhost&#039;, 3000)\n    run_event_loop()\nThis approach also has  a problem. We are writing to the socket and if the writing queue is full, it will block the execution. Which means, handle_connection should be broken into two functions to write and read from the socket.\nThis works for the simple applications but for the larger applications this doesn’t work.\nGenerators as Coroutines\nWe can use yield return the control back to the caller. This way we can achieve context switching as run code irrespective of blocking statements. The easiest thing we can do it to put yield above every blocking statements.\nAbout yield\nThis is used to create generators. What it does is returns the control back to the caller if yield gets executed. For example,\n1. def create_counter():\n2. \t\tfor i in range(10):\n3. \t\t\tyield i\n4.       \n \ncounter = create_counter()\n \nnext(counter) # gives 0\nnext(counter) # gives 1\n#...\nSo, it returns the control back to the caller if yield gets executed. In the context of generator, if generator is called again, it resumes where it left of. For examle, next(counter) returns 0 and controls goes back to calling location. When next(counter) called again generator start executing from line number 4 . It goes through the loop, i becomes 1 and again yield happens and it returns 1.\nLet’s look another example for more details\ndef generator():\n\t\tprint(&#039;started&#039;)\n\t\tprint(&#039;before yielding 1&#039;)\n\t\tyield 1\n\t\tprint(&#039;before yielding 2&#039;)\n\t\tyield 2\n \ng = generator()\nnext(g) # prints &#039;started&#039;, &#039;before yielding 1&#039; and returns 1\nnext(g) # prints &#039;before yielding 2&#039; and returns 2\nnext(g) # raises StopIteration exception and there is no more yield statement\nUsing generator in our problem\nSo, we can put yield wherever there is blocking code. Also, we need an event loop the runs all the generators (or coroutines).\n# server.py\nfrom collections import deque\nimport socket\n \nclass EventLoop:\n    def __init__(self):\n        self.tasks_to_run = deque([])\n \n    def create_task(self, coro):\n        self.tasks_to_run.append(coro)\n \n    def run(self):\n        while self.tasks_to_run:\n            task = self.tasks_to_run.popleft()\n            try:\n                print(&quot;running task&quot;, task)\n                next(task)\n            except StopIteration:\n                print(&#039;STOPITERATION FOR ==&gt; &#039;, task)\n                continue\n            self.create_task(task)\n \ndef run_server(host=&#039;127.0.0.1&#039;, port=55555):\n    sock = socket.socket()\n    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n    sock.bind((host, port))\n    sock.listen()\n    print(&quot;Server is running on {}:{}&quot;.format(host, port))\n    while True:\n        print(&quot;in run_server while loop&quot;)\n        yield\n        client_sock, addr = sock.accept()\n        print(&#039;Connection from&#039;, addr)\n        loop.create_task(handle_client(client_sock))\n \ndef handle_client(sock):\n    print(sock)\n    while True:\n        yield\n        received_data = sock.recv(4096)\n        print(received_data)\n        if not received_data:\n            break\n        yield\n        sock.sendall(received_data)\n \n    print(&#039;Client disconnected:&#039;, sock.getpeername())\n    sock.close()\n \nloop = EventLoop()\n \nif __name__ == &#039;__main__&#039;:\n    loop.create_task(run_server(&#039;localhost&#039;, 3000))\n    loop.run()\nSo, there is an event loop which has two methods of creating tasks and running all of them sequentially. It’s using deque .\nFlow\n\nWe create event loop loop and create task where run_server() returns a generator that gets added to the queue. Then we start the loop.\nLoop takes the leftmost task from the queue, runs it using next() that executes the generator until next yield comes. For the first time when run_server generator is getting executed, socket gets setup, we goes into the loop and we encouters our first yield that returns control back to the loop.\nLoop again takes the same task as there is no task, continue executing the task. As before it was yield , now it executes accept() that blocks the execution and waits for the connection.\nOnce a client is connected, control moves forward. One more task is created of connection handler. Execution continues there in run_server loop. It goes to the loop begining and prints in run_server while loop where again yield comes and control goes back to the event loop.\nNext task is then executed which is handler. It goes like that.\n\nDid you see the problem here?\nThere is a problem. Though there is some sort of concorrency but still another task has to wait for the previous task to get completed (or until next yield comes in the task).\nSo, if a client is connected and there is handler task get control, if client writes something on the socket, it won’t be written back as the\nyield\n        sock.sendall(received_data)\nmakes control go back to the event loop and run_server takes control and it waits for the new connection. When a new connection is made then control goes back to handler and then data is written back.\nSolving this issue with IO multiplexing\nWe can combine both generators and IO multiplexing to improve our solution. We have modify our EventLoop class.\n# event loop class\n \nclass EventLoop():\n    def __init__(self):\n        self.tasks = deque([])\n        self.sel = selectors.DefaultSelector()\n \n    def create_task(self, task):\n        self.tasks.append(task)\n \n    def run(self):\n        while True:\n            print(&#039;tasks&#039;, self.tasks)\n            if self.tasks:\n                task = self.tasks.popleft()\n                try:\n                    op, sock = next(task)\n                except StopIteration:\n                    continue\n \n                if op == &#039;read&#039;:\n                    self.sel.register(sock, selectors.EVENT_READ, task)\n                elif op == &#039;write&#039;:\n                    self.sel.register(sock, selectors.EVENT_WRITE, task)\n                else:\n                    raise ValueError(&#039;Invalid event loop operation type&#039;, op)\n            else:\n                for key, _ in self.sel.select():\n                    sock = key.fileobj\n                    task = key.data\n                    self.sel.unregister(sock)\n                    self.create_task(task)\nSo, what change we made in EventLoop class is that we get the task, run next. Now, yield in generator returns some information. It returns the operation ( read or write) and the particular socket.\nWhat we do is, according the operation code, we register the socket with selectors. So, if there is no task in the queue, we wait for some update on the socket using sel.select() method. We get the socket, and the task, unregister the socket and put back the same task into the queue where it gets executed.\ndef run_server(host=&#039;127.0.0.1&#039;, port=55555):\n    sock = socket.socket()\n    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n    sock.bind((host, port))\n    sock.listen()\n    print(&quot;Server is running on {}:{}&quot;.format(host, port))\n    while True:\n        print(&quot;in run_server while loop&quot;)\n        yield &#039;read&#039;, sock\n        client_sock, addr = sock.accept()\n        print(&#039;Connection from&#039;, addr)\n        sockets.add(client_sock)\n        loop.create_task(handle_client(client_sock))\n \ndef broadcast(sender_sock, message):\n    for sock in sockets:\n        if sock is not sender_sock:\n            sock.sendall(message)\n \ndef handle_client(sock):\n    print(sock)\n    while True:\n        yield &#039;read&#039;, sock\n        received_data = sock.recv(4096)\n        print(received_data)\n        if not received_data:\n            break\n        yield &#039;write&#039;, sock\n        broadcast(sock, received_data)\n        # sock.sendall(received_data)\n \n    print(&#039;Client disconnected:&#039;, sock.getpeername())\n    sock.close()\n \nloop = EventLoop()\n \nif __name__ == &#039;__main__&#039;:\n    loop.create_task(run_server(&#039;localhost&#039;, 3000))\n    loop.run()"},"notes/tech/CPython/asyncio/Async-IO":{"title":"Async IO","links":[],"tags":[],"content":"Async IO\nIt’s single threaded, single process design. It uses cooperative multitasking.\nCoroutines\nCoroutines are function that can suspend its execution and pass control to another coroutine.\nRead More"},"notes/tech/CPython/asyncio/async-for-loop":{"title":"async-for-loop","links":[],"tags":["concurrent","asyncio"],"content":"Async for loop\nAsync for loop with async for syntax are only with asynchronous generators or iterators.\nasync def async_gen(n):\n    for i in range(1, n):\n        yield i\n        await asyncio.sleep(i)\n \n \n@with_time\nasync def main():\n    task = asyncio.create_task(timeout(2))\n \n    async for item in async_gen(5):\n        print(item)\n \n    await task\n \nif __name__ == &quot;__main__&quot;:\n    asyncio.run(main())\nIt gives the result as follows,\n1\nbefore timeout 2\n2\n3\nafter timeout 2\n4\ntotal time elapsed:  10.004251718521118\n"},"notes/tech/CPython/asyncio/asyncio":{"title":"asyncio","links":[],"tags":[],"content":"It is a library in python to carry out asynchronous tasks. Python is asynchronous by nature.\nCoroutines\nA couroutine is a function that can suspended and resumed.\nFor example,\nasync def fetch(url: str):\n\tprint(&#039;sending request at &#039; + url)\n\tawait asyncio.sleep(2)\n\tprint(&#039;got response from  + url&#039;)\n\treturn url + &#039;?authToken=sdfsd&#039;\nfetch is a couroutine. If call coroutine like,\nfetch(&#039;tw.com&#039;)\n&lt;coroutine object fetch at 0x7f8a6dafba70&gt;\nIt is not called like an ordinary function. We need to run this coroutine using asyncio runner.\nasyncio.run(fetch(&#039;tw.com&#039;))\n&#039;sending request at tw.com&#039;\n&#039;got response from  + url&#039;\n&#039;tw.com#039;\nCoroutine function and coroutine object\nA coroutine function is a function where def is followed by async keyword.\nA coroutine object is an object which is generated when a coroutine function is invoked.\nTask\nA task is a wrapper around coroutine. A task schedules the coroutine concurrently.\nasync def main():\n\ttask = asyncio.create_task(fetch(&#039;tw.io&#039;))\n\tresult = await task\n\treturn result\n.create_task() method takes the coroutine and creates a task. It schedules the task immediately and task can only be completed once it is awaited.\n\nAwaiting a task runs all the tasks which can be finished within the finishing time of that task.  Look following example for that.\n\nasync def main():\n \n    tasks = []\n \n    urls = [{&#039;url&#039;: &#039;tw.com&#039;, &#039;time&#039;: 2}, {&#039;url&#039;: &#039;goo.com&#039;, &#039;time&#039;: 2}, { &#039;url&#039;: &#039;bitphile.com&#039;, &#039;time&#039;: 4}, {&#039;url&#039;: &#039;twi.com&#039;, &#039;time&#039;: 2}]\n \n    print(time.asctime())\n    \n    for url in urls:\n        print(url)\n        tasks.append(\n            asyncio.create_task(fetch(url[&#039;url&#039;], \n        url[&#039;time&#039;])))\n \n        print(&#039;--------&#039;)\n \n    task = tasks[0]\n \n    print(task)\n \n    await task\n \n    print(&#039;--------&#039;)\n \n    print(time.asctime())\nSo, awaiting first task will complete all the tasks having time of 2. Task of time 4 won’t get complete.\nIf we await tasks[3] then all the tasks will be completed getting that task be completed in the last.\nadd_done_callback\nThis is the method on task that gets invoked when the task is completed.\nasync def main():\n    task = asyncio.create_task(fetch(&#039;tw.io&#039;, 2))\n    task.add_done_callback(lambda arg: print(arg))\n    result = await task\n    return result\narg passed to lambda function is the task itself.\nAwaitables\nAnything that can be followed by await keyword.\nFor example,\n\ncoroutines\ntasks\nfutures\n"},"notes/tech/CPython/asyncio/create-task":{"title":"create-task","links":[],"tags":["python","concurrent"],"content":"Create Task\nasyncio.create_task API is used to schedule the execution of a coroutine. It puts the coroutine in the event loop and if there is nothing else to execute, event loop executes that coroutine.\ncreate_task method takes a coroutine and returns a task that needs to be awaited for the execution.\nBelow example shows use of create_task API, followed by a proper explanation of the intended behavior.\nimport asyncio\nfrom time import sleep, time \n \ndef with_time(fn):\n    async def wrapper():\n        start = time()\n        await fn()\n        print(&quot;total time elapsed: &quot;, time() - start)\n \n    return wrapper\n \n \nasync def timeout(n):\n    print(&quot;before timeout&quot;, n)\n    await asyncio.sleep(5)\n    print(&quot;after timeout&quot;, n)\n \n \nasync def async_print():\n    print(&quot;Hello world&quot;)\n \n \n@with_time\nasync def main():\n    task = asyncio.create_task(timeout(1))\n    task2 = asyncio.create_task(async_print())\n    await timeout(2)\n    await task\n    await task2\n \n \nif __name__ == &quot;__main__&quot;:\n    asyncio.run(main())\nIt gives the output as follows,\nbefore timeout 2\nbefore timeout 1\nHello world\nafter timeout 2\nafter timeout 1\ntotal time elapsed:  5.00157618522644\n\nExplanation\n\ncreate_task schedules timeout and async_print coroutines.\ntimeout(2) coroutine is started where there is a asyncio.sleep. This releases the control.\nThere is timeout(1) already scheduled, so event loop picks it up and timeout 1 log comes.\ntimeout(1) has a asyncio.sleep which releases the control.\nThere is async_print already scheduled, so event loop picks it up and we see the log.\nIn the end, those tasks are awaited which holds the program until timeout logs come and then total time elapsed log comes.\n\n\n\n                  \n                  Note\n                  \n                \n\nIf we do not await the tasks, the total elapsed time log comes before the rest of timeout logs because the control is not holded.\n\n"},"notes/tech/CPython/attributes-vs-properties":{"title":"attributes-vs-properties","links":[],"tags":["oops","python"],"content":"Attributes Vs Properties\nclass Person():\n    def __init__(self):\n        self._name = &quot;test&quot;\n \n    @property\n    def name(self):\n        return self._name\n \n    @name.setter\n    def name(self, value):\n        self._name = value\nGiven the above class, attributes are stored in a dictionary __dict__.\na = Person()\n \n# both gives the same result.\n \na._name # &quot;test&quot;\na.name # &quot;test&quot;\n \n# However, &quot;name&quot; as an attribute is not present in __dict__\n \nprint(a.__dict__)\n{&#039;_name&#039;: &#039;test&#039;}\nWe can set attribute by changing the a.__dict__ elements.\na.__dict__[&#039;_name&#039;] = &quot;some-name&quot;\n \na._name # &quot;some-name&quot;\na.name # &quot;some-name&quot;\nPython distinguishes between properties and attributes by their implementation.\nReferences\n\nwww.pythonmorsels.com/python-setattr/\n"},"notes/tech/CPython/dis":{"title":"dis","links":[],"tags":["flash-card","python"],"content":"dis\nDisassembles methods, functions, classes and other objects in python.\n \nimport dis\n \ndef inc(x):\n    x += 1\n    return x\n \ndis.dis(inc)\n \n#  2           0 LOAD_FAST                0 (x)\n#              2 LOAD_CONST               1 (1)\n#             4 INPLACE_ADD\n#             6 STORE_FAST               0 (x)\n#\n#  3           8 LOAD_FAST                0 (x)\n#             10 RETURN_VALUE"},"notes/tech/CPython/dunder-functions":{"title":"dunder-functions","links":[],"tags":["python"],"content":"Dunder Functions\nDunder word is taken by composing “Double” and “Underscore”. So, dunder functions are functions that start and end with double underscores. In python, interpreter treats them specially and these functions are not used directly. However, in some cases we may require to use these functions.\nThese functions enable us to make user defined data structures compatible with basic data types, apply arithmetic operations on instances, etc. For instance, we can make an instance of class Person addition with another instance of same class (or different class).\nclass Person():\n    def __init__(self, age):\n        self.age = age\n    def __add__(self, another):\n        return Person(self.age + another.age)\n \na = Person(2)\nb = Person(2)\n \nprint((a + b).age)\n4\nThere are several dunder functions available.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nDunder functionUsage__setitem__ and __getitem__Handling indexing__add__, __sub__, __div__ etcArithmetic operations__init__Initialise object__lt__, __gt__, __le__ etcRelational operators.\nReferences\n\nmathspp.com/blog/pydonts/dunder-methods\n"},"notes/tech/CPython/event-loop":{"title":"event-loop","links":["tags/language","tags/programming-language","tags/python","tags/concurrent","tags/parallelism","tags/asyncio","tags/loop","tags/event-loop"],"tags":["language","programming-language","python","concurrent","parallelism","asyncio","loop","event-loop"],"content":"tags:languageprogramming-languagepythonconcurrentparallelismasyncioloopevent-loop\nEvent Loop\nWhat is an Event loop?\nAn event loop is a loop which has a list of tasks and it attempts to progress them in a sequence in each iteration of the loop. Along with the execute of the tasks, it also executes callbacks and IO handlings.\nAn event loop is the driver code that manages the cooperative multitasking.\nThis is the core part of asyncio library to create and run asynchronuous code in python.\nEvent loop implementations\nEvent loop is an abstract class which has to be implemented explicility according the requirements. There are several event loop implentations are avaiable.\n\nasyncio.DefaultEventLoopPolicy\nasyncio.ProactorEventLoop\nuvloop a high performance event loop implementation based on libuv library which is used in node.js for its event loop.\nasyncio.SelectorEventLoop\n\nLet’s use uvloop implementation.\npip install uvloop\n \nimport asyncio\nimport uvloop\n \nuvloop.install()\n \nloop = asyncio.new_event_loop()\n \n#&lt;uvloop.Loop running=False closed=False debug=False&gt;\nEvent loop APIs\ncall_soon\nThis is the method of event loop to schedule a callback.\nFor instance,\ndef greet():\n    print(&quot;greetings&quot;)\n \nloop = asyncio.new_event_loop()\n \nloop.call_soon(greet)\n \nloop.run_forever()\nIt should print greetings.\nThere may times when we required to schedule a coroutine. Howeer, call_soon only takes function, not a coroutine. We can do by using asyncio.ensure_future which a method that creates a schedules a future wrapping the coroutine.\n \nasync def greet():\n    await asyncio.sleep(2)\n    print(&quot;greetings&quot;)\n \nloop.call_soon(asyncio.ensure_future, greet())\n \nloop.run_forever()\nSo, asyncio.ensure_future is scheduled as callbacks that takes greet() coroutine as an argument.\nReferences\n\n# Asyncio (superseded by async)\nAsync IO Event Loop\n\n"},"notes/tech/CPython/executor":{"title":"executor","links":[],"tags":[],"content":"Executor is a class concurrent.futures.Executor which is used of offload function calls asynchronously. It immediately returns a future object which can be used to get the result.\n \ndef blocking_io(label: int, bytes: int):\n    time.sleep(4)\n    print(f&#039;--------&gt; FOR {label} &lt;---------&#039;)\n    \n    with open(&#039;/usr/share/dict/words&#039;, &#039;r&#039;) as f:\n        print(f.read(bytes))\n        \n    print(&#039;-----------------------------&#039;)\n \nexecutor = concurrent.futures.ThreadPoolExecutor()\n \nhandler = executor.submit(blocking_io, 1, 100)\n \nhandler.add_done_callback(\n                    lambda future: print(future))\nThere are different Executor available in concurrent.futures such as ThreadPoolExecutor to execute tasks in Threads pool.\nWe also have ProcessPoolExecutor for cpu bound tasks."},"notes/tech/CPython/generators":{"title":"generators","links":["tags/language","tags/computer","tags/programming-language","tags/program"],"tags":["language","computer","programming-language","program"],"content":"tags:languagecomputerprogramming-languageprogram\nGenerators\nSpecial kind of functions which returns a lazy iterator.\nFor example, a file reader that files lazily.\n&quot;file_reader.py&quot;\n \n \ndef file_reader(filename):\n    print(&#039;above with&#039;)\n    with open(filename, &#039;r&#039;) as file:\n        print(&#039;below with&#039;)\n        for line in file:\n            yield line\n            print(&quot;after yield&quot;)\n \nGenerator expressions\ncounter = (num in range(10))\nyield\nIt suspends the execution of the function and returns the yield value to the caller. On next generator method call, it continues executing after the yield.\nIt saves the state of the function.\nGenerator methods\n\n.send() : yield is not a statement. It is an expression.\n\ndef counter():\n\ta = 0\n\twhile True:\n\t\tb = (yield a)\n\t\tprint(b)\n\t\ta += 1\nif we do,\nc = counter()\nc.send(12)\n \noutputs:\n0\n12\n1\n12 is assigned to variable b.\n\n.throw() used to throw exception in generator.\n.close() to StopIteration\n\nSee Also\n\ncProfile\n"},"notes/tech/CPython/gil":{"title":"gil","links":[],"tags":["python"],"content":"Global Interpreter Lock (GIL)\nIt is a implementation in CPython which puts a lock on the interpreter in multithreading. Only a single thread can access the interpreter at a time.\nIn IO bound multithreading, threads wait for IO and meanwhile another thread can access the interpreter.\nIn the case of CPU bound multithreading, one thread doesn’t leave the interpreter and executes behaves as single threaded as other threads have to wait for the interpreter to get released.\nPros\n\nMakes single threading faster as there is only lock, that is GIL lock, to maintain.\nGood for IO bound multithreading programs.\n\nCons\n\nNot good for CPU bound and combinations of both IO and CPU bound multithreading programs.\n\nReferences\n\nrealpython.com/python-gil/#what-problem-did-the-gil-solve-for-python\n"},"notes/tech/CPython/interned-objects":{"title":"interned-objects","links":[],"tags":["python","programming"],"content":"Interned Objects\nThese are the cached PyObjects  which python does for optimizations and performance.\n\nAll integers -5 to 255 are cached.\nStrings that contain ASCII letters, digits, or underscores only.\n\nFor example,\na = 1\nb = 1\n \na is b # True\n \nsys.getrefcount(a)\nsys.getrefcount(b)\n \n# both gives same result\nBoth a and b points to the same Python Object (PyObject).\nReferences\n\nrealpython.com/pointers-in-python/#a-note-on-intern-objects-in-python\n"},"notes/tech/CPython/itertools":{"title":"itertools","links":[],"tags":[],"content":"itertools\nProvides functions to deal with iterators. Most commonly used functions are,\n\ncount to create infinite sequence of numbers.\ncycle to create a cycling sequence with given collection.\n\nReferences\n\ndocs.python.org/3/howto/functional.html#the-itertools-module\n"},"notes/tech/CPython/logging/basicConfig":{"title":"basicConfig","links":[],"tags":["python","logs"],"content":"basicConfig\nIt is a method on logging module which tests the basic configurations for the root logger.\nIt can be only called once.\nlogging.basicConfig(level=logging.INFO)\nlogging.basicConfig(level=logging.DEBUG)\nSecond config won’t work.\nAlso, if any of the logging logging method such as .info, .warn etc is called, they implicitly calls this basicConfig with no arguments. So, basic configs can’t be set after calling any of the logging method."},"notes/tech/CPython/logging/logrecord-attributes":{"title":"logrecord-attributes","links":[],"tags":["logs","python"],"content":"LogRecord Attributes\nWhile constructing the format for the log, we can provide LogRecord attributes such asctime, message etc.\nlogging.basicConfig(\n                    format=&quot;%(levelname)s - %(message)s - %(filename)&quot;\n                    )\nReferences\n\ndocs.python.org/3/library/logging.html#logrecord-attributes\n"},"notes/tech/CPython/memory-management":{"title":"memory-management","links":["notes/tech/CPython/pyobject"],"tags":["python","memory-management"],"content":"\nPython code gets converted into bytecode. Then bytecode is interpreted by the interpreter such as Cpython, jython etc.\nWhat is that entity that converts python code to bytecode?\n\nPython Memory Management\nMemory management differs in the implementation of python interpreter (CPython, Jython, etc).\nThis note includes memory management in CPython.\nEverything in Python is an object which has pyobject as internal structure.\nPython Application Memory\nPython application gets memory from OS. It has following roughly structure.\n\nNon-object Memory for python internals objects.\nObject Memory for user objects.\n\n\nMemory structure\nMemory allocated to Object memory is divided into:\n\nArena\nPools\nBlocks\n\nArena are big size memory allocated which has several pools storing same size blocks.\n\nEach pool maintain a double linked list to another pools.\nPool states\n\nusedpools\nfullpools\nfreepools (empty)\n\nusedpools contains references to pools which have some occupied blocks. fullpools has references to fully occupied pools. freepools have references to totally empty pools.\nPool block states\n\nfree\nuntouched\nallocated\n\nReferences\n\nrealpython.com/python-memory-management/#cpythons-memory-management\n"},"notes/tech/CPython/multi-threading":{"title":"multi-threading","links":[],"tags":[],"content":"MultiThreading in Python\nThreadPoolExecutor\nlogging.info(&quot;Submitting thread_function in pool&quot;)\nwith ThreadPoolExecutor(max_workers=3) as executor:\n    executor.map(thread_function, [4])\nlogging.info(&quot;Submitted all the thread_function s &quot;)\nIt holds the control until all the tasks have been completed as we have used context manager with. It does implicit join.\nlogging.info(&quot;Submitting thread_function in pool&quot;)\nexecutor = ThreadPoolExecutor(max_workers=3)\nexecutor.map(thread_function, [4])\nlogging.info(&quot;Submitted all the thread_function s &quot;)\nIt runs the threads and control goes back to main thread. So, first log will come, then thread_function log and immediately last log."},"notes/tech/CPython/multiprocessing/queue":{"title":"queue","links":[],"tags":["multiprocessing","message-passing","python"],"content":"Queue\nA queue is process shared queue implementation. It is used as a way to pass information among the processes.\nfrom multiprocessing import Queue\nfrom threading import Thread\n \nq = Queue()\n \ndef worker():\n    while True:\n        value = q.get()\n        print(f&quot;Got some value {value}&quot;)\n \nt = Thread(target=worker)\n \nt.start()\n \n \nq.put(1)\n&quot;Got some value 1&quot;\n \nq.put(&quot;something&quot;)\n&quot;Got some value something&quot;\nq.get method blocks until it gets a value. It accepts arguments block and timeout. block is by default True and timeout is None. Passing a timeout will throw an empty queue exception if queue doesn’t get a value by the time."},"notes/tech/CPython/mutex-lock":{"title":"mutex-lock","links":[],"tags":["python","operating-system","deadlocks"],"content":"Lock\nTo make threading programming thread safe, we can use locking mechanism python provides. Python provides mutex locking system with threading.Lock.\nlock = threading.Lock()\n \nlock.acquier()\nchange_value()\nupdate_value()\nlock.release()\nIt can be done using with context manager.\nwith lock:\n    change_value()\n    update_value()\nExample\nclass Atom():\n    def __init__(self, value) -&gt; None:\n        self.value = value\n        self._lock = threading.Lock()\n \n    def inc(self, name) -&gt; int:\n        logging.info(&quot;Starting by thread %d&quot;, name)\n        logging.info(&quot;Acquire Lock by thread %d&quot;, name)\n        # with self._lock:\n        self._lock.acquire()\n        logging.info(&quot;Acquired Lock by thread %d&quot;, name)\n        copy = self.value\n        copy += 1\n        time.sleep(0.1)\n        logging.info(&quot;Update by thread %d&quot;, name)\n        self.value = copy\n        self._lock.release()\n        logging.info(&quot;Release Lock by thread %d&quot;, name)\n \n \nif __name__ == &quot;__main__&quot;:\n    format = &quot;%(asctime)s: %(message)s&quot;\n    logging.basicConfig(format=format, level=logging.INFO,\n                        datefmt=&quot;%H:%M:%S&quot;)\n \n    atom = Atom(1)\n    with ThreadPoolExecutor(max_workers=2) as executor:\n        executor.map(atom.inc, list(range(1, 3)))\n \n    logging.info(&quot;MAIN : atom value is %d&quot;, atom.value)\nOutput\n13:48:02: Starting by thread 1\n13:48:02: Acquire Lock by thread 1\n13:48:02: Acquired Lock by thread 1\n13:48:02: Starting by thread 2\n13:48:02: Acquire Lock by thread 2\n13:48:02: Update by thread 1\n13:48:02: Release Lock by thread 1\n13:48:02: Acquired Lock by thread 2\n13:48:02: Update by thread 2\n13:48:02: Release Lock by thread 2\n13:48:02: MAIN : atom value is 3\n"},"notes/tech/CPython/names-not-variables":{"title":"names-not-variables","links":[],"tags":["python","programming"],"content":"Python Names\nPython doesn’t have variables, instead they have names. There is no concept of variables in Python.\n\n\n                  \n                  Note \n                  \n                \n\nThe notion we have of a variable is something which stores value and it can be changed through out the program life cycle. There can be different implementation of in different programming languages. For instance in C, a variable owns a memory location and stores a value in it. If a new value is reassigned, the memory location remains the same but the value is overwritten on the same location.\n\n\nUnderstanding Names\nConsidering the following statement,\na = 1\nFollowing things happen when this statement executes.\n\nA PyObject is created. This PyObject can’t be accessed by user program. It is internal to CPython implementation.\ntypecode is set as integer.\nvalue is set as 1.\nref count is increased by 1.\nname is a is bounded to this PyObject.\n\n\n\n\n                  \n                  Tip\n                  \n                \n\nsys.getrefcount method returns reference count to a PyObject.\n\n\nReferences\n\nrealpython.com/pointers-in-python/\n\n"},"notes/tech/CPython/opencv-python":{"title":"opencv-python","links":[],"tags":[],"content":"opencv-python\nReading images\nimg = cv2.imread(&quot;path/to/image/file.jpg&quot;)\n# img is a numpy array\n \nimg = cv2.imread(&quot;path/to/image/file.jpg&quot;, 0)\n# 0 =&gt; grayscale, 1 =&gt; bgr, -1 =&gt; preserve alpha values\nCreating images\ncv2.imwrite(&quot;path/to/file.jpg&quot;, old_img)\nResizing images\ncv2.resize(image, (width, height))\nDetecting face\nTo detect face, we need some models that will be used by the cv2 to process the image and detect face.\nFor example, haarcascade_frontalface_default.xml is a model\nface_cascade = cv2.cascadeClassifier(&quot;haarcascade_frontalface_default.xml&quot;)\nresults = face_cascade.detectMultiScale(img, scaleFactor=1.05, minNeighbors=5)\nresults is an 2d array of detected positions.\n[\n\t[x, y, width, height]\n]\nDrawing rectangle\nThis positions can be used to draw rectangle around faces\nfor x, y, w, h in results:\n\timg = cv2.rectangle(img, (x, y), (x + w, y + h), 3)\nShowing image\ncv2.imshow(&quot;Image&quot;, img)\ncv2.waitKey(0)  # wait for key &#039;0&#039; to press\ncv2.destroyAllWindows()  # after pressing &#039;0&#039; the image window will get closed\nwaitKey method wait for user key press on the image window. It takes parameter time in milliseconds to wait for the key. If it’s 0 then wait forever.\nIt returns the ascii value key pressed.\nVideo processing from webcam\nvideo = cv2.VideoCapture(0) # 0 is the camera number\nhas_frame, frame = vide.read()\n \nvideo.realase() # release the camera control\nBlurring Images\nimg = cv.GaussianBlur(img, (21, 21), 0)\nReferences\n\nCascade Classifier\nopencv Haarcascades\n"},"notes/tech/CPython/package":{"title":"package","links":[],"tags":["python","programming"],"content":"Python Package\nA package is a directory containing python modules (or files) containing related set of code.\n__init__.py\n__init__.py is a file in a package which is added to make a directory a package. With old versions of python, it was mandatory to add this file. With newer versions, it is optional. However, for best practices, we should add it.\nFeatures\n\nIt can used to execute some code when the module is imported.\nWhen importing everything using from package import *, __init__.py can decide what all to import. By default nothing is imported when does like it. We need to explicitly add __all__ global variable in __init__.py.\n\n__init__.py\n__all__ = [&quot;format&quot;, &quot;my_math&quot;]\n\n\n                  \n                  Tip\n                  \n                \n\nAlthough, above can be accomplished using from .format import *.\n\n\n__init__.py\nfrom .format import *\nfrom .math import *\n\nfrom lib import *\n \nline(10)\n# &#039;----------&#039;"},"notes/tech/CPython/pickle":{"title":"pickle","links":[],"tags":["python","programming-language"],"content":"Pickle and Unpickle\nIt is used to serialize python objects into binary.\nimport pickle\n \npickle.dump(&quot;{&#039;a&#039;: &#039;b&#039;}&quot;, file) # file is file object\nwith open(&#039;./obj&#039;, &#039;rb&#039;) as file:\n    print(pickle.load(file))"},"notes/tech/CPython/poetry":{"title":"poetry","links":[],"tags":[],"content":"poetry\nInstalling dependencies\npoetry add --group test pytest\n"},"notes/tech/CPython/pyobject":{"title":"pyobject","links":["notes/tech/CPython/gil"],"tags":["python","programming"],"content":"PyObject\nA PyObject is a data structure used by CPython to store data objects in the memory. Everything in python is an object.\nPyObject structure\nCPython code has PyObject which is a grand object. It stores following information:\n\nReference Count: Total number of references for the actual data object.\nPointer to the actual data object.\n\nstruct {\n    ob_refcnt,\n    ob_type\n}\nReference count is used in freeing memory used by unused data objects. If reference counts becomes 0, the memory is freed.\nIn multithreading applications, multiple threads may try to access the same object which can cause inconsistencies in data and eventually program crash. To stop this, python has gil which locks the interpreter for a thread and other threads wait for the lock to get released.\nReference\n\nrealpython.com/python-memory-management\n"},"notes/tech/CPython/python-bindings/marshalling":{"title":"marshalling","links":[],"tags":["python"],"content":"Marshalling\nIt is a processing of converting a data residing in memory to a form that can be transmitted or stored. Mostly used with passing the data from one system to another system for remote calls. In this case, function call in another language.\nMarshalling vs Serialisation\n\nMarshalling is serialisation plus information about data type and codebase.\n\n\n\n                  \n                  Note: \n                  \n                \n\nCodebase: It stores the information about the implementation of the serialised object from where the receiver can know where to find the code to implement the object.\n\n\nWhy Marshalling in Python (Need to move into another file)\nTo create python bindings for c/c++, marshalling is used to move data between python and c/c++ because both languages use different mechanism to store data.\nReferences\n\nrealpython.com/python-bindings-overview/#marshalling-data-types\nMarshalling vs Serialisation at Stackoverflow\n"},"notes/tech/CPython/python-bindings/using-ctype":{"title":"using-ctype","links":[],"tags":["python"],"content":"Python binding using ctype\nAssuming there is already a shared c library, we can load this in python using following statement.\n \nshared_lib = &quot;path to shared library&quot;\nc_lib = ctype.CDDL(shared_lib)\nc_lib has all the function present in shared library as attributes.\nLet’s see there is a function mul which takes an integer and a float and returns the product of it as float.\nBy default, ctype marshalling process passes all the data as integer so we need to explicitly tell ctype to use float.\nc_lib.mul(2, ctype.c_float(2.3)) ## FAILS\nThe above statement fails. The reason being the return type is float and marshalling is not happening correctly from ctype end. Again we need to specify it.\nc_lib.mul.restype = ctype.c_float\nNow, it will work."},"notes/tech/CPython/python-loops":{"title":"python-loops","links":[],"tags":["python"],"content":"Why python loops are slow?\n\nPython’s dynamically types nature.\n"},"notes/tech/CPython/re":{"title":"re","links":[],"tags":["python","programming"],"content":"re module\ngroup\nReturns group by the number.\nm = re.match(r&quot;(\\w+).(\\d+)&quot;, &quot;www.222&quot;) \n \nm.group(1) # &#039;www&#039;\nm.group(2) # &#039;222&#039;\ngroups\nReturns a tuple of groups found.\nm = re.match(r&quot;(\\w+).(\\d+)&quot;, &quot;www.222&quot;) # gives matches\nm.groups() # (&#039;www&#039;, &#039;222&#039;)\ngroupdict\nReturns a dictionary of named groups.\nm = re.match(r&quot;(?P&lt;words&gt;\\w+).(?P&lt;numbers&gt;\\d+)&quot;, &quot;www.222&quot;) \nm.groupdict()\n# {&#039;word&#039;: &#039;www&#039;, &#039;number&#039;: &#039;222&#039;}"},"notes/tech/aws/aws-cli-setup-sso":{"title":"aws-cli-setup-sso","links":[],"tags":[],"content":"Setting AWS CLI With SSO\nCreating SSO User\nAWS provides IAM Identity Center to create SSO User. Following are the steps to create SSO User.\n\nEnable IAM Identity Center if now enabled in the region.\n\n\n\n                  \n                  Only one IAM Identity Center is allowed in any region. \n                  \n                \n\n\nCreate User by following the steps.\nCreate a group and add the user into the group.\n\n\n\n                  \n                  it is always advisable to attach permissions to the groups instead of individuals users. \n                  \n                \n\n\nCreate a permission set. For now, keep PowerUserAccess for all access except user management.\nAdd a group/user to an account. Multi-account permissions &gt; AWS Accounts.\n\nClick button Assign users or groups.\nAdd user/group\nAttach Permission set just created.\n\n\n\nInstalling AWS CLI\nThis section describes about installing AWS CLI using command line for current user.\nEither you can use user folder or can create new folder for the installation. Assuming a new folder for installation aws-installer.\n\nSetup choices.xml file which tells where to get the aws files.\n\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;\n&lt;plist version=&quot;1.0&quot;&gt;\n  &lt;array&gt;\n    &lt;dict&gt;\n      &lt;key&gt;choiceAttribute&lt;/key&gt;\n      &lt;string&gt;customLocation&lt;/string&gt;\n      &lt;key&gt;attributeSetting&lt;/key&gt;\n      &lt;string&gt;/Users/username/aws-installer&lt;/string&gt;\n      &lt;key&gt;choiceIdentifier&lt;/key&gt;\n      &lt;string&gt;default&lt;/string&gt;\n    &lt;/dict&gt;\n  &lt;/array&gt;\n&lt;/plist&gt;\n\nDownload the .pkg file.\n\ncurl &quot;awscli.amazonaws.com/AWSCLIV2.pkg&quot; -o &quot;AWSCLIV2.pkg&quot;\n\n\nInstall the downloaded .pkg.\n\ninstaller -pkg AWSCLIV2.pkg \\\n            -target CurrentUserHomeDirectory \\\n            -applyChoiceChangesXML choices.xml\n\n\nLinking the binaries. By default installation doesn’t modify the PATH to set aws binary location. We have to do it manually.\n\nsudo ln -s /Users/username/aws-installer/aws-cli/aws /usr/local/bin/aws\nsudo ln -s /Users/username/aws-installer/aws-cli/aws_completer /usr/local/bin/aws_completer\n\n\nVerify the installation.\n\n~/aws-installer\n⟩ aws --version\naws-cli/2.15.20 Python/3.11.6 Darwin/23.3.0 exe/x86_64 prompt/off\n\nAWS CLI SSO Setup\nThis setup results in the creation of profile that will be used to access aws resources.\n\nRun the command aws configure sso.\nIt asks for few details such as name, region name, start url that can be fetched from IAM Identity Center.\n"},"notes/tech/aws/email-notification-lambda":{"title":"email-notification-lambda","links":[],"tags":["data-engineering","amazon","lambda","aws"],"content":"Sending Email from Lambda\nA lambda function can be triggered whenever something changes in S3 bucket. This note describes how to setup the lambda to send email on S3 Bucket update.\nCreate Lambda\nCreate lambda with following code.\n&#039;use strict&#039;;\n \nconst AWS = require(&#039;aws-sdk&#039;);\n \nconst sns = new AWS.SNS()\n \nexports.handler = (event, context, callback) =&gt; {\n    console.log(process.env);\n    // This reads the environment variable &#039;sns_topic_arn&#039;\n    var topic_arn = process.env.sns_topic_arn\n    var publishParams = {\n        TopicArn: topic_arn,\n        Message: JSON.stringify(event, null, 2)\n    };\n    sns.publish(publishParams, (err, data) =&gt; {\n        if (err) console.log(err)\n        else callback(null, &quot;Completed&quot;);\n    })\n};\n\n\n                  \n                  Note: Please use Node version 14.x \n                  \n                \n\nSet Trigger Source\nWhile creating lambda function, it provides the trigger source. Select S3 Bucket there.\nAmazon provides SNS (Simple Notification Service) resource for sending email notification. Let’s setup SNS.\nSetting up SNS\nCreate a SNS topic with the name onS3BucketChange (name can be different).\nCreate a subscription where you need to add email address where to send the notification to.\nOnce the email address is added, a mail will be send to that email for subscription confirmation.\nThis should be enough for SNS. Let’s go back to Lambda. As we are using SNS in lambda, we have to provide permission to lambda to use SNS feature.\n\n\n                  \n                  When you create lambda function, you get a role for that lambda created. \n                  \n                \n\nAdd SNS policy for lambda\nGo to roles window and select role for lambda. Add one more policy for lambda role AmazonSNSFullAccess.\nThat’s it. Lambda can access SNS feature.\nConfigure Environment variable\nWe have used sns_topic_arn environment variable in the code. Go to Environment variables tab and add environment variable by putting ARN for SNS topic that we get from Topic dashboard.\nWe are good to go for testing."},"notes/tech/conda/export":{"title":"export","links":[],"tags":["python","share","management"],"content":"Conda export\n\nExporting all the dependencies and their additional packages.\n\nconda env export &gt; file.yml\n\n# or\n\nconda export -n env &gt; file.yml\n\nThis make sense when environment is being created in same platform as the source.\n\nExport without additional platform dependent packages.\n\nconda env export --from-history &gt; file.yml\n\nThis only export the high level required dependencies without their underlying packages which can be platform dependent.\nWhile installing the environment from this yml file, conda installs platform specific additional packages."},"notes/tech/dask/chunks":{"title":"chunks","links":[],"tags":["python","libraries","distributed-computing"],"content":"Chunks\nDask array composed of blocks of underlying array like structures such as numpy etc. Each of these blocks are called chunks.\n1 2 3   4 5 5\n6 6 7   7 7 7\n\n5 5 5   9 9 9\n6 6 6   7 7 7\n\nChunks can be specified different formats like shown below.\ndask.array.ones((3, 4), chunks=1)\n \n# or\n \ndask.array.ones((3, 4), chunks=(1, 2))\n \n# or\n \ndask.array.ones((3, 4), chunks=((2, 1), (2, 2)))\n \n# or\n \ndask.array.ones((3, 4), chunks={0: 2, 1: 2})\nFirst specifies single chunk size for all the dimensions. Second specifies chunk sizes of each dimension separately. Third one specifies more explicitly chunk sizes for blocks along each dimension. Fourth is similar to second approach with dictionary format.\n\n\n                  \n                  Note\n                  \n                \n\nChunk size means total number of elements in the chunk or block.\n\n"},"notes/tech/dask/client":{"title":"client","links":[],"tags":["parallelism","distributed-computing","python","libraries"],"content":"Client\nDask client for the computation.\nfrom dask.distributed import Client\n \nclient = Client(cluster)\n \n# Or\n \nscheduler_ip = &quot;tcp://IP&quot;\nclient = Client(scheduler_ip)"},"notes/tech/dask/compute-function":{"title":"compute-function","links":["notes/tech/dask/get-method"],"tags":["libraries"],"content":"compute function\nIt executes the dask collection (dask graph) by the default or given scheduler or get-method function.\ndask.compute(da_1, da_2, scheduler=&quot;threads&quot;)\nAs it takes multiple dask collections, it reuses the nodes in both graphs. For instance,\nx = da.arange(10)\ny = (x + 1).sum()\nz = (x + 1).mean()\n \ndask.compute(y, z)\nSo, node (x + 1) will be reused."},"notes/tech/dask/dask-dashboard":{"title":"dask-dashboard","links":[],"tags":["monitoring","charts","plots","streams"],"content":"Dask Dashboard\nDask dashboard provides details of the distributed computations, workers, and cluster resource usages.\nDashboard provides different diagnosis plots, some of them are:\n\nBytes stored and Bytes per worker\nTask processing/CPU utilization/Occupancy/Data Transfer\nTask Stream\nProgress\n\nBytes stored and Bytes per worker\nThese plots provides overall memory utilization of the cluster and individual workers. There are four different colors to describe different memory utilizations.\n\nBlue when memory is under the target which is 60% of memory available.\nOrange when memory is used 70% and is close to spilling to disk.\nRed when at least one worker is paused due to the memory usage 80% of available memory.\nDark gray shows the memory spilled to disk.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure: Memory utilizationThe different transparency in the plots shows memory management levels such as managed, unmanaged old and unmanaged recent.\nTask processing/CPU utilization/Occupancy/Data Transfer\nThis plots detail task being processed by workers, their CPU utilization, occupancy which is the amount of time dask expects worker to finish all the tasks, data transfer from/to other workers.\nTask Stream\nTask stream plot shows the tasks getting executed on each thread. Rows in the plot are threads and different color rectangular boxes are individual tasks. Tasks with same prefix will have same color as defined in progress bar plot. For example, tasks with prefix inc will have some color in the task stream.\nHowever, these following colors are reserved for specific kind of operations.\n\nLight red shows the data transfer between workers.\nLight orange shows read and writing the disk.\nLight gray shows serialize/deserialize of the data.\nBlack shows some error.\n\nWhite spaces among the tasks shows idle time of the threads. Having many white spaces and red bars show unoptimized execution.\n\n\n\n\n\n\n\n\n\n\n\nFigure: Healthy tasks stream.\n\n\n\n\n\n\n\n\n\n\n\nFigure: Unhealthy tasks strem.\nProgress bar\nThis shows the progress of each individual task prefix.\nResources\n\ndocs.dask.org/en/stable/dashboard.html\n"},"notes/tech/dask/dask-delayed":{"title":"dask-delayed","links":["notes/tech/dask/notebooks/delayed"],"tags":["python","libraries"],"content":"Dask Delayed\nIt is an interface provided dask to make the function calls lazy and supporting parallelism.\nimport dask\n \ndef mean(a):\n    return np.mean(a)\nmean becomes lazy. Calling it won’t give back the result. We need to explicitly call compute .\ndelayed = dask.delayed(mean)(a)\ndelayed.compute()\nDask actually creates a task graph of function calls which can be chained together.\nFor example,\ndef inc(x):\n    return x + 1\n \ndef dec(x):\n    return x - 1\n \ndef add(x, y):\n    return x + y\n \n \nz = dask.delayed(add)(\n                      dask.delayed(inc)(1),\n                      dask.delayed(dec)(2)\n                      )\n \n \ndask.visualise(z)\n\nRefer notebook for more details.\nReferences\n\ndocs.dask.org/en/stable/delayed.html\n"},"notes/tech/dask/dask-so-far":{"title":"dask-so-far","links":[],"tags":["python","libraries"],"content":"Dask So Far\n\nMakes dealing with big data in distributed and parallel manner.\nUses underlying numpy arrays for dask arrays.\n\n\n\n                  \n                  Note: \n                  \n                \n\nFor dataframes and other data structures, some different underlying data structure can be there.\n\n\n\nAll the computations are lazy. Applying computation methods such as mean, max etc won’t get executed immediately until explicitly computation is called. (using compute)\n\nd_array.max().compute()\n\nCreates a task graph for the computation operations like spark.\n\nd_array.visualize()\n"},"notes/tech/dask/get-method":{"title":"get-method","links":[],"tags":["distributed-computing"],"content":"get\nA get is used to execute a task graph. This is provided by different schedulers.\n\ndask.threaded.get\ndask.multiprocessing.get\ndask.distributed.Client.get\n\ndsk = {\n       &quot;x&quot;: 1,\n       &quot;y&quot;: (operator.add, &#039;x&#039;, 1)\n}\ndask.threaded.get(dsk, &#039;y&#039;)\ndask.threaded.get(dsk, &#039;x&#039;)\nReferences\n\ndocs.dask.org/en/stable/scheduler-overview.html\n"},"notes/tech/dask/high-level-graph":{"title":"high-level-graph","links":[],"tags":["graphs","distributed-computing","parallelism","python"],"content":"High Level Graphs\nDask collections operations are structurally defined as a high level graph of tasks and sub graphs. They can be used for visualizations and high level optimizations.\na = da.arange(10).sum()\n \ngraph = a.dask\nprint(graph)\n \nHighLevelGraph with 3 layers.\n&lt;dask.highlevelgraph.HighLevelGraph object at 0x10a9fbe50&gt;\n 0. arange-c08e9f8bb90c94d3a220f742c88f3f62\n 1. sum-2f28e54f9d1e0db193618f80e27e339c\n 2. sum-aggregate-6d9a43e9bf7912f58e31f11e385bdde2\nHigh level graph is made up of python dictionary.\nprint(a.dask.layers)\n \n{&#039;arange-c08e9f8bb90c94d3a220f742c88f3f62&#039;: &lt;dask.highlevelgraph.MaterializedLayer object at 0x106e1aef0&gt;,\n &#039;sum-2f28e54f9d1e0db193618f80e27e339c&#039;: Blockwise&lt;((&#039;arange-c08e9f8bb90c94d3a220f742c88f3f62&#039;, (&#039;.0&#039;,)),) -&gt; sum-2f28e54f9d1e0db193618f80e27e339c&gt;, \n &#039;sum-aggregate-6d9a43e9bf7912f58e31f11e385bdde2&#039;: &lt;dask.highlevelgraph.MaterializedLayer object at 0x10a9fbbb0&gt;}\n \n \nprint(a.dask.dependencies)\n \n{&#039;arange-c08e9f8bb90c94d3a220f742c88f3f62&#039;: set(),\n &#039;sum-2f28e54f9d1e0db193618f80e27e339c&#039;: {\n     &#039;arange-c08e9f8bb90c94d3a220f742c88f3f62&#039;\n     }, \n &#039;sum-aggregate-6d9a43e9bf7912f58e31f11e385bdde2&#039;: {\n     &#039;sum-2f28e54f9d1e0db193618f80e27e339c&#039;\n     }\n }\nA high level graph is composed of layers of tasks and dependencies among the layers. In the above example, there are three layers each of having some dependencies.\nDependencies is a set of keys from the graph. These dependencies create edges between the nodes in the graph.\nTo get the whole graph, we can use to_dict method on high level graph.\nprint(a.dask.to_dict())\n \n{\n (&#039;arange-c08e9f8bb90c94d3a220f742c88f3f62&#039;, 0): (functools.partial(&lt;function arange at 0x1086c9c60&gt;, like=None), 0, 10, 1, 10, dtype(&#039;int64&#039;)), \n \n (&#039;sum-2f28e54f9d1e0db193618f80e27e339c&#039;, 0): (subgraph_callable-cc3a9dd45bb3138b6928a8ae6eafc62f, (&#039;arange-c08e9f8bb90c94d3a220f742c88f3f62&#039;, 0)), \n \n (&#039;sum-aggregate-6d9a43e9bf7912f58e31f11e385bdde2&#039;,): (Compose(functools.partial(&lt;function sum at 0x107b1b130&gt;, dtype=dtype(&#039;int64&#039;), axis=(0,), keepdims=False), functools.partial(&lt;function _concatenate2 at 0x109d05a20&gt;, axes=[0])), [(&#039;sum-2f28e54f9d1e0db193618f80e27e339c&#039;, 0)])}\nIt is to be noted that the sub graphs have been opened up here.\nHighLevelGraph\nIt is an Mapping object consists of layers of sub mappings and dependencies among the layers.\nclass HighLevelGraph(Mapping):\n    layers: Dict[str, Mapping]\n    dependencies: Dict[str, Set[str]]\nWe can create a HighLevelGraph ourselves.\ndef add(x, y):\n  return x + y\n \ndef square(x):\n  return x ** 2\n \n \nlayers = {\n  &#039;add&#039;: {\n    (&#039;add&#039;, 0): (add, 1, 2),\n    (&#039;add&#039;, 1): (add, 3, 4)\n  },\n  &#039;square&#039;: {\n    (&#039;square&#039;, 0): (square, (&#039;add&#039;, 0)),\n    (&#039;square&#039;, 1): (square, (&#039;add&#039;, 1))\n  },\n  &#039;agg&#039;: {\n    &#039;agg&#039;: (add, (&#039;square&#039;, 0), (&#039;square&#039;, 1))}\n}\n \ndependencies = {\n  &#039;add&#039;: set(),\n  &#039;square&#039;: {&#039;add&#039;},\n  &#039;agg&#039;: {&#039;square&#039;}\n}\n \ng = HighLevelGraph(layers, dependencies)\n \nget(g, &#039;agg&#039;)\n \n# 58\n \nReferences\n\ndocs.dask.org/en/stable/high-level-graphs.html\n"},"notes/tech/dask/local-cluster":{"title":"local-cluster","links":[],"tags":["libraries","python","distributed-computing"],"content":"LocalCluster\nDask is designed to do no difference in running it on single machine or a distributed cluster.\nLocalCluster is designed to imitate a distributed cluster on a single machine.\nfrom dask.distributed import Client, LocalCluster\n \ncluster = LocalCluster(n_workers=8, threads_per_worker=8)\n \nclient = Client(cluster)"},"notes/tech/dask/map-blocks":{"title":"map-blocks","links":[],"tags":["libraries"],"content":"map_blocks\nThis function/method maps through the blocks in a dask array and apply a customized function on it.\nmap_blocks function from straight dask.array can take multiple dask arrays.\n \nda.map_blocks(lambda x: x * 2, data)\n \n# or\n \ndata.map_blocks(lambda x: x * 2)\nlambda gets numpy.ndarray as chunks.\n\n\n                  \n                  Note\n                  \n                \n\nChunks passed to the lambda are not fully evaluated. For instance, accessing any other element rather than first one will give error. chunk[2] will give error whilst chunk[0] won’t.\n\n\nExamples\n\nMap on two dask arrays of different block numbers\n\nd5 = da.from_array(np.random.random(10), chunks=2)\nd6 = da.arange(25, chunks=(5))\n \nres = da.map_blocks(lambda x, y: np.array([x.max(), y.max()]), d5, d6)\n \nres.compute()\nlambda returns chunk with max values from two corresponding chunks. So, res.compute() returns max values from corresponding chunks of two dask arrays."},"notes/tech/dask/notebooks/chunks":{"title":"chunks","links":[],"tags":[],"content":"Objectives\n\nUnderstand chunking in dask array\nDifferent ways of chunking\n\nimport dask.array as da\nimport numpy as np\nChunked Dask array\na = da.arange(6*6).reshape((6, 6))\na\n\n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; 288 B &lt;/td&gt;\n                    &lt;td&gt; 288 B &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; (6, 6) &lt;/td&gt;\n                    &lt;td&gt; (6, 6) &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 1 chunks in 2 graph layers &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; int64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n    &lt;svg width=&quot;170&quot; height=&quot;170&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n6\n6\n\n\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                \na.chunks\n((6,), (6,))\n\nRechunk\na = a.rechunk({0: 2, 1: 3})\na\n\n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; 288 B &lt;/td&gt;\n                    &lt;td&gt; 48 B &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; (6, 6) &lt;/td&gt;\n                    &lt;td&gt; (2, 3) &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 6 chunks in 3 graph layers &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; int64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n    &lt;svg width=&quot;170&quot; height=&quot;170&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n6\n6\n\n\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                \nb = a[a &gt; 2]\nb\n\n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; unknown &lt;/td&gt;\n                    &lt;td&gt; unknown &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; (nan,) &lt;/td&gt;\n                    &lt;td&gt; (nan,) &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 6 chunks in 10 graph layers &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; int64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n\n    &lt;/td&gt;\n&lt;/tr&gt;\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                \nb.compute_chunk_sizes()\n\n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; 264 B &lt;/td&gt;\n                    &lt;td&gt; 48 B &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; (33,) &lt;/td&gt;\n                    &lt;td&gt; (6,) &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 6 chunks in 10 graph layers &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; int64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n    &lt;svg width=&quot;170&quot; height=&quot;81&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n33\n1\n\n\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                \nReshape\na = da.arange(3*4).reshape((3, 4)).rechunk(((2, 1), (2, 2)))\na\n\n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; 96 B &lt;/td&gt;\n                    &lt;td&gt; 32 B &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; (3, 4) &lt;/td&gt;\n                    &lt;td&gt; (2, 2) &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 4 chunks in 3 graph layers &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; int64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n    &lt;svg width=&quot;170&quot; height=&quot;140&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n4\n3\n\n\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                \na.compute()\narray([[ 0,  1,  2,  3],\n       [ 4,  5,  6,  7],\n       [ 8,  9, 10, 11]])\n\na.reshape((3, 2, 2)).compute()\narray([[[ 0,  1],\n        [ 2,  3]],\n\n       [[ 4,  5],\n        [ 6,  7]],\n\n       [[ 8,  9],\n        [10, 11]]])\n\na.reshape(12) # does the merge of the chunks\n\n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; 96 B &lt;/td&gt;\n                    &lt;td&gt; 32 B &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; (12,) &lt;/td&gt;\n                    &lt;td&gt; (4,) &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 3 chunks in 5 graph layers &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; int64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n    &lt;svg width=&quot;170&quot; height=&quot;87&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n12\n1\n\n\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                \na.reshape(12, merge_chunks=False) # does not merge but converts the slow-axis to of chunk (1,)\n\n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; 96 B &lt;/td&gt;\n                    &lt;td&gt; 16 B &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; (12,) &lt;/td&gt;\n                    &lt;td&gt; (2,) &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 6 chunks in 5 graph layers &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; int64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n    &lt;svg width=&quot;170&quot; height=&quot;87&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n12\n1\n\n\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                \nda.ones((3, 4), chunks=(2, 2)).rechunk(((1, 1, 1), (2, 2)))\n\n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; 96 B &lt;/td&gt;\n                    &lt;td&gt; 16 B &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; (3, 4) &lt;/td&gt;\n                    &lt;td&gt; (1, 2) &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 6 chunks in 2 graph layers &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; float64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n    &lt;svg width=&quot;170&quot; height=&quot;140&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n4\n3\n\n\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                \nda.from_array(np.arange(24).reshape(2, 3, 4), chunks=((2,), (2, 1), (2, 2)))\n\n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; 192 B &lt;/td&gt;\n                    &lt;td&gt; 64 B &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; (2, 3, 4) &lt;/td&gt;\n                    &lt;td&gt; (2, 2, 2) &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 4 chunks in 1 graph layer &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; int64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n    &lt;svg width=&quot;215&quot; height=&quot;175&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n4\n3\n2\n\n\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                "},"notes/tech/dask/notebooks/dask-fuse":{"title":"dask-fuse","links":["tags/bdbdbd","tags/eeeeee","tags/1F1F1F"],"tags":["e0e0e0","bdbdbd","eeeeee","1F1F1F"],"content":"Observations\nHighLevelGraphs\nHow to get the HighLevelGraph:\n\n\nres.data.dask or res.__dask_graph__() to get the graph in layers format.\n\n\nres.data.dask.visualize() or res.__dask_graph__().visualize() to get in graph format.\n\n\nInternals:\n\n\nHLG is a dict, res.data.dask.__dict__. It has the nodes and keys of the task graphs. (which is basically the low level graph’s nodes)\n\n\nres.data.dask.dependencies to get the layers, dependencies and key_dependencies.\n\n\nres.__dask_graph__().keys  or res.data.dask.keys would give the layers as keys. (res.data.dask.values also gives the same, i.e keys and values are same)\n\n\nOn res.data.dask. we can perform these operations [cull, merge, cull_layers, validate, get, copy, dependents, get_all_dependencies, visualize].\n\n\nNotes:\n\ntype(dask.visualize(res)) this gets the low level graph, but the type is an Image. type(res.data.dask) this gets the HLG, and the type is also HLG.\n\nFuse and HighLevelGraph\n# from dask.distributed import Client\n# client = Client(address = &quot;tcp://192.168.0.100:8786&quot;)\n# client\nimport xarray as xr\nimport dask.array as da\nimport numpy as np\n \n# (a+b)^2 = a^2 + b^2 + 2ab\n \na = da.from_array([1, 2, 3, 4], chunks = (1))\nb = da.from_array([5, 6, 7, 8], chunks = (1))\nxr_a = xr.DataArray(a)\nxr_b = xr.DataArray(b)\n \ndef add(arr1, arr2):\n    return arr1 + arr2\n \ndef sq(arr):\n    return arr ** 2\n \ndef mul(arr1, arr2):\n    return arr1 * arr2\n \na_sq = sq(xr_a) \nb_sq = sq(xr_b)\nadd_ab = add(a_sq, b_sq) # a^2 +b^2\nmul_ab = mul(xr_a, xr_b) # ab\n \nres = add(add_ab, mul_ab)\n \n# res.__dask_layers__() -&gt; dk\n# dask.visualize(res) -&gt; low level graphs\n# dask.optimize(a)\n# a.npartitions # gives no.of chunks\n# a.chunksize # gives chunk size\n# res.__dask_keys__() -&gt; dont know the real reason behind the keys\n \n \n# compute \n# dask delayed\n# from_collections()\n \nres.compute()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n:root {\n—xr-font-color0: var(—jp-content-font-color0, rgba(0, 0, 0, 1));\n—xr-font-color2: var(—jp-content-font-color2, rgba(0, 0, 0, 0.54));\n—xr-font-color3: var(—jp-content-font-color3, rgba(0, 0, 0, 0.38));\n—xr-border-color: var(—jp-border-color2,e0e0e0);\n—xr-disabled-color: var(—jp-layout-color3,bdbdbd);\n—xr-background-color: var(—jp-layout-color0, white);\n—xr-background-color-row-even: var(—jp-layout-color1, white);\n—xr-background-color-row-odd: var(—jp-layout-color2,eeeeee);\n}\nhtml[theme=dark],\nhtml[data-theme=dark],\nbody[data-theme=dark],\nbody.vscode-dark {\n—xr-font-color0: rgba(255, 255, 255, 1);\n—xr-font-color2: rgba(255, 255, 255, 0.54);\n—xr-font-color3: rgba(255, 255, 255, 0.38);\n—xr-border-color:1F1F1F;\n—xr-disabled-color: #515151;\n—xr-background-color: #111111;\n—xr-background-color-row-even: #111111;\n—xr-background-color-row-odd: #313131;\n}\n.xr-wrap {\ndisplay: block !important;\nmin-width: 300px;\nmax-width: 700px;\n}\n.xr-text-repr-fallback {\n/* fallback to plain text repr when CSS is not injected (untrusted notebook) */\ndisplay: none;\n}\n.xr-header {\npadding-top: 6px;\npadding-bottom: 6px;\nmargin-bottom: 4px;\nborder-bottom: solid 1px var(—xr-border-color);\n}\n.xr-header &gt; div,\n.xr-header &gt; ul {\ndisplay: inline;\nmargin-top: 0;\nmargin-bottom: 0;\n}\n.xr-obj-type,\n.xr-array-name {\nmargin-left: 2px;\nmargin-right: 10px;\n}\n.xr-obj-type {\ncolor: var(—xr-font-color2);\n}\n.xr-sections {\npadding-left: 0 !important;\ndisplay: grid;\ngrid-template-columns: 150px auto auto 1fr 20px 20px;\n}\n.xr-section-item {\ndisplay: contents;\n}\n.xr-section-item input {\ndisplay: none;\n}\n.xr-section-item input + label {\ncolor: var(—xr-disabled-color);\n}\n.xr-section-item input:enabled + label {\ncursor: pointer;\ncolor: var(—xr-font-color2);\n}\n.xr-section-item input:enabled + label:hover {\ncolor: var(—xr-font-color0);\n}\n.xr-section-summary {\ngrid-column: 1;\ncolor: var(—xr-font-color2);\nfont-weight: 500;\n}\n.xr-section-summary &gt; span {\ndisplay: inline-block;\npadding-left: 0.5em;\n}\n.xr-section-summary-in:disabled + label {\ncolor: var(—xr-font-color2);\n}\n.xr-section-summary-in + label:before {\ndisplay: inline-block;\ncontent: ’►’;\nfont-size: 11px;\nwidth: 15px;\ntext-align: center;\n}\n.xr-section-summary-in:disabled + label:before {\ncolor: var(—xr-disabled-color);\n}\n.xr-section-summary-in:checked + label:before {\ncontent: ’▼’;\n}\n.xr-section-summary-in:checked + label &gt; span {\ndisplay: none;\n}\n.xr-section-summary,\n.xr-section-inline-details {\npadding-top: 4px;\npadding-bottom: 4px;\n}\n.xr-section-inline-details {\ngrid-column: 2 / -1;\n}\n.xr-section-details {\ndisplay: none;\ngrid-column: 1 / -1;\nmargin-bottom: 5px;\n}\n.xr-section-summary-in:checked ~ .xr-section-details {\ndisplay: contents;\n}\n.xr-array-wrap {\ngrid-column: 1 / -1;\ndisplay: grid;\ngrid-template-columns: 20px auto;\n}\n.xr-array-wrap &gt; label {\ngrid-column: 1;\nvertical-align: top;\n}\n.xr-preview {\ncolor: var(—xr-font-color3);\n}\n.xr-array-preview,\n.xr-array-data {\npadding: 0 5px !important;\ngrid-column: 2;\n}\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\ndisplay: none;\n}\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\ndisplay: inline-block;\n}\n.xr-dim-list {\ndisplay: inline-block !important;\nlist-style: none;\npadding: 0 !important;\nmargin: 0;\n}\n.xr-dim-list li {\ndisplay: inline-block;\npadding: 0;\nmargin: 0;\n}\n.xr-dim-list:before {\ncontent: ’(’;\n}\n.xr-dim-list:after {\ncontent: ’)’;\n}\n.xr-dim-list li:not(:last-child):after {\ncontent: ’,’;\npadding-right: 5px;\n}\n.xr-has-index {\nfont-weight: bold;\n}\n.xr-var-list,\n.xr-var-item {\ndisplay: contents;\n}\n.xr-var-item &gt; div,\n.xr-var-item label,\n.xr-var-item &gt; .xr-var-name span {\nbackground-color: var(—xr-background-color-row-even);\nmargin-bottom: 0;\n}\n.xr-var-item &gt; .xr-var-name:hover span {\npadding-right: 5px;\n}\n.xr-var-list &gt; li:nth-child(odd) &gt; div,\n.xr-var-list &gt; li:nth-child(odd) &gt; label,\n.xr-var-list &gt; li:nth-child(odd) &gt; .xr-var-name span {\nbackground-color: var(—xr-background-color-row-odd);\n}\n.xr-var-name {\ngrid-column: 1;\n}\n.xr-var-dims {\ngrid-column: 2;\n}\n.xr-var-dtype {\ngrid-column: 3;\ntext-align: right;\ncolor: var(—xr-font-color2);\n}\n.xr-var-preview {\ngrid-column: 4;\n}\n.xr-index-preview {\ngrid-column: 2 / 5;\ncolor: var(—xr-font-color2);\n}\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\nwhite-space: nowrap;\noverflow: hidden;\ntext-overflow: ellipsis;\npadding-right: 10px;\n}\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\noverflow: visible;\nwidth: auto;\nz-index: 1;\n}\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\ndisplay: none;\nbackground-color: var(—xr-background-color) !important;\npadding-bottom: 5px !important;\n}\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\ndisplay: block;\n}\n.xr-var-data &gt; table {\nfloat: right;\n}\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\npadding-left: 25px !important;\n}\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\ngrid-column: 1 / -1;\n}\ndl.xr-attrs {\npadding: 0;\nmargin: 0;\ndisplay: grid;\ngrid-template-columns: 125px auto;\n}\n.xr-attrs dt,\n.xr-attrs dd {\npadding: 0;\nmargin: 0;\nfloat: left;\npadding-right: 10px;\nwidth: auto;\n}\n.xr-attrs dt {\nfont-weight: normal;\ngrid-column: 1;\n}\n.xr-attrs dt:hover span {\ndisplay: inline-block;\nbackground: var(—xr-background-color);\npadding-right: 10px;\n}\n.xr-attrs dd {\ngrid-column: 2;\nwhite-space: pre-wrap;\nword-break: break-all;\n}\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\ndisplay: inline-block;\nvertical-align: middle;\nwidth: 1em;\nheight: 1.5em !important;\nstroke-width: 0;\nstroke: currentColor;\nfill: currentColor;\n}\n&lt;xarray.DataArray (dim_0: 4)&gt; Size: 32B\narray([ 31,  52,  79, 112])\nDimensions without coordinates: dim_0xarray.DataArraydim_0: 431 52 79 112array([ 31,  52,  79, 112])Coordinates: (0)Indexes: (0)Attributes: (0)\nres.data.dask.visualize()\n\nimport dask\n \ngraph = res.data.dask\n \nhlg_keys = res.data.dask.keys\nfrom dask.threaded import get\nfrom dask.optimization import fuse, fuse_linear\n \noutputs = &quot;add-ffe880f167c9131320013be9069dfca1&quot;\ngraph2, dep = fuse(dict(graph), fuse_subgraphs=True)\nkeys = graph2.keys()\nprint(keys)\nget(graph2, (&#039;add-ffe880f167c9131320013be9069dfca1&#039;, 0))\ndict_keys([(&#039;add-ffe880f167c9131320013be9069dfca1&#039;, 0), (&#039;add-ffe880f167c9131320013be9069dfca1&#039;, 1), (&#039;add-ffe880f167c9131320013be9069dfca1&#039;, 2), (&#039;add-ffe880f167c9131320013be9069dfca1&#039;, 3), (&#039;add-d8368b0c413b7b1ff3e4545d5d219543&#039;, 0), (&#039;add-d8368b0c413b7b1ff3e4545d5d219543&#039;, 1), (&#039;add-d8368b0c413b7b1ff3e4545d5d219543&#039;, 2), (&#039;add-d8368b0c413b7b1ff3e4545d5d219543&#039;, 3), (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 0), (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 1), (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 2), (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 3), (&#039;pow-f98325ba6ded8b13c46607d966ba51d1&#039;, 0), (&#039;pow-f98325ba6ded8b13c46607d966ba51d1&#039;, 1), (&#039;pow-f98325ba6ded8b13c46607d966ba51d1&#039;, 2), (&#039;pow-f98325ba6ded8b13c46607d966ba51d1&#039;, 3), (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 0), (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 1), (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 2), (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 3), (&#039;pow-5022bc0a56d6e28f1fd172a750ba8cff&#039;, 0), (&#039;pow-5022bc0a56d6e28f1fd172a750ba8cff&#039;, 1), (&#039;pow-5022bc0a56d6e28f1fd172a750ba8cff&#039;, 2), (&#039;pow-5022bc0a56d6e28f1fd172a750ba8cff&#039;, 3), (&#039;mul-8e9e32e19f9c6e612b3800864d8cc810&#039;, 0), (&#039;mul-8e9e32e19f9c6e612b3800864d8cc810&#039;, 1), (&#039;mul-8e9e32e19f9c6e612b3800864d8cc810&#039;, 2), (&#039;mul-8e9e32e19f9c6e612b3800864d8cc810&#039;, 3)])\n\n\n\n\n\narray([31])\n\nCall delayed on HLG\n \nfrom dask.delayed import Delayed, delayed\nroot_key = &quot;add-ffe880f167c9131320013be9069dfca1&quot;\n \ng1 = graph\nresult = delayed(graph)\nresult.compute()\n\n    \n        \n            \n                \n                \n                \n                \n                \n                \n                \n                \n            \n        \n        \n            HighLevelGraph\n            \n                HighLevelGraph with 7 layers and 28 keys from all layers.\n            \n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer1: array&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        array-e0289449abd23dc644f0fd074cd695dc\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(4,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;int64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;121&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n4\n1\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer2: pow&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        pow-5022bc0a56d6e28f1fd172a750ba8cff\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(4,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;int64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;array-e0289449abd23dc644f0fd074cd695dc&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;121&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n4\n1\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer3: array&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        array-93fac394d6028ca1841a0aaaf012fdfd\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(4,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;int64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;121&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n4\n1\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer4: mul&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        mul-8e9e32e19f9c6e612b3800864d8cc810\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(4,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;int64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;array-93fac394d6028ca1841a0aaaf012fdfd&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;&lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;array-e0289449abd23dc644f0fd074cd695dc&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;121&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n4\n1\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer5: pow&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        pow-f98325ba6ded8b13c46607d966ba51d1\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(4,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;int64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;array-93fac394d6028ca1841a0aaaf012fdfd&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;121&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n4\n1\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer6: add&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        add-d8368b0c413b7b1ff3e4545d5d219543\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(4,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;int64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;pow-5022bc0a56d6e28f1fd172a750ba8cff&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;&lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;pow-f98325ba6ded8b13c46607d966ba51d1&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;121&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n4\n1\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer7: add&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        add-ffe880f167c9131320013be9069dfca1\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(4,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;int64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;add-d8368b0c413b7b1ff3e4545d5d219543&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;&lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;mul-8e9e32e19f9c6e612b3800864d8cc810&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;121&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n4\n1\n\n\n\n\n&lt;/details&gt;\n\n\n    &lt;/div&gt;\n&lt;/div&gt;\n\n\n# github.com/ska-sa/katsdpcal/blob/e13c3442ae7be050a7455bc384116aae8e082895/katsdpcal/inplace.py#L250\n \n \n# Returns equivalent dask collections that all share the same merged and\n# optimized underlying graph. This can be useful if converting multiple\n# collections to delayed objects, or to manually apply the optimizations at\n# strategic points.  \n# github.com/dask/dask/blob/aafde77e5c7f5220775635a0035c7ae64310ed3a/dask/base.py#L588\n \n# def repack(results):\n#         dsk = repack_dsk.copy()\n#         dsk[collections_token] = quote(results)\n#         return simple_get(dsk, out)\n \n# Quote: Ensure that this value remains this value in a dask graph github.com/dask/dask/blob/main/dask/core.py#L515\n \ndask delayed and fuse\nimport xarray as xr\nimport dask.array as da\nimport numpy as np\n \n# (a+b)^2 = a^2 + b^2 + 2ab\n \na = da.from_array([1, 2, 3, 4], chunks = (1))\nb = da.from_array([5, 6, 7, 8], chunks = (1))\nxr_a = xr.DataArray(a)\nxr_b = xr.DataArray(b)\n \n@dask.delayed\ndef add_d(arr1, arr2):\n    return arr1 + arr2\n \n@dask.delayed\ndef sq_d(arr):\n    return arr ** 2\n \n@dask.delayed\ndef mul_d(arr1, arr2):\n    return arr1 * arr2\n \na_sq = sq_d(xr_a) \nb_sq = sq_d(xr_b)\nadd_ab = add_d(a_sq, b_sq) # a^2 +b^2\nmul_ab = mul_d(xr_a, xr_b) # ab\n \nres_d = add(add_ab, mul_ab)\ndelayed_hgl = res_d.data.dask\ndelayed_hgl.visualize()\n\ndict(delayed_hgl)\n{&#039;add-a362066893b349d99b2b19a5d658fccb&#039;: (&lt;function _operator.add(a, b, /)&gt;,\n  &#039;add_d-a0be0541-c05e-46af-b8c5-df5fb17eea90&#039;,\n  &#039;mul_d-f2fc9779-b3f6-4bec-8822-f5f6fe8041e0&#039;),\n &#039;add_d-a0be0541-c05e-46af-b8c5-df5fb17eea90&#039;: (&lt;function __main__.add_d(arr1, arr2)&gt;,\n  &#039;sq_d-96134174-5594-4c11-bb93-b045188f8a65&#039;,\n  &#039;sq_d-57df3f05-4ad2-41b4-bf02-4f82ddcaa741&#039;),\n (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 0): array([1]),\n (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 1): array([2]),\n (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 2): array([3]),\n (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 3): array([4]),\n &#039;finalize-71ed3afe-61b1-46e5-8a49-2c36a9e8826f&#039;: (&lt;bound method DataArray._dask_finalize of &lt;class &#039;xarray.core.dataarray.DataArray&#039;&gt;&gt;,\n  [[(&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 0),\n    (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 1),\n    (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 2),\n    (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 3)]],\n  &#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;,\n  &lt;bound method Dataset._dask_postcompute of &lt;xarray.Dataset&gt; Size: 32B\n  Dimensions:       (dim_0: 4)\n  Dimensions without coordinates: dim_0\n  Data variables:\n      &lt;this-array&gt;  (dim_0) int64 32B dask.array&lt;chunksize=(1,), meta=np.ndarray&gt;&gt;),\n &#039;sq_d-96134174-5594-4c11-bb93-b045188f8a65&#039;: (&lt;function __main__.sq_d(arr)&gt;,\n  &#039;finalize-71ed3afe-61b1-46e5-8a49-2c36a9e8826f&#039;),\n (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 0): array([5]),\n (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 1): array([6]),\n (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 2): array([7]),\n (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 3): array([8]),\n &#039;finalize-89a5a21d-b67f-47b9-969d-bf82c9f632d6&#039;: (&lt;bound method DataArray._dask_finalize of &lt;class &#039;xarray.core.dataarray.DataArray&#039;&gt;&gt;,\n  [[(&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 0),\n    (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 1),\n    (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 2),\n    (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 3)]],\n  &#039;array-e0289449abd23dc644f0fd074cd695dc&#039;,\n  &lt;bound method Dataset._dask_postcompute of &lt;xarray.Dataset&gt; Size: 32B\n  Dimensions:       (dim_0: 4)\n  Dimensions without coordinates: dim_0\n  Data variables:\n      &lt;this-array&gt;  (dim_0) int64 32B dask.array&lt;chunksize=(1,), meta=np.ndarray&gt;&gt;),\n &#039;sq_d-57df3f05-4ad2-41b4-bf02-4f82ddcaa741&#039;: (&lt;function __main__.sq_d(arr)&gt;,\n  &#039;finalize-89a5a21d-b67f-47b9-969d-bf82c9f632d6&#039;),\n &#039;mul_d-f2fc9779-b3f6-4bec-8822-f5f6fe8041e0&#039;: (&lt;function __main__.mul_d(arr1, arr2)&gt;,\n  &#039;finalize-8e4a37e5-68d7-4d57-908c-05611cb218a2&#039;,\n  &#039;finalize-abb81368-05d0-48fd-bc81-4da3d383a026&#039;),\n &#039;finalize-8e4a37e5-68d7-4d57-908c-05611cb218a2&#039;: (&lt;bound method DataArray._dask_finalize of &lt;class &#039;xarray.core.dataarray.DataArray&#039;&gt;&gt;,\n  [[(&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 0),\n    (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 1),\n    (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 2),\n    (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 3)]],\n  &#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;,\n  &lt;bound method Dataset._dask_postcompute of &lt;xarray.Dataset&gt; Size: 32B\n  Dimensions:       (dim_0: 4)\n  Dimensions without coordinates: dim_0\n  Data variables:\n      &lt;this-array&gt;  (dim_0) int64 32B dask.array&lt;chunksize=(1,), meta=np.ndarray&gt;&gt;),\n &#039;finalize-abb81368-05d0-48fd-bc81-4da3d383a026&#039;: (&lt;bound method DataArray._dask_finalize of &lt;class &#039;xarray.core.dataarray.DataArray&#039;&gt;&gt;,\n  [[(&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 0),\n    (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 1),\n    (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 2),\n    (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 3)]],\n  &#039;array-e0289449abd23dc644f0fd074cd695dc&#039;,\n  &lt;bound method Dataset._dask_postcompute of &lt;xarray.Dataset&gt; Size: 32B\n  Dimensions:       (dim_0: 4)\n  Dimensions without coordinates: dim_0\n  Data variables:\n      &lt;this-array&gt;  (dim_0) int64 32B dask.array&lt;chunksize=(1,), meta=np.ndarray&gt;&gt;),\n &#039;getattr-d83101a6b9634af52ae2ed30c7d8dba0&#039;: (&lt;function getattr&gt;,\n  &#039;add-a362066893b349d99b2b19a5d658fccb&#039;,\n  &#039;data&#039;)}\n\nclient.get(dict(delayed_hgl), &#039;add-a362066893b349d99b2b19a5d658fccb&#039;)\n# get(dict(delayed_hgl), &#039;add-a362066893b349d99b2b19a5d658fccb&#039;)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n:root {\n—xr-font-color0: var(—jp-content-font-color0, rgba(0, 0, 0, 1));\n—xr-font-color2: var(—jp-content-font-color2, rgba(0, 0, 0, 0.54));\n—xr-font-color3: var(—jp-content-font-color3, rgba(0, 0, 0, 0.38));\n—xr-border-color: var(—jp-border-color2,e0e0e0);\n—xr-disabled-color: var(—jp-layout-color3,bdbdbd);\n—xr-background-color: var(—jp-layout-color0, white);\n—xr-background-color-row-even: var(—jp-layout-color1, white);\n—xr-background-color-row-odd: var(—jp-layout-color2,eeeeee);\n}\nhtml[theme=dark],\nhtml[data-theme=dark],\nbody[data-theme=dark],\nbody.vscode-dark {\n—xr-font-color0: rgba(255, 255, 255, 1);\n—xr-font-color2: rgba(255, 255, 255, 0.54);\n—xr-font-color3: rgba(255, 255, 255, 0.38);\n—xr-border-color:1F1F1F;\n—xr-disabled-color: #515151;\n—xr-background-color: #111111;\n—xr-background-color-row-even: #111111;\n—xr-background-color-row-odd: #313131;\n}\n.xr-wrap {\ndisplay: block !important;\nmin-width: 300px;\nmax-width: 700px;\n}\n.xr-text-repr-fallback {\n/* fallback to plain text repr when CSS is not injected (untrusted notebook) */\ndisplay: none;\n}\n.xr-header {\npadding-top: 6px;\npadding-bottom: 6px;\nmargin-bottom: 4px;\nborder-bottom: solid 1px var(—xr-border-color);\n}\n.xr-header &gt; div,\n.xr-header &gt; ul {\ndisplay: inline;\nmargin-top: 0;\nmargin-bottom: 0;\n}\n.xr-obj-type,\n.xr-array-name {\nmargin-left: 2px;\nmargin-right: 10px;\n}\n.xr-obj-type {\ncolor: var(—xr-font-color2);\n}\n.xr-sections {\npadding-left: 0 !important;\ndisplay: grid;\ngrid-template-columns: 150px auto auto 1fr 20px 20px;\n}\n.xr-section-item {\ndisplay: contents;\n}\n.xr-section-item input {\ndisplay: none;\n}\n.xr-section-item input + label {\ncolor: var(—xr-disabled-color);\n}\n.xr-section-item input:enabled + label {\ncursor: pointer;\ncolor: var(—xr-font-color2);\n}\n.xr-section-item input:enabled + label:hover {\ncolor: var(—xr-font-color0);\n}\n.xr-section-summary {\ngrid-column: 1;\ncolor: var(—xr-font-color2);\nfont-weight: 500;\n}\n.xr-section-summary &gt; span {\ndisplay: inline-block;\npadding-left: 0.5em;\n}\n.xr-section-summary-in:disabled + label {\ncolor: var(—xr-font-color2);\n}\n.xr-section-summary-in + label:before {\ndisplay: inline-block;\ncontent: ’►’;\nfont-size: 11px;\nwidth: 15px;\ntext-align: center;\n}\n.xr-section-summary-in:disabled + label:before {\ncolor: var(—xr-disabled-color);\n}\n.xr-section-summary-in:checked + label:before {\ncontent: ’▼’;\n}\n.xr-section-summary-in:checked + label &gt; span {\ndisplay: none;\n}\n.xr-section-summary,\n.xr-section-inline-details {\npadding-top: 4px;\npadding-bottom: 4px;\n}\n.xr-section-inline-details {\ngrid-column: 2 / -1;\n}\n.xr-section-details {\ndisplay: none;\ngrid-column: 1 / -1;\nmargin-bottom: 5px;\n}\n.xr-section-summary-in:checked ~ .xr-section-details {\ndisplay: contents;\n}\n.xr-array-wrap {\ngrid-column: 1 / -1;\ndisplay: grid;\ngrid-template-columns: 20px auto;\n}\n.xr-array-wrap &gt; label {\ngrid-column: 1;\nvertical-align: top;\n}\n.xr-preview {\ncolor: var(—xr-font-color3);\n}\n.xr-array-preview,\n.xr-array-data {\npadding: 0 5px !important;\ngrid-column: 2;\n}\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\ndisplay: none;\n}\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\ndisplay: inline-block;\n}\n.xr-dim-list {\ndisplay: inline-block !important;\nlist-style: none;\npadding: 0 !important;\nmargin: 0;\n}\n.xr-dim-list li {\ndisplay: inline-block;\npadding: 0;\nmargin: 0;\n}\n.xr-dim-list:before {\ncontent: ’(’;\n}\n.xr-dim-list:after {\ncontent: ’)’;\n}\n.xr-dim-list li:not(:last-child):after {\ncontent: ’,’;\npadding-right: 5px;\n}\n.xr-has-index {\nfont-weight: bold;\n}\n.xr-var-list,\n.xr-var-item {\ndisplay: contents;\n}\n.xr-var-item &gt; div,\n.xr-var-item label,\n.xr-var-item &gt; .xr-var-name span {\nbackground-color: var(—xr-background-color-row-even);\nmargin-bottom: 0;\n}\n.xr-var-item &gt; .xr-var-name:hover span {\npadding-right: 5px;\n}\n.xr-var-list &gt; li:nth-child(odd) &gt; div,\n.xr-var-list &gt; li:nth-child(odd) &gt; label,\n.xr-var-list &gt; li:nth-child(odd) &gt; .xr-var-name span {\nbackground-color: var(—xr-background-color-row-odd);\n}\n.xr-var-name {\ngrid-column: 1;\n}\n.xr-var-dims {\ngrid-column: 2;\n}\n.xr-var-dtype {\ngrid-column: 3;\ntext-align: right;\ncolor: var(—xr-font-color2);\n}\n.xr-var-preview {\ngrid-column: 4;\n}\n.xr-index-preview {\ngrid-column: 2 / 5;\ncolor: var(—xr-font-color2);\n}\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\nwhite-space: nowrap;\noverflow: hidden;\ntext-overflow: ellipsis;\npadding-right: 10px;\n}\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\noverflow: visible;\nwidth: auto;\nz-index: 1;\n}\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\ndisplay: none;\nbackground-color: var(—xr-background-color) !important;\npadding-bottom: 5px !important;\n}\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\ndisplay: block;\n}\n.xr-var-data &gt; table {\nfloat: right;\n}\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\npadding-left: 25px !important;\n}\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\ngrid-column: 1 / -1;\n}\ndl.xr-attrs {\npadding: 0;\nmargin: 0;\ndisplay: grid;\ngrid-template-columns: 125px auto;\n}\n.xr-attrs dt,\n.xr-attrs dd {\npadding: 0;\nmargin: 0;\nfloat: left;\npadding-right: 10px;\nwidth: auto;\n}\n.xr-attrs dt {\nfont-weight: normal;\ngrid-column: 1;\n}\n.xr-attrs dt:hover span {\ndisplay: inline-block;\nbackground: var(—xr-background-color);\npadding-right: 10px;\n}\n.xr-attrs dd {\ngrid-column: 2;\nwhite-space: pre-wrap;\nword-break: break-all;\n}\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\ndisplay: inline-block;\nvertical-align: middle;\nwidth: 1em;\nheight: 1.5em !important;\nstroke-width: 0;\nstroke: currentColor;\nfill: currentColor;\n}\n&lt;xarray.DataArray (dim_0: 4)&gt; Size: 32B\narray([ 31,  52,  79, 112])\nDimensions without coordinates: dim_0xarray.DataArraydim_0: 431 52 79 112array([ 31,  52,  79, 112])Coordinates: (0)Indexes: (0)Attributes: (0)\ndelayed_hgl\n\n    \n        \n            \n                \n                \n                \n                \n                \n                \n                \n                \n            \n        \n        \n            HighLevelGraph\n            \n                HighLevelGraph with 12 layers and 18 keys from all layers.\n            \n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer1: array&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        array-e0289449abd23dc644f0fd074cd695dc\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(4,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;int64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;121&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n4\n1\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer2: finalize&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        finalize-abb81368-05d0-48fd-bc81-4da3d383a026\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;array-e0289449abd23dc644f0fd074cd695dc&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer3: finalize&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        finalize-89a5a21d-b67f-47b9-969d-bf82c9f632d6\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;array-e0289449abd23dc644f0fd074cd695dc&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer4: sq_d&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        sq_d-57df3f05-4ad2-41b4-bf02-4f82ddcaa741\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;finalize-89a5a21d-b67f-47b9-969d-bf82c9f632d6&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer5: array&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        array-93fac394d6028ca1841a0aaaf012fdfd\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(4,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;int64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;121&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n4\n1\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer6: finalize&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        finalize-8e4a37e5-68d7-4d57-908c-05611cb218a2\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;array-93fac394d6028ca1841a0aaaf012fdfd&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer7: mul_d&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        mul_d-f2fc9779-b3f6-4bec-8822-f5f6fe8041e0\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;finalize-8e4a37e5-68d7-4d57-908c-05611cb218a2&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;&lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;finalize-abb81368-05d0-48fd-bc81-4da3d383a026&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer8: finalize&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        finalize-71ed3afe-61b1-46e5-8a49-2c36a9e8826f\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;array-93fac394d6028ca1841a0aaaf012fdfd&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer9: sq_d&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        sq_d-96134174-5594-4c11-bb93-b045188f8a65\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;finalize-71ed3afe-61b1-46e5-8a49-2c36a9e8826f&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer10: add_d&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        add_d-a0be0541-c05e-46af-b8c5-df5fb17eea90\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;sq_d-57df3f05-4ad2-41b4-bf02-4f82ddcaa741&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;&lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;sq_d-96134174-5594-4c11-bb93-b045188f8a65&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer11: add&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        add-a362066893b349d99b2b19a5d658fccb\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;add_d-a0be0541-c05e-46af-b8c5-df5fb17eea90&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;&lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;mul_d-f2fc9779-b3f6-4bec-8822-f5f6fe8041e0&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer12: getattr&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        getattr-d83101a6b9634af52ae2ed30c7d8dba0\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;add-a362066893b349d99b2b19a5d658fccb&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n    &lt;/div&gt;\n&lt;/div&gt;\n\n\ndelayed_hgl.layers\n{&#039;add-a362066893b349d99b2b19a5d658fccb&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x16447ceb0&gt;,\n &#039;add_d-a0be0541-c05e-46af-b8c5-df5fb17eea90&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x16447cc10&gt;,\n &#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x164d21930&gt;,\n &#039;finalize-71ed3afe-61b1-46e5-8a49-2c36a9e8826f&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x164d8c8e0&gt;,\n &#039;sq_d-96134174-5594-4c11-bb93-b045188f8a65&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x164d22920&gt;,\n &#039;array-e0289449abd23dc644f0fd074cd695dc&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x164d8c1f0&gt;,\n &#039;finalize-89a5a21d-b67f-47b9-969d-bf82c9f632d6&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x164d8ca00&gt;,\n &#039;sq_d-57df3f05-4ad2-41b4-bf02-4f82ddcaa741&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x108e85c30&gt;,\n &#039;mul_d-f2fc9779-b3f6-4bec-8822-f5f6fe8041e0&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x16447d2a0&gt;,\n &#039;finalize-8e4a37e5-68d7-4d57-908c-05611cb218a2&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x164d8dd20&gt;,\n &#039;finalize-abb81368-05d0-48fd-bc81-4da3d383a026&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x164d8dd50&gt;,\n &#039;getattr-d83101a6b9634af52ae2ed30c7d8dba0&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x16447d000&gt;}\n\nfrom dask.optimization import fuse, fuse_linear\nfrom dask.highlevelgraph import HighLevelGraph\n \n# print(delayed_hgl.layers)\nsel_layers = delayed_hgl.layers\nmerged_hgl = delayed_hgl.merge(sel_layers)\n \n# print(dict(merged_hgl))\n \nget(dict(merged_hgl),&#039;add-a362066893b349d99b2b19a5d658fccb&#039; )\n \n# delayed_hgl.__dir__()\n \n# help(HighLevelGraph.validate)\nfrom dask.distributed import Client\n \nclient = Client(&quot;tcp://192.168.0.100:8786&quot;)\n \n# help(dask.distributed.get)\n# get(dict(merged_hgl) , &#039;add-a362066893b349d99b2b19a5d658fccb&#039; )\n# print(delayed_hgl.validate())\ndict(merged_hgl)\n{&#039;add-a362066893b349d99b2b19a5d658fccb&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x16447ceb0&gt;,\n &#039;add_d-a0be0541-c05e-46af-b8c5-df5fb17eea90&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x16447cc10&gt;,\n &#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x164d21930&gt;,\n &#039;finalize-71ed3afe-61b1-46e5-8a49-2c36a9e8826f&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x164d8c8e0&gt;,\n &#039;sq_d-96134174-5594-4c11-bb93-b045188f8a65&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x164d22920&gt;,\n &#039;array-e0289449abd23dc644f0fd074cd695dc&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x164d8c1f0&gt;,\n &#039;finalize-89a5a21d-b67f-47b9-969d-bf82c9f632d6&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x164d8ca00&gt;,\n &#039;sq_d-57df3f05-4ad2-41b4-bf02-4f82ddcaa741&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x108e85c30&gt;,\n &#039;mul_d-f2fc9779-b3f6-4bec-8822-f5f6fe8041e0&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x16447d2a0&gt;,\n &#039;finalize-8e4a37e5-68d7-4d57-908c-05611cb218a2&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x164d8dd20&gt;,\n &#039;finalize-abb81368-05d0-48fd-bc81-4da3d383a026&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x164d8dd50&gt;,\n &#039;getattr-d83101a6b9634af52ae2ed30c7d8dba0&#039;: &lt;dask.highlevelgraph.MaterializedLayer at 0x16447d000&gt;}\n\nml = client.get(merged_hgl,&#039;add-a362066893b349d99b2b19a5d658fccb&#039;)\nml.__dir__()\n[&#039;annotations&#039;,\n &#039;collection_annotations&#039;,\n &#039;mapping&#039;,\n &#039;__module__&#039;,\n &#039;__doc__&#039;,\n &#039;__init__&#039;,\n &#039;__contains__&#039;,\n &#039;__getitem__&#039;,\n &#039;__iter__&#039;,\n &#039;__len__&#039;,\n &#039;is_materialized&#039;,\n &#039;get_output_keys&#039;,\n &#039;__abstractmethods__&#039;,\n &#039;_abc_impl&#039;,\n &#039;__slotnames__&#039;,\n &#039;__annotations__&#039;,\n &#039;cull&#039;,\n &#039;get_dependencies&#039;,\n &#039;clone&#039;,\n &#039;__copy__&#039;,\n &#039;_repr_html_&#039;,\n &#039;layer_info_dict&#039;,\n &#039;__orig_bases__&#039;,\n &#039;__dict__&#039;,\n &#039;__weakref__&#039;,\n &#039;__slots__&#039;,\n &#039;get&#039;,\n &#039;keys&#039;,\n &#039;items&#039;,\n &#039;values&#039;,\n &#039;__eq__&#039;,\n &#039;__reversed__&#039;,\n &#039;__hash__&#039;,\n &#039;__subclasshook__&#039;,\n &#039;__new__&#039;,\n &#039;__repr__&#039;,\n &#039;__str__&#039;,\n &#039;__getattribute__&#039;,\n &#039;__setattr__&#039;,\n &#039;__delattr__&#039;,\n &#039;__lt__&#039;,\n &#039;__le__&#039;,\n &#039;__ne__&#039;,\n &#039;__gt__&#039;,\n &#039;__ge__&#039;,\n &#039;__reduce_ex__&#039;,\n &#039;__reduce__&#039;,\n &#039;__init_subclass__&#039;,\n &#039;__format__&#039;,\n &#039;__sizeof__&#039;,\n &#039;__dir__&#039;,\n &#039;__class__&#039;,\n &#039;__class_getitem__&#039;]\n\ndict(ml)\n{&#039;add-a362066893b349d99b2b19a5d658fccb&#039;: (&lt;function _operator.add(a, b, /)&gt;,\n  &#039;add_d-a0be0541-c05e-46af-b8c5-df5fb17eea90&#039;,\n  &#039;mul_d-f2fc9779-b3f6-4bec-8822-f5f6fe8041e0&#039;)}\n\nmerged_hgl\n\n    \n        \n            \n                \n                \n                \n                \n                \n                \n                \n                \n            \n        \n        \n            HighLevelGraph\n            \n                HighLevelGraph with 1 layers and 12 keys from all layers.\n            \n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer1: 5977389568&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        5977389568\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;12&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n    &lt;/div&gt;\n&lt;/div&gt;\n\n\nDask Custom Graph\ncustom_graph = { &quot;print&quot; : (print(&quot;hello&quot;)) }\n \nfrom dask.threaded import get\nget(custom_graph, &#039;print&#039;)\nhello\n\ngraph = res.data.dask\ndask_layers = graph.layers\nextr = graph._all_external_keys\nextr\nlayers = graph.layers\nlayers[&#039;add-ffe880f167c9131320013be9069dfca1&#039;].__dir__()\n[&#039;annotations&#039;,\n &#039;collection_annotations&#039;,\n &#039;output&#039;,\n &#039;output_indices&#039;,\n &#039;output_blocks&#039;,\n &#039;dsk&#039;,\n &#039;numblocks&#039;,\n &#039;io_deps&#039;,\n &#039;indices&#039;,\n &#039;concatenate&#039;,\n &#039;new_axes&#039;,\n &#039;_dims&#039;,\n &#039;_cached_dict&#039;,\n &#039;__module__&#039;,\n &#039;__annotations__&#039;,\n &#039;__doc__&#039;,\n &#039;__init__&#039;,\n &#039;dims&#039;,\n &#039;__repr__&#039;,\n &#039;_dict&#039;,\n &#039;get_output_keys&#039;,\n &#039;__getitem__&#039;,\n &#039;__iter__&#039;,\n &#039;__len__&#039;,\n &#039;is_materialized&#039;,\n &#039;_cull_dependencies&#039;,\n &#039;_cull&#039;,\n &#039;cull&#039;,\n &#039;clone&#039;,\n &#039;__abstractmethods__&#039;,\n &#039;_abc_impl&#039;,\n &#039;get_dependencies&#039;,\n &#039;__copy__&#039;,\n &#039;_repr_html_&#039;,\n &#039;layer_info_dict&#039;,\n &#039;__orig_bases__&#039;,\n &#039;__dict__&#039;,\n &#039;__weakref__&#039;,\n &#039;__slots__&#039;,\n &#039;get&#039;,\n &#039;__contains__&#039;,\n &#039;keys&#039;,\n &#039;items&#039;,\n &#039;values&#039;,\n &#039;__eq__&#039;,\n &#039;__reversed__&#039;,\n &#039;__hash__&#039;,\n &#039;__subclasshook__&#039;,\n &#039;__new__&#039;,\n &#039;__str__&#039;,\n &#039;__getattribute__&#039;,\n &#039;__setattr__&#039;,\n &#039;__delattr__&#039;,\n &#039;__lt__&#039;,\n &#039;__le__&#039;,\n &#039;__ne__&#039;,\n &#039;__gt__&#039;,\n &#039;__ge__&#039;,\n &#039;__reduce_ex__&#039;,\n &#039;__reduce__&#039;,\n &#039;__init_subclass__&#039;,\n &#039;__format__&#039;,\n &#039;__sizeof__&#039;,\n &#039;__dir__&#039;,\n &#039;__class__&#039;,\n &#039;__class_getitem__&#039;]\n\ndict(graph).keys()\ndict_keys([(&#039;add-ffe880f167c9131320013be9069dfca1&#039;, 0), (&#039;add-ffe880f167c9131320013be9069dfca1&#039;, 1), (&#039;add-ffe880f167c9131320013be9069dfca1&#039;, 2), (&#039;add-ffe880f167c9131320013be9069dfca1&#039;, 3), (&#039;add-d8368b0c413b7b1ff3e4545d5d219543&#039;, 0), (&#039;add-d8368b0c413b7b1ff3e4545d5d219543&#039;, 1), (&#039;add-d8368b0c413b7b1ff3e4545d5d219543&#039;, 2), (&#039;add-d8368b0c413b7b1ff3e4545d5d219543&#039;, 3), (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 0), (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 1), (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 2), (&#039;array-93fac394d6028ca1841a0aaaf012fdfd&#039;, 3), (&#039;pow-f98325ba6ded8b13c46607d966ba51d1&#039;, 0), (&#039;pow-f98325ba6ded8b13c46607d966ba51d1&#039;, 1), (&#039;pow-f98325ba6ded8b13c46607d966ba51d1&#039;, 2), (&#039;pow-f98325ba6ded8b13c46607d966ba51d1&#039;, 3), (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 0), (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 1), (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 2), (&#039;array-e0289449abd23dc644f0fd074cd695dc&#039;, 3), (&#039;pow-5022bc0a56d6e28f1fd172a750ba8cff&#039;, 0), (&#039;pow-5022bc0a56d6e28f1fd172a750ba8cff&#039;, 1), (&#039;pow-5022bc0a56d6e28f1fd172a750ba8cff&#039;, 2), (&#039;pow-5022bc0a56d6e28f1fd172a750ba8cff&#039;, 3), (&#039;mul-8e9e32e19f9c6e612b3800864d8cc810&#039;, 0), (&#039;mul-8e9e32e19f9c6e612b3800864d8cc810&#039;, 1), (&#039;mul-8e9e32e19f9c6e612b3800864d8cc810&#039;, 2), (&#039;mul-8e9e32e19f9c6e612b3800864d8cc810&#039;, 3)])\n\nfor i in dict(graph):\n    print(get(dict(graph), i))\n# 31,  52,  79, 112\n[31]\n[52]\n[79]\n[112]\n[26]\n[40]\n[58]\n[80]\n[1]\n[2]\n[3]\n[4]\n[1]\n[4]\n[9]\n[16]\n[5]\n[6]\n[7]\n[8]\n[25]\n[36]\n[49]\n[64]\n[5]\n[12]\n[21]\n[32]\n\nfor i in extr:\n    print(get(extr, i[0]))\n3\n0\n2\n2\n1\n2\n1\n3\n0\n3\n2\n2\n2\n2\n1\n2\n0\n2\n1\n3\n3\n0\n2\n2\n3\n2\n3\n3\n\nxarray vs Numpy on delayed\n \n "},"notes/tech/dask/notebooks/debugging-in-dask":{"title":"debugging-in-dask","links":[],"tags":[],"content":"from dask.distributed import Client, print\nclient = Client()\nclient\n\n     \n    \n        Client\n        Client-859821fa-9297-11ef-8a5c-acde48001122\n        \n    &lt;tr&gt;\n\n        &lt;td style=&quot;text-align: left;&quot;&gt;&lt;strong&gt;Connection method:&lt;/strong&gt; Cluster object&lt;/td&gt;\n        &lt;td style=&quot;text-align: left;&quot;&gt;&lt;strong&gt;Cluster type:&lt;/strong&gt; distributed.LocalCluster&lt;/td&gt;\n\n    &lt;/tr&gt;\n\n\n        &lt;tr&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;\n                &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://127.0.0.1:8787/status&quot; target=&quot;_blank&quot;&gt;http://127.0.0.1:8787/status&lt;/a&gt;\n            &lt;/td&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n\n\n    &lt;/table&gt;\n\n\n\n\n        &lt;details&gt;\n        &lt;summary style=&quot;margin-bottom: 20px;&quot;&gt;&lt;h3 style=&quot;display: inline;&quot;&gt;Cluster Info&lt;/h3&gt;&lt;/summary&gt;\n        &lt;div class=&quot;jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output&quot;&gt;\n&lt;div style=&quot;width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;&quot;&gt;\n&lt;/div&gt;\n&lt;div style=&quot;margin-left: 48px;&quot;&gt;\n    &lt;h3 style=&quot;margin-bottom: 0px; margin-top: 0px;&quot;&gt;LocalCluster&lt;/h3&gt;\n    &lt;p style=&quot;color: #9D9D9D; margin-bottom: 0px;&quot;&gt;cb8eff24&lt;/p&gt;\n    &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n        &lt;tr&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;\n                &lt;strong&gt;Dashboard:&lt;/strong&gt; &lt;a href=&quot;http://127.0.0.1:8787/status&quot; target=&quot;_blank&quot;&gt;http://127.0.0.1:8787/status&lt;/a&gt;\n            &lt;/td&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;\n                &lt;strong&gt;Workers:&lt;/strong&gt; 4\n            &lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;tr&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;\n                &lt;strong&gt;Total threads:&lt;/strong&gt; 12\n            &lt;/td&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;\n                &lt;strong&gt;Total memory:&lt;/strong&gt; 16.00 GiB\n            &lt;/td&gt;\n        &lt;/tr&gt;\n\n        &lt;tr&gt;\n&lt;td style=&quot;text-align: left;&quot;&gt;&lt;strong&gt;Status:&lt;/strong&gt; running&lt;/td&gt;\n&lt;td style=&quot;text-align: left;&quot;&gt;&lt;strong&gt;Using processes:&lt;/strong&gt; True&lt;/td&gt;\n\n\n    &lt;/table&gt;\n\n    &lt;details&gt;\n        &lt;summary style=&quot;margin-bottom: 20px;&quot;&gt;\n            &lt;h3 style=&quot;display: inline;&quot;&gt;Scheduler Info&lt;/h3&gt;\n        &lt;/summary&gt;\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;div&gt;\n    &lt;div style=&quot;width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n    &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;h3 style=&quot;margin-bottom: 0px;&quot;&gt;Scheduler&lt;/h3&gt;\n        &lt;p style=&quot;color: #9D9D9D; margin-bottom: 0px;&quot;&gt;Scheduler-3866a1d7-7ee1-4fb5-8dca-7d15316c288d&lt;/p&gt;\n        &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Comm:&lt;/strong&gt; tcp://127.0.0.1:63770\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Workers:&lt;/strong&gt; 4\n                &lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Dashboard:&lt;/strong&gt; &lt;a href=&quot;http://127.0.0.1:8787/status&quot; target=&quot;_blank&quot;&gt;http://127.0.0.1:8787/status&lt;/a&gt;\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Total threads:&lt;/strong&gt; 12\n                &lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Started:&lt;/strong&gt; Just now\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Total memory:&lt;/strong&gt; 16.00 GiB\n                &lt;/td&gt;\n            &lt;/tr&gt;\n        &lt;/table&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n\n&lt;details style=&quot;margin-left: 48px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;h3 style=&quot;display: inline;&quot;&gt;Workers&lt;/h3&gt;\n    &lt;/summary&gt;\n\n\n    &lt;div style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;div style=&quot;width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n        &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;details&gt;\n            &lt;summary&gt;\n                &lt;h4 style=&quot;margin-bottom: 0px; display: inline;&quot;&gt;Worker: 0&lt;/h4&gt;\n            &lt;/summary&gt;\n            &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Comm: &lt;/strong&gt; tcp://127.0.0.1:63781\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Total threads: &lt;/strong&gt; 3\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://127.0.0.1:63785/status&quot; target=&quot;_blank&quot;&gt;http://127.0.0.1:63785/status&lt;/a&gt;\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory: &lt;/strong&gt; 4.00 GiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Nanny: &lt;/strong&gt; tcp://127.0.0.1:63773\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=&quot;2&quot; style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Local directory: &lt;/strong&gt; /var/folders/7y/91xrb3bs5g96r0pvlvq04yx00000gn/T/dask-scratch-space/worker-2jsow2af\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n\n\n            &lt;/table&gt;\n        &lt;/details&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;div style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;div style=&quot;width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n        &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;details&gt;\n            &lt;summary&gt;\n                &lt;h4 style=&quot;margin-bottom: 0px; display: inline;&quot;&gt;Worker: 1&lt;/h4&gt;\n            &lt;/summary&gt;\n            &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Comm: &lt;/strong&gt; tcp://127.0.0.1:63782\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Total threads: &lt;/strong&gt; 3\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://127.0.0.1:63787/status&quot; target=&quot;_blank&quot;&gt;http://127.0.0.1:63787/status&lt;/a&gt;\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory: &lt;/strong&gt; 4.00 GiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Nanny: &lt;/strong&gt; tcp://127.0.0.1:63774\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=&quot;2&quot; style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Local directory: &lt;/strong&gt; /var/folders/7y/91xrb3bs5g96r0pvlvq04yx00000gn/T/dask-scratch-space/worker-qqzq4_hi\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n\n\n            &lt;/table&gt;\n        &lt;/details&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;div style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;div style=&quot;width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n        &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;details&gt;\n            &lt;summary&gt;\n                &lt;h4 style=&quot;margin-bottom: 0px; display: inline;&quot;&gt;Worker: 2&lt;/h4&gt;\n            &lt;/summary&gt;\n            &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Comm: &lt;/strong&gt; tcp://127.0.0.1:63783\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Total threads: &lt;/strong&gt; 3\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://127.0.0.1:63789/status&quot; target=&quot;_blank&quot;&gt;http://127.0.0.1:63789/status&lt;/a&gt;\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory: &lt;/strong&gt; 4.00 GiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Nanny: &lt;/strong&gt; tcp://127.0.0.1:63775\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=&quot;2&quot; style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Local directory: &lt;/strong&gt; /var/folders/7y/91xrb3bs5g96r0pvlvq04yx00000gn/T/dask-scratch-space/worker-oi153djn\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n\n\n            &lt;/table&gt;\n        &lt;/details&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;div style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;div style=&quot;width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n        &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;details&gt;\n            &lt;summary&gt;\n                &lt;h4 style=&quot;margin-bottom: 0px; display: inline;&quot;&gt;Worker: 3&lt;/h4&gt;\n            &lt;/summary&gt;\n            &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Comm: &lt;/strong&gt; tcp://127.0.0.1:63784\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Total threads: &lt;/strong&gt; 3\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://127.0.0.1:63791/status&quot; target=&quot;_blank&quot;&gt;http://127.0.0.1:63791/status&lt;/a&gt;\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory: &lt;/strong&gt; 4.00 GiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Nanny: &lt;/strong&gt; tcp://127.0.0.1:63776\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=&quot;2&quot; style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Local directory: &lt;/strong&gt; /var/folders/7y/91xrb3bs5g96r0pvlvq04yx00000gn/T/dask-scratch-space/worker-48liq_9i\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n\n\n            &lt;/table&gt;\n        &lt;/details&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n\n&lt;/details&gt;\n\n\n    &lt;/details&gt;\n&lt;/div&gt;\n\n\n&lt;/div&gt;\n\n\nperforming some distributed task\nperforming some distributed task\nperformed some distributed task\nperforming some distributed task\nperformed some distributed task\nperforming some distributed task\nperformed some distributed task\nperforming some distributed task\nperformed some distributed task\n\ndef task():\n    print(&quot;performing some distributed task&quot;)\n    import numpy as np\n    result = np.arange(1000000).reshape((1000, 1000)).max(axis=1)\n    print(&quot;performed some distributed task&quot;)\n    return result\nimport dask\nt1 = dask.delayed(task)()\nt1\nDelayed(&#039;task-4e6869f6-47b8-4e4c-8848-116d9d720b29&#039;)\n\ndask.compute(t1)\n(array([   999,   1999,   2999,   3999,   4999,   5999,   6999,   7999,\n          8999,   9999,  10999,  11999,  12999,  13999,  14999,  15999,\n         16999,  17999,  18999,  19999,  20999,  21999,  22999,  23999,\n         24999,  25999,  26999,  27999,  28999,  29999,  30999,  31999,\n         32999,  33999,  34999,  35999,  36999,  37999,  38999,  39999,\n         40999,  41999,  42999,  43999,  44999,  45999,  46999,  47999,\n         48999,  49999,  50999,  51999,  52999,  53999,  54999,  55999,\n         56999,  57999,  58999,  59999,  60999,  61999,  62999,  63999,\n         64999,  65999,  66999,  67999,  68999,  69999,  70999,  71999,\n         72999,  73999,  74999,  75999,  76999,  77999,  78999,  79999,\n         80999,  81999,  82999,  83999,  84999,  85999,  86999,  87999,\n         88999,  89999,  90999,  91999,  92999,  93999,  94999,  95999,\n         96999,  97999,  98999,  99999, 100999, 101999, 102999, 103999,\n        104999, 105999, 106999, 107999, 108999, 109999, 110999, 111999,\n        112999, 113999, 114999, 115999, 116999, 117999, 118999, 119999,\n        120999, 121999, 122999, 123999, 124999, 125999, 126999, 127999,\n        128999, 129999, 130999, 131999, 132999, 133999, 134999, 135999,\n        136999, 137999, 138999, 139999, 140999, 141999, 142999, 143999,\n        144999, 145999, 146999, 147999, 148999, 149999, 150999, 151999,\n        152999, 153999, 154999, 155999, 156999, 157999, 158999, 159999,\n        160999, 161999, 162999, 163999, 164999, 165999, 166999, 167999,\n        168999, 169999, 170999, 171999, 172999, 173999, 174999, 175999,\n        176999, 177999, 178999, 179999, 180999, 181999, 182999, 183999,\n        184999, 185999, 186999, 187999, 188999, 189999, 190999, 191999,\n        192999, 193999, 194999, 195999, 196999, 197999, 198999, 199999,\n        200999, 201999, 202999, 203999, 204999, 205999, 206999, 207999,\n        208999, 209999, 210999, 211999, 212999, 213999, 214999, 215999,\n        216999, 217999, 218999, 219999, 220999, 221999, 222999, 223999,\n        224999, 225999, 226999, 227999, 228999, 229999, 230999, 231999,\n        232999, 233999, 234999, 235999, 236999, 237999, 238999, 239999,\n        240999, 241999, 242999, 243999, 244999, 245999, 246999, 247999,\n        248999, 249999, 250999, 251999, 252999, 253999, 254999, 255999,\n        256999, 257999, 258999, 259999, 260999, 261999, 262999, 263999,\n        264999, 265999, 266999, 267999, 268999, 269999, 270999, 271999,\n        272999, 273999, 274999, 275999, 276999, 277999, 278999, 279999,\n        280999, 281999, 282999, 283999, 284999, 285999, 286999, 287999,\n        288999, 289999, 290999, 291999, 292999, 293999, 294999, 295999,\n        296999, 297999, 298999, 299999, 300999, 301999, 302999, 303999,\n        304999, 305999, 306999, 307999, 308999, 309999, 310999, 311999,\n        312999, 313999, 314999, 315999, 316999, 317999, 318999, 319999,\n        320999, 321999, 322999, 323999, 324999, 325999, 326999, 327999,\n        328999, 329999, 330999, 331999, 332999, 333999, 334999, 335999,\n        336999, 337999, 338999, 339999, 340999, 341999, 342999, 343999,\n        344999, 345999, 346999, 347999, 348999, 349999, 350999, 351999,\n        352999, 353999, 354999, 355999, 356999, 357999, 358999, 359999,\n        360999, 361999, 362999, 363999, 364999, 365999, 366999, 367999,\n        368999, 369999, 370999, 371999, 372999, 373999, 374999, 375999,\n        376999, 377999, 378999, 379999, 380999, 381999, 382999, 383999,\n        384999, 385999, 386999, 387999, 388999, 389999, 390999, 391999,\n        392999, 393999, 394999, 395999, 396999, 397999, 398999, 399999,\n        400999, 401999, 402999, 403999, 404999, 405999, 406999, 407999,\n        408999, 409999, 410999, 411999, 412999, 413999, 414999, 415999,\n        416999, 417999, 418999, 419999, 420999, 421999, 422999, 423999,\n        424999, 425999, 426999, 427999, 428999, 429999, 430999, 431999,\n        432999, 433999, 434999, 435999, 436999, 437999, 438999, 439999,\n        440999, 441999, 442999, 443999, 444999, 445999, 446999, 447999,\n        448999, 449999, 450999, 451999, 452999, 453999, 454999, 455999,\n        456999, 457999, 458999, 459999, 460999, 461999, 462999, 463999,\n        464999, 465999, 466999, 467999, 468999, 469999, 470999, 471999,\n        472999, 473999, 474999, 475999, 476999, 477999, 478999, 479999,\n        480999, 481999, 482999, 483999, 484999, 485999, 486999, 487999,\n        488999, 489999, 490999, 491999, 492999, 493999, 494999, 495999,\n        496999, 497999, 498999, 499999, 500999, 501999, 502999, 503999,\n        504999, 505999, 506999, 507999, 508999, 509999, 510999, 511999,\n        512999, 513999, 514999, 515999, 516999, 517999, 518999, 519999,\n        520999, 521999, 522999, 523999, 524999, 525999, 526999, 527999,\n        528999, 529999, 530999, 531999, 532999, 533999, 534999, 535999,\n        536999, 537999, 538999, 539999, 540999, 541999, 542999, 543999,\n        544999, 545999, 546999, 547999, 548999, 549999, 550999, 551999,\n        552999, 553999, 554999, 555999, 556999, 557999, 558999, 559999,\n        560999, 561999, 562999, 563999, 564999, 565999, 566999, 567999,\n        568999, 569999, 570999, 571999, 572999, 573999, 574999, 575999,\n        576999, 577999, 578999, 579999, 580999, 581999, 582999, 583999,\n        584999, 585999, 586999, 587999, 588999, 589999, 590999, 591999,\n        592999, 593999, 594999, 595999, 596999, 597999, 598999, 599999,\n        600999, 601999, 602999, 603999, 604999, 605999, 606999, 607999,\n        608999, 609999, 610999, 611999, 612999, 613999, 614999, 615999,\n        616999, 617999, 618999, 619999, 620999, 621999, 622999, 623999,\n        624999, 625999, 626999, 627999, 628999, 629999, 630999, 631999,\n        632999, 633999, 634999, 635999, 636999, 637999, 638999, 639999,\n        640999, 641999, 642999, 643999, 644999, 645999, 646999, 647999,\n        648999, 649999, 650999, 651999, 652999, 653999, 654999, 655999,\n        656999, 657999, 658999, 659999, 660999, 661999, 662999, 663999,\n        664999, 665999, 666999, 667999, 668999, 669999, 670999, 671999,\n        672999, 673999, 674999, 675999, 676999, 677999, 678999, 679999,\n        680999, 681999, 682999, 683999, 684999, 685999, 686999, 687999,\n        688999, 689999, 690999, 691999, 692999, 693999, 694999, 695999,\n        696999, 697999, 698999, 699999, 700999, 701999, 702999, 703999,\n        704999, 705999, 706999, 707999, 708999, 709999, 710999, 711999,\n        712999, 713999, 714999, 715999, 716999, 717999, 718999, 719999,\n        720999, 721999, 722999, 723999, 724999, 725999, 726999, 727999,\n        728999, 729999, 730999, 731999, 732999, 733999, 734999, 735999,\n        736999, 737999, 738999, 739999, 740999, 741999, 742999, 743999,\n        744999, 745999, 746999, 747999, 748999, 749999, 750999, 751999,\n        752999, 753999, 754999, 755999, 756999, 757999, 758999, 759999,\n        760999, 761999, 762999, 763999, 764999, 765999, 766999, 767999,\n        768999, 769999, 770999, 771999, 772999, 773999, 774999, 775999,\n        776999, 777999, 778999, 779999, 780999, 781999, 782999, 783999,\n        784999, 785999, 786999, 787999, 788999, 789999, 790999, 791999,\n        792999, 793999, 794999, 795999, 796999, 797999, 798999, 799999,\n        800999, 801999, 802999, 803999, 804999, 805999, 806999, 807999,\n        808999, 809999, 810999, 811999, 812999, 813999, 814999, 815999,\n        816999, 817999, 818999, 819999, 820999, 821999, 822999, 823999,\n        824999, 825999, 826999, 827999, 828999, 829999, 830999, 831999,\n        832999, 833999, 834999, 835999, 836999, 837999, 838999, 839999,\n        840999, 841999, 842999, 843999, 844999, 845999, 846999, 847999,\n        848999, 849999, 850999, 851999, 852999, 853999, 854999, 855999,\n        856999, 857999, 858999, 859999, 860999, 861999, 862999, 863999,\n        864999, 865999, 866999, 867999, 868999, 869999, 870999, 871999,\n        872999, 873999, 874999, 875999, 876999, 877999, 878999, 879999,\n        880999, 881999, 882999, 883999, 884999, 885999, 886999, 887999,\n        888999, 889999, 890999, 891999, 892999, 893999, 894999, 895999,\n        896999, 897999, 898999, 899999, 900999, 901999, 902999, 903999,\n        904999, 905999, 906999, 907999, 908999, 909999, 910999, 911999,\n        912999, 913999, 914999, 915999, 916999, 917999, 918999, 919999,\n        920999, 921999, 922999, 923999, 924999, 925999, 926999, 927999,\n        928999, 929999, 930999, 931999, 932999, 933999, 934999, 935999,\n        936999, 937999, 938999, 939999, 940999, 941999, 942999, 943999,\n        944999, 945999, 946999, 947999, 948999, 949999, 950999, 951999,\n        952999, 953999, 954999, 955999, 956999, 957999, 958999, 959999,\n        960999, 961999, 962999, 963999, 964999, 965999, 966999, 967999,\n        968999, 969999, 970999, 971999, 972999, 973999, 974999, 975999,\n        976999, 977999, 978999, 979999, 980999, 981999, 982999, 983999,\n        984999, 985999, 986999, 987999, 988999, 989999, 990999, 991999,\n        992999, 993999, 994999, 995999, 996999, 997999, 998999, 999999]),)\n\n            "},"notes/tech/dask/notebooks/delayed":{"title":"delayed","links":[],"tags":[],"content":"import dask\nfrom dask.graph_manipulation import bind\nimport graphviz\nAdding task with side effects\nDATA = []\n \n@dask.delayed\ndef inc(x):\n    return x + 1\n \n \n@dask.delayed\ndef add_data(x):\n    DATA.append(x)\n \n \n@dask.delayed\ndef sum_data(x):\n    return sum(DATA) + x\n \n \na = inc(1)\nb = add_data(a)\nc = inc(3)\nd = add_data(c)\ne = inc(5)\nf = bind(sum_data, [b, d])(e)\n \ndask.visualize(f)\n\nf.compute()\n12\n\nRemarks\n\nDask provides bind method to add task with side effects\n\nDask delay inside delayed object\nCase 1\n@dask.delayed\ndef a():\n    return 1\n \n \n@dask.delayed\ndef b():\n    return 2\n \n \n@dask.delayed\ndef c():\n    return a + b\n \n \ndask.visualize(c())\n\nCase 2\n@dask.delayed\ndef a():\n    return 1\n \n \n@dask.delayed\ndef b():\n    return 2\n \n \n@dask.delayed\ndef c(a, b):\n    print(&quot;In c&quot;)\n    return a + b\n \n \nz = c(a(), b())\n \ndask.visualize(z)\n\nCase 3\n@dask.delayed\ndef a():\n    return 1\n \n \n@dask.delayed\ndef b():\n    return 2\n \n \ndef c(a, b):\n    print(&quot;Inside c&quot;)\n    c = a + b\n    return 1 + c\n \n \nz = c(a(), b())\ndask.visualize(z)\nInside c\n\n\n\n\n\n\n\nRemarks\n\nDask task graph shows the flow of input going into task and output coming from it.\nIf a task is taking dask delayed as input, it is shown.\nIf a task is internally consuming a dask delayed, it is not shown in the graph.\n\n "},"notes/tech/dask/notebooks/diagnostics-local":{"title":"diagnostics-local","links":[],"tags":[],"content":"import dask.array as da\nfrom dask.diagnostics import ProgressBar\na = da.arange(10000, chunks=(100))\na\n\n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; 78.12 kiB &lt;/td&gt;\n                    &lt;td&gt; 800 B &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; (10000,) &lt;/td&gt;\n                    &lt;td&gt; (100,) &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 100 chunks in 1 graph layer &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; int64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n    &lt;svg width=&quot;170&quot; height=&quot;75&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n10000\n1\n\n\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                \nwith ProgressBar():\n    a.mean().sum().compute()\n[########################################] | 100% Completed | 109.43 ms\n\n "},"notes/tech/dask/notebooks/exploration":{"title":"exploration","links":[],"tags":[],"content":"import dask.array as da\nimport dask\nx = da.ones(1000, chunks=(100,)).sum()\n \ndask.visualize(x)\n \n \n"},"notes/tech/dask/notebooks/high-level-graphs":{"title":"high-level-graphs","links":[],"tags":[],"content":"from dask.highlevelgraph import HighLevelGraph\nimport dask\nfrom dask.threaded import get\ndef add(x, y):\n  return x + y\n \ndef square(x):\n  return x ** 2\n \n \nlayers = {\n  &#039;add&#039;: {\n    (&#039;add&#039;, 0): (add, 1, 2),\n    (&#039;add&#039;, 1): (add, 3, 4)\n  },\n  &#039;square&#039;: {\n    (&#039;square&#039;, 0): (square, (&#039;add&#039;, 0)),\n    (&#039;square&#039;, 1): (square, (&#039;add&#039;, 1))\n  },\n  &#039;agg&#039;: {\n    &#039;agg&#039;: (add, (&#039;square&#039;, 0), (&#039;square&#039;, 1))}\n}\n \ndependencies = {\n  &#039;add&#039;: set(),\n  &#039;square&#039;: {&#039;add&#039;},\n  &#039;agg&#039;: {&#039;square&#039;}\n}\n \ng = HighLevelGraph(layers, dependencies)\n \nget(g, &#039;agg&#039;)\n58\n\ng = HighLevelGraph(layers, dependencies)\ndask.visualize(g)\n\ndask.visualize(graph)\n"},"notes/tech/dask/notebooks/internal-design":{"title":"internal-design","links":[],"tags":[],"content":"import dask.array as da\nimport numpy as np\nDask array as graph\na = da.arange(15, chunks=(5,))\na\n\n\n\n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; 120 B &lt;/td&gt;\n                    &lt;td&gt; 40 B &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; (15,) &lt;/td&gt;\n                    &lt;td&gt; (5,) &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 3 chunks in 1 graph layer &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; int64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n    &lt;svg width=&quot;170&quot; height=&quot;86&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n15\n1\n\n\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                \na.__dask_graph__()\n\n    \n        \n            \n                \n                \n                \n                \n                \n                \n                \n                \n            \n        \n        \n            HighLevelGraph\n            \n                HighLevelGraph with 1 layers and 3 keys from all layers.\n            \n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer1: arange&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        arange-571d5d5e2ac3b386ea241c8f4963b0ff\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;3&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(15,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;int64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(5,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;110&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n15\n1\n\n\n&lt;/details&gt;\n\n\n    &lt;/div&gt;\n&lt;/div&gt;\n\n\ndict(a.__dask_graph__())\n{(&#039;arange-571d5d5e2ac3b386ea241c8f4963b0ff&#039;,\n  0): (functools.partial(&lt;function arange at 0x107167eb0&gt;, like=None), 0, 5, 1, 5, dtype(&#039;int64&#039;)),\n (&#039;arange-571d5d5e2ac3b386ea241c8f4963b0ff&#039;,\n  1): (functools.partial(&lt;function arange at 0x107167eb0&gt;, like=None), 5, 10, 1, 5, dtype(&#039;int64&#039;)),\n (&#039;arange-571d5d5e2ac3b386ea241c8f4963b0ff&#039;,\n  2): (functools.partial(&lt;function arange at 0x107167eb0&gt;, like=None), 10, 15, 1, 5, dtype(&#039;int64&#039;))}\n\na.__dask_keys__()\n[(&#039;arange-571d5d5e2ac3b386ea241c8f4963b0ff&#039;, 0),\n (&#039;arange-571d5d5e2ac3b386ea241c8f4963b0ff&#039;, 1),\n (&#039;arange-571d5d5e2ac3b386ea241c8f4963b0ff&#039;, 2)]\n"},"notes/tech/dask/notebooks/optimization-custom-graphs":{"title":"optimization-custom-graphs","links":[],"tags":[],"content":"import dask\nfrom dask.distributed import Client\nimport dask.array as da\nimport xarray as xr\nimport numpy as np\nfrom dask.threaded import get\nfrom dask.highlevelgraph import HighLevelGraph\nfrom dask.optimization import fuse\n\na = da.arange(10000000, chunks=(10000,))\na\n\n\n\n\n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; 76.29 MiB &lt;/td&gt;\n                    &lt;td&gt; 78.12 kiB &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; (10000000,) &lt;/td&gt;\n                    &lt;td&gt; (10000,) &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 1000 chunks in 1 graph layer &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; int64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n    &lt;svg width=&quot;170&quot; height=&quot;75&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n10000000\n1\n\n\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                \nresult = a.sum()\nresult\n\n\n\n\n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; 8 B &lt;/td&gt;\n                    &lt;td&gt; 8 B &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; () &lt;/td&gt;\n                    &lt;td&gt; () &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 1 chunks in 4 graph layers &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; int64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n\n    &lt;/td&gt;\n&lt;/tr&gt;\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                \ndask.visualize(result)\n\n\ngraph = dict(result.dask)\n\nget(graph,(&#039;sum-aggregate-f91c8759583b5752b759c7202b1c1544&#039;,))\n\n---------------------------------------------------------------------------\n\nKeyError                                  Traceback (most recent call last)\n\nCell In[7], line 1\n----&gt; 1 get(graph,(&#039;sum-aggregate-f91c8759583b5752b759c7202b1c1544&#039;,))\n\n\nFile ~/miniconda3/envs/spec_line_sandbox/lib/python3.10/site-packages/dask/threaded.py:90, in get(dsk, keys, cache, num_workers, pool, **kwargs)\n     87     elif isinstance(pool, multiprocessing.pool.Pool):\n     88         pool = MultiprocessingPoolExecutor(pool)\n---&gt; 90 results = get_async(\n     91     pool.submit,\n     92     pool._max_workers,\n     93     dsk,\n     94     keys,\n     95     cache=cache,\n     96     get_id=_thread_get_id,\n     97     pack_exception=pack_exception,\n     98     **kwargs,\n     99 )\n    101 # Cleanup pools associated to dead threads\n    102 with pools_lock:\n\n\nFile ~/miniconda3/envs/spec_line_sandbox/lib/python3.10/site-packages/dask/local.py:526, in get_async(submit, num_workers, dsk, result, cache, get_id, rerun_exceptions_locally, pack_exception, raise_exception, callbacks, dumps, loads, chunksize, **kwargs)\n    523             if finish:\n    524                 finish(dsk, state, not succeeded)\n--&gt; 526 return nested_get(result, state[&quot;cache&quot;])\n\n\nFile ~/miniconda3/envs/spec_line_sandbox/lib/python3.10/site-packages/dask/local.py:305, in nested_get(ind, coll)\n    303     return tuple(nested_get(i, coll) for i in ind)\n    304 else:\n--&gt; 305     return coll[ind]\n\n\nKeyError: (&#039;sum-aggregate-f91c8759583b5752b759c7202b1c1544&#039;,)\n\nfrom dask.optimization import fuse\n\ndsk, dep = fuse(graph)\nHighLevelGraph(dsk, dep).visualize()\n\n\n@dask.delayed\ndef add_unit(a):\n    return a + 1\n\n\ndef sub_2(a):\n    return a - 1\n\ndef mul_2(a):\n    return a * 2\n\ndef sq_2(a):\n    return a ** 2\n\nresult = add_unit(np.arange(10000000)) + sub_2(a) + mul_2(sq_2(a))\n# result.visualize()\n\ndask.visualize(result, optimize_graph=True)\n\n\nresult.dask.merge(result.dask)\n\n\n    \n        \n            \n                \n                \n                \n                \n                \n                \n                \n                \n            \n        \n        \n            HighLevelGraph\n            \n                HighLevelGraph with 9 layers and 45 keys from all layers.\n            \n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer1: arange&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        arange-f3e29e89bdefcec09c94416d7cc877d4\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;10&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1000000,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;int64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(100000,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;92&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n1000000\n1\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D); fill: var(--jp-layout-color1, #F2F2F2);&quot; stroke-width=&quot;2&quot; /&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer2: pow&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        pow-c8de4c922347f0a9f74eb6ba60c96f67\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;False&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;10&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1000000,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;int64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(100000,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;arange-f3e29e89bdefcec09c94416d7cc877d4&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;92&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n1000000\n1\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D); fill: var(--jp-layout-color1, #F2F2F2);&quot; stroke-width=&quot;2&quot; /&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer3: mul&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        mul-70cb8ee7f6799eb0f209bd6e00ebc68d\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;False&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;10&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1000000,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;int64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(100000,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;pow-c8de4c922347f0a9f74eb6ba60c96f67&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;92&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n1000000\n1\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer4: finalize&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        finalize-84989d70-ccd9-4027-a139-f55697ae0c7b\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;mul-70cb8ee7f6799eb0f209bd6e00ebc68d&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D); fill: var(--jp-layout-color1, #F2F2F2);&quot; stroke-width=&quot;2&quot; /&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer5: sub&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        sub-6cee8e7d70db7adda2bce5bc26a8713f\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;False&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;10&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1000000,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;int64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(100000,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;arange-f3e29e89bdefcec09c94416d7cc877d4&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;92&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n1000000\n1\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer6: finalize&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        finalize-253e7a3b-93d7-4f21-9935-024669196fec\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;sub-6cee8e7d70db7adda2bce5bc26a8713f&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer7: add_unit&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        add_unit-e1c78a5a-9bf8-4ba6-96a5-f7434cd21288\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer8: add&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        add-61bd32823b46ab2e579f597bdfcd0c8c\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;finalize-253e7a3b-93d7-4f21-9935-024669196fec&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;&lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;add_unit-e1c78a5a-9bf8-4ba6-96a5-f7434cd21288&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer9: add&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        add-0bd3775a8fff364fe2ccb896ef6147d9\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;add-61bd32823b46ab2e579f597bdfcd0c8c&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;&lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;finalize-84989d70-ccd9-4027-a139-f55697ae0c7b&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n    &lt;/div&gt;\n&lt;/div&gt;\n\n\nfrom dask.optimization import fuse\ndef op(dsk, key):\n    # print(dsk)\n    # print(key)\n    \n\n    return fuse(dsk.to_dict())[0]\n\n\n\n%time result.compute(optimizations=[op])\n\n\nCPU times: user 96.4 ms, sys: 215 ms, total: 312 ms\nWall time: 1.26 s\n\n\n\n\n\narray([              0,               4,              12, ...,\n       199999900000012, 199999940000004, 199999980000000])\n\nresult.dask.visualize()\n\n\ndsk, dep = fuse(result.dask.to_dict())\n# HighLevelGraph(dsk, dep).visualize()\nfrom dask.delayed import Delayed\nresult._key\nDelayed(result._key, dsk).compute()\n\n/Users/nitinsharma/miniconda3/envs/spec_line_sandbox/lib/python3.10/site-packages/distributed/client.py:3357: UserWarning: Sending large graph of size 76.47 MiB.\nThis may cause some slowdown.\nConsider scattering data ahead of time and using futures.\n  warnings.warn(\n\n\n\n\n\narray([              0,               4,              12, ...,\n       199999900000012, 199999940000004, 199999980000000])\n\nprint(&#039;hi&#039;)\n\ndsk, dep = fuse(result.dask.to_dict())\nHighLevelGraph(dsk, dep).visualize()\n\n\nresult.dask.merge(result.dask.layers).__dict__\nHighLevelGraph({&#039;test&#039;: result.dask.layers}, {&#039;test&#039;: set()})\n\n\n    \n        \n            \n                \n                \n                \n                \n                \n                \n                \n                \n            \n        \n        \n            HighLevelGraph\n            \n                HighLevelGraph with 1 layers and 9 keys from all layers.\n            \n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer1: test&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        test\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;9&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n    &lt;/div&gt;\n&lt;/div&gt;\n\n\nclient = Client(&quot;tcp://192.168.0.107:8786&quot;)\nclient\n\n\n     \n    \n        Client\n        Client-4f621360-ad69-11ef-8550-acde48001122\n        \n    &lt;tr&gt;\n\n        &lt;td style=&quot;text-align: left;&quot;&gt;&lt;strong&gt;Connection method:&lt;/strong&gt; Direct&lt;/td&gt;\n        &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n\n    &lt;/tr&gt;\n\n\n        &lt;tr&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;\n                &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://192.168.0.107:8787/status&quot; target=&quot;_blank&quot;&gt;http://192.168.0.107:8787/status&lt;/a&gt;\n            &lt;/td&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n\n\n    &lt;/table&gt;\n\n\n\n\n        &lt;details&gt;\n        &lt;summary style=&quot;margin-bottom: 20px;&quot;&gt;&lt;h3 style=&quot;display: inline;&quot;&gt;Scheduler Info&lt;/h3&gt;&lt;/summary&gt;\n        &lt;div style=&quot;&quot;&gt;\n&lt;div&gt;\n    &lt;div style=&quot;width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n    &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;h3 style=&quot;margin-bottom: 0px;&quot;&gt;Scheduler&lt;/h3&gt;\n        &lt;p style=&quot;color: #9D9D9D; margin-bottom: 0px;&quot;&gt;Scheduler-73c4acfa-aa00-4189-9430-691903058756&lt;/p&gt;\n        &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Comm:&lt;/strong&gt; tcp://192.168.0.107:8786\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Workers:&lt;/strong&gt; 2\n                &lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Dashboard:&lt;/strong&gt; &lt;a href=&quot;http://192.168.0.107:8787/status&quot; target=&quot;_blank&quot;&gt;http://192.168.0.107:8787/status&lt;/a&gt;\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Total threads:&lt;/strong&gt; 2\n                &lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Started:&lt;/strong&gt; Just now\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Total memory:&lt;/strong&gt; 8.00 GiB\n                &lt;/td&gt;\n            &lt;/tr&gt;\n        &lt;/table&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n\n&lt;details style=&quot;margin-left: 48px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;h3 style=&quot;display: inline;&quot;&gt;Workers&lt;/h3&gt;\n    &lt;/summary&gt;\n\n\n    &lt;div style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;div style=&quot;width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n        &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;details&gt;\n            &lt;summary&gt;\n                &lt;h4 style=&quot;margin-bottom: 0px; display: inline;&quot;&gt;Worker: tcp://192.168.0.107:52741&lt;/h4&gt;\n            &lt;/summary&gt;\n            &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Comm: &lt;/strong&gt; tcp://192.168.0.107:52741\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Total threads: &lt;/strong&gt; 1\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://192.168.0.107:52742/status&quot; target=&quot;_blank&quot;&gt;http://192.168.0.107:52742/status&lt;/a&gt;\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory: &lt;/strong&gt; 4.00 GiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Nanny: &lt;/strong&gt; tcp://192.168.0.107:52738\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=&quot;2&quot; style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Local directory: &lt;/strong&gt; /var/folders/7y/91xrb3bs5g96r0pvlvq04yx00000gn/T/dask-scratch-space/worker-is8n2ls_\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks executing: &lt;/strong&gt; \n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks in memory: &lt;/strong&gt; \n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks ready: &lt;/strong&gt; \n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks in flight: &lt;/strong&gt;\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;CPU usage:&lt;/strong&gt; 4.2%\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Last seen: &lt;/strong&gt; Just now\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory usage: &lt;/strong&gt; 117.12 MiB\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Spilled bytes: &lt;/strong&gt; 0 B\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Read bytes: &lt;/strong&gt; 10.00 kiB\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Write bytes: &lt;/strong&gt; 20.00 kiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/details&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;div style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;div style=&quot;width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n        &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;details&gt;\n            &lt;summary&gt;\n                &lt;h4 style=&quot;margin-bottom: 0px; display: inline;&quot;&gt;Worker: tcp://192.168.0.107:52749&lt;/h4&gt;\n            &lt;/summary&gt;\n            &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Comm: &lt;/strong&gt; tcp://192.168.0.107:52749\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Total threads: &lt;/strong&gt; 1\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://192.168.0.107:52750/status&quot; target=&quot;_blank&quot;&gt;http://192.168.0.107:52750/status&lt;/a&gt;\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory: &lt;/strong&gt; 4.00 GiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Nanny: &lt;/strong&gt; tcp://192.168.0.107:52745\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=&quot;2&quot; style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Local directory: &lt;/strong&gt; /var/folders/7y/91xrb3bs5g96r0pvlvq04yx00000gn/T/dask-scratch-space/worker-052suecj\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks executing: &lt;/strong&gt; \n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks in memory: &lt;/strong&gt; \n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks ready: &lt;/strong&gt; \n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks in flight: &lt;/strong&gt;\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;CPU usage:&lt;/strong&gt; 4.3%\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Last seen: &lt;/strong&gt; Just now\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory usage: &lt;/strong&gt; 117.16 MiB\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Spilled bytes: &lt;/strong&gt; 0 B\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Read bytes: &lt;/strong&gt; 8.01 kiB\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Write bytes: &lt;/strong&gt; 34.03 kiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/details&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n\n&lt;/details&gt;\n\n\n&lt;/div&gt;\n\n\n2024-11-28 17:46:13,681 - distributed.client - ERROR - \nConnectionRefusedError: [Errno 61] Connection refused\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File &quot;/Users/nitinsharma/miniconda3/envs/spec_line_sandbox/lib/python3.10/site-packages/distributed/comm/core.py&quot;, line 342, in connect\n    comm = await wait_for(\n  File &quot;/Users/nitinsharma/miniconda3/envs/spec_line_sandbox/lib/python3.10/site-packages/distributed/utils.py&quot;, line 1957, in wait_for\n    return await asyncio.wait_for(fut, timeout)\n  File &quot;/Users/nitinsharma/miniconda3/envs/spec_line_sandbox/lib/python3.10/asyncio/tasks.py&quot;, line 445, in wait_for\n    return fut.result()\n  File &quot;/Users/nitinsharma/miniconda3/envs/spec_line_sandbox/lib/python3.10/site-packages/distributed/comm/tcp.py&quot;, line 559, in connect\n    convert_stream_closed_error(self, e)\n  File &quot;/Users/nitinsharma/miniconda3/envs/spec_line_sandbox/lib/python3.10/site-packages/distributed/comm/tcp.py&quot;, line 140, in convert_stream_closed_error\n    raise CommClosedError(f&quot;in {obj}: {exc.__class__.__name__}: {exc}&quot;) from exc\ndistributed.comm.core.CommClosedError: in &lt;distributed.comm.tcp.TCPConnector object at 0x15d137310&gt;: ConnectionRefusedError: [Errno 61] Connection refused\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File &quot;/Users/nitinsharma/miniconda3/envs/spec_line_sandbox/lib/python3.10/site-packages/distributed/utils.py&quot;, line 837, in wrapper\n    return await func(*args, **kwargs)\n  File &quot;/Users/nitinsharma/miniconda3/envs/spec_line_sandbox/lib/python3.10/site-packages/distributed/client.py&quot;, line 1549, in _reconnect\n    await self._ensure_connected(timeout=timeout)\n  File &quot;/Users/nitinsharma/miniconda3/envs/spec_line_sandbox/lib/python3.10/site-packages/distributed/client.py&quot;, line 1579, in _ensure_connected\n    comm = await connect(\n  File &quot;/Users/nitinsharma/miniconda3/envs/spec_line_sandbox/lib/python3.10/site-packages/distributed/comm/core.py&quot;, line 366, in connect\n    await asyncio.sleep(backoff)\n  File &quot;/Users/nitinsharma/miniconda3/envs/spec_line_sandbox/lib/python3.10/asyncio/tasks.py&quot;, line 605, in sleep\n    return await future\nasyncio.exceptions.CancelledError\n\nclient.get()\n\n&lt;bound method Client.get of &lt;Client: &#039;tcp://192.168.0.107:8786&#039; processes=1 threads=1, memory=4.00 GiB&gt;&gt;\n\nfrom dask.distributed import performance_report\n\nwith performance_report(filename=&quot;report.html&quot;):\n    dask.compute(result)\n\n            "},"notes/tech/dask/notebooks/ordering":{"title":"ordering","links":[],"tags":[],"content":"import dask.array as da\nimport dask\nfrom dask.distributed import Client, performance_report\n\nx = da.zeros((12500, 10000), chunks=(&#039;10MB&#039;, -1))\nx\n\n\n\n\n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; 0.93 GiB &lt;/td&gt;\n                    &lt;td&gt; 9.54 MiB &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; (12500, 10000) &lt;/td&gt;\n                    &lt;td&gt; (125, 10000) &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 100 chunks in 1 graph layer &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; float64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n    &lt;svg width=&quot;146&quot; height=&quot;170&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n10000\n12500\n\n\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                \nda.to_zarr(x, &quot;__pycache__/data/saved_x1.zarr&quot;, overwrite=True)\nda.to_zarr(x, &quot;__pycache__/data/saved_y1.zarr&quot;, overwrite=True)\n\nda.to_zarr(x, &quot;__pycache__/data/saved_x2.zarr&quot;, overwrite=True)\nda.to_zarr(x, &quot;__pycache__/data/saved_y2.zarr&quot;, overwrite=True)\n\nx1 = da.from_zarr(&#039;__pycache__/data/saved_x1.zarr&#039;)\ny1 = da.from_zarr(&#039;__pycache__/data/saved_x2.zarr&#039;)\nx2 = da.from_zarr(&#039;__pycache__/data/saved_y1.zarr&#039;)\ny2 = da.from_zarr(&#039;__pycache__/data/saved_y2.zarr&#039;)\n\ndef evaluate(x1, y1, x2, y2):\n    u = da.stack([x1, y1])\n    v = da.stack([x2, y2])\n    \n    components = [u, v, u ** 2 + v ** 2]\n    return [\n        abs(c[0] - c[1]).mean(axis=-1)\n        for c in components\n    ]\n\nn = 125 * 4\nresults = evaluate(x1[:n], y1[:n], x2[:n], y2[:n])\nresults\n\n[dask.array&lt;mean_agg-aggregate, shape=(500,), dtype=float64, chunksize=(125,), chunktype=numpy.ndarray&gt;,\n dask.array&lt;mean_agg-aggregate, shape=(500,), dtype=float64, chunksize=(125,), chunktype=numpy.ndarray&gt;,\n dask.array&lt;mean_agg-aggregate, shape=(500,), dtype=float64, chunksize=(125,), chunktype=numpy.ndarray&gt;]\n\ndask.visualize(results,  optimize_graph=True, cmap=&quot;autumn&quot;, node_attr={&quot;penwidth&quot;: &quot;4&quot;}, color=&#039;order&#039;)\n\n\nresults[0].dask\n\n\n    \n        \n            \n                \n                \n                \n                \n                \n                \n                \n                \n            \n        \n        \n            HighLevelGraph\n            \n                HighLevelGraph with 13 layers and 242 keys from all layers.\n            \n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer1: original-from-zarr&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        original-from-zarr-29046f8580ea540ea8b9402c9d9795c3\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer2: from-zarr&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        from-zarr-29046f8580ea540ea8b9402c9d9795c3\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;100&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(12500, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(125, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;original-from-zarr-29046f8580ea540ea8b9402c9d9795c3&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;210&quot; height=&quot;250&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n10000\n12500\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer3: getitem&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        getitem-ed33f4257cc98c9d86ea274bb23f39ec\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(500, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(125, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;from-zarr-29046f8580ea540ea8b9402c9d9795c3&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;107&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n10000\n500\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer4: original-from-zarr&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        original-from-zarr-b86d06dc7c4736ceef56e0c0d0e5af4d\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer5: from-zarr&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        from-zarr-b86d06dc7c4736ceef56e0c0d0e5af4d\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;100&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(12500, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(125, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;original-from-zarr-b86d06dc7c4736ceef56e0c0d0e5af4d&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;210&quot; height=&quot;250&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n10000\n12500\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer6: getitem&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        getitem-c8d738cbe21502c64bf9bd3a65eca0b5\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(500, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(125, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;from-zarr-b86d06dc7c4736ceef56e0c0d0e5af4d&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;107&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n10000\n500\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer7: stack&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        stack-576b40ac713fcb33a7513cd148008c3f\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;8&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(2, 500, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1, 125, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;getitem-ed33f4257cc98c9d86ea274bb23f39ec&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;&lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;getitem-c8d738cbe21502c64bf9bd3a65eca0b5&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;284&quot; height=&quot;132&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n10000\n500\n2\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer8: getitem&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        getitem-8a064bd748e2a143aa787cb3553dfdf9\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(500, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(125, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;stack-576b40ac713fcb33a7513cd148008c3f&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;107&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n10000\n500\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer9: getitem&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        getitem-e930bbed5998d3dd2d58a6aa337e457b\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(500, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(125, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;stack-576b40ac713fcb33a7513cd148008c3f&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;107&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n10000\n500\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer10: sub&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        sub-355c38cde8a95825d373f7b0914bd4c9\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(500, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(125, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;getitem-e930bbed5998d3dd2d58a6aa337e457b&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;&lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;getitem-8a064bd748e2a143aa787cb3553dfdf9&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;107&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n10000\n500\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer11: abs&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        abs-d8a1a780e1ba46de42c427217504d0d2\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(500, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(125, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;sub-355c38cde8a95825d373f7b0914bd4c9&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;107&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n10000\n500\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer12: mean_chunk&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        mean_chunk-53c7b82e972b136fba07af296fb1d71a\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(500, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(125, 10000)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;abs-d8a1a780e1ba46de42c427217504d0d2&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;107&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n10000\n500\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer13: mean_agg-aggregate&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        mean_agg-aggregate-85b94be6a1c9bedbdda1c02171b37ba6\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(500,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(125,)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;mean_chunk-53c7b82e972b136fba07af296fb1d71a&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;92&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n500\n1\n\n\n\n\n&lt;/details&gt;\n\n\n    &lt;/div&gt;\n&lt;/div&gt;\n\n\nclient = Client(&quot;tcp://172.20.104.205:8786&quot;)\nclient\n\n\n     \n    \n        Client\n        Client-1d81e416-a8b3-11ef-a0f3-acde48001122\n        \n    &lt;tr&gt;\n\n        &lt;td style=&quot;text-align: left;&quot;&gt;&lt;strong&gt;Connection method:&lt;/strong&gt; Direct&lt;/td&gt;\n        &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n\n    &lt;/tr&gt;\n\n\n        &lt;tr&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;\n                &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://172.20.104.205:8787/status&quot; target=&quot;_blank&quot;&gt;http://172.20.104.205:8787/status&lt;/a&gt;\n            &lt;/td&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n\n\n    &lt;/table&gt;\n\n\n\n\n        &lt;details&gt;\n        &lt;summary style=&quot;margin-bottom: 20px;&quot;&gt;&lt;h3 style=&quot;display: inline;&quot;&gt;Scheduler Info&lt;/h3&gt;&lt;/summary&gt;\n        &lt;div style=&quot;&quot;&gt;\n&lt;div&gt;\n    &lt;div style=&quot;width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n    &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;h3 style=&quot;margin-bottom: 0px;&quot;&gt;Scheduler&lt;/h3&gt;\n        &lt;p style=&quot;color: #9D9D9D; margin-bottom: 0px;&quot;&gt;Scheduler-000827b1-3cb8-409d-b77e-594e9b6b470d&lt;/p&gt;\n        &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Comm:&lt;/strong&gt; tcp://172.20.104.205:8786\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Workers:&lt;/strong&gt; 2\n                &lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Dashboard:&lt;/strong&gt; &lt;a href=&quot;http://172.20.104.205:8787/status&quot; target=&quot;_blank&quot;&gt;http://172.20.104.205:8787/status&lt;/a&gt;\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Total threads:&lt;/strong&gt; 8\n                &lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Started:&lt;/strong&gt; Just now\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Total memory:&lt;/strong&gt; 8.00 GiB\n                &lt;/td&gt;\n            &lt;/tr&gt;\n        &lt;/table&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n\n&lt;details style=&quot;margin-left: 48px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;h3 style=&quot;display: inline;&quot;&gt;Workers&lt;/h3&gt;\n    &lt;/summary&gt;\n\n\n    &lt;div style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;div style=&quot;width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n        &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;details&gt;\n            &lt;summary&gt;\n                &lt;h4 style=&quot;margin-bottom: 0px; display: inline;&quot;&gt;Worker: tcp://172.20.104.205:54988&lt;/h4&gt;\n            &lt;/summary&gt;\n            &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Comm: &lt;/strong&gt; tcp://172.20.104.205:54988\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Total threads: &lt;/strong&gt; 4\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://172.20.104.205:54989/status&quot; target=&quot;_blank&quot;&gt;http://172.20.104.205:54989/status&lt;/a&gt;\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory: &lt;/strong&gt; 4.00 GiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Nanny: &lt;/strong&gt; tcp://172.20.104.205:54986\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=&quot;2&quot; style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Local directory: &lt;/strong&gt; /var/folders/7y/91xrb3bs5g96r0pvlvq04yx00000gn/T/dask-scratch-space/worker-vxz_961y\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks executing: &lt;/strong&gt; \n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks in memory: &lt;/strong&gt; \n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks ready: &lt;/strong&gt; \n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks in flight: &lt;/strong&gt;\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;CPU usage:&lt;/strong&gt; 3.1%\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Last seen: &lt;/strong&gt; Just now\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory usage: &lt;/strong&gt; 119.92 MiB\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Spilled bytes: &lt;/strong&gt; 0 B\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Read bytes: &lt;/strong&gt; 14.01 kiB\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Write bytes: &lt;/strong&gt; 6.00 kiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/details&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;div style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;div style=&quot;width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n        &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;details&gt;\n            &lt;summary&gt;\n                &lt;h4 style=&quot;margin-bottom: 0px; display: inline;&quot;&gt;Worker: tcp://172.20.104.205:54996&lt;/h4&gt;\n            &lt;/summary&gt;\n            &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Comm: &lt;/strong&gt; tcp://172.20.104.205:54996\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Total threads: &lt;/strong&gt; 4\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://172.20.104.205:54997/status&quot; target=&quot;_blank&quot;&gt;http://172.20.104.205:54997/status&lt;/a&gt;\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory: &lt;/strong&gt; 4.00 GiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Nanny: &lt;/strong&gt; tcp://172.20.104.205:54994\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=&quot;2&quot; style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Local directory: &lt;/strong&gt; /var/folders/7y/91xrb3bs5g96r0pvlvq04yx00000gn/T/dask-scratch-space/worker-5zofw279\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks executing: &lt;/strong&gt; \n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks in memory: &lt;/strong&gt; \n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks ready: &lt;/strong&gt; \n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks in flight: &lt;/strong&gt;\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;CPU usage:&lt;/strong&gt; 3.2%\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Last seen: &lt;/strong&gt; Just now\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory usage: &lt;/strong&gt; 117.19 MiB\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Spilled bytes: &lt;/strong&gt; 0 B\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Read bytes: &lt;/strong&gt; 14.02 kiB\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Write bytes: &lt;/strong&gt; 10.02 kiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/details&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n\n&lt;/details&gt;\n\n\n&lt;/div&gt;\n\n\nwith performance_report(filename=&quot;dask-report.html&quot;):\n    dask.compute(*results)\n\ndask.visualize(results[0])\n\n\n            "},"notes/tech/dask/notebooks/stages-of-computation":{"title":"stages-of-computation","links":[],"tags":[],"content":"import dask\nfrom dask.distributed import Client\nimport dask.array as da\nimport numpy as np\n%load_ext snakeviz\nclient = Client(&quot;tcp://172.20.104.205:8786&quot;)\nclient\n\n     \n    \n        Client\n        Client-dec853f0-a65e-11ef-80b7-acde48001122\n        \n    &lt;tr&gt;\n\n        &lt;td style=&quot;text-align: left;&quot;&gt;&lt;strong&gt;Connection method:&lt;/strong&gt; Direct&lt;/td&gt;\n        &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n\n    &lt;/tr&gt;\n\n\n        &lt;tr&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;\n                &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://172.20.104.205:8787/status&quot; target=&quot;_blank&quot;&gt;http://172.20.104.205:8787/status&lt;/a&gt;\n            &lt;/td&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n\n\n    &lt;/table&gt;\n\n\n\n\n        &lt;details&gt;\n        &lt;summary style=&quot;margin-bottom: 20px;&quot;&gt;&lt;h3 style=&quot;display: inline;&quot;&gt;Scheduler Info&lt;/h3&gt;&lt;/summary&gt;\n        &lt;div style=&quot;&quot;&gt;\n&lt;div&gt;\n    &lt;div style=&quot;width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n    &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;h3 style=&quot;margin-bottom: 0px;&quot;&gt;Scheduler&lt;/h3&gt;\n        &lt;p style=&quot;color: #9D9D9D; margin-bottom: 0px;&quot;&gt;Scheduler-8ffa2bc2-0cbb-48e2-b818-41edc5e5d4d8&lt;/p&gt;\n        &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Comm:&lt;/strong&gt; tcp://172.20.104.205:8786\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Workers:&lt;/strong&gt; 3\n                &lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Dashboard:&lt;/strong&gt; &lt;a href=&quot;http://172.20.104.205:8787/status&quot; target=&quot;_blank&quot;&gt;http://172.20.104.205:8787/status&lt;/a&gt;\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Total threads:&lt;/strong&gt; 36\n                &lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Started:&lt;/strong&gt; 2 minutes ago\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Total memory:&lt;/strong&gt; 48.00 GiB\n                &lt;/td&gt;\n            &lt;/tr&gt;\n        &lt;/table&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n\n&lt;details style=&quot;margin-left: 48px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;h3 style=&quot;display: inline;&quot;&gt;Workers&lt;/h3&gt;\n    &lt;/summary&gt;\n\n\n    &lt;div style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;div style=&quot;width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n        &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;details&gt;\n            &lt;summary&gt;\n                &lt;h4 style=&quot;margin-bottom: 0px; display: inline;&quot;&gt;Worker: tcp://172.20.104.205:50218&lt;/h4&gt;\n            &lt;/summary&gt;\n            &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Comm: &lt;/strong&gt; tcp://172.20.104.205:50218\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Total threads: &lt;/strong&gt; 12\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://172.20.104.205:50219/status&quot; target=&quot;_blank&quot;&gt;http://172.20.104.205:50219/status&lt;/a&gt;\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory: &lt;/strong&gt; 16.00 GiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Nanny: &lt;/strong&gt; tcp://172.20.104.205:50216\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=&quot;2&quot; style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Local directory: &lt;/strong&gt; /var/folders/7y/91xrb3bs5g96r0pvlvq04yx00000gn/T/dask-scratch-space/worker-3j6kie84\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks executing: &lt;/strong&gt; \n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks in memory: &lt;/strong&gt; \n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks ready: &lt;/strong&gt; \n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks in flight: &lt;/strong&gt;\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;CPU usage:&lt;/strong&gt; 3.0%\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Last seen: &lt;/strong&gt; Just now\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory usage: &lt;/strong&gt; 117.25 MiB\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Spilled bytes: &lt;/strong&gt; 0 B\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Read bytes: &lt;/strong&gt; 6.00 kiB\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Write bytes: &lt;/strong&gt; 6.00 kiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/details&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;div style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;div style=&quot;width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n        &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;details&gt;\n            &lt;summary&gt;\n                &lt;h4 style=&quot;margin-bottom: 0px; display: inline;&quot;&gt;Worker: tcp://172.20.104.205:50228&lt;/h4&gt;\n            &lt;/summary&gt;\n            &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Comm: &lt;/strong&gt; tcp://172.20.104.205:50228\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Total threads: &lt;/strong&gt; 12\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://172.20.104.205:50229/status&quot; target=&quot;_blank&quot;&gt;http://172.20.104.205:50229/status&lt;/a&gt;\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory: &lt;/strong&gt; 16.00 GiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Nanny: &lt;/strong&gt; tcp://172.20.104.205:50226\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=&quot;2&quot; style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Local directory: &lt;/strong&gt; /var/folders/7y/91xrb3bs5g96r0pvlvq04yx00000gn/T/dask-scratch-space/worker-iuwpvy_f\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks executing: &lt;/strong&gt; \n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks in memory: &lt;/strong&gt; \n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks ready: &lt;/strong&gt; \n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks in flight: &lt;/strong&gt;\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;CPU usage:&lt;/strong&gt; 2.9%\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Last seen: &lt;/strong&gt; Just now\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory usage: &lt;/strong&gt; 118.91 MiB\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Spilled bytes: &lt;/strong&gt; 0 B\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Read bytes: &lt;/strong&gt; 4.00 kiB\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Write bytes: &lt;/strong&gt; 4.00 kiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/details&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;div style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;div style=&quot;width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n        &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;details&gt;\n            &lt;summary&gt;\n                &lt;h4 style=&quot;margin-bottom: 0px; display: inline;&quot;&gt;Worker: tcp://172.20.104.205:50235&lt;/h4&gt;\n            &lt;/summary&gt;\n            &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Comm: &lt;/strong&gt; tcp://172.20.104.205:50235\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Total threads: &lt;/strong&gt; 12\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://172.20.104.205:50238/status&quot; target=&quot;_blank&quot;&gt;http://172.20.104.205:50238/status&lt;/a&gt;\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory: &lt;/strong&gt; 16.00 GiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Nanny: &lt;/strong&gt; tcp://172.20.104.205:50233\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=&quot;2&quot; style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Local directory: &lt;/strong&gt; /var/folders/7y/91xrb3bs5g96r0pvlvq04yx00000gn/T/dask-scratch-space/worker-t2wywt9q\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks executing: &lt;/strong&gt; \n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks in memory: &lt;/strong&gt; \n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks ready: &lt;/strong&gt; \n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Tasks in flight: &lt;/strong&gt;\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;CPU usage:&lt;/strong&gt; 2.8%\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Last seen: &lt;/strong&gt; Just now\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory usage: &lt;/strong&gt; 117.27 MiB\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Spilled bytes: &lt;/strong&gt; 0 B\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Read bytes: &lt;/strong&gt; 4.00 kiB\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Write bytes: &lt;/strong&gt; 4.00 kiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/details&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n\n&lt;/details&gt;\n\n\n&lt;/div&gt;\n\n\n2024-11-19 20:48:16,286 - distributed.client - ERROR - Failed to reconnect to scheduler after 30.00 seconds, closing client\n\na = da.array(np.arange(10000*100).reshape(10000,100))\na = a.rechunk((1000, 10))\na\n\n            \n    \n        \n            \n                &lt;tr&gt;\n                    &lt;th&gt; Bytes &lt;/th&gt;\n                    &lt;td&gt; 7.63 MiB &lt;/td&gt;\n                    &lt;td&gt; 78.12 kiB &lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th&gt; Shape &lt;/th&gt;\n                    &lt;td&gt; (10000, 100) &lt;/td&gt;\n                    &lt;td&gt; (1000, 10) &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Dask graph &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; 100 chunks in 2 graph layers &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;th&gt; Data type &lt;/th&gt;\n                    &lt;td colspan=&quot;2&quot;&gt; int64 numpy.ndarray &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;td&gt;\n    &lt;svg width=&quot;75&quot; height=&quot;170&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n100\n10000\n\n\n\n\n                \n                    \n                         \n                         Array \n                         Chunk \n                    \n                \n                \na.compute()\narray([[     0,      1,      2, ...,     97,     98,     99],\n       [   100,    101,    102, ...,    197,    198,    199],\n       [   200,    201,    202, ...,    297,    298,    299],\n       ...,\n       [999700, 999701, 999702, ..., 999797, 999798, 999799],\n       [999800, 999801, 999802, ..., 999897, 999898, 999899],\n       [999900, 999901, 999902, ..., 999997, 999998, 999999]])\n"},"notes/tech/dask/notebooks/task-graphs":{"title":"task-graphs","links":[],"tags":[],"content":"from dask.threaded import get\ndef add(a, b):\n    return a + b\n \n \ndsk = {\n    &#039;x&#039;: 3,\n    &#039;y&#039;: 2,\n    &#039;z&#039;: (add, &#039;x&#039;, &#039;y&#039;)\n}\nget(dsk, &#039;z&#039;)\n5\n\ndef add(a, b):\n    return len(a) + len(b)\n \n \ndsk = {\n    &#039;x&#039;: 3,\n    &#039;y&#039;: 2,\n    &#039;z&#039;: (add, [&#039;x&#039;], [&#039;y&#039;, &#039;y&#039;])\n}\nget(dsk, &#039;z&#039;)\n3\n\ndef add(a, b):\n    return a + b\n \n \ndsk = {\n    &#039;x&#039;: 1,\n    &#039;y&#039;: 2,\n    &#039;z&#039;: (add, &#039;x&#039;, &#039;y&#039;),\n    &#039;q&#039;: [(sum, [&#039;x&#039;, &#039;y&#039;, &#039;z&#039;]), &#039;z&#039;]\n}\n \nget(dsk, &#039;q&#039;)\n[6, 3]\n\nCustom Graphs\ndef load(chunk_name):\n    print(f&quot;Loading chunk {chunk_name}&quot;)\n    return f&quot;chunk --- --- {chunk_name}&quot;\n \n \ndef sanitize(chunk):\n    print(f&quot;Sanitizing chunk {chunk}&quot;)\n    return chunk\n \n \ndef mean(chunks):\n    print(f&quot;mean {chunks}&quot;)\n    return chunks[0]\n \n \ndef save(result):\n    print(&quot;saving result&quot;)\n \ndsk = {\n    &#039;load-chunk-1&#039;: (load, &#039;chunk1.dat&#039;),\n    &#039;load-chunk-2&#039;: (load, &#039;chunk2.dat&#039;),\n    &#039;sanitize-1&#039;: (sanitize, &#039;load-chunk-1&#039;),\n    &#039;sanitize-2&#039;: (sanitize, &#039;load-chunk-2&#039;),\n    &#039;mean&#039;: (mean, [&quot;load-chunk-%d&quot; % i for i in [1, 2]]),\n    &#039;save&#039;: (save, &#039;mean&#039;)\n}\nfrom dask.distributed import Client\nclient = Client(n_workers=2)\nclient\n\n     \n    \n        Client\n        Client-d418603c-8ef1-11ef-a143-acde48001122\n        \n    &lt;tr&gt;\n\n        &lt;td style=&quot;text-align: left;&quot;&gt;&lt;strong&gt;Connection method:&lt;/strong&gt; Cluster object&lt;/td&gt;\n        &lt;td style=&quot;text-align: left;&quot;&gt;&lt;strong&gt;Cluster type:&lt;/strong&gt; distributed.LocalCluster&lt;/td&gt;\n\n    &lt;/tr&gt;\n\n\n        &lt;tr&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;\n                &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://127.0.0.1:8787/status&quot; target=&quot;_blank&quot;&gt;http://127.0.0.1:8787/status&lt;/a&gt;\n            &lt;/td&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n\n\n    &lt;/table&gt;\n\n\n\n\n        &lt;details&gt;\n        &lt;summary style=&quot;margin-bottom: 20px;&quot;&gt;&lt;h3 style=&quot;display: inline;&quot;&gt;Cluster Info&lt;/h3&gt;&lt;/summary&gt;\n        &lt;div class=&quot;jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output&quot;&gt;\n&lt;div style=&quot;width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;&quot;&gt;\n&lt;/div&gt;\n&lt;div style=&quot;margin-left: 48px;&quot;&gt;\n    &lt;h3 style=&quot;margin-bottom: 0px; margin-top: 0px;&quot;&gt;LocalCluster&lt;/h3&gt;\n    &lt;p style=&quot;color: #9D9D9D; margin-bottom: 0px;&quot;&gt;9e696e30&lt;/p&gt;\n    &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n        &lt;tr&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;\n                &lt;strong&gt;Dashboard:&lt;/strong&gt; &lt;a href=&quot;http://127.0.0.1:8787/status&quot; target=&quot;_blank&quot;&gt;http://127.0.0.1:8787/status&lt;/a&gt;\n            &lt;/td&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;\n                &lt;strong&gt;Workers:&lt;/strong&gt; 2\n            &lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;tr&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;\n                &lt;strong&gt;Total threads:&lt;/strong&gt; 12\n            &lt;/td&gt;\n            &lt;td style=&quot;text-align: left;&quot;&gt;\n                &lt;strong&gt;Total memory:&lt;/strong&gt; 16.00 GiB\n            &lt;/td&gt;\n        &lt;/tr&gt;\n\n        &lt;tr&gt;\n&lt;td style=&quot;text-align: left;&quot;&gt;&lt;strong&gt;Status:&lt;/strong&gt; running&lt;/td&gt;\n&lt;td style=&quot;text-align: left;&quot;&gt;&lt;strong&gt;Using processes:&lt;/strong&gt; True&lt;/td&gt;\n\n\n    &lt;/table&gt;\n\n    &lt;details&gt;\n        &lt;summary style=&quot;margin-bottom: 20px;&quot;&gt;\n            &lt;h3 style=&quot;display: inline;&quot;&gt;Scheduler Info&lt;/h3&gt;\n        &lt;/summary&gt;\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;div&gt;\n    &lt;div style=&quot;width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n    &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;h3 style=&quot;margin-bottom: 0px;&quot;&gt;Scheduler&lt;/h3&gt;\n        &lt;p style=&quot;color: #9D9D9D; margin-bottom: 0px;&quot;&gt;Scheduler-8f432180-0dfb-4565-ac7a-8d40f0b6a709&lt;/p&gt;\n        &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Comm:&lt;/strong&gt; tcp://127.0.0.1:59079\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Workers:&lt;/strong&gt; 2\n                &lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Dashboard:&lt;/strong&gt; &lt;a href=&quot;http://127.0.0.1:8787/status&quot; target=&quot;_blank&quot;&gt;http://127.0.0.1:8787/status&lt;/a&gt;\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Total threads:&lt;/strong&gt; 12\n                &lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Started:&lt;/strong&gt; Just now\n                &lt;/td&gt;\n                &lt;td style=&quot;text-align: left;&quot;&gt;\n                    &lt;strong&gt;Total memory:&lt;/strong&gt; 16.00 GiB\n                &lt;/td&gt;\n            &lt;/tr&gt;\n        &lt;/table&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n\n&lt;details style=&quot;margin-left: 48px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;h3 style=&quot;display: inline;&quot;&gt;Workers&lt;/h3&gt;\n    &lt;/summary&gt;\n\n\n    &lt;div style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;div style=&quot;width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n        &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;details&gt;\n            &lt;summary&gt;\n                &lt;h4 style=&quot;margin-bottom: 0px; display: inline;&quot;&gt;Worker: 0&lt;/h4&gt;\n            &lt;/summary&gt;\n            &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Comm: &lt;/strong&gt; tcp://127.0.0.1:59086\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Total threads: &lt;/strong&gt; 6\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://127.0.0.1:59090/status&quot; target=&quot;_blank&quot;&gt;http://127.0.0.1:59090/status&lt;/a&gt;\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory: &lt;/strong&gt; 8.00 GiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Nanny: &lt;/strong&gt; tcp://127.0.0.1:59082\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=&quot;2&quot; style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Local directory: &lt;/strong&gt; /var/folders/7y/91xrb3bs5g96r0pvlvq04yx00000gn/T/dask-scratch-space/worker-kpcc0yu9\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n\n\n            &lt;/table&gt;\n        &lt;/details&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;div style=&quot;margin-bottom: 20px;&quot;&gt;\n        &lt;div style=&quot;width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;&quot;&gt; &lt;/div&gt;\n        &lt;div style=&quot;margin-left: 48px;&quot;&gt;\n        &lt;details&gt;\n            &lt;summary&gt;\n                &lt;h4 style=&quot;margin-bottom: 0px; display: inline;&quot;&gt;Worker: 1&lt;/h4&gt;\n            &lt;/summary&gt;\n            &lt;table style=&quot;width: 100%; text-align: left;&quot;&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Comm: &lt;/strong&gt; tcp://127.0.0.1:59087\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Total threads: &lt;/strong&gt; 6\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Dashboard: &lt;/strong&gt; &lt;a href=&quot;http://127.0.0.1:59088/status&quot; target=&quot;_blank&quot;&gt;http://127.0.0.1:59088/status&lt;/a&gt;\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Memory: &lt;/strong&gt; 8.00 GiB\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Nanny: &lt;/strong&gt; tcp://127.0.0.1:59083\n                    &lt;/td&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=&quot;2&quot; style=&quot;text-align: left;&quot;&gt;\n                        &lt;strong&gt;Local directory: &lt;/strong&gt; /var/folders/7y/91xrb3bs5g96r0pvlvq04yx00000gn/T/dask-scratch-space/worker-lmiace3z\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n\n\n            &lt;/table&gt;\n        &lt;/details&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n\n&lt;/details&gt;\n\n\n    &lt;/details&gt;\n&lt;/div&gt;\n\n\n&lt;/div&gt;\n\n\n2024-10-21 08:13:44,417 - distributed.scheduler - WARNING - Worker failed to heartbeat for 3656s; attempting restart: &lt;WorkerState &#039;tcp://127.0.0.1:59086&#039;, name: 0, status: running, memory: 0, processing: 0&gt;\n2024-10-21 08:13:44,622 - distributed.scheduler - WARNING - Worker failed to heartbeat for 3656s; attempting restart: &lt;WorkerState &#039;tcp://127.0.0.1:59087&#039;, name: 1, status: running, memory: 0, processing: 0&gt;\n2024-10-21 08:13:45,460 - distributed.nanny - WARNING - Restarting worker\n2024-10-21 08:13:45,475 - distributed.nanny - WARNING - Restarting worker\n2024-10-21 10:37:54,647 - distributed.nanny - WARNING - Restarting worker\n2024-10-21 10:37:54,656 - distributed.nanny - WARNING - Restarting worker\n2024-10-21 10:37:54,734 - distributed.nanny - WARNING - Restarting worker\n2024-10-21 10:37:54,856 - distributed.nanny - WARNING - Restarting worker\n2024-10-21 10:37:54,860 - distributed.nanny - WARNING - Restarting worker\n2024-10-21 10:37:55,186 - distributed.nanny - WARNING - Restarting worker\n2024-10-21 10:37:55,189 - distributed.nanny - WARNING - Restarting worker\n2024-10-21 10:37:56,213 - distributed.nanny - WARNING - Restarting worker\n2024-10-21 10:37:56,217 - distributed.nanny - WARNING - Restarting worker\n\nclient.get(dsk, &#039;save&#039;)\n \n \n            "},"notes/tech/dask/notebooks/visualize-task-graphs":{"title":"visualize-task-graphs","links":[],"tags":[],"content":"import dask.array as da\nimport dask\n\nx = da.ones((15, 15), chunks=(5, 5))\n\ny = x.sum()\n\ndask.visualize(y)\n\n\ny.visualize(rankdir=&#039;BT&#039;)\n\n\ndask.visualize(y, optimize_graph=True)\n\n\nVisualize High level dask graph\ny.dask.visualize(filename=&#039;test.svg&#039;)\n\n\n\nHigh level graph HTML representation\ny.dask\n\n\n    \n        \n            \n                \n                \n                \n                \n                \n                \n                \n                \n            \n        \n        \n            HighLevelGraph\n            \n                HighLevelGraph with 4 layers and 23 keys from all layers.\n            \n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer1: ones_like&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        ones_like-44817800100989a0a789e6d1be702b8f\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;9&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(15, 15)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(5, 5)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;250&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n15\n15\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer2: sum&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        sum-1eee5d86c351bbfd9246db6fcdd2ab33\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;Blockwise&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;9&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(15, 15)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(5, 5)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;ones_like-44817800100989a0a789e6d1be702b8f&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;250&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n15\n15\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer3: sum-partial&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        sum-partial-0259629db3a875f0182cc02372216a68\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(2, 2)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;(1, 1)&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;sum-1eee5d86c351bbfd9246db6fcdd2ab33&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n            &lt;svg width=&quot;250&quot; height=&quot;250&quot; style=&quot;stroke:rgb(0,0,0);stroke-width:1&quot; &gt;\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n2\n2\n\n\n\n\n&lt;/details&gt;\n\n\n        &lt;div style=&quot;&quot;&gt;\n&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 32 32&quot; fill=&quot;none&quot; xmlns=&quot;www.w3.org/2000/svg&quot; style=&quot;position: absolute;&quot;&gt;\n\n    &lt;circle cx=&quot;16&quot; cy=&quot;16&quot; r=&quot;14&quot; fill=&quot;#8F8F8F&quot; style=&quot;stroke: var(--jp-ui-font-color2, #1D1D1D);&quot; stroke-width=&quot;2&quot;/&gt;\n\n&lt;/svg&gt;\n\n&lt;details style=&quot;margin-left: 32px;&quot;&gt;\n    &lt;summary style=&quot;margin-bottom: 10px; margin-top: 10px;&quot;&gt;\n        &lt;h4 style=&quot;display: inline;&quot;&gt;Layer4: sum-aggregate&lt;/h4&gt;\n    &lt;/summary&gt;\n    &lt;p style=&quot;color: var(--jp-ui-font-color2, #5D5851); margin: -0.25em 0px 0px 0px;&quot;&gt;\n        sum-aggregate-00894334ef002abf8d298cbe8aa1aab4\n    &lt;/p&gt;\n\n    &lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;\n            &lt;table&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;layer_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;MaterializedLayer&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;is_materialized&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;True&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;number of outputs&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;shape&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;()&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;dtype&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;float64&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunksize&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;()&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;dask.array.core.Array&lt;/td&gt;\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt;chunk_type&lt;/th&gt;\n                    &lt;td style=&quot;text-align: left;&quot;&gt;numpy.ndarray&lt;/td&gt;\n                &lt;/tr&gt;\n\n\n\n                    &lt;tr&gt;\n                        &lt;th style=&quot;text-align: left; width: 150px;&quot;&gt; depends on &lt;/th&gt;\n                        &lt;td style=&quot;text-align: left;&quot;&gt;sum-partial-0259629db3a875f0182cc02372216a68&lt;/td&gt;\n                    &lt;/tr&gt;\n\n\n            &lt;/table&gt;\n        &lt;/td&gt;\n        &lt;td&gt;\n\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n\n&lt;/details&gt;\n\n\n    &lt;/div&gt;\n&lt;/div&gt;\n\n"},"notes/tech/dask/persist":{"title":"persist","links":[],"tags":["distributed-computing","data","memory"],"content":"Persist\npersist starts the computation and stores the results in memory. However, it is different from compute in a way where persist gives back dask object with results being computed or computed and stored on distributed cluster memory. compute on one hand returns back the numpy or pandas dataframe as result which is a big one data stored. This is may not be possible for a single machine memory to store such big data. If cluster is accessible, we can use persist which can stored results on cluster distributed memory.\n# returns an in-memory non-dask object\nresult = y.compute()\n \n# returns an in-memory dask object that uses distributed storage\n# if available\nresult = y.persist()\nOne usecase of persist is that persisting the data after some preprocessing the large data and then using this persisted data for other processing which gives faster results.\na = da.arange(10000, chunks=(100))\nprocessed = a % 2\nprocessed = processed.persist()\n \n \n# These are relatively faster as relevant data is in memory\nprocessed.sum().compute()\nprocessed.mean().compute()"},"notes/tech/dask/rechunk":{"title":"rechunk","links":["notes/tech/dask/chunks"],"tags":["distributed-computing","data-engineering"],"content":"Rechunk\nDask arrays can be rechunked using dask.array.rechunk method using any of the chunk format as described here.\ndask.array.ones((3, 4), chunks=(2, 2)).rechunk(((1, 1, 1), (2, 2)))"},"notes/tech/dask/reshape":{"title":"reshape","links":[],"tags":["libraries","data"],"content":"Reshape\nDask array can be reshaped using dask.array.reshape method.\na = da.ones((3, 4), chunks=(2, 2))\na.reshape((3, 2, 2))\nReshape in dask array is not similar as numpy reshape because dask arrays have chunks and doing reshaping requires some re-alignment or re-chunking of the chunks. The re-chunking has to be done to make it compatible with the output shape.\nFast moving axes\nAxes with less strides. In 2D array, axis=1 is fast\\ moving\\ axes. In re-chunking operation, we move across the fast moving axes and then goes to the next fasting moving axis.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfigure: Moving across axes for reshapingIf we have chunk size greater than 1 for slow axis (axis=0), then some of the values in the block will be left while moving left to right along the axes.\nFor example, for below array the first block is of shape (2, 2) and while moving left to right, the block still got two values left at the bottom.\n\n\n\n\n\n\n\n\n\n\n\nfigure: Problem with reshape with chunk size more than 1 on slow axis\nReshaping of the following dask array with chunks defined would require to do re-chunking.\nda.ones((3, 4), chunks=((2, 1), (2, 2))).reshape(12)\ndask.array.reshape method has logic to do re-chunking by merging the chunks or splitting the chunks on slow axis to 1 chunk size. We can handle this using parameter merge_chunks. By default reshape does merge chunks.\ndask_array.reshape(12, merge_chunks=False)\nReferences\n\ndocs.dask.org/en/stable/array-chunks.html\n"},"notes/tech/dask/scheduler":{"title":"scheduler","links":["notes/tech/CPython/gil","notes/tech/dask/local-cluster"],"tags":["python","libraries"],"content":"Scheduler\nA scheduler is something that schedules the tasks graph on parallel hardware. There are two types of scheduler,\n\nSingle machine\nDistributed scheduler\n\nSingle machine\nSingle machine scheduler uses machines threads and processes.\ndask.config.set(scheduler=&quot;processes&quot;) # it uses multiprocessing scheduler inside single machine\n \ndask.config.set(scheduler=&quot;threads&quot;)\nAbove configs are set globally. However, they can be used with context manager.\nwith dask.config.set(scheduler=&quot;threads&quot;):\n    d.compute()\nWhile calling compute, we can provide scheduler.\nd.compute(scheduler=&quot;processes&quot;)\nLocal threads\nEasy to setup scheduler that works well with simple computations. It provides good concurrency when used with numerical computing libraries such as numpy arrays etc. This is because python has this GIL problem which locks the python interpreter when one thread is in the\nexecution.\nLocal Processes\nTo overcome the limitations of threading scheduler, we can use this scheduler where multiple processes are utilized by dask for the computations.\nThis scheduler is good when the workflow is linear as there is less transmission of data between processes.\nSynchronous\nSingle threaded scheduler with no concurrency/parallelism. It is good for debugging and profiling.\ndask.config.set(scheduler=&quot;synchronous&quot;)\n\n\n                  \n                  Note\n                  \n                \n\nWhile creating a local cluster with multiprocessing should be enclosed in if __name__ == &quot;__main__&quot; because it will create multiple clients while loading the same script for spawning the sub processes.\n\n\nif __name__ == &quot;__main__&quot;:\n   from dask.distributed import Client\n   client = Client()\nDistributed Scheduler\nDistributed scheduler uses workers to schedule the job on. It can be setup on local single machine or a multi node cluster.\nReferences\n\ndocs.dask.org/en/stable/scheduling.html\n"},"notes/tech/dask/task-graphs":{"title":"task-graphs","links":["notes/tech/dask/get-method"],"tags":["parallelism","graph","distributed-computing"],"content":"Task Graphs\nDask internally converts the algorithms into a graph format made of python dicts, tuples, and functions.\nFor example,\ndsk = {\n &#039;x&#039;: 1,\n &#039;y&#039;: 2,\n &#039;z&#039;: (add, &#039;x&#039;, &#039;y&#039;)\n}\nA key can be a str, bytes, float, or a tuple.\nA task is a tuple with first element as callable and rest are arguments. Arguments again can be any other key, literal value or any computations.\nSo,\nKey\n---\n&#039;x&#039;\n(&#039;x&#039;, 1, 2) \n\n\nTasks\n----\n(add, &#039;x&#039;, &#039;y&#039;)\n(sum [1, 2, 3], 2)\n\nA computation can be\n\na literal value such as 1.\na task\nany key present in dask graph\na list of computations such as [&#039;x&#039;, 1, (add 1, 2)]\n\nEvaluate Graph\nget method from dask is served as entry point for the execution. It computes the value of the key from the dask graph.\nfrom dask.threaded import get\n \nget(dsk, &#039;x&#039;)\n \n1\nget takes the dask graph and key to compute."},"notes/tech/dask/visualize-task-graphs":{"title":"visualize-task-graphs","links":["notes/tech/dask/high-level-graph"],"tags":["graphs","distributed-computing"],"content":"Visualize Task Graphs\nTask graph can be visualized using dask.visualize and .visualize on the collections.\nHigh level task graphs\nBelow code snippet shows High level task graphs visualization.\nx = da.ones((15, 15), chunks=(5, 5))\n \ny = x.sum()\n \ny.dask.visualize()\nIt shows graph at higher level, without the underlying nodes and subgraphs.\nLow level task graphs\nLow level task graphs includes all the nodes and dependencies. It is used when we wan to understand and analyse the graph thoroughly.\ndask.visualize(y)\n \n# Or\n \ny.visualize()\nIt can take arguments such as engine to used. There are two engine supported, graphvis and cytoscape. Graph layout can also be changed using argument rankdir with values like LR, RL, TB, BT.\nIf we want optimized graph, we can use optimize_graph argument."},"notes/tech/elk-stack":{"title":"elk-stack","links":[],"tags":["logs","data"],"content":"ELK Stack\nObservations\n\nLogs management and analytics\nELK stack was first introduced by Elastic and was open source. However, the changed it to licensed from open source\nAWS launched OpenSearch as replacement for ELK which was open source.\nLogstash collects the logs data, applies transformations passes onto elasticsearch which indexes and stores the data. Kibana is then used to visualize the data.\n\nElasticsearch\nText search and analytics engine based on apache Lucene open source search engine.\nLogstash\nLogs aggregator and data collector from various sources, execute different transformations and enhancements and ship the data to various supported destinations.\nKibana\nVisualization tool works on top of elasticsearch."},"notes/tech/environment-modules/installing-modules":{"title":"installing-modules","links":[],"tags":["infrastructure","linux","unix","shell","terminal"],"content":"To install module from source, we need to download tarball of the required version, unpack it and install using make.\nDifferent releases of module can be find here.\n⟩ wget github.com/cea-hpc/modules/releases/download/v5.5.0/modules-5.5.0.tar.gz\n\n⟩ tar xfv modules-5.5.0.tar.gz\n\nWe can provide installation path and default module files to reside during the configuration.\n⟩ cd modules-5.5.0\n\n⟩ ./configure --prefix ~/.local/Modules --modulefilesdir ~/.local/Modules/modulefiles\n\nNow install the files using make.\nmake\n\nmake install\n\nInitialize on shell start\nSource the module for the specific shell currently in use by its config file (for fish), or .bashrc or .zshrc.\nAdd these lines to the file.\nsource /home/nitin/local/Modules/init/fish\nsource /home/nitin/local/Modules/init/fish_completion\n\nReferences\n\nmodules.readthedocs.io/en/latest/INSTALL.html\n\n"},"notes/tech/environment-modules/modules":{"title":"modules","links":[],"tags":["libraries"],"content":"It setups the libraries and paths. Custom configurations that setups the paths, can be written by the user be used with module load command.\nIt already comes on Linux system and can be initialized using,\nsource /usr/local/Modules/init/&lt;shell&gt;\n\nshell can be any supported shell."},"notes/tech/environment-modules/simple-module-file":{"title":"simple-module-file","links":[],"tags":["infra","shell","linux","unix"],"content":"Write a module file\nA module files are written using TCL (Tool Command Language) and is interpreted by modulecmd.tcl.\nA simple example of module file which adds a path to environment variable PATH.\n#%Module1.0\n\nproc ModulesHelp {} {\n    puts stderr &quot;This is a simple module file&quot;\n}\n\nmodule-whatis &quot;This is a simple module file prepending a path.&quot;\n\nset path &quot;/home/nitin/bin&quot;\n\nprepend-path PATH $path\n\n\nLet’s say it resides at /home/nitin/modulefiles/test and to use it, we need to make this path available for module.\nmodule use /home/nitin/modulefiles\n\nThis should add the path for module files. module avail should show new added modules.\nnitin@workstation ~&gt; module avail\n\n------------------------ /home/nitin/modulefiles ---------------------\ntest\n\n------------------------ /usr/share/modules/modulefiles --------------\ndot  module-git  module-info  modules  null  use.own\n\nKey:\nmodulepath\n\nWe can load the module using,\nmodule load test\n\nIt should prepend /home/nitin/bin to PATH."},"notes/tech/git/git-revert":{"title":"git-revert","links":[],"tags":["git"],"content":"git revert\nGit revert is a mechanism to undo the changes in a safely manner. This method is said to be safe because it does not removes the commit from the history, instead it goes back to the previous changes and creates the new commit in the history.\nThis is useful when working with shared repository environment. If git reset is used which removes the commit from the history, pushing the changes give error as local repository is behind the commits.\n⟩ git log --oneline --decorate --color\n3a3c1b3 (HEAD -&gt; master) something new in dir1/file\ne076952 Create new file in dir2 with content good bye\nfac1972 Removed &quot;why not me&quot; song\n81c668d Added &quot;why not me&quot; song\nb9aa371 Deleted dir2/fil\neee4a58 Added some more content to dir2/fil\n1758893 Added some content to the dir2/file\ne615279 deleted dir1/fie\ne7b8888 setting up directories\n\n~/Learning/Git/dir · (master)\n⟩ cat dir1/file\nsomething\nhello world\n\n~/Learning/Git/dir · (master)\n⟩ echo bye world &gt;&gt; dir1/file\n\n~/Learning/Git/dir · (master±)\n⟩ git add dir1/file\n\n⟩ git commit -m &quot;bye world into dir1/file&quot;\n[master 37c834b] bye world into dir1/file\n 1 file changed, 1 insertion(+)\n\n~/Learning/Git/dir · (master)\n⟩ git log --oneline --decorate --color\n54f69d3 (HEAD -&gt; master) bye world into dir1/file\n3a3c1b3 something new in dir1/file\ne076952 Create new file in dir2 with content good bye\nfac1972 Removed &quot;why not me&quot; song\n81c668d Added &quot;why not me&quot; song\nb9aa371 Deleted dir2/fil\neee4a58 Added some more content to dir2/fil\n1758893 Added some content to the dir2/file\ne615279 deleted dir1/fie\ne7b8888 setting up directories\n\n⟩ git revert HEAD\n[master 9fd4134] Revert &quot;bye world into dir1/file&quot;\n 1 file changed, 1 deletion(-)\n\n~/Learning/Git/dir · (master)\n⟩ git log --oneline --decorate --color\n9fd4134 (HEAD -&gt; master) Revert &quot;bye world into dir1/file&quot;\n54f69d3 bye world into dir1/file\n3a3c1b3 something new in dir1/file\ne076952 Create new file in dir2 with content good bye\nfac1972 Removed &quot;why not me&quot; song\n81c668d Added &quot;why not me&quot; song\nb9aa371 Deleted dir2/fil\neee4a58 Added some more content to dir2/fil\n1758893 Added some content to the dir2/file\ne615279 deleted dir1/fie\ne7b8888 setting up directories\n\nReferences\n\nwww.atlassian.com/git/tutorials/undoing-changes/git-revert\n"},"notes/tech/git/git-stash":{"title":"git-stash","links":[],"tags":["git"],"content":"git stash\nStash is used to temporarily shift the changes made to working repository so that something else can be done there.\nStash saves changes for tracked files and indexed files by default.\n\n\n                  \n                  Note\n                  \n                \n\nIndexed files are newly tracked or staged files.\n\n\nTo save the untracked files we can use -u or --inclusive-untracked flag with git stash.\nTo save all files we can use -a or --all flag which stashes ignored files as well.\ngit stash (default stash)\ngit stash -u (include untracked files)\ngit stash -a (stash all files)\n\nHow stash works?\nA stash is also encoded as a commit object. .git/ref/stash points to the latest stash made. Depending on the stash made, there can be multiple stash commits.\nIf only tracked files are stashed, a single commit is made with parent as current HEAD commit.\nIf untracked files are included, one more commit is created.\nSimilarly, commit is created for ignored files.\n\n\n\n\n\n\n\n\n\n\n\nfig: Git stash commits\nReferences\n\nwww.atlassian.com/git/tutorials/saving-changes/git-stash\n"},"notes/tech/git/gitlab-ci":{"title":"gitlab-ci","links":[],"tags":["versioning","git"],"content":"Gitlab CI\n\nA gitlab ci contains stages and job. Jobs are grouped in stages and run in parallel.\n\nstages:\n  - build\n  - deploy\n \nbuild-job:\n  stage: build\n  image: node\n  script:\n    - npm install\n    - npm run build\n  artifacts:\n    paths:\n      - &quot;build/&quot;\n \npages:\n  stage: deploy\n  script:\n    - mv build/ public/\n  artifacts:\n    paths:\n      - &quot;public/&quot;\n \n\nstages directive defines the sequence of jobs. There are two jobs with their stage mentioned in their definition.\n\nReferences\n\ndocs.gitlab.com/ee/ci/quick_start/tutorial.html\n"},"notes/tech/git/setup-ssh-with-gitlab":{"title":"setup-ssh-with-gitlab","links":[],"tags":["git","ssh"],"content":"Setup ssh with gitlab\nStep 1: Generate ssh key pair\nssh-keygen -t rsa -b 2048 -C &quot;nitinsharmacs@gitlab.com&quot;\n\n-t can be any encryption you want to use. -C is for comment that goes at the key end.\nStep 2: Copy and paste the public key in user’s gitlab settings\ntr -d &#039;\\n&#039; &lt; ~/.ssh/gitlab-access.pub | pbcopy\n\nThis removes the leading new line character from the key.\n\nPaste the public key in the given input element.\nStep 3: Config ssh config\nWe can config ssh for different hosts.\nAdd following in ~/.ssh/config\nHost gitlab.com\n  PreferredAuthentications publickey\n  IdentityFile ~/.ssh/gitlab-access\n\nStep 4: Setup ssh agent\nTo avoid entering key passphrase again and again, we can set up ssh agent.\neval `ssh-agent -s`\n\nNow, let’s add the key to the agent.\nssh-add ~/.ssh/gitlab-access\n\nListing all the keys added to the agent.\nssh-add -l\n\nThis agent specific to the shell. For the different shell, you have config it again."},"notes/tech/googleapis/delete-rows":{"title":"delete-rows","links":[],"tags":["spreadsheet","gsheets"],"content":"Rows can be deleted using batchUpdate API.\n \nresource = {&quot;requests&quot;:\n                [\n                    {&quot;deleteDimension&quot;: {\n                        &quot;range&quot;:{\n                            &quot;sheetId&quot;:0,\n                            &quot;dimension&quot;:&quot;ROWS&quot;,\n                            &quot;startIndex&quot;:20,\n                            &quot;endIndex&quot;:21}\n                        }\n                    }\n                ]\n            }\n \nbatchReqBody = {spreadsheetId: spreadSheet, resource: resource}\nclient.spreadsheets.batchUpdate(batchReqBody)\nstartIndex specify the range start. This row is not deleted. For instance, the range is startIndex = 16 and endIndex = 20, it will delete rows 17, 18, 19, and 20."},"notes/tech/jax/jax":{"title":"jax","links":[],"tags":["libraries","dic"],"content":"It uses MLIR."},"notes/tech/kubernetes/architectural-components":{"title":"architectural-components","links":[],"tags":["kubernetes","distributed-computing","architecture"],"content":"Kubernetes Architecture\nKubernetes architecture comprises following components.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nSr.ComponentDescription1.API serverIt acts as a frontend to kubernetes cluster.All the cli commands talk to kubernetes using this API server.2.etcdIt is a distributed key-value database to store the nodes information required to manage the cluster.It is responsible for implementing the locks to make sure there are no conflicts between the masters. (Need to understand and verify)3.SchedulerIt is responsible for the distribution of containers across multiple nodes. It looks for new containers and assign them to the nodes.4.ControllerIt is the brain of kubernetes.It looks for container or nodes went down and responsible for restarting them in such cases.5.kubeletIt is the agent that runs on each worker nodes and makes sure the containers are running as expected.6.Container runtimeSoftware responsible for running the container. Docker, rkt and CRI-O are such examples."},"notes/tech/kubernetes/at-rest-encryption":{"title":"at-rest-encryption","links":["notes/tech/kubernetes/secrets"],"tags":["kubernetes","rest-api"],"content":"Encryption at REST-API\nKubernetes stores key value pair data inside etcd in plain text format which can be easily comprehended by anyone who has access to to it.\nWe can enable encryption at kubernetes API that will encrypt the resource data entering into etcd. For example, we can configure to encrypt only Secret resource.\nBefore enabling encryption\nLet’s see how etcd stores secrets data when no api level encryption is enabled. Following describes the steps to do so.\n\nWe would need etcdctl client tool installed on our system.\n\nsudo apt install etcd-client\n\n\nWe required to locate the necessary certificate and key files. etcdctl requires ...etcd/ca.crt, ...etcd/server.crt, ...etcd/server.key to get the data from etcd.\n\nIn my case, I was using minikube. I could find this files inside control node at path /var/lib/minikube/certs/etcd.\n\nRun the command to get the data from etcd.\n\nETCDCTL_API=3 etcdctl \\\n   --cacert=ca.crt   \\\n   --cert=server.crt \\\n   --key=server.key  \\\n   get /registry/secrets/&lt;namespace&gt;/&lt;secret-name&gt;\n\nYou may face issues with permissions to access these certificates and key file and provide to command, it’s better to copy paste where there is no permission issue and use that path. (and delete afterwards obviously)\nIt should show something like below.\n/registry/secrets/learning/mysql-db-secret\nk8s\n\n\nv1Secret\n\nmysql-db-secrelearning&quot;*$6866e01b-df74-4a98-9511-d0b52d6773cf2qB\nkubectl-createUpdatevFieldsV1:=\n;{&quot;f:data&quot;:{&quot;.&quot;:{},&quot;f:PASSWORD&quot;:{},&quot;f:USER&quot;:{}},&quot;f:type&quot;:{}}B\nPASSWORDuser\n\nUSERuserOpaque&quot;\n\nIt clearly shows the data inside secret mysql-db-secret in namespace learning.\nThat is the problem!\nEnable encryption at rest\nSo we need to enable encryption at kube-apiserver pod. Here we need two things, kube-apiserver.yaml pod file and encryption resource file that will create.\nEncryption Resource file\napiVersion: apiserver.config.k8s.io/v1\nkind: EncryptionConfiguration\nresources:\n  - resources:\n      - secrets\n      - configmaps\n      - pandas.awesome.bears.example\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: &lt;BASE 64 ENCODED SECRET&gt;\n      - identity: {}\nresources.resources lists the kubernetes resources we need to enable the encryption for. providers lists the encryption algorithms. First item in providers is used for encryption and rest for fallbacks if any provider is enable to encrypt/decrypt. This is a list of available providers here.\nKey secret has to be base64 encoded that we can generated as follows\nThis is method is for linux.\n head -c 32 /dev/urandom | base64\n\nSo Encryption resource file for our case can be like following.\n/etc/kubernetes/enc/enc.yaml\napiVersion: apiserver.config.k8s.io/v1\nkind: EncryptionConfiguration\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: er+42Uj8deiLT9sUFFwycEqLPW+Egt0EDVTWPsF3MDM=\n      - identity: {}\nUsing Encryption Resource file\nWe need to use this resource file inside kube-apiserver pod. We can achieve by providing --encryption-provider-config parameter with value as path to encryption resource yaml file, while creating the kube-apiserver pod.\nkube-apiserver.yaml can be located at path /etc/kubernetes/manifests/kube-apiserver.yaml.\nWe need to do two things here.\n\nProvide --encryption-provider-config parameter in command section of containers.\n\nCode snippet of kube-apiserver.yaml.\nspec:\n  containers:\n  - command:\n    - kube-apiserver\n    - --advertise-address=192.168.76.2\n    - --allow-privileged=true\n    - --authorization-mode=Node,RBAC\n    - --client-ca-file=/var/lib/minikube/certs/ca.crt\n    - --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,MutatingAdmissionWebhook,Validat\ningAdmissionWebhook,ResourceQuota\n    - --enable-bootstrap-token-auth=true\n    ..........\n    - --tls-cert-file=/var/lib/minikube/certs/apiserver.crt\n    - --tls-private-key-file=/var/lib/minikube/certs/apiserver.key\n    - --encryption-provider-config=/etc/kubernetes/enc/enc.yaml\n\nMount the path to pod where it can find /etc/kubernetes/enc/enc.yaml.\n\nCode snippet of kube-apiserver.yaml.\nspec:\n  containers:\n    - ...\n     volumeMounts:\n        - mountPath: /etc/ssl/certs\n          name: ca-certs\n          readOnly: true\n        ....\n        - mountPath: /etc/kubernetes/enc\n          name: enc\n          readOnly: true\n  volumes:\n  - hostPath:\n      path: /etc/ssl/certs\n      type: DirectoryOrCreate\n    name: ca-certs\n   .....\n  - name: enc\n    hostPath:\n      path: /etc/kubernetes/enc\n      type: DirectoryOrCreate\n  \nSo /etc/kubernetes/enc is mounted to pod path /etc/kubernetes/enc. Encryption resource file should be present at /etc/kubernetes/enc/enc.yaml at host.\nUpdating the kube-apiserver.yaml would restart the api server automatically and any further creation of secret should be encrypted.\nResources\n\nkubernetes.io/docs/tasks/administer-cluster/encrypt-data/\n"},"notes/tech/kubernetes/clusterip-service":{"title":"clusterip-service","links":[],"tags":["kubernetes"],"content":"ClusterIP Service\nThis service is required when we need communication among the pods running inside nodes in a cluster.\nPods get assign IP addresses which usually change during their life cycle. It is necessary to use some textual address or their name instead of IP. This is achieved using ClusterIP service.\nResource file for clusterIP service is shown below.\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-clusterip-service\nspec:\n  type: ClusterIP\n  ports:\n    - port: 80\n      targetPort: 80\n  selector:\n    type: router\nWith this, pod can be reached with service name nginx-clusterip-service."},"notes/tech/kubernetes/command-and-args":{"title":"command-and-args","links":[],"tags":["kubernetes"],"content":"Command and Args\nDocker container contains ENTRYPOINT and CMD which start when container starts. These can be modified in kubernetes in pod definition file.\ncommand is used to overwrite ENTRYPOINT and args for CMD.\nFor example, let’s say we have container with sleep as entrypoint and 10 as cmd. Below pod definition file shows how we can change it.\napiVersion: v1\nkind: Pod\nmetadata:\n    name: sleep\nspec:\n    containers:\n        - name: sleep\n          image: ubuntu\n          command: [&quot;echo&quot;]\n          args: [&quot;Hello world&quot;]\nNow echo Hello world will be run when the container starts."},"notes/tech/kubernetes/config-maps":{"title":"config-maps","links":[],"tags":["kubernetes"],"content":"ConfigMap\nConfigMap stores key value pair configurations.\nCreating ConfigMap\nA ConfigMap can be created using imperative command and in a declarative way using resource yaml file.\nUsing imperative command\nkubectl create configmap mysql-db --from-literal USER=user \\\n                                  --from-literal PASSWORD=password  \n\nWe can provide config data from file as well using --from-file option.\nUsing declarative approach\nmysql-db-cm.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n    name: mysql-db-cm\n    namespace: default\ndata:\n    USER: user\n    PASSWORD: password\nUsing this resource file we can create ConfigMap by running command,\nkubectl create -f mysql-db-cm.yaml\n\nUsing ConfigMap\nSimple use case of ConfigMap is to provide environment variables to a pod.\nUsing above ConfigMap definition file,\nmysql-pod.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n    name: mysql-db\n    labels:\n        type: db\nspec:\n    containers:\n        - name: mysql\n          image: mysql\n          envFrom:\n            - configMapRef:\n                name: mysql-db-cm        \nTo provide selected values from ConfigMap,\ncontainers:\n    - name: mysql\n      image: mysql\n      env:\n        - name: USER\n          valueFrom:\n              configMapKeyRef:\n                  name: mysql-db-cm\n                  key: USER\n    "},"notes/tech/kubernetes/deployment-strategy":{"title":"deployment-strategy","links":[],"tags":["kubernetes"],"content":"Deployment Strategy\nThere are two types of deployment strategy.\n\nRecreate\nRolling update\n\nRecreate strategy\nThis strategy involves deleting all the pods and then recreating new pods with the update. It has a downside of application downtime when the update is happening.\nRolling update\nThis strategy updates the pods one by one so that the application is still accessible for the users. This is the by default strategy used for deployment updates."},"notes/tech/kubernetes/deployment-upgrades":{"title":"deployment-upgrades","links":["notes/tech/kubernetes/deployments","notes/tech/kubernetes/replicaset"],"tags":["kubernetes"],"content":"Upgrades\nThis note describe how the deployments get updated with new changes.\nDeployment has replicasets under the hood. When a new update is rollout, deployment creates a new replicaset with new pods getting created and old pods from previous replicaset getting down. This can be seen by listing down replicasets using kubectl get replicasets.\nThis way, it enables us to rollback to previous state as and when required. We can do rollback as follows.\nkubectl rollout undo &lt;deployment&gt;\n"},"notes/tech/kubernetes/deployments":{"title":"deployments","links":["notes/tech/kubernetes/replicaset"],"tags":["kubernetes"],"content":"Deployments\nDeployment make sure that the pods are updated without hampering the access to the services. It makes the updates like rolling updates and rollbacks to previous version seamless as all the pods in deployments are not updated all at once. Updates happen one by one so that the application is accessible to the user.\nDeployment comes on top of Replicaset.\n\nThe definition file of deployment is same as replicaset with kind set to Deployment.\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: app-rs\n  labels:\n    type: router-rs\nspec:\n  template:\n    metadata:\n      name: router-pod\n      labels:\n        type: router\n    spec:\n      containers:\n        - name: nginx\n          image: nginx\n  replicas: 2\n  selector:\n    matchLabels:\n      type: router\nResources\n\nLearn Kubernetes in simple, easy and fun way with hands-on coding exercises. For beginners in DevOps. By Mumshad Mannambeth. Udemy.\n"},"notes/tech/kubernetes/imperative-commands":{"title":"imperative-commands","links":[],"tags":[],"content":"This document is as it is taken from Udemy course.\n\nImperative Commands\nWhile you would be working mostly the declarative way - using definition files, imperative commands can help in getting one-time tasks done quickly, as well as generate a definition template easily. This would help save a considerable amount of time during your exams.\nBefore we begin, familiarize yourself with the two options that can come in handy while working with the below commands:\n--dry-run: By default, as soon as the command is run, the resource will be created. If you simply want to test your command, use the --dry-run=client option. This will not create the resource. Instead, tell you whether the resource can be created and if your command is right.\n-o yaml: This will output the resource definition in YAML format on the screen.\nUse the above two in combination along with Linux output redirection to generate a resource definition file quickly, that you can then modify and create resources as required, instead of creating the files from scratch.\nkubectl run nginx --image=nginx --dry-run=client -o yaml &gt; nginx-pod.yaml\nPOD\nCreate an NGINX Pod\nkubectl run nginx --image=nginx\nGenerate POD Manifest YAML file (-o yaml). Don’t create it(—dry-run)\nkubectl run nginx --image=nginx --dry-run=client -o yaml\nDeployment\nCreate a deployment\nkubectl create deployment --image=nginx nginx\nGenerate Deployment YAML file (-o yaml). Don’t create it(—dry-run)\nkubectl create deployment --image=nginx nginx --dry-run -o yaml\nGenerate Deployment with 4 Replicas\nkubectl create deployment nginx --image=nginx --replicas=4\nYou can also scale deployment using the kubectl scale command.\nkubectl scale deployment nginx --replicas=4\nAnother way to do this is to save the YAML definition to a file and modify\nkubectl create deployment nginx —image=nginx--dry-run=client -o yaml &gt; nginx-deployment.yaml\nYou can then update the YAML file with the replicas or any other field before creating the deployment.\nService\nCreate a Service named redis-service of type ClusterIP to expose pod redis on port 6379\nkubectl expose pod redis --port=6379 --name redis-service --dry-run=client -o yaml\n(This will automatically use the pod’s labels as selectors)\nOr\nkubectl create service clusterip redis --tcp=6379:6379 --dry-run=client -o yaml (This will not use the pods’ labels as selectors; instead it will assume selectors as app=redis. You cannot pass in selectors as an option. So it does not work well if your pod has a different label set. So generate the file and modify the selectors before creating the service)\nCreate a Service named nginx of type NodePort to expose pod nginx’s port 80 on port 30080 on the nodes:\nkubectl expose pod nginx --port=80 --name nginx-service --type=NodePort --dry-run=client -o yaml\n(This will automatically use the pod’s labels as selectors, but you cannot specify the node port. You have to generate a definition file and then add the node port in manually before creating the service with the pod.)\nOr\nkubectl create service nodeport nginx --tcp=80:80 --node-port=30080 --dry-run=client -o yaml\n(This will not use the pods’ labels as selectors)\nBoth the above commands have their own challenges. While one of it cannot accept a selector the other cannot accept a node port. I would recommend going with the kubectl expose command. If you need to specify a node port, generate a definition file using the same command and manually input the nodeport before creating the service.\nReference:\nkubernetes.io/docs/reference/kubectl/conventions/"},"notes/tech/kubernetes/loadbalancer-service":{"title":"loadbalancer-service","links":["notes/tech/kubernetes/nodeport-service"],"tags":["kubernetes"],"content":"LoadBalancer Service\nThis service is useful when there are multiple pods of same application running and the load has to be distributed among all the pods. It provides a single endpoint to access the pods and forwarding of the request to available pod gets taken care of by this service.\nLoadbalancer service can be used only when the cluster where kubernetes is setup, support it natively. Otherwise, it acts same as NodePort service.\nResource yaml file for loadbalancer service is shown below.\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-loadbalancer-service\nspec:\n  type: LoadBalancer\n  ports:\n    - port: 80\n      targetPort: 80\n      nodePort: 30008\n  selector:\n    type: router"},"notes/tech/kubernetes/master-vs-worker-nodes":{"title":"master-vs-worker-nodes","links":[],"tags":["kubernetes","distributed-computing"],"content":"Master Vs Worker nodes\nMaster nodes has following components:\n\nkube-apiserver: it talks to kubelet on worker nodes to manage them.\netcd: it is key-value pair storage which stores nodes information and other information.\ncontroller: controls the creation and destruction of containers.\nscheduler\n\nWorker nodes has following components:\n\nkubelet: gives the health information about the worker nodes.\nContainer runtime: software responsible for running the containers. For example docker, rkt and CRI-O.\n"},"notes/tech/kubernetes/namespace":{"title":"namespace","links":["notes/tech/kubernetes/resource-quota","notes/tech/kubernetes/services"],"tags":["kubernetes"],"content":"Namespace\nA namespace is a mechanism to isolate a group of resources in kubernetes. It defines resource quotas, policies etc that apply on the pods and other resources being created in that namespace.\nKubernetes has its own namespace for its internal services. We can create custom namespaces for our applications.\nDNS\nServices in a same namespace can be accessed using their names. For example, service redis can be accessed by its name. However, services in different namespaces require namespace to be appended with service name. For example,\nWe have two namespaces default and dev. There is a service in dev named mysql-db. To access it in a pod running in default namespace, we require to use mysql-db.dev.svc.cluster.local as service name.\nWhere mysql-db is service name. dev is namespace. svc for service and cluster.local is the domain used by kubernetes.\nCreate namespace\nNamespace can be created using resource yaml file or just a command.\napiVersion: v1\nkind: Namespace\nmetadata:\n    name: dev\nOr using command kubectl create namespace dev.\nChange Default Namespace\nWe need to set namespace in the kubernetes context.\nWe can use following command to do so.\nkubectl config set-context &lt;context&gt; --namespace dev\n\nWe can get context using command kubectl config current-context."},"notes/tech/kubernetes/nodeport-service":{"title":"nodeport-service","links":[],"tags":["kubernetes"],"content":"NodePort service\nNodePort service enables the external access to pod running inside the node.\nLet’s say we have nginx pod running inside a single node cluster and we want to access it, we would need to ssh inside the node and then do the curl. If we want to curl without sshing into the node, we would a service.\nHow it works?\nService with NodePort type takes the request coming to a specified node port and then forwards the request to the particular pod.\ncurl http://node-ip:node-port\n        |\n        |\n        v\n    node-port\n        |\n        |\n        v\n      service\n        |\n        |\n        v\n       pod\n\nResource file of a service can be as shown below.\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-service\n  labels:\n    type: router-service\nspec:\n  type: NodePort\n  ports:\n    - port: 80\n      targetPort: 80\n      nodePort: 30008\n  selector:\n    type: router\nWhere port is the port on the service, targetPort is the pod port and nodePort is node port where the external request will come.\nIt matches the pod to map to using selector/labels.\n\n\n                  \n                  Info\n                  \n                \n\nWe can only use nodePort in range 30000 - 32767\n\n"},"notes/tech/kubernetes/replicaset":{"title":"replicaset","links":["notes/tech/kubernetes/replication-controller"],"tags":["kubernetes"],"content":"ReplicaSet\nReplicaset is same as ReplicationController and came after it. The only different is the spec.selector section and it recreates the already existing pods if they get terminated. In other words, replicaset makes sure the specified number of pods matching by the selector are running.\nFollowing shows the resource yml for replicaset.\napiVersion: apps/v1\nkind: ReplicaSet\nmetadata:\n  name: app-rs\n  labels:\n    type: router-rs\nspec:\n  template:\n    metadata:\n      name: router-pod\n      labels:\n        type: router\n    spec:\n      containers:\n        - name: nginx\n          image: nginx\n  replicas: 2\n  selector:\n    matchLabels:\n      type: router\nIt will make sure that the 2 pods of type router are running.\nReplicaset can be created using command,\nkubectl create -f replicaset-def.yml\n\nIt can be scaled up/down by changing replicas value in yml file and running the command,\nkubectl apply -f replicaset-def.yml\n\n# or\n\nkubectl replace -f replicaset-def.yml\n\nAnother way to scale up/down by using the commands,\nkubectl scale --replicas=4 -f replicaset-def.yml\n\n# or\n\nkubectl scale --replicas=4 -f app-rs\n\nWhere app-rs is the name of the replicaset."},"notes/tech/kubernetes/replication-controller":{"title":"replication-controller","links":["notes/tech/kubernetes/replicaset"],"tags":["kubernetes"],"content":"Replication Controller\nThis is the old technology used in kubernetes that is replaced with Replica Set. It is used to make sure that specified number of pods are running for an application. If any pods get terminated because of some reason, replication controller restarts them.\nThe resource yml file for replication controller is as follows.\napiVersion: v1\nkind: ReplicationController\nmetadata:\n  name: myapp-rc\n  labels:\n    type: frontend-rc\n    name: myapp\n    \nspec:\n  template:\n    metadata:\n      name: nginx\n      labels:\n        type: router\n        name: nginx-router\n    spec:\n      containers:\n        - name: nginx\n          image: nginx\n  replicas: 2\ntemplate contains the pod specifications. replicas specifies the number of replications of the pod."},"notes/tech/kubernetes/resource-quota":{"title":"resource-quota","links":[],"tags":["kubernetes"],"content":"Resource Quota\nResource Quota is used to limit resources in a namespace. It can be defined used resource yaml file.\napiVersion: v1\nkind: ResourceQuota\nmetadata:\n    name: compute-resources\n    namespace: dev\nspec:\n    hard:\n        pods: &quot;10&quot;\n        requests.cpu: &quot;2&quot;\n        requests.memory: 2Gi\n        limits.cpu: &quot;2&quot;\n        limits.memory: 10Gi\nWe need to specify resources in pod definition file if some resource quota is present in a namespace and is being use by pod. To do that we can add resources section in containers pod resource file.\ncontainers:\n    - name: nginx\n      image: nginx\n      envFrom:\n        - configMapRef:\n            name: mysql-db-env\n      resources:\n        requests:\n          cpu: 1\n          memory: 2Gi\n        limits:\n          memory: 4Gi\n          cpu: 2"},"notes/tech/kubernetes/rollout":{"title":"rollout","links":["notes/tech/kubernetes/deployments"],"tags":["kubernetes","versioning"],"content":"Rollout\nWhen new version of software is deployed is deployment that’s called rollout. Each rollout gives new Revision.\nkubectl rollout status &lt;deployment&gt;\n\nAbove command gives the status of replicas getting updated in rollout.\nTo see the history of revisions we can use command,\nkubectl rollout history &lt;deployment&gt;\n"},"notes/tech/kubernetes/secrets":{"title":"secrets","links":["notes/tech/kubernetes/config-maps"],"tags":["kubernetes"],"content":"Secrets\nSecrets are similar to ConfigMaps which stores confidential data. These are used to pass passwords, keys, etc to the pods.\nCreate Secrets\nSecrets can be created using imperative (command) and using resource yam file.\nImperative way to create secrets\nkubectl create secret &lt;secret-type&gt; &lt;secret-name&gt; --from-literal &lt;key&gt;=&lt;value&gt;\n\nThis way does not require to encode the values in base64.\nkubectl create secret generic test-secret --from-literal password=password\n\nDeclarative way\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mysql-db-secret\ndata:\n  USER: dXNlcg==\n  PASSWORD: dXNlcg==\nThis requires to encode the value in base64, otherwise it will throw error.\nUsing secrets\nTo use secrets in a pod, we can do this following way.\nSnippet of pod-def.yaml\ncontainers:\n    - name: nginx\n      image: nginx\n      envFrom:\n        - secretRef:\n            name: mysql-db-secret\nWhen secret is being used in container, those are decoded by kubernetes itself.\n\n\n                  \n                  Note\n                  \n                \n\nSecrets are not encrypted and can be accessed by anyone who as access to the cluster and the namespace. It is better to try third party secret storage.\n\n"},"notes/tech/kubernetes/security-contexts":{"title":"security-contexts","links":[],"tags":["kubernetes","docker"],"content":"Security Contexts\nFor some background, containers share the host kernel but they run in their namespace managed by docker. Containers can have same user as host and they have root users also. If containers have root users, is not it dangerous for host? It is not, as only few capabilities are given to root users of containers.\n\n\n                  \n                  Capabilities \n                  \n                \n\nThese are the privileges or access level provided to root user. For example, KILL, CHOWN, MAC_ADMIN etc. We can find all these capabilities at location /usr/include/linux/capability.h\n\n\nSecurity Context is used to define the user for pods and containers and capabilities for containers.\napiVersion: v1\nkind: Pod\nmetadata:\n    name: nginx\nspec:\n    securityContext:\n        runAsUser: 1001\n    containers:\n        - name: nginx\n          image: nginx\nsecurityContext is set at pod level. It will apply to all the containers inside the pod, unless we defined securityContext for containers explicitly. For example,\napiVersion: v1\nkind: Pod\nmetadata:\n    name: nginx\nspec:\n    securityContext:\n        runAsUser: 1001\n    containers:\n        - name: nginx\n          image: nginx\n          securityContext:\n              runAsUser: 1002\nCapabilities can only be provided to container.\napiVersion: v1\nkind: Pod\nmetadata:\n    name: nginx\nspec:\n    containers:\n        - name: nginx\n          image: nginx\n          securityContext:\n              capabilities:\n                  add: \n                      - SYS_TIME\n                      - NET_ADMIN"},"notes/tech/kubernetes/services":{"title":"services","links":["notes/tech/kubernetes/nodeport-service","notes/tech/kubernetes/clusterip-service","notes/tech/kubernetes/loadbalancer-service"],"tags":["kubernetes"],"content":"Services\nA service is a kubernetes resource which provides external access to pods running in nodes and communication among the nodes.\nThere are three types of services\n\nNodePort service\nClusterIP service\nLoadbalancer service\n"},"notes/tech/kubernetes/useful-commands":{"title":"useful-commands","links":[],"tags":["kubernetes"],"content":"Useful Kubernetes commands\n\n\n\n\n\n\n\n\n\n\n\n\n\nCommandDescriptionkubectl edit pod &lt;podname&gt;Opens up the yml file of the pod to edit."},"notes/tech/kubernetes/yml-file":{"title":"yml-file","links":[],"tags":["kubernetes","distributed-computing"],"content":"YML File\nYML file is used to define any object in kubernetes. It has following basic and mandatory fields.\napiVersion: v1\nkind: Pod\nmetadata:\n    name: mypod\n    labels:\n        type: frontend\n        \nspec:\n    containers:\n        - name: nginx-container\n          image: nginx\napiVersion tells which api version to use for a particular resource. Following table shows api version for different kind of resources.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nKindVersionPodv1Servicev1Deploymentapps/v1ReplicaSetapps/v1\nmetadata contains information about the resource which consists of keys like name and labels. labels can have any key value pairs. labels help distinguish resources.\nspeccontainers specifications for the resources and it will be different for different kind. In this case of Pod, it has containers."},"notes/tech/linux/accessing-usb-drives":{"title":"accessing-usb-drives","links":[],"tags":["linux","terminal","cli","storage"],"content":"List the drives using command,\n\nlsblk - list block devices which lists all the block devices available in the system.\nblkid - list and print block devices attributes\nfdisk - deals file disk partitions and manages them.\nudiskctl\n\nMount and Unmount\n\nMounting is used to mount the external storage device to the local file system. It makes external storage devices accessible within the system.\n\nmount /dev/sda /storage/ultafit\n\n\n\nSyntax - mount device directory\n\n\nUnmounting remove the external storage mount from the directory and the external storage no longer be accessed inside the file system.\n\n\numount /storage/ultafit\n"},"notes/tech/linux/automount-drives":{"title":"automount-drives","links":[],"tags":["storage","linux"],"content":"Auto mount USB drives\nThis can be done by fstab (filesystem table) system file. It can be found at /etc/fstab. It has all the drive information to mount on boot.\nWe can append our usb drive information to this file.\nPARTUUID=494aac82-01 /home/nitin-remote/storage/hp auto defaults,nofail,uid=nitin-remote,gid=nitin-remote,x-systemd.automount 0 2\n\n\n\nWe can provide usb drive path using /dev/sda etc but to play safe and ignoring where we insert the usb into which port, they have a UUID that we can use to identify them.\n\n\nauto flag is tell auto mount.\n\n\nReferences\n\nwww.baeldung.com/linux/automount-usb-device\nwww.redhat.com/sysadmin/etc-fstab\n\n"},"notes/tech/linux/resources":{"title":"resources","links":[],"tags":["linux","resources"],"content":"\nwww.actualtechmedia.com/wp-content/uploads/2017/12/CUMULUS-NETWORKS-Linux101.pdf\n"},"notes/tech/matplotlib/dump":{"title":"dump","links":[],"tags":["misc"],"content":"plt.imshow(\n    output,\n    cmap=&quot;gray&quot;,\n    extent=[np.min(x), np.max(x), np.min(y), np.max(y)]\n)"},"notes/tech/numpy/array-interface":{"title":"array-interface","links":[],"tags":["memory","python","implementation"],"content":"Array Interface\nContains information about array buffers, data types and other details for interoperability for array like python objects.\nx = np.array([[1, 2], [3, 4]])\nx.__array_interface__ \n \n# {&#039;data&#039;: (105553174888512, False),\n#&#039;strides&#039;: None,\n#&#039;descr&#039;: [(&#039;&#039;, &#039;&lt;i8&#039;)],\n#&#039;typestr&#039;: &#039;&lt;i8&#039;,\n#&#039;shape&#039;: (2, 2),\n#&#039;version&#039;: 3}\nImage library from pillow provides array interface to make it interoperable with numpy arrays.\nfrom PIL import Image\nimg = Image.open(&#039;data/test.png&#039;)\nimg.__array_interface__\n \nx = np.asarray(img)\nx.shape"},"notes/tech/numpy/broadcasting":{"title":"broadcasting","links":[],"tags":["python","libraries"],"content":"Broadcasting\nBroadcasting is the process of transforming arrays into same size (shape) to carry out operations like addition, and other operations.\n\nUsed in arithmetic operations in numpy arrays.\nProvides a means of vectorizing array operations so that the looping happens inside C instead of python.\nApplying arithmetic operations on arrays with different shapes and dimensions, the smaller one has to be stretched to make compatible with larger one.\n\nBroadcasting rules\n\nCompatibility checks starts from right to left.\nTwo dimensions are compatible only when\n\nboth are same\neither one of them is 1\n\n\n\ndims1 = (1,)\ndims2 = (1,)\nBOTH ARE COMPATIBLE\n------------\n\ndims1 = (1,2)\ndims2 = (1,1)\nBOTH ARE COMPATIBLE as there is 1 in last dimension\n------------\n\ndims1 = (1,2)\ndims2 = (1,3)\nNOT COMPATIBLE as dimensions differ and one of them is not 1\n------------\n\ndims1 = (4, 1)\ndims2 = (3,)\nBOTH ARE COMPATIBLE\nas\n       4 x 1\n       1 x 3\nresult 4 x 3\n\n\nitems = np.arange(10).reshape((2, 5))\nitems.shape # (2, 5)\n \nmul = np.array([2, 3](2,%203))\nmul.shape # (2, 2)\n \nitems * mul\n# ValueError: operands could not be broadcast together with shapes (2,5) (2,2)\nReferences\n\nlectures.scientific-python.org/intro/numpy/operations.html#broadcasting\n"},"notes/tech/numpy/comparisons":{"title":"comparisons","links":[],"tags":["libraries","python"],"content":"Comparisons\nComparisons can be elementwise or arraywise.\nElementwise comparisons\na = np.arange(5)\nb = np.array([5, 1, 9, 6, 4])\n \na &lt; b\n# array([ True, False,  True,  True, False])\n \na == b\n# array([False,  True, False, False,  True])\nArraywise comparisons\nComparisons on the arrays instead of individual elements. Methods such as np.array_equal, np.array_equiv etc are used for arraywise comparisons.\nnp.array_equal(a, b)\n# False\nnp.array_equal checks if two arrays have same shape and elements."},"notes/tech/numpy/datatype-sizes":{"title":"datatype-sizes","links":[],"tags":["data","python","libraries"],"content":"Datatype sizes\nIntegers\n\nint8\nint16\nint32 (int for 32bits)\nint64 (int for 64bits)\nuint8\nuint16\nuint32\nuint64\n\nnp.array([2**32], dtype=np.int32).dtype\n# shows deprecation warning because of out-of-bound integer\n# conversion to smaller data size\nWe can check the size of numpy integer datatype using method np.iinfo.\nnp.iinfo(np.int32)\n# iinfo(min=-2147483648, max=2147483647, dtype=int32)\nFloats\nTo check the size of float integers, we can use method np.finfo.\nnp.finfo(np.float64)\n# finfo(resolution=1e-15, min=-1.7976931348623157e+308, max=1.7976931348623157e+308, dtype=float64)\nAvailable floats,\n\nfloat16\nfloat32\nfloat64\nfloat96 platform dependent (or np.longdouble)\nfloat128 platform dependent (or np.longdouble)\n\nnp.finfo(np.float32).eps\n# 1.1920929e-07\n\n\n                  \n                  Note\n                  \n                \n\neps is machine epsilon which defines round off error for float numbers.\n\n\nComplex numbers\n\ncomplex64 two 32 bits floats\ncomplex128 two 64 bits floats\ncomplex192 two 96 bits floats, platform depedent\ncomplex256 two 128 bits floats, platform depedent\n\nReferences\n\nlectures.scientific-python.org/intro/numpy/elaborate_arrays.html#different-data-type-sizes\n"},"notes/tech/numpy/datatypes":{"title":"datatypes","links":[],"tags":["libraries","python"],"content":"Datatypes\nFollowing are the available datatypes in numpy.\n\nint32, int64, uint32, uint64\nfloat64 (default)\ncomplex128\nbool\nstrings are typed by taking the maximum length string in the array.\n\nf = np.array([&quot;abc&quot;, &quot;ab&quot;, &quot;a&quot;])\nf.dtype\n# dtype(&#039;&lt;U3&#039;)\nSo, dtype says string type with 3 max characters."},"notes/tech/numpy/fancy-indexing":{"title":"fancy-indexing","links":["notes/tech/numpy/view"],"tags":["libraries","python"],"content":"Fancy Indexing\nArrays created using fancy indexing such as boolean masks or integer arrays, are copies of the original array, not the views.\nUsing Masks\na = np.arange(10)\nsub_array = a[a%2 == 0]\n# array([0, 2, 4, 6, 8])\nsub_array doesn’t share the same memory buffer with array a.\nUsing array of Integers\nIndexing by providing an array of integers returns the array in the same shape of the given array of integers.\nindexes = np.array([[1, 5],\n                    [6, 7]])\na[indexes]\n# array([[1, 5],\n#      [6, 7]])\nResults are always copy of the original arrays.\nAssigning new values\nNew values can be assigned using these methods.\n \na[a%2 == 0] = -1\n# assigns -1 to all the item divisible by 2\n \na[indexes] = -1\n# assigns -1 to all given indexes.\nReferences\n\nlectures.scientific-python.org/intro/numpy/array_object.html#fancy-indexing\n"},"notes/tech/numpy/flatting":{"title":"flatting","links":[],"tags":["python","libraries"],"content":"Flatting\nnp.ravel method is used for flatting arrays. Flatting starts from last dimension. For example, array of shape (2, 3, 4) will start with dimension 4 then move to next last and so on.\na = np.array([1, 2, 3](1,%202,%203))\na.ravel()\n# array([1, 2, 3, 4, 5, 6])\n\n\n                  \n                  Note\n                  \n                \n\nIt returns view of the original array.\n\n"},"notes/tech/numpy/indexing":{"title":"indexing","links":[],"tags":["libraries","python"],"content":"Indexing on ndarrays\n\nThree types of indexing\n\nbasic\nadvanced\nfield\n\n\n\n"},"notes/tech/numpy/internal-organization":{"title":"internal-organization","links":["notes/tech/numpy/view"],"tags":["python","libraries"],"content":"Internal Organization\nNumpy arrays are organized using a set of two parts.\n\nMetadata\nRaw array data (or data buffer)\n\nMetadata is the information about the data buffer. It has information about shape, size, data type etc. A numpy array object is the metadata which points to the data buffer.\nAny operations on the data buffer results in making new metadata object which points to the same data buffer. This is usually called view of the original array (data buffer). This way, same data buffer can be used for different representation.\nHowever, some numpy operation may return new copy of the data buffer.\nReferences\n\nnumpy.org/doc/stable/dev/internals.html\n\n"},"notes/tech/numpy/interoperability":{"title":"interoperability","links":["notes/tech/numpy/old-buffer-protocol","notes/tech/numpy/array-interface"],"tags":["python","libraries"],"content":"Interoperability\nInteroperability defines how well numpy integrates with other libraries. To accomplish this, there are solutions like old buffer protocol and array interface.\nReferences\n\nlectures.scientific-python.org/advanced/advanced_numpy/index.html#interoperability-features\n"},"notes/tech/numpy/interp":{"title":"interp","links":[],"tags":["python","libraries"],"content":"np.interp\nThis method interpolate or determines the value of position for a given function.\nFunction here means two arrays data points of equal length. np.interp is then determines the corresponding value of given position with respect to the function (two arrays).\nx = np.array([1, 2, 3, 4])\ny = np.array([1, 2, 3, 4])\n \nnp.interp(0, x, y)\n# 1.0\n# obiuously \n \n# calculating 100 points between x min and max\nx_interp = np.linspace(x.min(), x.max(), 100)\n \ny_interp = np.interp(x_interp, x, y)\n \n# y_interp will be values corresponding to x_interp value with respect to function x, y"},"notes/tech/numpy/masked-arrays":{"title":"masked-arrays","links":[],"tags":["data","libraries","python"],"content":"Masked Arrays\nMasked arrays are arrays with invalid or missing values. Numpy has numpy.ma module dedicated to masked arrays.\nnp.ma.array([1, 2, 3, 4], mask=[0, 1, 0, 1])\n# masked_array(data=[1, --, 3, --],\n#            mask=[False,  True, False,  True],\n#      fill_value=999999)\nReferences\n\nlectures.scientific-python.org/intro/numpy/elaborate_arrays.html#maskedarray-dealing-with-propagation-of-missing-data\n"},"notes/tech/numpy/meshgrid":{"title":"meshgrid","links":["notes/tech/numpy/notebook/grids-in-numpy"],"tags":["python","data","libraries","graph"],"content":"Meshgrid\nNumpy meshgrid creates grid matrices from the input arrays. These matrices are also called coordinate matrices.\n\n\n\n\n\n\n\n\n\n\n\nfigure: From microsoft excel. Showing good example of meshgrid.\na = np.arange(5)\nX, Y = np.meshgrid(a, a)\nX\n \narray([[0, 1, 2, 3, 4],\n       [0, 1, 2, 3, 4],\n       [0, 1, 2, 3, 4],\n       [0, 1, 2, 3, 4],\n       [0, 1, 2, 3, 4]])\n \nY\narray([[0, 0, 0, 0, 0],\n       [1, 1, 1, 1, 1],\n       [2, 2, 2, 2, 2],\n       [3, 3, 3, 3, 3],\n       [4, 4, 4, 4, 4]])\nThese matrices allow to make all the possible combinations for the input arrays elements. We can do this by placing these x and y matrices on top one another.\nfor i in a:\n   for j in a:\n       print((X[i,j], Y[i,j]))\n \n \n(0, 0)\n(1, 0)\n(2, 0)\n(3, 0)\n(4, 0)\n(0, 1)\n(1, 1)\n(2, 1)\n(3, 1)\n(4, 1)\n(0, 2)\n(1, 2)\n(2, 2)\n(3, 2)\n(4, 2)\n(0, 3)\n(1, 3)\n(2, 3)\n(3, 3)\n(4, 3)\n(0, 4)\n(1, 4)\n(2, 4)\n(3, 4)\n(4, 4)\n\n\n                  \n                  Note\n                  \n                \n\nUsing Uppercase variable name for output return from meshgrid is usually a preferred, given using small case in python conventions.\n\n\nBy default np.meshgrid uses Cartesian system for indexing (xy system). This can be changed to matrix indexing ij .\nnp.meshgrid([1, 2], [4, 5])\n[array([[1, 2],\n        [1, 2]]),\n array([[4, 4],\n        [5, 5]])]\n \n \nnp.meshgrid([1, 2], [4, 5], indexing=&quot;ij&quot;)\n[array([[1, 1],\n        [2, 2]]),\n array([[4, 5],\n        [4, 5]])]\nApplications for Meshgrid\n\nMeshgrid is used to create coordinate matrices to model a grid.\nModel 2D mathematical functions.\netc.\n\nRefer notebook.\nReferences\n\nwww.udacity.com/blog/2021/10/numpy-np-meshgrid-tutorial-for-beginners.html\nthepythoncodingbook.com/2022/05/28/numpy-meshgrid\n"},"notes/tech/numpy/mgrid":{"title":"mgrid","links":["notes/tech/numpy/meshgrid"],"tags":["python","libraries","data"],"content":"numpy.mgrid\nnumpy.mgridcan be used to create meshgrid by using slices.\nnp.mgrid[0:5, 0:5]\n \narray([[[0, 0, 0, 0, 0],\n        [1, 1, 1, 1, 1],\n        [2, 2, 2, 2, 2],\n        [3, 3, 3, 3, 3],\n        [4, 4, 4, 4, 4]],\n \n       [[0, 1, 2, 3, 4],\n        [0, 1, 2, 3, 4],\n        [0, 1, 2, 3, 4],\n        [0, 1, 2, 3, 4],\n        [0, 1, 2, 3, 4]]])\n        \nThis is equivalent to,\nnp.meshgrid(np.arange(5), np.arange(5), indexing=&quot;ij&quot;)\n \n[array([[0, 0, 0, 0, 0],\n        [1, 1, 1, 1, 1],\n        [2, 2, 2, 2, 2],\n        [3, 3, 3, 3, 3],\n        [4, 4, 4, 4, 4]]),\n array([[0, 1, 2, 3, 4],\n        [0, 1, 2, 3, 4],\n        [0, 1, 2, 3, 4],\n        [0, 1, 2, 3, 4],\n        [0, 1, 2, 3, 4]])]\nnp.mgrid uses matrix indexing system.\nWe can provide steps to np.mgrid as it is working with slices.\nnp.mgrid[0:5:2, 0:5:2]\n \narray([[[0, 0, 0],\n        [2, 2, 2],\n        [4, 4, 4]],\n \n       [[0, 2, 4],\n        [0, 2, 4],\n        [0, 2, 4]]])\nThis is equivalent to,\nnp.meshgrid(np.arange(0, 5, 2), np.arange(0, 5, 2), indexing=&quot;ij&quot;)\n \n[array([[0, 0, 0],\n        [2, 2, 2],\n        [4, 4, 4]]),\n array([[0, 2, 4],\n        [0, 2, 4],\n        [0, 2, 4]])]\nBy providing complex number step to the slice, we can mimic np.linspace method.\nnp.mgrid[0:5:4j, 0:5:4j]\n \narray([[[0.        , 0.        , 0.        , 0.        ],\n        [1.66666667, 1.66666667, 1.66666667, 1.66666667],\n        [3.33333333, 3.33333333, 3.33333333, 3.33333333],\n        [5.        , 5.        , 5.        , 5.        ]],\n \n       [[0.        , 1.66666667, 3.33333333, 5.        ],\n        [0.        , 1.66666667, 3.33333333, 5.        ],\n        [0.        , 1.66666667, 3.33333333, 5.        ],\n        [0.        , 1.66666667, 3.33333333, 5.        ]]])\nWhich again can be done with np.meshgrid.\nnp.meshgrid(np.linspace(0, 5, 4), np.linspace(0, 5, 4), indexing=&quot;ij&quot;)\n \n[array([[0.        , 0.        , 0.        , 0.        ],\n        [1.66666667, 1.66666667, 1.66666667, 1.66666667],\n        [3.33333333, 3.33333333, 3.33333333, 3.33333333],\n        [5.        , 5.        , 5.        , 5.        ]]),\n array([[0.        , 1.66666667, 3.33333333, 5.        ],\n        [0.        , 1.66666667, 3.33333333, 5.        ],\n        [0.        , 1.66666667, 3.33333333, 5.        ],\n        [0.        , 1.66666667, 3.33333333, 5.        ]])]"},"notes/tech/numpy/ndarray-block-of-memory":{"title":"ndarray-block-of-memory","links":["notes/tech/numpy/view","notes/tech/numpy/array-interface"],"tags":["libraries","python","design"],"content":"Block of memory\nNumpy array consists of raw data and mechanism to access data. Numpy arrays are stored in continuous memory locations and views of array shares the same memory locations.\nWe can access those meta information using np.array_interface.\na = np.arange(10)\n \na.__array_interface__\n# {&#039;data&#039;: (105553130113056, False),\n#&#039;strides&#039;: None,\n#&#039;descr&#039;: [(&#039;&#039;, &#039;&lt;i8&#039;)],\n#&#039;typestr&#039;: &#039;&lt;i8&#039;,\n#&#039;shape&#039;: (10,),\n#&#039;version&#039;: 3}\nIt has memory location, datatype description and other meta information.\nndarray from other memory\nWe can create ndarray using a buffer doesn’t own by numpy.\na = b&#039;abc&#039;\n \nb = np.frombuffer(a, dtype=np.int8)\n# array([97, 98, 99], dtype=int8)\nb uses a as source of data and b contains ascii values of abc.\nb.flags\n \n# C_CONTIGUOUS : True\n# F_CONTIGUOUS : True\n# OWNDATA : False\n# WRITEABLE : False\n# ALIGNED : True\n# WRITEBACKIFCOPY : False\nb is only readable and it doesn’t own the data.\nReferences\n\nlectures.scientific-python.org/advanced/advanced_numpy/index.html#block-of-memory\n"},"notes/tech/numpy/newaxis":{"title":"newaxis","links":[],"tags":["python","libraries"],"content":"np.newaxis\nAdds new dimension to the array.\na = np.array([1, 2])\n \na[np.newaxis].shape\n# (1, 2)\nThe same can be done using None. None and np.newaxis are same."},"notes/tech/numpy/notebook/grids-in-numpy":{"title":"grids-in-numpy","links":[],"tags":[],"content":"Grids in numpy\nimport numpy as np\nimport matplotlib.pyplot as plt\n%matplotlib inline\na = np.array([3, 1, 2, 5, 6, 7])\nb = np.array(a[::-1])\nx, y = np.meshgrid(a, b)\nx, y\n(array([[3, 1, 2, 5, 6, 7],\n        [3, 1, 2, 5, 6, 7],\n        [3, 1, 2, 5, 6, 7],\n        [3, 1, 2, 5, 6, 7],\n        [3, 1, 2, 5, 6, 7],\n        [3, 1, 2, 5, 6, 7]]),\n array([[7, 7, 7, 7, 7, 7],\n        [6, 6, 6, 6, 6, 6],\n        [5, 5, 5, 5, 5, 5],\n        [2, 2, 2, 2, 2, 2],\n        [1, 1, 1, 1, 1, 1],\n        [3, 3, 3, 3, 3, 3]]))\n\nplt.plot(x, y, marker=&#039;.&#039;, color=&#039;k&#039;, linestyle=&#039;none&#039;)\nplt.xticks(a)\nplt.yticks(a)\nplt.show()\n\nRemarks\n\nUsing meshgrid, we can create coordinate metrices x, y.\nMeshgrid allows to make all possible combinations for given arrays elements.\n\nPlotting two dimension functions\nSine function\ndef sin(x, y):\n    return np.sin(x) + np.sin(y)\nz = sin(x, y)\nz\narray([[ 0.79810661,  1.49845758,  1.56628403, -0.30193768,  0.3775711 ,\n         1.3139732 ],\n       [-0.13829549,  0.56205549,  0.62988193, -1.23833977, -0.558831  ,\n         0.3775711 ],\n       [-0.81780427, -0.11745329, -0.04962685, -1.91784855, -1.23833977,\n        -0.30193768],\n       [ 1.05041743,  1.75076841,  1.81859485, -0.04962685,  0.62988193,\n         1.56628403],\n       [ 0.98259099,  1.68294197,  1.75076841, -0.11745329,  0.56205549,\n         1.49845758],\n       [ 0.28224002,  0.98259099,  1.05041743, -0.81780427, -0.13829549,\n         0.79810661]])\n\nplt.figure(figsize=(8, 6))\nplt.imshow(z, origin=&#039;lower&#039;)\nplt.colorbar()\nplt.locator_params(axis=&#039;y&#039;, nbins=4)\nplt.locator_params(axis=&#039;x&#039;, nbins=4)\nplt.show()\n\nseq = np.linspace(-10, 10, 100)\nx, y = np.meshgrid(seq, seq)\nz = sin(x, y)\nplt.figure(figsize=(8, 6))\nplt.imshow(z)\nplt.colorbar()\nplt.locator_params(axis=&#039;x&#039;, nbins=4)\nplt.locator_params(axis=&#039;y&#039;, nbins=4)\nplt.show()\n\nAnother function\nz = x ** 2 + (y - x) * 2\nplt.imshow(z)\nplt.colorbar()\nplt.locator_params(&#039;x&#039;, nbins=4)\nplt.locator_params(&#039;y&#039;, nbins=4)\nplt.show()\n\nPlotting 3D functions\nfrom mpl_toolkits.mplot3d import Axes3D\nfig = plt.figure(figsize=(8, 4))\nax = fig.add_subplot(projection=&quot;3d&quot;)\n \nax.plot_surface(x, y, z)\nplt.show()\n\nApproaching same problem without meshgrid\nx2 = np.linspace(-10, 10, 100)[np.newaxis]\ny2 = np.linspace(-10, 10, 100)[:, np.newaxis]\nz2 = x ** 2 + (y - x) * 2\nplt.imshow(z)\nplt.colorbar()\nplt.locator_params(&#039;x&#039;, nbins=4)\nplt.locator_params(&#039;y&#039;, nbins=4)\nplt.show()\n\nRemarks\n\nThis approach is more memory efficient than using meshgrid because it has very less elements that meshgrid.\n\nWhat about performance?\nseq = np.linspace(-10, 10, 10000)\nx, y = np.meshgrid(seq, seq)\n \n%time x ** 2 + (y - x) * 2\nCPU times: user 664 ms, sys: 421 ms, total: 1.09 s\nWall time: 1.09 s\n\n\n\n\n\narray([[100.       ,  99.9559996,  99.9120072, ...,  59.9280088,\n         59.9640004,  60.       ],\n       [100.0040004,  99.96     ,  99.9160076, ...,  59.9320092,\n         59.9680008,  60.0040004],\n       [100.0080008,  99.9640004,  99.920008 , ...,  59.9360096,\n         59.9720012,  60.0080008],\n       ...,\n       [139.9919992, 139.9479988, 139.9040064, ...,  99.920008 ,\n         99.9559996,  99.9919992],\n       [139.9959996, 139.9519992, 139.9080068, ...,  99.9240084,\n         99.96     ,  99.9959996],\n       [140.       , 139.9559996, 139.9120072, ...,  99.9280088,\n         99.9640004, 100.       ]])\n\nx2 = np.array([seq])\ny2 = x2.T\n \n%time x2 ** 2 + (y2 - x2) * 2\nCPU times: user 442 ms, sys: 382 ms, total: 824 ms\nWall time: 847 ms\n\n\n\n\n\narray([[100.       ,  99.9559996,  99.9120072, ...,  59.9280088,\n         59.9640004,  60.       ],\n       [100.0040004,  99.96     ,  99.9160076, ...,  59.9320092,\n         59.9680008,  60.0040004],\n       [100.0080008,  99.9640004,  99.920008 , ...,  59.9360096,\n         59.9720012,  60.0080008],\n       ...,\n       [139.9919992, 139.9479988, 139.9040064, ...,  99.920008 ,\n         99.9559996,  99.9919992],\n       [139.9959996, 139.9519992, 139.9080068, ...,  99.9240084,\n         99.96     ,  99.9959996],\n       [140.       , 139.9559996, 139.9120072, ...,  99.9280088,\n         99.9640004, 100.       ]])\n\nRemarks\nPerformance is better than the meshgrid"},"notes/tech/numpy/notebook/numpy.polynomials":{"title":"numpy.polynomials","links":[],"tags":[],"content":"Goal\nUnderstanding polynomials handling methods of numpy.\nIncludes\n\npoly1d\npolyval\npolyfit\n\nimport numpy as np\npoly1d\nCreates a polynomial\nCreating polynomial\n# Creating polynomial of order 1\n# 2x + 1\npol = np.poly1d([2, 1])\nprint(pol)\n2 x + 1\n\n# Creating a polynomal of order 2\n# 2x^2 + 3x + 4\npol = np.poly1d([2, 3, 4])\nprint(pol)\n   2\n2 x + 3 x + 4\n\nEvaluation\n# Evaluating pol with x = 2\nprint(pol)\nprint(pol(2))\nprint(pol([2, 3, 4]))\n   2\n2 x + 3 x + 4\n18\n[18 31 48]\n\nArithmetic operations\n# addition of pols\n \nprint(pol + pol)\n \n# multiplication\nprint(pol * pol)\n \n# division\n \nprint(pol / pol) # returns quotient and remainder\n \n# square pols\nprint(pol ** 3)\n   2\n4 x + 6 x + 8\n   4      3      2\n4 x + 12 x + 25 x + 24 x + 16\n(poly1d([1.]), poly1d([0.]))\n   6      5       4       3       2\n8 x + 36 x + 102 x + 171 x + 204 x + 144 x + 64\n\npolyval\nnp.polynomial.polynomial.polyval([1,2,3, 4], [2, 3, 4])\narray([ 9., 24., 47., 78.])\n\nprint(pol(4))\n48\n\nIssue?\nprint(pol)\nprint(pol(2))\nprint(np.polynomial.polynomial.polyval(2, pol))\n# why both evaluations result different values?\n   2\n2 x + 3 x + 4\n18\n24.0\n\npolyfit\npolyfit is used to find the cofficient of a polynomial that best fits the given data points.\nFor example, there are data points such as (1, 1), (2, 1), (3, 4) and we need to find a polynomial that best fit these data points, we can use polyfit numpy method\nHow it finds the best fit polynomial?\nnumpy.polyfit uses least squares method.\n# data points\nx = np.array([1, 2, 3, 4], dtype=&quot;int64&quot;)\ny = np.array([2, 3, 5, 7], dtype=&quot;int64&quot;)\n# finding the coefficients using polyfit\n \ncoef = np.polynomial.polynomial.polyfit(x, y, 1)\ncoef\narray([-1.38690251e-16,  1.70000000e+00])\n\n# creating the polynomial\npol = np.poly1d(coef)\npol\npoly1d([-1.38690251e-16,  1.70000000e+00])\n\n_y_fit = np.polyval(coef, x) # another method\n_y_fit\narray([1.7, 1.7, 1.7, 1.7])\n\n# fitted y_axis\ny_fit = pol(x)\nimport matplotlib.pyplot as plt\nplt.scatter(x, y, label=&quot;Data points&quot;)\nplt.plot(x, y_fit, label=&quot;fitted line&quot;)\nplt.xlabel(&quot;x&quot;)\nplt.ylabel(&quot;y&quot;)\nplt.legend()\nplt.show()\nprint(y_fit)\n\n[1.7 1.7 1.7 1.7]\n\nOutputs\n\n\npoly1d creates the polynomial with takes a list coefficients. The number of coefficients determine the degree of the polynomial. The resultant polynomial can be evaluated by calling it as a function and passing value of x.\n\n\nnp.polyval and np.polynomial.polynomials.polyval work different and give different results. See the section of polyval.\n\n\nfor polyfit, need a better data points to work with.\n\n\n "},"notes/tech/numpy/notebook/polyfit":{"title":"polyfit","links":[],"tags":[],"content":"import numpy as np\nimport matplotlib.pyplot as plt\npolyfit\nObjective is to create a fit of a set of data points and plot it.\n1 degree polynomial\nx = np.array([1, 2, 3, 4])\ny = np.array([1, 2, 3, 4])\nfit = np.polyfit(x, y, 1)\nequation = np.poly1d(fit)\nx_points = np.linspace(1, 10, 100)\ny_points = equation(x_points)\nplt.figure(figsize=(4, 2))\nplt.plot(x, y, &#039;.&#039;)\nplt.plot(x_points, y_points, &#039;-r&#039;)\n[&lt;matplotlib.lines.Line2D at 0x14c8564d0&gt;]\n\n\n\n\n\n\n2 degree polynomial\ndegree_2_fit = np.polyfit(x, y, 2)\ndegree_2_eq = np.poly1d(degree_2_fit)\nprint(degree_2_eq)\n            2\n-4.958e-16 x + 1 x - 2.442e-15\n\ny_points = degree_2_eq(x_points)\nplt.figure(figsize=(4, 2))\nplt.plot(x, y, &#039;.&#039;, x_points, y_points, &#039;-r&#039;)\n[&lt;matplotlib.lines.Line2D at 0x14c7af670&gt;,\n &lt;matplotlib.lines.Line2D at 0x14c7afcd0&gt;]\n\n\n\n\n\n"},"notes/tech/numpy/numpy-flags":{"title":"numpy-flags","links":[],"tags":["libraries","python"],"content":"Numpy flags\nContains information about memory layout of the array.\narray.flags\n \n# C_CONTIGUOUS : True\n# F_CONTIGUOUS : True\n# OWNDATA : False\n# WRITEABLE : False\n# ALIGNED : True\n# WRITEBACKIFCOPY : False\nC and F contiguous defines the C or F style single contiguous segment.\nWRITEABLE inherits from the base array (view of another array). If view is created from non writeable array, then view is also non writeable and flag can’t be modified.\nIf the view is already created and base array becomes non writeable, still we can write to the view and base array changes."},"notes/tech/numpy/numpy-log":{"title":"numpy-log","links":[],"tags":["libraries","data","python"],"content":"np.log10\nnp.log10(100)\n# 2"},"notes/tech/numpy/ogrid":{"title":"ogrid","links":["notes/tech/numpy/mgrid","notes/tech/numpy/meshgrid"],"tags":["python","libraries","data"],"content":"np.ogrid\nThe way it is different than np.mgrid is that it does not include all the elements required for the grid. It returns 1D arrays and rest of the things lie on the numpy broadcasting.\nThis is called as open mesh grid.\nx, y = np.ogrid[0:5, 15:20]\nx, y\n(array([[0],\n        [1],\n        [2],\n        [3],\n        [4]]),\n array([[15, 16, 17, 18, 19]]))\nIt is memory efficient and performant than meshgrid and np.mgrid because it only uses 1D arrays."},"notes/tech/numpy/pad":{"title":"pad","links":[],"tags":["python","libraries"],"content":"np.pad\nPads the numpy array. By defaults it pads with constant value as shown below.\na = np.arange(5)\n \n# array([0, 1, 2, 3, 4])\nnp.pad(a, (1, 1))\n \n# array([0, 0, 1, 2, 3, 4, 0])\nLooking at the tuple (1, 1) says 1 left and 1 right.\nFor 2d array,\na = np.arange(4).reshape(2, 2)\n \n#array([[0, 1],\n#       [2, 3]])\n \nnp.pad(a, ((1, 1), (1, 1)))\n# array([[0, 0, 0, 0],\n#      [0, 0, 1, 0],\n#      [0, 2, 3, 0],\n#      [0, 0, 0, 0]])\nAgain looking at the tuple for each dimension\n\nfor dimension 0, it is one top and one bottom\nfor dimension 1, it one left and one right.\n"},"notes/tech/numpy/polynomials/poly1d":{"title":"poly1d","links":[],"tags":["libraries","python"],"content":"poly1d\nCreates polynomial given the coefficients. Number of coefficients determine the order of the polynomial.\npol = np.poly1d([2, 3, 4])\nprint(pol)\n#   2\n# 2 x + 3 x + 4\nPolynomial can be evaluated by giving x values to it.\npol(2)\n# 18\n \npol([1, 2, 3, 4])\n# array([ 9, 18, 31, 48])\nReferences\n\nnumpy.org/doc/stable/reference/generated/numpy.poly1d.html\n"},"notes/tech/numpy/polynomials/polyfit":{"title":"polyfit","links":[],"tags":["python","libraries"],"content":"polyfit\npolyfit is used to create a fitting polynomial for a given set of data x and y. It uses least square method to create the polynomial."},"notes/tech/numpy/see-also":{"title":"see-also","links":[],"tags":["later","misc"],"content":"See also\n\n C-order indexing\n"},"notes/tech/numpy/slicing":{"title":"slicing","links":[],"tags":["python","libraries"],"content":"Slicing\nSlicing consists three components, start:end:step. By default, start is 1, end is last and step is 1.\na = np.arange(10)\n \na[1:]\n# array([1, 2, 3, 4, 5, 6, 7, 8, 9])\n \na[:3]\n# array([0, 1, 2]), last index is not included.\n \na[::2]\n#  array([0, 2, 4, 6, 8]), element at each 2 step\nAdvance Slicing\nSlicing on multi-dimensional is bit tricky but useful. Following image is a better example to understand slicing on n-dimensional arrays.\n\nSlice Assignment\nAssignment can be done to array slices.\na[:8] = 10\n# a becomes  array([10, 10, 10, 10, 10, 10, 10, 10,  8,  9])\nReferences\n\nlectures.scientific-python.org/intro/numpy/array_object.html#indexing-and-slicing\n"},"notes/tech/numpy/strides":{"title":"strides","links":[],"tags":["libraries","python"],"content":"Strides\narray.strides gives the number of bytes need to be jumped to find the next elements on the corresponding dimensions.\na = np.arange(4).reshape((2, 2))\n \n# array([[0, 1],\n#      [2, 3]])\n       \na.strides\n# (16, 8)\nSo, 16 bytes for x-axis and 8 bytes for y-axis needs to be jumped to get to next element."},"notes/tech/numpy/transpose":{"title":"transpose","links":[],"tags":["libraries","python"],"content":"Transpose\nChange the axises of numpy arrays.\na = np.arange(2 * 5).reshape((2, 5))\n# array([[0, 1, 2, 3, 4],\n#       [5, 6, 7, 8, 9]])\n \na.transpose(1, 0)\n \n# array([[0, 5],\n#      [1, 6],\n#      [2, 7],\n#      [3, 8],\n#      [4, 9]])\n \ntranspose takes axises as arguments.\na.T\nAlso does the same thing. However, it only right shifts the axis and so the last axis becomes first.\n\n\n                  \n                  Note\n                  \n                \n\nTranspose returns view. However, reshape on the transposed array returns a new copy. (don’t know why!)\n\n"},"notes/tech/numpy/vectorize":{"title":"vectorize","links":[],"tags":["python","libraries"],"content":"Vectorize\nIt is used to create a vectorize function on the numpy array.\nBasic syntax\nnp.vectorize(user_def_fn)\nIt returns a vectorize function which access numpy array. Numpy then maps the array elements over the function.\nnums = np.arange(10)\nsquare = np.vectorize(lambda x: x * x)\nsquare(nums)\n# array([ 0,  1,  4,  9, 16, 25, 36, 49, 64, 81])\nsignature\nBy default function gets scaler value from the array and returns the scaler value as output. However, we can change this behavior using optional parameter signature.\nA signature specifies what nd array the function would accept and returns as output.\nnums = np.arange(4).reshape((2, 2))\n# array([[0, 1],\n#       [2, 3]])\n \nsquare_array = np.vectorize(lambda sub_array: sub_array ** 2, signature=&quot;(n)-&gt;(n)&quot;)\nsquare_array(nums)\nSignature (n) -&gt; (n) specifies that the function would take 1d array as input and returns 1d array as output. Signature specifies the shape of input and output array.\n(n, k) -&gt; (n) means the function takes 2d array as input and returns 1d array as output. If the function returns 2d array as output, the signature should be (n, k) -&gt; (x, y).\n\n\n                  \n                  Note: \n                  \n                \n\nThe variables used in input and output signature has not to be same by names.\n\n\nSignature (n),(n)-&gt;(),() specifies that the vectorized function takes two 1d arrays and return two scaler values"},"notes/tech/numpy/view":{"title":"view","links":[],"tags":["libraries","python","programming"],"content":"View\nWhen a new array is created after some operation on existing numpy array, a view is created which points to the same raw array data (data buffer).\nSome operation returns view and some returns array pointing to whole new data buffer.\nIt increase the performance of numpy as no new data is getting created.\nHowever, it has some implications as shown below.\na = np.arange(5)\n#array([0, 1, 2, 3, 4])\n \nb = a[:2]\n#array([0, 1])\n \na[0] = 133\n \n#array([133,   1,   2,   3,   4])\n \nb\n# array([133,   1])\nSo, changing the view modifies the original data buffer.\nnp.may_share_memory() can be used to verify if two arrays share the same memory buffer.\nnp.may_share_memory(a, b)\n# True\nReferences\n\nnumpy.org/doc/stable/glossary.html#term-view\n"},"notes/tech/shell-commands/arp":{"title":"arp","links":[],"tags":["command","shell"],"content":"arp\nAddress Resolution Display and control. It can be used to list all the ip and their mac addresses in the local network.\nFor example,\narp -a\n\n? (192.168.74.199) at &lt;mac address&gt; on en0 ifscope [ethernet]\n? (192.168.74.202) at &lt;mac address&gt; on en0 ifscope [ethernet]\n"},"notes/tech/singularity/container-fs":{"title":"container-fs","links":[],"tags":["inferences","docker"],"content":"Container File System\n\n$SINGULARITY_ROOTFS environment variables has the path to the container file system.\n"},"notes/tech/singularity/definition-file-sections":{"title":"definition-file-sections","links":[],"tags":["infrastructure","docker"],"content":"Sections\n\nmultiple sections with the same name can be included and will be appended to one another during the build process.\n\n%setup\n\nExecutes the commands on the host system after base operating system is installed in the container.\nThis section is usually not used as it is dangerous.\n\n%files\n\nThis section is used to copy files from host system to container. Also, from previous stage specified.\n%files section is executed before %post so that files are available while build process in %post.\nsource can be a path from host system or path in previous stage if specified. destination is the path in the container.\n\nif destination is not specified, source path is used for destination.\n\n\n\n# copying file from host to container\n%files\n/from-host /to-container\n\n# copying file from previous stage to current container\n%files prev_stage\n/from /to-container\n"},"notes/tech/singularity/defintion-file-header":{"title":"defintion-file-header","links":[],"tags":["infrastructure","docker"],"content":"Header\nContains information about the base operating system to be used to build container. It is written on the top of def file.\nBootstrap key needs to have a bootstrap agent that will be used to create base operating system.\n“"},"notes/tech/slurm/run-slurm-script":{"title":"run-slurm-script","links":[],"tags":["distributed-computing","parallelism"],"content":"Slurm Script\nA slurm script is used to run a set of slurm job steps. It can be submitted using sbatch command.\nLet’s try running following slurm script.\nslurm.script\n#!/bin/sh\n#SBATCH --time=1\n/bin/hostname\nsrun -l /bin/hostname\nsrun -l /bin/pwd\n\nThis script prints hostname of the node the script is scheduled and host names and pwd of nodes where other jobs will be run.\nsbatch -n2 --output output.txt slurm.script\n"},"notes/tech/slurm/slurm-overview":{"title":"slurm-overview","links":[],"tags":["distributed-computing","parallelism"],"content":"Slurm\nSlurm is a fault-tolerant, highly scalable cluster management and job scheduling system for large and small linux clusters. As a workload manager, it handles allocation of resources, scheduling and monitoring jobs.\nComponents\nThe key components of slurm are\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nComponentDescriptionslurmctldSlurm control daemon which runs on management node.It is responsible for managing the resources, scheduling and monitoring of jobs etc.There can be multiple slurm control daemons running incase anyone fails to operate.slurmdThese are slurm worker nodes which perform the task. slurmd daemon runs on each worker node.slurmdbdSlurm database daemon for maintaining database of jobs, resources etc.CommandsCommands such as scontrol, sbatch, squeue, srun etc.\n\n\n\n\n\n\n\n\n\n\n\nFig: Slurm architecture\nResources\n\nslurm.schedmd.com/quickstart.html\n"},"notes/tech/spack/create-package-recipe":{"title":"create-package-recipe","links":[],"tags":["packages"],"content":"Spack Package Recipe\nPackage recipe defines the logic for package build. Spack follows the instructions and installs the package.\nWe can start creating package recipe with command,\nspack create --name python-cli-app github.com/nitinsharmacs/python-cli-app\n\nwhere --name specifies package name followed by link.\nThis will create package directory in repo with a boilerplate package.py, selected by spack. We can check the selected repo using command\nspack repo list\n\nwhichever comes on top takes the precedence.\nFollowing is the modified package.py.\npackage.py\nfrom spack.package import *\n \n \nclass PythonCliApp(PythonPackage):\n    &quot;Python cli app spack package.&quot;\n \n    # FIXME: Add a proper url for your package&#039;s homepage here.\n    homepage = &quot;github.com/nitinsharmacs/python-cli-app&quot;\n    url = &quot;github.com/nitinsharmacs/python-cli-app&quot;\n    git = &quot;github.com/nitinsharmacs/python-cli-app.git&quot;\n \n    # FIXME: Add a list of GitHub accounts to\n    # notify when the package is updated.\n    # maintainers(&quot;nitinsharmacs&quot;)\n \n    # FIXME: Add the SPDX identifier of the project&#039;s license below.\n    # See spdx.org/licenses/ for a list. Upon manually verifying\n    # the license, set checked_by to your Github username.\n \n    # FIXME: Add proper versions and checksums here.\n    version(&quot;0.1.0&quot;, tag=&quot;v0.1.0&quot;)\n \n    # FIXME: Add dependencies if required.\n    # depends_on(&quot;foo&quot;)\n    depends_on(&quot;python@3.10&quot;, type=(&quot;build&quot;, &quot;run&quot;))\n    depends_on(&quot;py-poetry-core&quot;, type=&quot;build&quot;)\nOnce all the required information is added in package file, we can install it and use it.\nspack install python-cli-app\n\nspack load python-cli-app\n\nThis should make executables accessible in the current process."},"notes/tech/spack/dependencies-graph":{"title":"dependencies-graph","links":[],"tags":["command"],"content":"spack graph\ngraph command gives the graphical representation of package dependencies.\nspack graph mysql\n\nTo create pdf of graph, we can use\nspack graph --dot mysql | dot -Tpdf &gt; dependencies.pdf\n"},"notes/tech/spack/find-command":{"title":"find-command","links":[],"tags":["command"],"content":"spack find\nfind command is used to find the specified package. It can take options like -l for showing hashes for the package and its dependencies, -f for showing the compiler being used to compile the package and its dependencies.\nspack find -l mysql\n\n-- linux-ubuntu22.04-zen3 / gcc@12.3.0 --------------------------\nnlf6uyf mysql@8.0.35\n==&gt; 1 installed package\n\nnlf6uyf is the hash.\nspack find -f mysql\n\n-- linux-ubuntu22.04-zen3 / gcc@12.3.0 --------------------------\nmysql@8.0.35%gcc\n==&gt; 1 installed package\n\nThese options can be used combined.\nspack find -fl mysql\n\n-- linux-ubuntu22.04-zen3 / gcc@12.3.0 --------------------------\nnlf6uyf mysql@8.0.35%gcc\n==&gt; 1 installed package\n\nTo show the dependencies in the package, we can use flag -d.\nspack find -d mysql\n\n-- linux-ubuntu22.04-zen3 / gcc@12.3.0 --------------------------\nmysql@8.0.35\n    bison@3.8.2\n        diffutils@3.10\n        m4@1.4.19\n            libsigsegv@2.14\n    boost@1.77.0\n        bzip2@1.0.8\n        icu4c@74.2\n            autoconf@2.72\n            automake@1.16.5\n            libtool@2.4.7\n        xz@5.4.6\n    cmake@3.31.0\n    curl@8.10.1\n        nghttp2@1.64.0\n    doxygen@1.12.0\n        flex@2.6.3\n            findutils@4.9.0\n        python@3.13.0\n            expat@2.6.4\n                libbsd@0.12.2\n                    libmd@1.0.4\n            gdbm@1.23\n            libffi@3.4.6\n            readline@8.2\n            util-linux-uuid@2.40.2\n        spdlog@1.14.1\n            fmt@11.0.2\n        sqlite@3.46.0\n    gcc-runtime@12.3.0\n    glibc@2.35\n    gmake@4.4.1\n    libedit@3.1-20240808\n    libevent@2.1.12\n    libtirpc@1.3.3\n        krb5@1.21.3\n    lz4@1.10.0\n    ncurses@6.5\n    openssl@3.4.0\n        ca-certificates-mozilla@2023-05-30\n        perl@5.40.0\n            berkeley-db@18.1.40\n    patchelf@0.17.2\n    pkgconf@2.2.0\n    rpcsvc-proto@1.4.4\n        gettext@0.22.5\n            libxml2@2.13.4\n            tar@1.35\n                pigz@2.8\n    zlib-ng@2.2.1\n    zstd@1.5.6\n\n==&gt; 1 installed package\n\nWe can use -p flag to know the path of the installed package.\nspack find -p mysql\n\n-- linux-ubuntu22.04-zen3 / gcc@12.3.0 --------------------------\nmysql@8.0.35  /home/user/spack/opt/spack/linux-ubuntu22.04-zen3/gcc-12.3.0/mysql-8.0.35-nlf6uyfszhie4qx52ixmoaj76yshtxm4\n==&gt; 1 installed package\n\nReferences\n\nspack-tutorial.readthedocs.io/en/latest/tutorial_basics.html#:~:text=The-,spack%20find,-command%20is%20used\n\n"},"notes/tech/spack/loading-unloading-packages":{"title":"loading-unloading-packages","links":[],"tags":["command"],"content":"Loading/Unloading Spack Packages\nSpack load command is used to load packages. It changes the PATH variable so that package executables becomes available.\nspack load mysql\n\nmysql becomes available.\nSpack unload command can be used to unload the packages.\nspack unload mysql\n\nmysql becomes unavailable."},"notes/tech/spack/spec":{"title":"spec","links":[],"tags":["packages"],"content":"Specs\nSpecs are descriptors used to provide more information while installing spack packages. For example, package name, providing a specific version of the package using @, compiler using % and compiler options etc.\nmpileaks @1.2:1.4 %gcc@4.7.5 +debug -qt target=x86_64 ^callpath @1.1 %gcc@4.7.2\n\nAbove command can be described as, install package mpileaks of version in between 1.2 and 1.4 built using gcc of version 4.7.5 for architecture x86_64 with debug option enabled and Qt  option disabled. Additionally using dependency callpath of version 1.1 built using gcc of version 4.7.2.\nSpec consists of following pieces.\n\npackage name which is mandatory.\nversion using @ which works for both package and compiler.\n% to specify the compiler for both package and dependencies. It sould come just after the package name and whatever dependencies.\n+, -, or ~ variant specifiers.\nname=&lt;value&gt; optional compiler flags.\ntarget=&lt;value&gt; or os=&lt;value&gt; for architecture information.\n^ to specify dependencies.\n\nReferences\n\nspack.readthedocs.io/en/latest/basic_usage.html#sec-specs\n"},"notes/tech/xarray-cuda/xarray-cuda":{"title":"xarray-cuda","links":[],"tags":["libraries","gpu","python"],"content":"Observations\n\nCuda Array works same as numpy array.\nHowever, some of the functionality where xarray more specific to numpy array, operations on cuda arrays give error.\n\nFor example, xarray.apply_ufunc with vectorize param give error when operated on cuda arrays as internally xarray.apply_ufunc -&gt; dask.array.gufunc.apply_gufunc uses np.vectorize\nAlso, passing cuda vectorize function to xarray.apply_ufunc doesn’t work. Looks like they have not implemented it yet.\npassing signature is not yet implemented for cuda vectorize\n\n\n"},"notes/tech/xarray/apply_ufunc-dask-vectorize":{"title":"apply_ufunc-dask-vectorize","links":["notes/tech/xarray/apply_ufunc-dask"],"tags":["libraries","python"],"content":"Vectorize Dask Xarray\nVectorization for dask xarray works only when we give dask=parallelized parameter.\nFrom the note we saw that dask.array.apply_gufunc provides chunk blocks to custom function. When vectorize is provided, numpy vectorization happens on the custom function.\nSo the flow of execution is as follows,\nxarray.apply_ufunc\n        |\n        V\ndask.array.apply_gufunc\n        |\n        V\nnp.vectorize\n        |\n        V\ncustom function\n\nFor example,\ndata\n# &lt;xarray.DataArray &#039;air&#039; (time: 2, lat: 5, lon: 5)&gt; Size: 400B dask.array&lt;rechunk-merge, shape=(2, 5, 5), dtype=float64, chunksize=(1, 5, 5), chunktype=numpy.ndarray&gt;\n \n \ndef add_wrapper(d, value):\n     print(&#039;------------------- START ---------------------&#039;)\n     print(type(d))\n     print(d.shape)\n     print(d)\n     print(&#039;-------------------- END ------------------------&#039;)\n     return d + value\n \n \nxr.apply_ufunc(add_wrapper, \n               data, \n               1, \n               input_core_dims=[[&quot;lon&quot;], []], \n               output_core_dims=[[&quot;lon&quot;]], \n               dask=&quot;parallelized&quot;, \n               vectorize=True).compute()\n \n# ------------------- START ---------------------\n# &lt;class &#039;numpy.ndarray&#039;&gt;\n# (1,)\n# [1.]\n# -------------------- END ------------------------\n# ------------------- START ---------------------\n# &lt;class &#039;numpy.ndarray&#039;&gt;\n# (5,)\n# [242.1  242.7  243.1  243.39 243.6 ]\n# -------------------- END ------------------------\n# ------------------- START ---------------------\n# &lt;class &#039;numpy.ndarray&#039;&gt;\n# (5,)\n# [243.6 244.1 244.2 244.1 243.7]\n# -------------------- END ------------------------\n# ------------------- START ---------------------\n# &lt;class &#039;numpy.ndarray&#039;&gt;\n# (5,)\n# [253.2  252.89 252.1  250.8  249.3 ]\n# -------------------- END ------------------------\n# ------------------- START ---------------------\n# &lt;class &#039;numpy.ndarray&#039;&gt;\n# (5,)\n# [269.7 269.4 268.6 267.4 266. ]\n# -------------------- END ------------------------\n# ------------------- START ---------------------\n# &lt;class &#039;numpy.ndarray&#039;&gt;\n# (5,)\n# [272.5 271.5 270.4 269.4 268.5]\n# -------------------- END ------------------------\n# ------------------- START ---------------------\n# &lt;class &#039;numpy.ndarray&#039;&gt;\n# (5,)\n# [241.2 242.5 243.5 244.  244.1]\n# -------------------- END ------------------------\n# ------------------- START ---------------------\n# &lt;class &#039;numpy.ndarray&#039;&gt;\n# (5,)\n# [243.8  244.5  244.7  244.2  243.39]\n# -------------------- END ------------------------\n# ------------------- START ---------------------\n# &lt;class &#039;numpy.ndarray&#039;&gt;\n# (5,)\n# [250.   249.8  248.89 247.5  246.  ]\n# -------------------- END ------------------------\n# ------------------- START ---------------------\n# &lt;class &#039;numpy.ndarray&#039;&gt;\n# (5,)\n# [266.5 267.1 267.1 266.7 265.9]\n# -------------------- END ------------------------\n# ------------------- START ---------------------\n# &lt;class &#039;numpy.ndarray&#039;&gt;\n# (5,)\n# [274.5  274.29 274.1  274.   273.79]\n# -------------------- END ------------------------\n# &lt;xarray.DataArray &#039;air&#039; (time: 2, lat: 5, lon: 5)&gt; Size: 400B\n# array([[[242.2 , 243.5 , 244.5 , 245.  , 245.1 ],\n#         [244.8 , 245.5 , 245.7 , 245.2 , 244.39],\n#         [251.  , 250.8 , 249.89, 248.5 , 247.  ],\n#         [267.5 , 268.1 , 268.1 , 267.7 , 266.9 ],\n#         [275.5 , 275.29, 275.1 , 275.  , 274.79]],\n \n#        [[243.1 , 243.7 , 244.1 , 244.39, 244.6 ],\n#         [244.6 , 245.1 , 245.2 , 245.1 , 244.7 ],\n#         [254.2 , 253.89, 253.1 , 251.8 , 250.3 ],\n#         [270.7 , 270.4 , 269.6 , 268.4 , 267.  ],\n#         [273.5 , 272.5 , 271.4 , 270.4 , 269.5 ]]])\nVectorized custom functions is called with 1d array of dim lon 10 times because there are two chunks (1, 5, 5) and (1, 5, 5) and we have broadcasted on dims time and lat. So, function is called with 1d array of 5 elements 10 (1, 5) + (1, 5) = 10\nReferences\n\ntutorial.xarray.dev/advanced/apply_ufunc/dask_apply_ufunc.html#automatic-vectorizing\n"},"notes/tech/xarray/apply_ufunc-dask":{"title":"apply_ufunc-dask","links":[],"tags":["python","libraries"],"content":"apply_ufunc with dask arrays\napply_ufunc handles dask xarray in same manner as it does with numpy xarray. However, it requires an dask argument` to work with dask xarrays.\nxr.apply_ufunc(xda, dask=&#039;allowed&#039;)\ndask parameter\n\ndask=forbidden gives error when dask xarray is given.\ndask=allowed is when given function is able to handle dask array as input.\ndask=parallelized is when function is not able to handle dask array and want xarray.apply_ufunc to make function work with dask arrays.\n\nWorking with non-dask functions\nWhen function doesn’t support dask xarrays, we can use dask=parallelized argument for xr.apply_ufunc.\nHow it works?\n\nxarray.apply_ufunc uses dask.array.apply_gufunc internally.\nunderlying dask array is passed to apply_gufunc.\napply_gufunc then passes each chunk block numpy array to custom function.\ndask stitches back all the output chunk array from custom function.\nxarray then populates meta information to the output array.\n\n\n\n                  \n                  Warning\n                  \n                \n\nIf data is chunked on a core dimension the custom function is working on, executing such operations give error.\n\n\nFor example,\nds.air\n# &lt;xarray.DataArray &#039;air&#039; (time: 2920, lat: 25, lon: 53)&gt; Size: 31MB dask.array&lt;open_dataset-air, shape=(2920, 25, 53), dtype=float64, chunksize=(100, 25, 53), chunktype=numpy.ndarray&gt;\n \n \nxr.apply_ufunc(mean, ds.air, input_core_dims=[&quot;time&quot;](&quot;time&quot;), kwargs={&quot;axis&quot;: -1}, dask=&quot;parallelized&quot;)\n \n# dimension time on 0th function argument to apply_ufunc with dask=&#039;parallelized&#039; consists of multiple chunks, but is also a core dimension. To fix, either rechunk into a single array chunk along this dimension, i.e., ``.chunk(dict(time=-1))``, or pass ``allow_rechunk=True`` in ``dask_gufunc_kwargs`` but beware that this may significantly increase memory usage.\nData is chunked across time dimension and providing time as core dimension raises the error. The data has to be re-chunked if we don’t want this error. This can be done by providing argument for dask.apply_gufunc.\n  def mean(d, **kwargs):\n     print(&#039;------------------- START ---------------------&#039;)\n     print(type(d))\n     print(d.shape)\n     print(&#039;-------------------- END ------------------------&#039;)\n     return np.mean(d, **kwargs)\nxr.apply_ufunc(mean,\n               ds.air,\n               input_core_dims=[&quot;time&quot;](&quot;time&quot;), \n               kwargs={&quot;axis&quot;: -1}, \n               dask_gufunc_kwargs={&quot;allow_rechunk&quot;:True},\n               dask=&quot;parallelized&quot;)\nHowever, this is consumes more memory.\nTo determine the effect of the function on the input, dask first runs the function with dummy data as shown below.\nxr.apply_ufunc(mean, \n               ds.air, \n               input_core_dims=[&quot;lon&quot;](&quot;lon&quot;), \n               kwargs={&quot;axis&quot;: -1}, dask=&quot;parallelized&quot;)\n \n# ------------------- START ---------------------\n# &lt;class &#039;numpy.ndarray&#039;&gt;\n# (1, 1, 1)\n# -------------------- END ------------------------\n#&lt;xarray.DataArray &#039;air&#039; (time: 2920, lat: 25)&gt; Size: 584kB dask.array&lt;transpose, shape=(2920, 25), dtype=float64, chunksize=(100, 25), chunktype=numpy.ndarray&gt;\nReferences\n\ntutorial.xarray.dev/advanced/apply_ufunc/dask_apply_ufunc.html#understanding-what-s-happening\n"},"notes/tech/xarray/apply_ufunc":{"title":"apply_ufunc","links":[],"tags":["libraries","python"],"content":"apply_ufunc\nXarray method that applies custom function on underlying array in xarray. The underlying array can be a numpy or a dask array (need verification).\nHow it works?\n\nWhen xarray DataArray is given to apply_ufunc, it gets the underlying array, and passes to the custom function. Custom function returns the result array which again wrapped by apply_ufunc and returned to us.\nWhen xarray DataSet is given, it loops over the data variables(DataArray), passes each of the data array to the custom function, gets the result array and wraps in Data Array and then in Data set and returns.\nAll the input DataSet/DataArray metadata gets populated on the result by apply_ufunc.\nBy default, attributes are not populated on the result but can retained using keep_attrs=True.\n\n\n\n                  \n                  Note \n                  \n                \n\nvectorize=True doesn’t work when input array is a dask array.\n\n\nSyntax\nIt is the minimal syntax\nxr.apply_ufunct(custom_function, dataset/dataarray, pos_args, kwargs={}, keep_attrs=True)\ninput_core_dims\n\nThis parameter takes the dimensions to which the function would be operated on.\nspecified dimensions are moved to last. for example, input_core_dims=[&quot;time&quot;](&quot;time&quot;) will be moved to last dimension.\n\nReferences\n\ntutorial.xarray.dev/advanced/apply_ufunc/simple_numpy_apply_ufunc.html\n"},"notes/tech/xarray/core-dimensions":{"title":"core-dimensions","links":["notes/tech/xarray/apply_ufunc"],"tags":["data","python","libraries"],"content":"Core Dimensions\nFundamental dimensions over which an operation is defined.\nWhy core dimensions?\n\napply_ufunc is used to create generalized operations on xarray data.\nCore dimensions specifies which are the main dimensions the function will be operating with.\nCore dimensions are moved to last index (transposed).\n\nFor example,\nda.shape\n# (2, 3, 4)\n \ndef func(d):\n    print(d.shape)\n    return d\n \nxr.apply_ufunc(func, da, input_core_dims=[&quot;first_dim&quot;](&quot;first_dim&quot;))\n \n# (3, 4, 2)\n\n\n                  \n                  Todo\n                  \n                \n\nUnderstand the use of core dimensions in case of vectorise=True\n\n\nReferences\n\ntutorial.xarray.dev/advanced/apply_ufunc/core-dimensions.html\n"},"notes/tech/xarray/loop-dimensions":{"title":"loop-dimensions","links":["notes/tech/xarray/core-dimensions","notes/tech/xarray/apply_ufunc"],"tags":["python","data","libraries"],"content":"Loop Dimensions\nFunctions that performs operations on data with core-dimensions and taking axis as argument, can be easily used with apply_ufunc.\nHowever, functions which don’t take axis argument and need to work on core-dimensions need loop dimensions. Loop dimension is something where the loop happens and function gets the sub-array as input.\nFor example, a 2d data array with dimensions x and y and square needs to work on only y, we need to loop over x so that function can get only 1d array on dimension y.\ndef square(item):\n    return item ** 2\n    \nxr.apply_ufunc(square,\n               xda,\n               input_core_dims=[&quot;y&quot;](&quot;y&quot;), \n               output_core_dims=[&quot;y&quot;](&quot;y&quot;), \n               vectorize=True)\nsquare gets 1d array of dimension y. input_core_dims provides the core dimensions function will take and dimensions which are not provided will be taken as loop dimensions (which is x) here.\nReferences\n\ntutorial.xarray.dev/advanced/apply_ufunc/automatic-vectorizing-numpy.html#core-dimensions-and-looping\n\n"},"notes/tech/xarray/map_blocks":{"title":"map_blocks","links":[],"tags":["python","libraries","parallelism"],"content":"xarray.map_blocks\nIt applies custom function on each chunk block of the DataArray or Dataset.\ndef add_wrapper(d):\n    print(&#039;------------------- START ---------------------&#039;)\n    print(type(d))\n    print(d.shape)\n    print(d)\n    print(&#039;-------------------- END ------------------------&#039;)\n    return d + 1\n \nxda = ds.air[:2, :5, :5].chunk({&quot;time&quot;: 1})\n \n xr.map_blocks(add_wrapper, ds.air).compute()\nOutput\n------------------- START ---------------------\n&lt;class &#039;xarray.core.dataarray.DataArray&#039;&gt;\n(0, 0, 0)\n&lt;xarray.DataArray &#039;air&#039; (time: 0, lat: 0, lon: 0)&gt; Size: 0B\narray([], shape=(0, 0, 0), dtype=float64)\n-------------------- END ------------------------\n------------------- START ---------------------\n&lt;class &#039;xarray.core.dataarray.DataArray&#039;&gt;\n(1, 5, 5)\n&lt;xarray.DataArray &#039;air&#039; (time: 1, lat: 5, lon: 5)&gt; Size: 200B\narray([[[241.2 , 242.5 , 243.5 , 244.  , 244.1 ],\n        [243.8 , 244.5 , 244.7 , 244.2 , 243.39],\n        [250.  , 249.8 , 248.89, 247.5 , 246.  ],\n        [266.5 , 267.1 , 267.1 , 266.7 , 265.9 ],\n        [274.5 , 274.29, 274.1 , 274.  , 273.79]]])\n-------------------- END ------------------------\n------------------- START ---------------------\n&lt;class &#039;xarray.core.dataarray.DataArray&#039;&gt;\n(1, 5, 5)\n&lt;xarray.DataArray &#039;air&#039; (time: 1, lat: 5, lon: 5)&gt; Size: 200B\narray([[[242.1 , 242.7 , 243.1 , 243.39, 243.6 ],\n        [243.6 , 244.1 , 244.2 , 244.1 , 243.7 ],\n        [253.2 , 252.89, 252.1 , 250.8 , 249.3 ],\n        [269.7 , 269.4 , 268.6 , 267.4 , 266.  ],\n        [272.5 , 271.5 , 270.4 , 269.4 , 268.5 ]]])\n-------------------- END ------------------------\nOut[40]:\n&lt;xarray.DataArray &#039;air&#039; (time: 2, lat: 5, lon: 5)&gt; Size: 400B\narray([[[242.2 , 243.5 , 244.5 , 245.  , 245.1 ],\n        [244.8 , 245.5 , 245.7 , 245.2 , 244.39],\n        [251.  , 250.8 , 249.89, 248.5 , 247.  ],\n        [267.5 , 268.1 , 268.1 , 267.7 , 266.9 ],\n        [275.5 , 275.29, 275.1 , 275.  , 274.79]],\n\n       [[243.1 , 243.7 , 244.1 , 244.39, 244.6 ],\n        [244.6 , 245.1 , 245.2 , 245.1 , 244.7 ],\n        [254.2 , 253.89, 253.1 , 251.8 , 250.3 ],\n        [270.7 , 270.4 , 269.6 , 268.4 , 267.  ],\n        [273.5 , 272.5 , 271.4 , 270.4 , 269.5 ]]])\n\nObservations\n\nFunction add_wrapper receives loaded DataArray.\nmap_blocks calls function first time with random data for output type inferencing. If it is not able to determine the type, we need explicitly specify type using template kwarg.\nSo in the above example, the function is called three times.\n\nOne for inference\nFirst chunk\nSecond chunk\n\n\n\n"},"notes/tech/xarray/xarray-so-far":{"title":"xarray-so-far","links":[],"tags":["libraries","python"],"content":"\nxarray is made on top of numpy by adding more information about the nature of data.\nadding lables to the dimensions. Instead of just raw dimension, xarray added name to them such as time, longitude, etc.\n\n"},"notes/tech/xarray/xarray-with-dask":{"title":"xarray-with-dask","links":[],"tags":["libraries","python","data-engineering"],"content":"Xarray with Dask\nXarray is numpy array with metadata and accessing the array with metadata.\nXarray does the computations in memory so has the limitation on data size.\nDask enables xarray to compute with big data with in disk computation like spark.\nDask makes the computation parallel using chunking method.\nXarray fits well with numpy as data array and dask array. Underling array can be a numpy or a dask.\nd = xr.DataArray(np.arange(10)) # numpy array\n \nb = xr.open_dataset(&quot;file.nc&quot;, chunks={&quot;dim_0&quot;: 1}) # dask array\nopen_dataset method reads netCDF files.\nReferences\n\nstephanhoyer.com/2015/06/11/xray-dask-out-of-core-labeled-arrays/\n"}}